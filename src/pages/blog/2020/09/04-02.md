---
title        : ã‚¤ãƒãƒ‰ã‚­ã¯ Webpack ã˜ã‚ƒãªãã¦ Rollup ã ï¼Terser ã¨ã¨ã‚‚ã« Rollup ã‚’ä½¿ã£ã¦ã¿ã‚‹
created      : 2020-09-04
last-modified: 2020-09-04
header-date  : true
path:
  - /index.html Neo's World
  - /blog/index.html Blog
  - /blog/2020/index.html 2020å¹´
  - /blog/2020/09/index.html 09æœˆ
hidden-info:
  original-blog: Corredor
---

Webpack ãªã‚“ã‹ã¨åŒã˜ãƒ“ãƒ«ãƒ‰ãƒ»ãƒãƒ³ãƒ‰ãƒ«ãƒ„ãƒ¼ãƒ«ã® __Rollup__ ã‚’ä½¿ã£ã¦ã¿ã‚‹ã€‚

## ç›®æ¬¡

## Rollup ã¨ Webpack ã®é•ã„

åŒã˜ãƒãƒ³ãƒ‰ãƒ«ãƒ„ãƒ¼ãƒ«ã§ã‚ã‚‹ Webpack ã¨ Rollup ã®ç‰¹å¾´ã‚’æ¯”ã¹ã¦ã¿ã‚‹ã€‚

- å‚è€ƒï¼š[Webpackã¨Rollupã‚’æ¯”ã¹ã¦ã¿ã¦ - Qiita](https://qiita.com/jkr_2255/items/63b6926ebbef5d3e979b)
  - CommonJS : `require` ã¨ `module.exports`
  - ES6 (ES2015) : `import` ã¨ `export`
  - Webpack ã¯ CommonJS ã—ã‹èªè­˜ã§ããªã„
- å‚è€ƒï¼š[webpackã¨Rollupï¼šä¼¼ã¦éãªã‚‹ã‚‚ã® | POSTD](https://postd.cc/webpack-and-rollup-the-same-but-different/)
  - Rollup ã¯ ES2015 ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ä»•çµ„ã¿ã‚’æ´»ã‹ã™ä½œã‚Š
  - ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ã¯ Rollup ãŒå‘ã„ã¦ã„ã‚‹
- å‚è€ƒï¼š[RollupãŒã¡ã‚‡ã†ã©ã„ã„æ„Ÿã˜ - Qiita](https://qiita.com/cognitom/items/e3ac0da00241f427dad6)
  - Rollup ã¯å†…éƒ¨çš„ã« ES6 ã§æ‰±ã†
- å‚è€ƒï¼š[rollup ãŒæ±‚ã‚ã¦ãŸã‚‚ã®ã ã£ãŸã‹ã‚‚ã—ã‚Œãªã„](http://var.blog.jp/archives/79902630.html)
  - Export ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆåˆ¥æ¯”è¼ƒ

_Webpack ã¯ CommonJS ã§èªè­˜_ã—ã€__Rollup ã¯ ES Modules ã§æ‰±ã†__ã€ã¨ã„ã†ã®ãŒå¤§ããªé•ã„ã‹ã€‚ECMAScript ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®é•ã„ã ã‘ã§ãªãã€ã‚³ãƒ¬ãŒ Tree-Shaking ãªã©ã«åŠ¹ã„ã¦ãã‚‹ã®ã§ã€ãƒãƒ³ãƒ‰ãƒ«åŠ¹ç‡ã«å·®ãŒå‡ºã¦ãã‚‹ã‚ˆã†ã ã€‚

## Transpiler ã¨ Minifier ã¨ã®åŒºåˆ¥

Rollup ã‚„ Webpack ã¯ _Bundler_ ã§ã‚ã‚‹ãŒã€Babel ã¯ Transpiler ã ã—ã€å¾Œã§ä½¿ã† Terser ã¯ Minifier ã ã€‚ã“ã‚Œã‚‰ã®åŒºåˆ¥ã‚’ã—ã£ã‹ã‚Šä»˜ã‘ã¦ãŠã“ã†ã€‚

- Bundler
  - `export`ãƒ»`import` ã§è¤‡æ•°ã«åˆ¥ã‚Œã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ãŸã¡ã‚’1ãƒ•ã‚¡ã‚¤ãƒ«ã«æŸã­ã‚‹
- Transpiler
  - æ–°ã—ã„ä»•æ§˜ã®ã‚³ãƒ¼ãƒ‰ã‚’å¤ã„ä»•æ§˜ã®ã‚³ãƒ¼ãƒ‰ã«å¤‰æ›ã™ã‚‹
- Minifier
  - ã‚³ãƒ¼ãƒ‰ã‚’åœ§ç¸®ã—ãŸã‚Šé›£èª­åŒ–ã—ãŸã‚Šã™ã‚‹

ç´ äººè€ƒãˆã ã¨ã€ŒBundler ã§æŸã­ã¦ â†’ Transpiler ã§å½¢å¼ç›´ã—ã¦ â†’ Minifier ã§åœ§ç¸®ã™ã‚Œã°ãˆãˆã‚“ã¡ã‚ƒã†ã®ï¼Ÿã€ã¨æ€ã£ã¦ã—ã¾ã†ãŒã€å®Ÿéš›ã®ã¨ã“ã‚ã¯ãã†ç°¡å˜ã«ã‚‚ã„ã‹ãªã„ã‚ˆã†ã ã€‚

- å‚è€ƒï¼š[plugins/packages/babel at master Â· rollup/plugins Â· GitHub](https://github.com/rollup/plugins/tree/master/packages/babel#why)

ä½•ã‚’ä»˜ã‘è¶³ã—ã€ä½•ã‚’å–ã‚Šé™¤ã„ã¦ã„ã„ã‹ã€ã¨ã„ã†åˆ¤æ–­ãŒè¤‡é›‘ã«ãªã‚Šã€Source Map ã‚’ä½œã‚‹ã®ãŒå›°é›£ã ã£ãŸã‚Šã™ã‚‹ã‚‰ã—ã„ã€‚

ãã®è¾ºã‚’è§£æ¶ˆã™ã‚‹ãŸã‚ã«ã€Webpack ã‚„ Rollup ã¯ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã¨ã„ã†å½¢ã§ã€Babel ã‚„ Terser ã‚’çµ„ã¿è¾¼ã‚ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã‚‹ã‚ˆã†ã ã€‚

- å‚è€ƒï¼š[å€‹äººçš„ã«Terser & Babelã®å¥½ããªã¨ã“ã‚ Â· GitHub](https://gist.github.com/shqld/d101cae50dd83ab7d3487cdb10b80f4d)

## Rollup ã‚’è©¦ã—ã¦ã¿ã‚‹

æ¦‚å¿µã‚’æ•´ç†ã—ãŸã¨ã“ã‚ã§ã€Rollup ã‚’ä½¿ã£ã¦ã¿ã‚‹ã€‚å…¬å¼ã®ã‚¬ã‚¤ãƒ‰ã‚’å‚è€ƒã«ã€‚

- å‚è€ƒï¼š[rollup.js](https://rollupjs.org/guide/en/)

é©å½“ãªä½œæ¥­ç”¨ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œã‚Šã€`rollup` ã‚³ãƒãƒ³ãƒ‰ãŒãƒ­ãƒ¼ã‚«ãƒ«ã§å‹•ãã“ã¨ã‚’ç¢ºèªã™ã‚‹ã€‚

```bash
$ npm init -y
$ npm install -D rollup
$ npx rollup
```

ãã—ãŸã‚‰æ¬¡ã®ã‚ˆã†ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œã£ã¦ã¿ã‚‹ã€‚

- `src/index.mjs`

```javascript
import hoge from './hoge.mjs';
import fuga from './fuga.mjs';

new hoge().hello();
console.log(fuga);
```

- `src/hoge.mjs`

```javascript
export default class hoge {
  hello() {
    console.log('Hello');
  }
}
```

- `src/fuga.mjs`

```javascript
const fuga = {
  a: 'a',
  b: 'b'
};
export default fuga;
```

ES Modules ã®ä»•çµ„ã¿ã§å®Ÿè£…ã—ã¦ã„ã‚‹ã®ã§ã€æ‹¡å¼µå­ã¯ `.mjs` ã§ã€`require` ã§ã¯ãªã `import` ã‚’ä½¿ã£ã¦ã„ã‚‹ã€‚

ã‚³ãƒ¬ã‚’ Rollup ã§æŸã­ã¦ã¿ã‚‹ã€‚

```bash
$ npx rollup src/index.mjs

src/index.mjs â†’ stdout...
class hoge {
  hello() {
    console.log('Hello');
  }
}

const fuga = {
  a: 'a',
  b: 'b'
};

new hoge().hello();
console.log(fuga);
```

`src/hoge.mjs` ã¨ `src/fuga.mjs` ã®å†…å®¹ãŒæ··ãœè¾¼ã¾ã‚Œã¦ã€1ã¤ã«ãªã£ãŸã€‚

ç¶šã„ã¦ _IIFE (Immediately Invoked Function Expressionãƒ»å³æ™‚å®Ÿè¡Œé–¢æ•°å¼)_ ã®å½¢å¼ã§å‡ºåŠ›ã—ã¦ã¿ã‚‹ã€‚

```bash
$ npx rollup src/index.mjs --format='iife'

src/index.mjs â†’ stdout...
(function () {
  'use strict';

  class hoge {
    hello() {
      console.log('Hello');
    }
  }

  const fuga = {
    a: 'a',
    b: 'b'
  };

  new hoge().hello();
  console.log(fuga);

}());
```

ã‚³ãƒãƒ©ã¯å³æ™‚é–¢æ•°ã®ä¸­ã«ãƒ©ãƒƒãƒ—ã•ã‚Œã¦ã„ã¦ã€HTML ã«çµ„ã¿è¾¼ã¿ã‚„ã™ããªã£ã¦ã„ã‚‹ã€‚

ãƒ•ã‚¡ã‚¤ãƒ«ã«å‡ºåŠ›ã™ã‚‹å ´åˆã¯ `--file` ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä½¿ã†ã€‚

```bash
$ npx rollup src/index.mjs --format='iife' --file='dist.js'

src/index.mjs â†’ dist.js...
created dist.js in 55ms
```

ã“ã‚“ãªæ„Ÿã˜ã€‚

## Rollup ã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œã‚‹

ã“ã“ã¾ã§ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã§ Rollup ã‚’å©ã„ã¦ã„ãŸãŒã€ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãªã©ã®å†…å®¹ã‚’è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãã“ã¨ã‚‚ã§ãã‚‹ã€‚

- `rollup.config.js`
  - `module.exports` ã§å‡ºåŠ›ã™ã‚‹ Webpack ã¨é•ã„ã€ES Modules ã® `export default` ã‚’ä½¿ã†ã¨ã“ã‚ãŒæ–°ã—ã„

```javascript
export default {
  input: 'src/index.mjs',
  output: {
    file: 'dist.js',
    format: 'iife'
  }
}
```

ã§ã€å®Ÿè¡Œæ™‚ã« `--config` (`-c`) ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’ä»˜ã‘ã‚Œã° `rollup.config.js` ãŒèª­ã¿è¾¼ã¾ã‚Œã‚‹ã€‚

```bash
$ npx rollup --config
```

## Terser ã‚’çµ„ã¿è¾¼ã‚€ : `rollup-plugin-terser`

æœ€å¾Œã«ã€Rollup ã« Terser ã‚’çµ„ã¿è¾¼ã‚“ã§ã€ã‚³ãƒ¼ãƒ‰ã‚’åœ§ç¸®ã—ã¦ã¿ã‚‹ã€‚`rollup-plugin-terser` ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã€‚`terser` æœ¬ä½“ã¯ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãªãã¦è‰¯ã„ã€‚

- [rollup-plugin-terser - npm](https://www.npmjs.com/package/rollup-plugin-terser)

```bash
$ npm install -D rollup-plugin-terser
```

è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã¯ã“ã†ã™ã‚‹ã€‚

- `rollup.config.js`

```javascript
import { terser } from 'rollup-plugin-terser';

export default {
  input: 'src/index.mjs',
  output: [
    // éåœ§ç¸®ã®é€šå¸¸ç‰ˆãƒ•ã‚¡ã‚¤ãƒ«
    {
      file: 'dist.js',
      format: 'cjs'
    },
    // Terser ã«ã‚ˆã‚‹åœ§ç¸®ç‰ˆãƒ•ã‚¡ã‚¤ãƒ«
    {
      file: 'dist.min.js',
      format: 'cjs',
      plugins: [
        terser()
      ]
    }
  ]
}
```

ã‚³ãƒ¬ã§ãƒ“ãƒ«ãƒ‰ã—ã¦ã¿ã‚‹ã€‚

```bash
# package.json ã« npm-scripts ã‚’æ›¸ã„ã¦ã¿ãŸ
$ npm run build

> practice-rollup@ build /Users/Neo/practice-rollup
> rollup --config

src/index.mjs â†’ dist.js, dist.min.js...
created dist.js, dist.min.js in 207ms
```

è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ã„ãŸã¨ãŠã‚Šã€2ã¤ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒç”Ÿæˆã•ã‚ŒãŸã“ã¨ãŒåˆ†ã‹ã‚‹ã€‚

ãã‚Œãã‚Œä¸­èº«ã‚’è¦‹ã¦ã¿ã‚ˆã†ã€‚

- `dist.js`
  - Terser ã‚’çµ„ã¿è¾¼ã‚“ã§ã„ãªã„éåœ§ç¸®ç‰ˆã€‚Rollup å˜ä½“ã®æˆæœ

```javascript
'use strict';

class hoge {
  hello() {
    console.log('Hello');
  }
}

const fuga = {
  a: 'a',
  b: 'b'
};

new hoge().hello();
console.log(fuga);
```

- `dist.min.js`
  - Terser ã«ã‚ˆã‚‹åœ§ç¸®ãŒè¡Œã‚ã‚Œã¦ã„ã‚‹ã€‚ç‰¹ã« `fuga` å¤‰æ•°ãŒæ¶ˆãˆã¦ã„ã‚‹ã“ã¨ãŒé¡•è‘—ã§ã‚ã‚ã†

```javascript
"use strict";(new class{hello(){console.log("Hello")}}).hello(),console.log({a:"a",b:"b"});
```

ã“ã‚“ãªæ„Ÿã˜ã€‚ã‹ãªã‚Šã‚·ãƒ³ãƒ—ãƒ«ã«ä½¿ãˆã¦è‰¯ã„æ„Ÿã˜ã€‚

- å‚è€ƒï¼š[Rollup ã®ä½¿ã„æ–¹ - ãƒŠãƒ‡ã‚ºãƒ€ãƒ»ã‚´ãƒœãƒªãƒ³ğŸ–¥](https://hysryt.com/archives/1565)
- å‚è€ƒï¼š[GitHub - rollup/awesome: âš¡ï¸ Delightful Rollup Plugins, Packages, and Resources](https://github.com/rollup/awesome)
