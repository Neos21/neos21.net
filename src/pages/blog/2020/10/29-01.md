---
title        : XREA ã‚µãƒ¼ãƒã§æœ€æ–°ã® Node.js ã‚’ä½¿ã†
created      : 2020-10-29
last-modified: 2020-10-29
header-date  : true
path:
  - /index.html Neo's World
  - /blog/index.html Blog
  - /blog/2020/index.html 2020å¹´
  - /blog/2020/10/index.html 10æœˆ
hidden-info:
  original-blog: Corredor
---

ä»¥å‰ç´¹ä»‹ã—ãŸã¨ãŠã‚Šã€ã¡ã‚‡ã£ã¨é ‘å¼µã‚Œã° SSH æ¥ç¶šãŒã§ãã‚‹ XREAã€‚

- [XREA ã®ã‚µãƒ¼ãƒã« SSH æ¥ç¶šã™ã‚‹](/blog/2019/08/12-02.html)

XREA ã‚µãƒ¼ãƒã«ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ Node.js ã¨ npm ãŒå…¥ã£ã¦ã„ã‚‹ã®ã ãŒã€å°‘ã€…ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒå¤ã„ã€‚

```bash
$ /usr/bin/node -v
v6.17.1

$ /usr/bin/npm -v
3.10.10
```

ãã“ã§ã€æœ€æ–°ã® Node.js ã‚’å°å…¥ã—ã¦ã¿ã‚‹ã€‚

## ç›®æ¬¡

## SSH æ¥ç¶šã—ã€åˆ¶é™ãªã—ã® Bash ã‚’ä½¿ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹

ä»¥å‰ç´¹ä»‹ã—ãŸè¨˜äº‹ã«æ²¿ã£ã¦ SSH æ¥ç¶šã™ã‚‹ã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯ rbash ã¨ã„ã†åˆ¶é™ä»˜ãã®ã‚·ã‚§ãƒ«ã§ã€`cd` ãªã©ãŒã§ããªã„ã®ã§ã€åˆ¶é™ãŒãªã„ Bash ã«åˆ‡ã‚Šæ›¿ãˆã‚‹ã€‚

```bash
$ chsh -s /bin/bash
# ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã™ã‚‹
# å¤‰æ›´å¾Œã€å†ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚Œã°åæ˜ ã•ã‚Œã‚‹æ§˜å­

# ã†ã¾ãã„ã‹ãªã‹ã£ãŸã‚‰ä»¥ä¸‹ã®ã„ãšã‚Œã‹ã§ Bash ã‚’é–‹ã‘ã°è¡Œã‘ãŸ
$ bash
$ /bin/bash

# /usr/bin/bash ã ã¨ rbash ã«ãªã£ã¦ã—ã¾ã†ã‚ˆã†ãªã®ã§ç¢ºèªã—ã¦ãŠã
$ echo "${BASH}"
/bin/bash
```

## æœ€æ–°ã® Node.js ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹

Node.js ã®å…¬å¼ãƒšãƒ¼ã‚¸ã‹ã‚‰ã€ã€ŒLinux Binaries (x64)ã€ã®ãƒªãƒ³ã‚¯ URL ã‚’å–å¾—ã™ã‚‹ã€‚LTS ã§ã‚‚è‰¯ã„ã—ã€Current ã§ã‚‚è‰¯ã„ã€‚è‡ªåˆ†ã¯ v14.13.1 (Current) ã‚’é¸æŠã—ãŸã€‚

- [Download | Node.js](https://nodejs.org/en/download/)

ãã—ãŸã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã€‚

```bash
$ curl -sSL -O https://nodejs.org/dist/v14.13.1/node-v14.13.1-linux-x64.tar.xz

$ ls -lh
-rw-r--r--  1 neo hpusers 21M 2020-10-14 10:41 node-v14.13.1-linux-x64.tar.xz
```

## è§£å‡ã—é…ç½®ã™ã‚‹

ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã‚‰ã€è§£å‡ã—ã¦é©å½“ãªã¨ã“ã‚ã«é…ç½®ã™ã‚‹ã€‚ä»Šå›ã¯ `~/.local/lib/` é…ä¸‹ã«é…ç½®ã™ã‚‹ã“ã¨ã«ã—ãŸã€‚

```bash
# æ‹¡å¼µå­ã®ã¨ãŠã‚Š XZ å½¢å¼
$ file ./node-v14.13.1-linux-x64.tar.xz
node-v14.13.1-linux-x64.tar.xz: XZ compressed data

# ã¾ãšã¯ãã®å ´ (ãƒ›ãƒ¼ãƒ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª) ã«è§£å‡ã—ã¦ã¿ã‚‹
$ tar xvf ./node-v14.13.1-linux-x64.tar.xz

# ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ç”¨æ„ã—ã€ç§»å‹•ã™ã‚‹
$ mkdir -p ~/.local/lib
$ mv ./node-v14.13.1-linux-x64/ ~/.local/lib/

# é…ç½®ã§ããŸã‹ç¢ºèªã™ã‚‹
$ ls -lh ~/.local/lib/
drwxr-xr-x 6 neo hpusers 9 2020-10-08 02:58 node-v14.13.1-linux-x64/

$ ls -lh ~/.local/lib/node-v14.13.1-linux-x64/
-rw-r--r-- 1 neo hpusers 52K 2020-10-08 02:58 CHANGELOG.md
-rw-r--r-- 1 neo hpusers 79K 2020-10-08 02:58 LICENSE
-rw-r--r-- 1 neo hpusers 28K 2020-10-08 02:58 README.md
drwxr-xr-x 2 neo hpusers   5 2020-10-08 02:58 bin/
drwxr-xr-x 3 neo hpusers   3 2020-10-08 02:58 include/
drwxr-xr-x 3 neo hpusers   3 2020-10-08 02:58 lib/
drwxr-xr-x 5 neo hpusers   5 2020-10-08 02:58 share/
```

## PATH ã‚’é€šã™

ä»¥ä¸Šã§é…ç½®ãŒã§ããŸã®ã§ã€PATH ã‚’é€šã™ã€‚`~/.bash_profile` ã‚ãŸã‚Šã§ä»¥ä¸‹ã®ã‚ˆã†ã«æ›¸ãã€åæ˜ ã™ã‚‹ã€‚rbash ã ã¨ç’°å¢ƒå¤‰æ•° PATH ã¯èª­ã¿å–ã‚Šå°‚ç”¨ã ã¨æ€’ã‚‰ã‚Œã‚‹ã®ã§æ³¨æ„ã€‚

```bash
export PATH="${HOME}/.local/lib/node-v14.13.1-linux-x64/bin:${PATH}"
```

```bash
# åæ˜ ã™ã‚‹
$ source ~/.bash_profile

# æœ€æ–°ç‰ˆã«ãªã£ã¦ã„ã‚‹
$ node -v
v14.13.1

$ npm -v
6.14.8
```

## æœ€æ–°ç‰ˆã® Node.js ã‚’ CGI ã¨ã—ã¦ä½¿ãˆã‚‹ã‹ç¢ºèªã™ã‚‹

ä»Šå›ã¯ `~/.local/lib/` é…ä¸‹ã«é›‘ã«é…ç½®ã—ãŸã®ã ãŒã€ãƒ•ãƒ«ãƒ‘ã‚¹ã§æŒ‡å®šã™ã‚Œã° Node.js ã‚’ CGI ã¨ã—ã¦ä½¿ç”¨ã§ãã‚‹ã€‚

```bash
# ãƒ•ãƒ«ãƒ‘ã‚¹ã‚’ç¢ºèªã—ã¦ãŠãã€‚${HOME} ã¯ /virtual/ã€ãƒ¦ãƒ¼ã‚¶åã€‘/ ã¨ãªã‚‹
$ type node
node ã¯ãƒãƒƒã‚·ãƒ¥ã•ã‚Œã¦ã„ã¾ã™ (/virtual/neo/.local/lib/node-v14.13.1-linux-x64/bin/node)

# Node.js v12 ä»¥é™ã§ä½¿ãˆã‚‹ asyncãƒ»await ã‚’ä½¿ã£ãŸç°¡å˜ãª CGI ã‚’æ›¸ã„ã¦ã¿ã‚‹
$ cat <<EOL > ~/public_html/test.cgi
#!/virtual/neo/.local/lib/node-v14.13.1-linux-x64/bin/node

process.stdout.write('Content-Type: text/html\n\n');
(async () => {
  await new Promise(r => setTimeout(r, 2000));
  console.log(process.version);
})();
EOL

# å®Ÿè¡Œæ¨©é™ã‚’ä»˜ä¸ã™ã‚‹
$ chmod 777 ~/public_html/test.cgi

# ãƒ–ãƒ©ã‚¦ã‚¶ã‚„ curl ã§ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã¿ã‚‹ã€‚2ç§’ã»ã©å¾…ãŸã•ã‚ŒãŸå¾Œã«ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸ Node.js ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒè¡¨ç¤ºã•ã‚ŒãŸã‚‰ OK
$ curl http://neo.s21.xrea.com/test.cgi
v14.13.1
```

- å‚è€ƒï¼š[Xreaã«Node.jsã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« | No title](https://otti.xyz/2020/07/install-nodejs-on-xrea.html)
- å‚è€ƒï¼š[ğ˜´ğ˜´ğ˜® on Twitter: "xreaã®ç„¡æ–™ãƒ—ãƒ©ãƒ³ã§node.jså°å…¥ã§ãã¾ã—ãŸ fast-cgi-binå†…ã«nodeã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æ‰‹å‹•ã§æ”¾ã‚Šè¾¼ã‚“ã§ã€ä¸‹è¨˜ã®"å¯¾è©±ç’°å¢ƒã§hello worldã—ã¦ã¿ã‚‹"ã§ç¢ºèªã—ã¾ã—ãŸ https://t.co/mqIlfzUl2O â€¦#xrea #Nodeâ€¦ https://t.co/56VQzAE8Kl"](https://twitter.com/hakosiratama/status/914167879150342144)
- å‚è€ƒï¼š[Xrea.com ã§ã€Œåˆ¶é™ç„¡ã—ã€ BASH ã‚’ä½¿ã†ï¼ˆã¨å•é¡Œã‚ã‚Šï¼Ÿï¼‰ | äºœç´°äºœãƒè›¾](https://asiamoth.com/200801242353/)
- å‚è€ƒï¼š[XREA ã« SSH æ¥ç¶šã™ã‚‹ - IMUZA.com](https://www.imuza.com/entry/xrea-ssh)

ã¤ã„ã§ã«ã€‚

XREA ã®ç„¡æ–™ã‚µãƒ¼ãƒ (s21) ã®å†…å®¹ã¯ã“ã‚“ãªæ„Ÿã˜ã ã£ãŸã€‚

```bash
$ cat /etc/os-release
NAME="CentOS Linux"
VERSION="7 (Core)"
ID="centos"
ID_LIKE="rhel fedora"
VERSION_ID="7"
PRETTY_NAME="CentOS Linux 7 (Core)"
ANSI_COLOR="0;31"
CPE_NAME="cpe:/o:centos:centos:7"
HOME_URL="https://www.centos.org/"
BUG_REPORT_URL="https://bugs.centos.org/"

CENTOS_MANTISBT_PROJECT="CentOS-7"
CENTOS_MANTISBT_PROJECT_VERSION="7"
REDHAT_SUPPORT_PRODUCT="centos"
REDHAT_SUPPORT_PRODUCT_VERSION="7"

$ lscpu
ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£: x86_64
CPU op-mode(s):        32-bit, 64-bit
Byte Order:            Little Endian
CPU(s):                48
On-line CPU(s) list:   0-47
ã‚³ã‚¢ã‚ãŸã‚Šã®ã‚¹ãƒ¬ãƒƒãƒ‰æ•°:2
ã‚½ã‚±ãƒƒãƒˆã‚ãŸã‚Šã®ã‚³ã‚¢æ•°:12
Socket(s):             2
NUMAãƒãƒ¼ãƒ‰:         2
ãƒ™ãƒ³ãƒ€ãƒ¼ID:        GenuineIntel
CPUãƒ•ã‚¡ãƒŸãƒªãƒ¼:    6
ãƒ¢ãƒ‡ãƒ«:             79
Model name:            Intel(R) Xeon(R) CPU E5-2650 v4 @ 2.20GHz
ã‚¹ãƒ†ãƒƒãƒ”ãƒ³ã‚°:    1
CPU MHz:               2500.007
CPU max MHz:           2900.0000
CPU min MHz:           1200.0000
BogoMIPS:              4400.42
ä»®æƒ³åŒ–:             VT-x
L1d ã‚­ãƒ£ãƒƒã‚·ãƒ¥:   32K
L1i ã‚­ãƒ£ãƒƒã‚·ãƒ¥:   32K
L2 ã‚­ãƒ£ãƒƒã‚·ãƒ¥:    256K
L3 ã‚­ãƒ£ãƒƒã‚·ãƒ¥:    30720K
NUMAãƒãƒ¼ãƒ‰ 0 CPU:   0,2,4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,34,36,38,40,42,44,46
NUMAãƒãƒ¼ãƒ‰ 1 CPU:   1,3,5,7,9,11,13,15,17,19,21,23,25,27,29,31,33,35,37,39,41,43,45,47
Flags:                 fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx pdpe1gb rdtscp lm constant_tsc arch_perfmon pebs bts rep_good nopl xtopology nonstop_tsc aperfmperf pni pclmulqdq dtes64 monitor ds_cpl vmx smx est tm2 ssse3 sdbg fma cx16 xtpr pdcm pcid dca sse4_1 sse4_2 x2apic movbe popcnt tsc_deadline_timer aes xsave avx f16c rdrand lahf_lm abm 3dnowprefetch epb invpcid_single intel_pt ssbd ibrs ibpb stibp kaiser tpr_shadow vnmi flexpriority ept vpid fsgsbase tsc_adjust bmi1 hle avx2 smep bmi2 erms invpcid rtm cqm rdseed adx smap xsaveopt cqm_llc cqm_occup_llc cqm_mbm_total cqm_mbm_local dtherm ida arat pln pts md_clear flush_l1d

$ lsmem
RANGE                                  SIZE  STATE REMOVABLE BLOCK
0x0000000000000000-0x000000007fffffff    2G online        no     0
0x0000000100000000-0x000000207fffffff  126G online        no  2-64

Memory block size:         2G
Total online memory:     128G
Total offline memory:      0B

$ free -h
              total        used        free      shared  buff/cache   available
Mem:           125G        2.5G        122G         30G        696M        122G
Swap:          127G        118G        9.1G

$ df -h
ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹       ã‚µã‚¤ã‚º  ä½¿ç”¨  æ®‹ã‚Š ä½¿ç”¨% ãƒã‚¦ãƒ³ãƒˆä½ç½®
lxd/containers/s21   4.7T   56G  4.7T    2% /
none                 492K  4.0K  488K    1% /dev
udev                  63G     0   63G    0% /dev/tty
tmpfs                100K     0  100K    0% /dev/lxd
tmpfs                100K     0  100K    0% /dev/.lxd-mounts
tmpfs                 63G  4.0K   63G    1% /dev/shm
tmpfs                 63G  4.4G   59G    7% /run
tmpfs                 63G     0   63G    0% /sys/fs/cgroup
/dev/shm             4.0G  140K  4.0G    1% /mnt/ram
/dev/shm              64M     0   64M    0% /mnt/ram2
tmpfs                 13G     0   13G    0% /run/user/1501
tmpfs                 13G     0   13G    0% /run/user/0
tmpfs                 13G     0   13G    0% /run/user/10002
```
