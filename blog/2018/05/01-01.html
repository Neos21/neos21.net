<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="theme-color" content="#0990d0">
    <!-- Google Search Console -->
    <meta name="google-site-verification" content="AvoEr3mUJFF2H_mPWWgShfmjBVP3ywRpyx9hxeeq2d4">
    <!-- Open Graph・Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="Neo's World">
    <meta property="og:title" content="Markdown の強調構文で使う「アスタリスク」と「アンダースコア」の違い - Neo's World">
    <meta property="og:description" content="Markdown の強調構文で使う「アスタリスク」と「アンダースコア」の違い - Neo's World">
    <meta property="og:url" content="https://neos21.net/blog/2018/05/01-01.html">
    <meta property="og:image" content="https://neos21.net/ogp.png">
    <meta property="og:locale" content="ja_JP">
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:title" content="Markdown の強調構文で使う「アスタリスク」と「アンダースコア」の違い - Neo's World">
    <meta property="twitter:description" content="Markdown の強調構文で使う「アスタリスク」と「アンダースコア」の違い - Neo's World">
    <meta property="twitter:url" content="https://neos21.net/blog/2018/05/01-01.html">
    <meta property="twitter:image" content="https://neos21.net/ogp.png">
    <title>Markdown の強調構文で使う「アスタリスク」と「アンダースコア」の違い - Neo's World</title>
    <link rel="icon" href="/favicon.ico">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    <link rel="manifest" href="/manifest.webmanifest">
    <link rel="stylesheet" href="/styles.css">
    <link rel="canonical" href="https://neos21.net/blog/2018/05/01-01.html">
    <link rel="search" type="application/opensearchdescription+xml" title="neos21.net" href="/opensearch.xml">
    <link rel="alternate" type="application/atom+xml" title="Feeds" href="/feeds.xml">
    <link rel="author" href="http://www.hatena.ne.jp/neos21/">
    <script src="/scripts.js"></script>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-MZCGD23');</script>
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6475907504235292" crossorigin="anonymous"></script>
  </head>
  <body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MZCGD23" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <div id="container">
      <header id="header">
        <div id="header-brand">
          <div id="header-brand-contents">
            <div id="site-title"><a href="/index.html">Neo's World</a></div>
            <nav id="header-links">
              <ul>
                <li id="header-link-theme"><a href="#" title="Toggle Theme"><span>Toggle Theme</span></a></li>
                <li id="header-link-about"><a href="/about/index.html" title="About"><span>About</span></a></li>
                <li id="header-link-search"><a href="/about/search.html" title="Search"><span>Search</span></a></li>
                <li id="header-link-feeds"><a href="/feeds.xml" title="Feeds"><span>Feeds</span></a></li>
                <li id="header-link-to-bottom"><a href="#footer" title="To Bottom"><span>▼ To Bottom</span></a></li>
              </ul>
            </nav>
          </div>
        </div>
        <nav id="global-nav">
          <ul>
            <li><a href="/blog/index.html">Blog</a></li>
            <li><a href="/tech/index.html">Tech</a></li>
            <li><a href="/music/index.html">Music</a></li>
            <li><a href="/games/index.html">Games</a></li>
            <li><a href="/gallery/index.html">Gallery</a></li>
            <li><a href="/etc/index.html">Etc.</a></li>
          </ul>
        </nav>
        <nav id="path">
          <ul>
            <li><a href="/index.html">Neo's World</a></li>
            <li><a href="/blog/index.html">Blog</a></li>
            <li><a href="/blog/2018/index.html">2018年</a></li>
            <li><a href="/blog/2018/05/index.html">05月</a></li>
          </ul>
        </nav>
      </header>
      <main id="main">
        <div id="header-date"><time>2018-05-01</time></div>
        <h1 id="page-title">Markdown の強調構文で使う「アスタリスク」と「アンダースコア」の違い</h1>

<p>Markdown 記法の中で<em>強調</em>するための記号には2種類ある。アスタリスク <code>*</code> とアンダースコア <code>_</code> だ。</p>
<pre class="language-markdown"><code class="language-markdown"><span class="token bold"><span class="token punctuation">**</span><span class="token content">これで強調される</span><span class="token punctuation">**</span></span>

<span class="token bold"><span class="token punctuation">__</span><span class="token content">これでも強調される</span><span class="token punctuation">__</span></span>
</code></pre>
<p>これらの2つの違いと、なぜ2つあるのか、というところを調べてみた。</p>
<h2 id="目次"><a class="header-link" href="#目次"><span class="header-link-mark"></span></a>目次</h2>
<ul>
  <li><a href="#%E3%82%A2%E3%82%B9%E3%82%BF%E3%83%AA%E3%82%B9%E3%82%AF%E3%81%A8%E3%82%A2%E3%83%B3%E3%83%80%E3%83%BC%E3%82%B9%E3%82%B3%E3%82%A2%E3%81%AE%E9%81%95%E3%81%84">アスタリスクとアンダースコアの違い</a></li>
  <li><a href="#%E5%88%A5%E3%81%AB%E3%82%A2%E3%83%B3%E3%83%80%E3%83%BC%E3%82%B9%E3%82%B3%E3%82%A2%E3%81%A7%E3%82%82%E5%BC%B7%E8%AA%BF%E3%81%A7%E3%81%8D%E3%82%8B%E3%81%91%E3%81%A9%E3%81%AB%E5%AF%BE%E3%81%99%E3%82%8B%E8%AA%AC%E6%98%8E">「別にアンダースコアでも強調できるけど？」に対する説明</a></li>
  <li><a href="#markdown-%E3%81%AE%E4%BB%95%E6%A7%98%E3%81%AF%E3%81%A9%E3%81%86%E3%82%84%E3%81%A3%E3%81%A6%E6%B1%BA%E3%81%BE%E3%81%A3%E3%81%A6%E3%81%84%E3%82%8B%E3%81%AE%E3%81%8B%E5%B7%AE%E7%95%B0%E3%81%8C%E7%94%9F%E3%81%BE%E3%82%8C%E3%81%9F%E7%90%86%E7%94%B1">「Markdown の仕様」はどうやって決まっているのか・差異が生まれた理由</a></li>
  <li><a href="#commonmark-%E3%81%8C%E5%88%86%E3%81%8B%E3%81%A1%E6%9B%B8%E3%81%8D%E3%81%97%E3%81%A6%E3%81%84%E3%81%AA%E3%81%84%E3%82%A2%E3%83%B3%E3%83%80%E3%83%BC%E3%82%B9%E3%82%B3%E3%82%A2%E3%82%92%E5%BC%B7%E8%AA%BF%E3%81%97%E3%81%AA%E3%81%84%E7%90%86%E7%94%B1">CommonMark が分かち書きしていないアンダースコアを強調しない理由</a></li>
  <li><a href="#%E3%81%BE%E3%81%A8%E3%82%81">まとめ</a></li>
  <li><a href="#%E3%81%9D%E3%81%AE%E4%BB%96%E5%8F%82%E8%80%83">その他参考</a></li>
</ul>
<h2 id="アスタリスクとアンダースコアの違い"><a class="header-link" href="#アスタリスクとアンダースコアの違い"><span class="header-link-mark"></span></a>アスタリスクとアンダースコアの違い</h2>
<p>アスタリスクで強調した時とアンダースコアで強調した時の違いは、「<strong>分かち書きが必要かどうか</strong>」にある。</p>
<p>「分かち書き」とは、スペースで単語を区切る、通常の英文章の書かれ方のこと。日本語の場合、普段スペースで単語を区切ることはないので、「分かち書きがない文章」ということになる。</p>
<p>アスタリスク <code>*</code> を使った時は、「英単語中の特定の文字だけ」とか、「スペース区切りがない通常の日本語文中の一部だけ」を強調できる。</p>
<pre class="language-markdown"><code class="language-markdown">これは<span class="token bold"><span class="token punctuation">**</span><span class="token content">強調</span><span class="token punctuation">**</span></span>できる  ← 「強調」の2文字が太字になる
Mar<span class="token bold"><span class="token punctuation">**</span><span class="token content">k</span><span class="token punctuation">**</span></span>down          ← 一単語中の「k」だけ太字になる
</code></pre>
<p>一方、アンダースコア <code>_</code> の方は、<strong>分かち書きをしないと強調構文と見なされない</strong>のだ。</p>
<pre class="language-markdown"><code class="language-markdown">これは<span class="token bold"><span class="token punctuation">__</span><span class="token content">強調</span><span class="token punctuation">__</span></span>できない  ← 「<span class="token bold"><span class="token punctuation">__</span><span class="token content">強調</span><span class="token punctuation">__</span></span>」と表示され、太字にはならない
Mar__k__down            ← 「Mar__k__down」と表示され、太字にはならない
</code></pre>
<p>もし日本語文中でアンダースコアを使って強調したい時は、強調したい箇所をスペースで区切る必要がある。</p>
<pre class="language-markdown"><code class="language-markdown">これは <span class="token bold"><span class="token punctuation">__</span><span class="token content">強調</span><span class="token punctuation">__</span></span> できる  ← 前後にスペースを入れたので「強調」が太字になる
</code></pre>
<h2 id="別にアンダースコアでも強調できるけどに対する説明"><a class="header-link" href="#別にアンダースコアでも強調できるけどに対する説明"><span class="header-link-mark"></span></a>「別にアンダースコアでも強調できるけど？」に対する説明</h2>
<p>ここまで聞いて、「<em>あれ？自分が普段使っているエディタ・ブログでは分かち書きせずにアンダースコアを使っても強調できるけど？</em>」と思った人もいるかもしれない。これは、Markdown のパーサの実装によって違いがあるのだ。</p>
<p>自分が普段使っているサービス等で、<strong>分かち書きせずにアンダースコアで強調できる</strong> Markdown パーサを採用しているのは以下あたり。</p>
<ul>
  <li><a href="https://marked.js.org/demo/">marked.js</a> … JavaScript 製の Markdown パーサ</li>
  <li><a href="https://github.com/GitbookIO/gitbook">GitBook</a></li>
  <li>はてなブログ … ちなみに、僕がこのブログを書く時は、強調構文は全てアンダースコア <code>_</code> を使って書いている。</li>
</ul>
<p>逆に、<em>アンダースコアを使う時は分かち書きが必要になる</em>のは以下あたり。</p>
<ul>
  <li><a href="https://github.com/markdown-it/markdown-it">markdown-it</a> … marked.js 同様の JS 製パーサ</li>
  <li>GitHub (<a href="https://github.github.com/gfm/">GitHub Flavored Markdown (GFM)</a>) … Issue へのコメントなど</li>
  <li>VSCode の Markdown プレビュー画面</li>
</ul>
<p>この辺の違いの詳細は、以下の記事などが参考になる。</p>
<ul>
  <li>参考 : <a href="https://qiita.com/8x9/items/19acf458ba04b25a30e4">Markdown日本語対応星取表 —— 強調箇所は分かち書き必須か - Qiita</a></li>
</ul>
<p>このような違いが生まれているのはなぜだろうか。</p>
<h2 id="markdown-の仕様はどうやって決まっているのか差異が生まれた理由"><a class="header-link" href="#markdown-の仕様はどうやって決まっているのか差異が生まれた理由"><span class="header-link-mark"></span></a>「Markdown の仕様」はどうやって決まっているのか・差異が生まれた理由</h2>
<p>ところで、Markdown の文法はどこが定めているのだろう。<a href="https://github.github.com/gfm/">GitHub Flavored Markdown (GFM)</a> といった方言・拡張があったりするのは分かるが、そのベースはどこが作っているのか。</p>
<p>ベースとなる仕様は、<strong>CommonMark</strong> というプロジェクトで標準化が進められている。</p>
<ul>
  <li><a href="http://spec.commonmark.org/">CommonMark Spec</a></li>
</ul>
<blockquote>
  <p>CommonMarkというのはMarkdownの標準化を目指して2014年に立ち上がったプロジェクトです。</p>
  <p>GitHubがCommonMarkを採用したというアナウンスがありました。つまり、長らくMarkdownデファクトと考えられてきたGFM: GitHub Flavored Markdownは、いまやCommonMarkのスーパーセットなのです。</p>
</blockquote>
<ul>
  <li>参考 : <a href="https://gfx.hatenablog.com/entry/2017/04/12/103117">CommonMarkの現状 2017年4月版 - Islands in the byte stream</a></li>
</ul>
<p>Markdown を作った John Gruber (ジョン・グルーバー) 氏のサイトにも仕様が載っているが、コチラの強調構文に関する記述は "You can use whichever style you prefer; the lone restriction is that the same character must be used to open and close an emphasis span."、つまり「どっちでも好きに使ってね (同じ記号で開始・終了を書けばいいよ)」としか書かれていない。</p>
<ul>
  <li>参考 : <a href="https://daringfireball.net/projects/markdown/syntax#em">Daring Fireball: Markdown Syntax Documentation</a></li>
</ul>
<p>CommonMark はこの最初の発言を基に、具体的な仕様に落とし込んでいっているようだ。ちなみに、<strong>John Gruber 氏の本家 Markdown パーサは「分かち書きしなくても強調できる」</strong> が、<em>CommonMark は「分かち書きしないと強調できない」</em>。CommonMark の方が「制限が厳しくなっている」「融通が効かなくなっている」ともいえる。</p>
<p>つまり、<em>CommonMark の仕様に準拠しているパーサは、アンダースコアは分かち書きが必要</em>になっていて、<strong>これに準拠していないパーサは分かち書きしなくても強調できる</strong>、という作りなのだ。</p>
<blockquote>
  <p>QiitaやHatena Blogはさすがに日本語ユーザー向けにしっかり対応してますね。</p>
</blockquote>
<p>ということなので、分かち書きをしない言語向けのサービスではあえて CommonMark の仕様に沿わない作りになっていると思われる。</p>
<h2 id="commonmark-が分かち書きしていないアンダースコアを強調しない理由"><a class="header-link" href="#commonmark-が分かち書きしていないアンダースコアを強調しない理由"><span class="header-link-mark"></span></a>CommonMark が分かち書きしていないアンダースコアを強調しない理由</h2>
<p>ところで、ジョン・グルーバー氏の本家 Markdown では許容していたのに、CommonMark はどうして、<em>分かち書きしていないアンダースコアを強調してくれない</em>のだろうか。</p>
<p>強調構文に関する仕様は以下に記載されている。</p>
<ul>
  <li><a href="http://spec.commonmark.org/0.28/#emphasis-and-strong-emphasis">CommonMark Spec - v0.28 - 6.4 Emphasis and strong emphasis</a></li>
</ul>
<p>この中で、以下のように触れられている。</p>
<blockquote>
  <p>Many implementations have also restricted intraword emphasis to the <code>*</code> forms, to avoid unwanted emphasis in words containing internal underscores. (It is best practice to put these in code spans, but users often do not.)</p>
</blockquote>
<p>意訳すると、</p>
<ul>
  <li>多くの実装では、単語内の強調に <code>*</code> (アスタリスク) を使うよう制限を入れている。それは、アンダースコアを含む単語を不要に強調しないようにするためだ (「アンダースコアを含む単語」は本来コードスパンで囲むのがベストプラクティスだが、しばしばユーザはそのようにしないため)。</li>
</ul>
<p>ということになる。</p>
<p>つまり、<code>foo_bar_baz</code> といった単語を表記する時は、本当はコードスパン (バッククォート) で囲って書くべきなのだが、そうしない利用者がいて、これを強調と捉えられてしまうと困ると考えて、アンダースコアを無効化しているようだ。</p>
<h2 id="まとめ"><a class="header-link" href="#まとめ"><span class="header-link-mark"></span></a>まとめ</h2>
<ul>
  <li>そもそもなぜ強調構文にアスタリスクとアンダースコアの2種類があるのかというと、Markdown 作者のジョン・グルーバーがそう決めたから、である。</li>
  <li>Markdown の標準仕様策定を進める CommonMark の仕様上は「アンダースコア <code>_</code> は分かち書き必須」、「アスタリスク <code>*</code> は分かち書き不要」という差異がある。</li>
  <li>パーサによっては CommonMark の仕様に準拠していないこともあり、日本語圏は特に分かち書きしないので、分かち書きなしのアンダースコア強調ができるサービス・ツールもある。</li>
</ul>
<p>僕は、アスタリスクで書くよりもアンダースコアの方が、文字列がごちゃつかなくてスッキリするし、アスタリスクはリスト記法にも使える記号だから混同しないように、という理由でアンダースコアを好んで使っているのだが、今のところ CommonMark 仕様とは外れた書き方であることに注意しないと。</p>
<p>もしもはてなブログが「パーサの仕様を CommonMark 標準に揃えました」なんて言い出したら、僕のブログにはあちこちにアンダースコアが表面化することになるワケだ。w</p>
<p>日本語圏の人間としては、できたらアンダースコアも分かち書きなしの仕様に統一してほしいなぁ〜。</p>
<h2 id="その他参考"><a class="header-link" href="#その他参考"><span class="header-link-mark"></span></a>その他参考</h2>
<ul>
  <li><a href="https://tokunagakazuya.tk/7c6q">Markdownのパーサーで PHP でも JavaScript でも同じ結果が欲しい時は、CommonMark に準拠したライブラリだと良いですよ、という話 - TokunagaKazuya.tk</a></li>
  <li><a href="https://gfx.hatenablog.com/entry/2017/08/14/174621">CommonMark v0.28 のイマイチなところ - Islands in the byte stream</a></li>
  <li><a href="http://genjiapp.com/blog/2013/11/13/jekyll-config-for-markdown.html">JekyllのMarkdown設定（2013年11月18日追記） — Genji App Blog</a> … Redcarpet レンダラのオプションに <code>no_intra_emphasis</code> なるオプションがある。優秀。</li>
</ul>

      </main>
      <footer id="footer">
        <div id="footer-contents">
          <div id="date-time">
            <dl>
              <dt>Created</dt>
              <dd><time>2018-05-01</time></dd>
              <dt>Last-Modified</dt>
              <dd><time>2018-05-01</time></dd>
            </dl>
          </div>
          <nav id="footer-links">
            <ul>
              <li id="footer-link-about"><a href="/about/index.html" title="About">About</a></li>
              <li id="footer-link-search"><a href="/about/search.html" title="Search">Search</a></li>
              <li id="footer-link-feeds"><a href="/feeds.xml" title="Feeds">Feeds</a></li>
              <li id="footer-link-github"><a href="https://github.com/Neos21/" title="GitHub">GitHub</a></li>
            </ul>
          </nav>
          <nav id="to-top"><a href="#" title="To Top"><span>▲ To Top</span></a></nav>
        </div>
      </footer>
    </div>
  </body>
</html>
