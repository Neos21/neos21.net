<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="theme-color" content="#0990d0">
    <!-- Google Search Console -->
    <meta name="google-site-verification" content="AvoEr3mUJFF2H_mPWWgShfmjBVP3ywRpyx9hxeeq2d4">
    <title>MacOS に VirtualBox + Vagrant を使って CentOS + GNOME GUI デスクトップ環境を構築する - Neo's World</title>
    <link rel="icon" href="/favicon.ico">
    <link rel="stylesheet" href="/styles.css">
    <link rel="canonical" href="https://neos21.net/blog/2018/10/06-01.html">
    <link rel="search" type="application/opensearchdescription+xml" title="neos21.net" href="/opensearch.xml">
    <link rel="alternate" type="application/atom+xml" href="/feeds.xml">
    <link rel="author" href="http://www.hatena.ne.jp/neos21/">
    <!-- Global Site Tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YMHFLZP1M1"></script>
    <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date());gtag('config','G-YMHFLZP1M1');gtag('config','UA-106501-1');</script>
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6475907504235292" crossorigin="anonymous"></script>
  </head>
  <body>
    <div id="container">
      <header id="header">
        <div id="header-brand">
          <div id="header-brand-contents">
            <div id="site-title"><a href="/index.html">Neo's World</a></div>
            <nav id="header-links">
              <ul>
                <li id="header-link-about"><a href="/about/index.html" title="About"><span>About</span></a></li>
                <li id="header-link-search"><a href="/about/search.html" title="Search"><span>Search</span></a></li>
                <li id="header-link-feeds"><a href="/feeds.xml" title="Feeds"><span>Feeds</span></a></li>
                <li id="header-link-to-bottom"><a href="#footer" title="To Bottom"><span>▼ To Bottom</span></a></li>
              </ul>
            </nav>
          </div>
        </div>
        <nav id="global-nav">
          <ul>
            <li><a href="/blog/index.html">Blog</a></li>
            <li><a href="/tech/index.html">Tech</a></li>
            <li><a href="/music/index.html">Music</a></li>
            <li><a href="/games/index.html">Games</a></li>
            <li><a href="/gallery/index.html">Gallery</a></li>
            <li><a href="/etc/index.html">Etc.</a></li>
          </ul>
        </nav>
        <nav id="path">
          <ul>
            <li><a href="/index.html">Neo's World</a></li>
            <li><a href="/blog/index.html">Blog</a></li>
            <li><a href="/blog/2018/index.html">2018年</a></li>
            <li><a href="/blog/2018/10/index.html">10月</a></li>
          </ul>
        </nav>
      </header>
      <main id="main">
        <div id="header-date"><time>2018-10-06</time></div>
        <h1 id="page-title">MacOS に VirtualBox + Vagrant を使って CentOS + GNOME GUI デスクトップ環境を構築する</h1>

<p>以前、Windows 上に VirtualBox + Vagrant で CentOS 環境を構築する手順を紹介した。</p>
<ul>
  <li><a href="/blog/2017/04/17-03.html">Vagrant と VirtualBox で CentOS 環境をサクッと作る</a></li>
</ul>
<p>今回、VirtualBox + Vagrant を使用する点はそのままに、ホストに MacOS High Sierra を使用し、ゲストの CentOS に GNOME デスクトップ環境を用意してみる。</p>
<h2 id="目次"><a class="header-link" href="#目次"><span class="header-link-mark"></span></a>目次</h2>
<ul>
  <li><a href="#virtualbox-%E3%81%A8-vagrant-%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB">VirtualBox と Vagrant のインストール</a></li>
  <li><a href="#vagrantfile-%E3%82%92%E7%94%A8%E6%84%8F%E3%81%99%E3%82%8B">Vagrantfile を用意する</a></li>
  <li><a href="#%E3%83%A1%E3%83%A2%E3%83%AA%E4%B8%8D%E8%B6%B3%E3%82%92%E8%A7%A3%E6%B6%88%E3%81%99%E3%82%8B">メモリ不足を解消する</a></li>
  <li><a href="#%E8%A7%A3%E5%83%8F%E5%BA%A6%E3%82%92%E3%83%AA%E3%82%B5%E3%82%A4%E3%82%BA%E3%81%A7%E3%81%8D%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%99%E3%82%8B">解像度をリサイズできるようにする</a></li>
  <li><a href="#chrome-%E3%83%96%E3%83%A9%E3%82%A6%E3%82%B6%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B">Chrome ブラウザをインストールする</a></li>
</ul>
<h2 id="virtualbox-と-vagrant-のインストール"><a class="header-link" href="#virtualbox-と-vagrant-のインストール"><span class="header-link-mark"></span></a>VirtualBox と Vagrant のインストール</h2>
<p>Windows 同様、それぞれをインストールしておく。</p>
<ul>
  <li><a href="/blog/2018/03/18-01.html">Vagrant で Mac 上に Windows の仮想環境を構築する</a></li>
</ul>
<h2 id="vagrantfile-を用意する"><a class="header-link" href="#vagrantfile-を用意する"><span class="header-link-mark"></span></a>Vagrantfile を用意する</h2>
<p>以下のサイトで紹介されている <code>Vagrantfile</code> を適当なディレクトリに保存する。</p>
<ul>
  <li>参考：<a href="https://mseeeen.msen.jp/centos7-gnome-desktop-with-vagrant/">Vagrant で手っ取り早く CentOS 7 + GNOME 環境を立ち上げる</a></li>
</ul>
<pre class="language-ruby"><code class="language-ruby"><span class="token comment"># -*- mode: ruby -*-</span>
<span class="token comment"># vi: set ft=ruby :</span>

<span class="token constant">Vagrant</span><span class="token punctuation">.</span>configure<span class="token punctuation">(</span><span class="token string">"2"</span><span class="token punctuation">)</span> <span class="token keyword">do</span> <span class="token operator">|</span>config<span class="token operator">|</span>
  config<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>box <span class="token operator">=</span> <span class="token string">"bento/centos-7.3"</span>
  config<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>provider <span class="token string">"virtualbox"</span> <span class="token keyword">do</span> <span class="token operator">|</span>vb<span class="token operator">|</span>
    vb<span class="token punctuation">.</span>gui <span class="token operator">=</span> <span class="token boolean">true</span>
    vb<span class="token punctuation">.</span>memory <span class="token operator">=</span> <span class="token string">"1024"</span>
  <span class="token keyword">end</span>
  config<span class="token punctuation">.</span>vm<span class="token punctuation">.</span>provision <span class="token string">"shell"</span><span class="token punctuation">,</span> inline<span class="token punctuation">:</span> <span class="token operator">&#x3C;</span><span class="token operator">&#x3C;</span><span class="token operator">-</span><span class="token constant">SHELL</span>
    sudo yum <span class="token operator">-</span>y groupinstall <span class="token string">"GNOME Desktop"</span>
    sudo yum <span class="token operator">-</span>y epel<span class="token operator">-</span>release
    sudo systemctl set<span class="token operator">-</span>default graphical<span class="token punctuation">.</span>target
    systemctl get<span class="token operator">-</span>default
    sudo shutdown <span class="token operator">-</span>r now
  <span class="token constant">SHELL</span>
<span class="token keyword">end</span>
</code></pre>
<p>この <code>Vagrantfile</code> があるディレクトリで <code>vagrant up</code> コマンドを叩くと、しばらくダウンロードやインストール作業が行われるので待つ。</p>
<p>作業が完了すると、GNOME デスクトップ環境が立ち上がる。<em>なんとコレだけ！！</em> GNOME 上でシャットダウンすれば、<code>vagrant halt</code> 相当の終了処理が行われる。</p>
<blockquote>
  <ul>
    <li><code>vb.gui = true</code> で VirtualBox で GUI が使えるようにしています。このフラグを設定しておかないと vagrant はヘッドレスモードで VM を起動しますので、 VitualBox の GUI で操作ができません。</li>
  </ul>
</blockquote>
<p>とのこと。</p>
<h2 id="メモリ不足を解消する"><a class="header-link" href="#メモリ不足を解消する"><span class="header-link-mark"></span></a>メモリ不足を解消する</h2>
<p>コレで GNOME 環境自体はできたのだが、どうもメモリが足りず、動作がもっさりする。</p>
<p>ということで、先程の <code>Vagrantfile</code> を開き、<code>vb.memory = "1024"</code> の行の数値を変更する。<code>"2048"</code> で 2GB、<code>"4096"</code> で 4GB のメモリを仮想環境に割り当てる。この辺は環境に合わせてお好みで。</p>
<h2 id="解像度をリサイズできるようにする"><a class="header-link" href="#解像度をリサイズできるようにする"><span class="header-link-mark"></span></a>解像度をリサイズできるようにする</h2>
<p>環境構築直後の GNOME 環境は、1024x768px とかで、解像度が小さい。そこで、VirtualBox Guest Additions をインストールして、解像度を変えられるようにする。</p>
<p>設定のため、Vagrant から立ち上げた GNOME 環境は一旦閉じて、VirtualBox から対象の仮想環境を開いてみる。</p>
<p>VirtualBox メニューの Devices → 「Insert Guest Additions CD Imag...」を選択する。もしココでこの項目が選択できない場合は、ホストマシンに物理的な CD-ROM ドライブがないのが原因と思われる。環境設定より仮想 CD-ROM ドライブを追加しておくと選べるようになる。</p>
<p>次に、GNOME 上でターミナルを開き、以下のコマンドを打って Guest Additions をインストールする。</p>
<pre class="language-bash"><code class="language-bash">$ <span class="token function">mkdir</span> /mnt/cdrom
$ <span class="token function">mount</span> /dev/cdrom /mnt/cdrom/
$ <span class="token function">bash</span> /mnt/cdrom/VBoxLinuxAdditions.run
</code></pre>
<p>インストールが完了したら</p>
<pre class="language-bash"><code class="language-bash">$ <span class="token function">umount</span> /media/cdrom
</code></pre>
<p>でアンマウントし、ゲスト OS をシャットダウンする。ココまでできたら Guest Additions の仮想 CD-ROM ドライブは取り外して良い。</p>
<p><code>vagrant up</code> で再起動すると、ウィンドウサイズに合わせてゲスト OS の解像度が変更されるようになった。</p>
<ul>
  <li>参考：<a href="https://docs.oracle.com/cd/E26217_01/E35194/html/qs-guest-additions.html">6.4. VirtualBox Guest Additions のインストール</a></li>
  <li>参考：<a href="https://pc-karuma.net/virtualbox-install-guest-additions/">VirtualBoxの使い方 - Guest Additions のインストール - PC設定のカルマ</a></li>
  <li>参考：<a href="https://bacchi.me/infrastructure/virtualbox-auto-resize/">VirtualBoxのディスプレイ解像度を自動的にリサイズする | bacchi.me</a></li>
</ul>
<h2 id="chrome-ブラウザをインストールする"><a class="header-link" href="#chrome-ブラウザをインストールする"><span class="header-link-mark"></span></a>Chrome ブラウザをインストールする</h2>
<p>GNOME 上で Application Installer アプリを開き、Chromium をインストールしようとすると、以下のエラーが出てしまった。</p>
<pre><code>Detailed errors from the package manager follow:
installing not available
</code></pre>
<ul>
  <li>参考：<a href="https://detail.chiebukuro.yahoo.co.jp/qa/question_detail/q14189665894">centosに変えてから、Application Installerをひらいて、Chromiumをイ... - Yahoo!知恵袋</a></li>
</ul>
<p>調べてみると、Chrome ブラウザは別で存在し、Yum リポジトリを追加してやれば良いようだ。以下の記事に従って操作してみる。</p>
<ul>
  <li>参考：<a href="https://qiita.com/phos/items/b9884be437cdc3b34c59">CentOS7にChromeをインストール</a></li>
  <li>参考：<a href="https://qiita.com/shadowhat/items/af6b973df43d75abfe8e">CentOS7にChromeをインストール</a></li>
</ul>
<pre class="language-bash"><code class="language-bash"><span class="token comment"># リポジトリファイルを作る</span>
$ <span class="token function">sudo</span> <span class="token function">vi</span> /etc/yum.repos.d/google.chrome.repo

<span class="token comment"># 中身は以下のようにする</span>
<span class="token punctuation">[</span>google-chrome<span class="token punctuation">]</span>
<span class="token assign-left variable">name</span><span class="token operator">=</span>google-chrome
<span class="token assign-left variable">baseurl</span><span class="token operator">=</span>http://dl.google.com/linux/chrome/rpm/stable/<span class="token variable">$basearch</span>
<span class="token assign-left variable">enabled</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token assign-left variable">gpgcheck</span><span class="token operator">=</span><span class="token number">1</span>
<span class="token assign-left variable">gpgkey</span><span class="token operator">=</span>https://dl-ssl.google.com/linux/linux_signing_key.pub

<span class="token comment"># 情報を反映する</span>
$ <span class="token function">sudo</span> yum update

<span class="token comment"># Chrome をインストールする</span>
$ <span class="token function">sudo</span> yum <span class="token function">install</span> google-chrome-stable
</code></pre>
<p>コレで OK。</p>
<p>既存の Yum リポジトリの設定ファイルを見てみると、ほとんどが <code>enabled=0</code> で無効になっていたので、Yum 設定ファイルを変更するコマンド <em><code>yum-config-manager</code></em> で全リポジトリを有効にしてみようと思う。</p>
<pre class="language-bash"><code class="language-bash">$ <span class="token function">sudo</span> yum-config-manager --enable <span class="token punctuation">\</span>*

$ <span class="token function">sudo</span> yum update
</code></pre>
<p><code>update</code> に滅茶苦茶時間がかかるようになってしまった。多分ホントはこういうことしないんだと思う。w 今回は Yum のお勉強ということで紹介まで。</p>
<ul>
  <li>参考：<a href="https://access.redhat.com/documentation/ja-jp/red_hat_enterprise_linux/6/html/deployment_guide/sec-managing_yum_repositories">6.3.5. Yum リポジトリを有効/設定/無効にする方法 - Red Hat Customer Portal</a></li>
  <li>参考：<a href="http://kazmax.zpp.jp/linux_beginner/yum_repository_enable_disable.html">yum｜yum リポジトリの有効／無効</a></li>
</ul>
<p>以上。コレで LPIC 学習用の環境は立ち上げられたが、LPIC (LPI 日本支部) と LinuC (LPI-Japan) が分断しちゃってどうなる感…。</p>

      </main>
      <footer id="footer">
        <div id="footer-contents">
          <div id="date-time">
            <dl>
              <dt>Created</dt>
              <dd><time>2018-10-06</time></dd>
              <dt>Last-Modified</dt>
              <dd><time>2018-10-06</time></dd>
            </dl>
          </div>
          <nav id="footer-links">
            <ul>
              <li id="footer-link-about"><a href="/about/index.html" title="About">About</a></li>
              <li id="footer-link-search"><a href="/about/search.html" title="Search">Search</a></li>
              <li id="footer-link-feeds"><a href="/feeds.xml" title="Feeds">Feeds</a></li>
              <li id="footer-link-github"><a href="https://github.com/Neos21/" title="GitHub">GitHub</a></li>
            </ul>
          </nav>
          <nav id="to-top"><a href="#" title="To Top"><span>▲ To Top</span></a></nav>
        </div>
      </footer>
    </div>
  </body>
</html>
