<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="theme-color" content="#0990d0">
    <!-- Google Search Console -->
    <meta name="google-site-verification" content="AvoEr3mUJFF2H_mPWWgShfmjBVP3ywRpyx9hxeeq2d4">
    <title>Markdown を Lint チェックできる「markdownlint」を試してみた - Neo's World</title>
    <link rel="icon" href="/favicon.ico">
    <link rel="stylesheet" href="/styles.css">
    <link rel="canonical" href="https://neos21.net/blog/2018/04/20-01.html">
    <link rel="search" type="application/opensearchdescription+xml" title="neos21.net" href="/opensearch.xml">
    <link rel="alternate" type="application/atom+xml" href="/feeds.xml">
    <link rel="author" href="http://www.hatena.ne.jp/neos21/">
    <!-- Global Site Tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YMHFLZP1M1"></script>
    <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date());gtag('config','G-YMHFLZP1M1');gtag('config','UA-106501-1');</script>
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6475907504235292" crossorigin="anonymous"></script>
  </head>
  <body>
    <div id="container">
      <header id="header">
        <div id="site-title"><a href="/index.html">Neo's World</a></div>
        <nav id="header-links">
          <ul>
            <li id="header-link-about"><a href="/about/index.html" title="About"><span>About</span></a></li>
            <li id="header-link-search"><a href="/about/search.html" title="Search"><span>Search</span></a></li>
            <li id="header-link-feeds"><a href="/feeds.xml" title="Feeds"><span>Feeds</span></a></li>
            <li id="header-link-to-bottom"><a href="#footer" title="To Bottom"><span>▼ To Bottom</span></a></li>
          </ul>
        </nav>
        <nav id="global-nav">
          <ul>
            <li><a href="/blog/index.html">Blog</a></li>
            <li><a href="/tech/index.html">Tech</a></li>
            <li><a href="/music/index.html">Music</a></li>
            <li><a href="/games/index.html">Games</a></li>
            <li><a href="/gallery/index.html">Gallery</a></li>
            <li><a href="/etc/index.html">Etc.</a></li>
          </ul>
        </nav>
        <nav id="path">
          <ul>
            <li><a href="/index.html">Neo's World</a></li>
            <li><a href="/blog/index.html">Blog</a></li>
            <li><a href="/blog/2018/index.html">2018年</a></li>
            <li><a href="/blog/2018/04/index.html">04月</a></li>
          </ul>
        </nav>
      </header>
      <main id="main">
        <div id="header-date"><time>2018-04-20</time></div>
        <h1 id="page-title">Markdown を Lint チェックできる「markdownlint」を試してみた</h1>

<p>Markdown 記法は HTML パースしてプレビューするものだが、プレーンテキストで見ても見出しやリストなどの可読性が高いことが特徴だ。</p>
<p>しかし、Markdown 記法や「文章をマークアップする」という概念に乏しい素人が書くと、適切な改行はないわ、デタラメに半角スペースを入れるわで、読めたもんじゃない。</p>
<p>日本語としてまともかどうかは以前紹介した <em>textlint</em> でチェックするとして、</p>
<ul>
  <li><a href="/blog/2017/09/19-02.html">TextLint を使ってみる</a></li>
</ul>
<p>今回は、Markdown 記法が読みやすく適切に書けているかをチェックする <strong>markdownlint</strong> というツールを使ってみる。</p>
<h2 id="目次"><a class="header-link" href="#目次"><span class="header-link-mark"></span></a>目次</h2>
<ul>
  <li><a href="#markdownlint">MarkdownLint</a></li>
  <li><a href="#%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%A8%E5%9F%BA%E6%9C%AC%E7%9A%84%E3%81%AA%E4%BD%BF%E3%81%84%E6%96%B9">インストールと基本的な使い方</a></li>
  <li><a href="#%E5%A4%96%E9%83%A8%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%A7%E3%83%AB%E3%83%BC%E3%83%AB%E3%82%92%E8%A8%AD%E5%AE%9A%E3%81%99%E3%82%8B">外部ファイルでルールを設定する</a></li>
  <li><a href="#%E9%99%A4%E5%A4%96%E3%81%99%E3%82%8B%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E6%8C%87%E5%AE%9A%E3%81%99%E3%82%8B">除外するディレクトリ・ファイルを指定する</a></li>
  <li><a href="#auto-fix-%E6%A9%9F%E8%83%BD%E3%81%AF-vscode-%E6%8B%A1%E5%BC%B5%E6%A9%9F%E8%83%BD%E3%81%A7">Auto Fix 機能は VSCode 拡張機能で</a></li>
  <li><a href="#%E4%BB%A5%E4%B8%8A">以上</a></li>
</ul>
<h2 id="markdownlint"><a class="header-link" href="#markdownlint"><span class="header-link-mark"></span></a>MarkdownLint</h2>
<p>MarkdownLint 本体は API しか提供していない。</p>
<ul>
  <li><a href="https://github.com/markdownlint/markdownlint">GitHub - markdownlint/markdownlint: Markdown lint tool</a></li>
</ul>
<p>今回はコレを CLI から実行できる、<strong>markdownlint-cli</strong> を使ってみる。</p>
<ul>
  <li><a href="https://github.com/igorshubovych/markdownlint-cli">GitHub - igorshubovych/markdownlint-cli: MarkdownLint Command Line Interface</a></li>
</ul>
<h2 id="インストールと基本的な使い方"><a class="header-link" href="#インストールと基本的な使い方"><span class="header-link-mark"></span></a>インストールと基本的な使い方</h2>
<p>まずは markdownlint-cli をインストールする。今回は簡単にするためグローバルインストールする。</p>
<pre class="language-bash"><code class="language-bash">$ <span class="token function">npm</span> i -g markdownlint-cli
</code></pre>
<p>デフォルトで用意されているルールを使ってそのままチェックを始める、最も基本的な使い方は以下のとおり。</p>
<pre class="language-bash"><code class="language-bash">$ markdownlint ./documents/

documents/example1.md: <span class="token number">4</span>: MD022/blanks-around-headers Headers should be surrounded by blank lines <span class="token punctuation">[</span>Context: <span class="token string">"# 見出しテキスト"</span><span class="token punctuation">]</span>
documents/some-section/example2.md: <span class="token number">112</span>: MD009/no-trailing-spaces Trailing spaces <span class="token punctuation">[</span>Expected: <span class="token number">2</span><span class="token punctuation">;</span> Actual: <span class="token number">4</span><span class="token punctuation">]</span>
</code></pre>
<p>このようにすると、<code>./documents/</code> 配下にある Markdown ファイルを全てチェックしてくれる。サブディレクトリも再帰的に調べてくれるので楽チン。</p>
<p>上述の結果だと、</p>
<ul>
  <li><code>example1.md</code> は <code># 見出しテキスト</code> の前後に空行がないよ、のエラー</li>
  <li><code>example2.md</code> は行末に4つの半角スペースがあるが、改行のためのスペースなら2つで良いよ、のエラー</li>
</ul>
<p>が検出されている。</p>
<h2 id="外部ファイルでルールを設定する"><a class="header-link" href="#外部ファイルでルールを設定する"><span class="header-link-mark"></span></a>外部ファイルでルールを設定する</h2>
<p>MarkdownLint が対応しているルールの一覧は以下で確認できる。</p>
<ul>
  <li><a href="https://github.com/DavidAnson/markdownlint/blob/master/doc/Rules.md">markdownlint/Rules.md at master · DavidAnson/markdownlint · GitHub</a></li>
</ul>
<p>このルールを個別に無効にしたり、ルールで縛る内容を変更したりできる。CLI で使う時は何でも良いが、VSCode 拡張機能との連携を考慮して <code>.markdownlint.json</code> というファイル名にしておこう。</p>
<p>内容は JSON 形式で記述する。以下は MD001、見出しレベルを1つずつ下げているか (見出しレベルをスキップしていないか) をチェックするルールを無効にした。</p>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"MD001"</span><span class="token operator">:</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>
</code></pre>
<p>ルール名は ID だけでなくエイリアスも振られているので、MD001 のルールを無効にするには、以下のように書いても同じだ。</p>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"header-increment"</span><span class="token operator">:</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>
</code></pre>
<p>JavaScript コメントを書いても認識はしてくれるが、パースエラーというワーニングが表示されて精神衛生的に良くない。無効なプロパティは無視されるので、ルール ID をコメントで記述し、エイリアスの方で実際にルールを指定するとメンテしやすいかも。</p>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"//"</span><span class="token operator">:</span> <span class="token string">".markdownlint.json : https://github.com/DavidAnson/markdownlint/blob/master/doc/Rules.md"</span><span class="token punctuation">,</span>
  <span class="token property">"//"</span><span class="token operator">:</span> <span class="token string">"--------+-----------------------------------------"</span><span class="token punctuation">,</span>
  <span class="token property">"//"</span><span class="token operator">:</span> <span class="token string">" ID     | Rules                                   "</span><span class="token punctuation">,</span>
  <span class="token property">"//"</span><span class="token operator">:</span> <span class="token string">"--------+-----------------------------------------"</span><span class="token punctuation">,</span>
  <span class="token property">"//"</span><span class="token operator">:</span> <span class="token string">"MD003"</span><span class="token punctuation">,</span>   <span class="token property">"header-style"</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">"style"</span><span class="token operator">:</span> <span class="token string">"atx"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"//"</span><span class="token operator">:</span> <span class="token string">"MD004"</span><span class="token punctuation">,</span>   <span class="token property">"ul-style"</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">"style"</span><span class="token operator">:</span> <span class="token string">"dash"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"//"</span><span class="token operator">:</span> <span class="token string">"MD009"</span><span class="token punctuation">,</span>   <span class="token property">"no-trailing-spaces"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                     <span class="token property">"br_spaces"</span><span class="token operator">:</span> <span class="token number">2</span>
                   <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"//"</span><span class="token operator">:</span> <span class="token string">"MD012"</span><span class="token punctuation">,</span>   <span class="token property">"no-multiple-blanks"</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">"maximum"</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"//"</span><span class="token operator">:</span> <span class="token string">"MD013"</span><span class="token punctuation">,</span>   <span class="token property">"line-length"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token property">"//"</span><span class="token operator">:</span> <span class="token string">"MD014"</span><span class="token punctuation">,</span>   <span class="token property">"commands-show-output"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token property">"//"</span><span class="token operator">:</span> <span class="token string">"MD024"</span><span class="token punctuation">,</span>   <span class="token property">"no-duplicate-header"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token property">"//"</span><span class="token operator">:</span> <span class="token string">"MD026"</span><span class="token punctuation">,</span>   <span class="token property">"no-trailing-punctuation"</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">"punctuation"</span><span class="token operator">:</span> <span class="token string">".,:!?"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"//"</span><span class="token operator">:</span> <span class="token string">"MD033"</span><span class="token punctuation">,</span>   <span class="token property">"no-inline-html"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token property">"//"</span><span class="token operator">:</span> <span class="token string">"MD035"</span><span class="token punctuation">,</span>   <span class="token property">"hr-style"</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token property">"style"</span><span class="token operator">:</span> <span class="token string">"---"</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"//"</span><span class="token operator">:</span> <span class="token string">"MD041"</span><span class="token punctuation">,</span>   <span class="token property">"first-line-h1"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
  <span class="token property">"//"</span><span class="token operator">:</span> <span class="token string">"MD044"</span><span class="token punctuation">,</span>   <span class="token property">"proper-names"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                      <span class="token property">"names"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                        <span class="token string">"JavaScript"</span>
                      <span class="token punctuation">]</span><span class="token punctuation">,</span>
                      <span class="token property">"code_blocks"</span><span class="token operator">:</span> <span class="token boolean">false</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"//"</span><span class="token operator">:</span> <span class="token string">"--------------------------------------------------"</span>
<span class="token punctuation">}</span>
</code></pre>
<p>こんな感じ。逆に見づらいかな…。</p>
<p>設定ファイルを利用して Lint チェックを行うには以下のように呼ぶ。</p>
<pre class="language-bash"><code class="language-bash">$ markdownlint ./documents/ --config ./.markdownlint.json
</code></pre>
<h2 id="除外するディレクトリファイルを指定する"><a class="header-link" href="#除外するディレクトリファイルを指定する"><span class="header-link-mark"></span></a>除外するディレクトリ・ファイルを指定する</h2>
<p>Lint チェックの対象外とするディレクトリやファイルを指定するには以下のようにする。<code>--ignore</code> オプションは複数書ける。</p>
<pre class="language-bash"><code class="language-bash">$ markdownlint ./documents/ --config ./.markdownlint.json --ignore ./documents/node_modules/ --ignore ./documents/memo.md
</code></pre>
<h2 id="auto-fix-機能は-vscode-拡張機能で"><a class="header-link" href="#auto-fix-機能は-vscode-拡張機能で"><span class="header-link-mark"></span></a>Auto Fix 機能は VSCode 拡張機能で</h2>
<p>markdownlint-cli には Auto Fix (自動修正) 機能はない。自動修正をしたい場合は、VSCode エディタの拡張機能「markdownlint」を使おう。</p>
<ul>
  <li><a href="https://marketplace.visualstudio.com/items?itemName=DavidAnson.vscode-markdownlint">markdownlint - Visual Studio Marketplace</a></li>
</ul>
<p>コレをインストールしたら Markdown ファイルを開き、緑の波線が引かれている箇所を選択する。すると電球のアイコンが表示されるので、それをクリックするか <code>Ctrl + .</code> (<code>Cmd + .</code>) を押下してコンテキストメニューを表示する。メニューから「Click to fix this violoation...」を選択すると自動修正できる。</p>
<p>残念ながら、ファイル内の指摘箇所を全て一気に修正したり、対象ディレクトリ内の違反箇所を一括で自動修正したりはできない模様。普段からよく読み返してちゃんと書けということか。</p>
<h2 id="以上"><a class="header-link" href="#以上"><span class="header-link-mark"></span></a>以上</h2>
<p>TextLint と MarkdownLint で、Markdown ファイルの形式的な日本語・書式チェックはできるようになったであろう。</p>

      </main>
      <footer id="footer">
        <div id="date-time">
          <dl>
            <dt>Created</dt>
            <dd><time>2018-04-20</time></dd>
            <dt>Last-Modified</dt>
            <dd><time>2018-04-20</time></dd>
          </dl>
        </div>
        <nav id="footer-links">
          <ul>
            <li id="footer-link-about"><a href="/about/index.html" title="About">About</a></li>
            <li id="footer-link-search"><a href="/about/search.html" title="Search">Search</a></li>
            <li id="footer-link-feeds"><a href="/feeds.xml" title="Feeds">Feeds</a></li>
            <li id="footer-link-github"><a href="https://github.com/Neos21/" title="GitHub">GitHub</a></li>
          </ul>
        </nav>
        <nav id="to-top"><a href="#" title="To Top"><span>▲ To Top</span></a></nav>
      </footer>
    </div>
  </body>
</html>
