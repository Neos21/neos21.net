<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="theme-color" content="#0990d0">
    <!-- Google Search Console -->
    <meta name="google-site-verification" content="AvoEr3mUJFF2H_mPWWgShfmjBVP3ywRpyx9hxeeq2d4">
    <title>é…ã‚Œã°ã›ãªãŒã‚‰ Stable Diffusion ã‚’è§¦ã£ã¦ã¿ã¾ã—ãŸãƒ»ã‚³ãƒ”ãƒšã§å‹•ã‹ã›ã‚‹ã‚³ãƒãƒ³ãƒ‰ãƒ»ã‚³ãƒ¼ãƒ‰ç´¹ä»‹ - Neo's World</title>
    <link rel="icon" href="/favicon.ico">
    <link rel="stylesheet" href="/styles.css">
    <link rel="canonical" href="https://neos21.net/blog/2023/02/27-01.html">
    <link rel="search" type="application/opensearchdescription+xml" title="neos21.net" href="/opensearch.xml">
    <link rel="alternate" type="application/atom+xml" href="/feeds.xml">
    <link rel="author" href="http://www.hatena.ne.jp/neos21/">
    <!-- Global Site Tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YMHFLZP1M1"></script>
    <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date());gtag('config','G-YMHFLZP1M1');gtag('config','UA-106501-1');</script>
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6475907504235292" crossorigin="anonymous"></script>
  </head>
  <body>
    <div id="container">
      <header id="header">
        <div id="header-brand">
          <div id="header-brand-contents">
            <div id="site-title"><a href="/index.html">Neo's World</a></div>
            <nav id="header-links">
              <ul>
                <li id="header-link-about"><a href="/about/index.html" title="About"><span>About</span></a></li>
                <li id="header-link-search"><a href="/about/search.html" title="Search"><span>Search</span></a></li>
                <li id="header-link-feeds"><a href="/feeds.xml" title="Feeds"><span>Feeds</span></a></li>
                <li id="header-link-to-bottom"><a href="#footer" title="To Bottom"><span>â–¼ To Bottom</span></a></li>
              </ul>
            </nav>
          </div>
        </div>
        <nav id="global-nav">
          <ul>
            <li><a href="/blog/index.html">Blog</a></li>
            <li><a href="/tech/index.html">Tech</a></li>
            <li><a href="/music/index.html">Music</a></li>
            <li><a href="/games/index.html">Games</a></li>
            <li><a href="/gallery/index.html">Gallery</a></li>
            <li><a href="/etc/index.html">Etc.</a></li>
          </ul>
        </nav>
        <nav id="path">
          <ul>
            <li><a href="/index.html">Neo's World</a></li>
            <li><a href="/blog/index.html">Blog</a></li>
            <li><a href="/blog/2023/index.html">2023å¹´</a></li>
            <li><a href="/blog/2023/02/index.html">02æœˆ</a></li>
          </ul>
        </nav>
      </header>
      <main id="main">
        <div id="header-date"><time>2023-02-27</time></div>
        <h1 id="page-title">é…ã‚Œã°ã›ãªãŒã‚‰ Stable Diffusion ã‚’è§¦ã£ã¦ã¿ã¾ã—ãŸãƒ»ã‚³ãƒ”ãƒšã§å‹•ã‹ã›ã‚‹ã‚³ãƒãƒ³ãƒ‰ãƒ»ã‚³ãƒ¼ãƒ‰ç´¹ä»‹</h1>

<p>ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ (å‘ªæ–‡) ãƒ†ã‚­ã‚¹ãƒˆã‚’å…¥åŠ›ã™ã‚‹ã¨ç”»åƒã‚’ç”Ÿæˆã—ã¦ãã‚Œã‚‹ AIã€<strong>Stable Diffusion</strong>ã€‚ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã™ã‚Œã°ãƒ­ãƒ¼ã‚«ãƒ«ãƒã‚·ãƒ³ä¸Šã§ã‚‚å‹•ã‹ã›ã‚‹ã®ãŒç‰¹å¾´ãªã®ã§ã€ä»Šå›ã¯è‡ªåˆ†ã®ãƒã‚·ãƒ³ã§ Stable Diffusion ã«ã‚ˆã‚‹ç”»åƒç”Ÿæˆã¾ã§ã‚’è©¦ã—ã¦ã¿ãŸã€‚<strong>ä»Šå›ç´¹ä»‹ã™ã‚‹ã‚³ãƒãƒ³ãƒ‰ãƒ»ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒšã—ã¦çœŸä¼¼ã—ã¦ã„ã‘ã°ã‚¢ãƒŠã‚¿ã®ãƒã‚·ãƒ³ã§ã‚‚ Stable Diffusion ãŒå‹•ã‹ã›ã‚‹ãƒ¨ï¼</strong></p><div class="ad-amazon">
  <div class="ad-amazon-image">
    <a href="https://www.amazon.co.jp/dp/B0BJTVNYNR?tag=neos21-22&amp;linkCode=osi&amp;th=1&amp;psc=1">
      <img src="https://m.media-amazon.com/images/I/51GUPZw6JbL._SL160_.jpg" width="113" height="160">
    </a>
  </div>
  <div class="ad-amazon-info">
    <div class="ad-amazon-title">
      <a href="https://www.amazon.co.jp/dp/B0BJTVNYNR?tag=neos21-22&amp;linkCode=osi&amp;th=1&amp;psc=1">AIã¨ã‚³ãƒ©ãƒœã—ã¦ç¥çµµå¸«ã«ãªã‚‹ã€€è«–æ–‡ã‹ã‚‰èª­ã¿è§£ãStable Diffusion (æŠ€è¡“ã®æ³‰ã‚·ãƒªãƒ¼ã‚ºï¼ˆNextPublishingï¼‰)</a>
    </div>
  </div>
</div>
<h2 id="ç›®æ¬¡"><a class="header-link" href="#ç›®æ¬¡"><span class="header-link-mark"></span></a>ç›®æ¬¡</h2>
<ul>
  <li>
    <ul>
      <li><a href="#pc-%E7%92%B0%E5%A2%83">PC ç’°å¢ƒ</a></li>
      <li><a href="#python-39-%E7%B3%BB%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B">Python 3.9 ç³»ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹</a></li>
      <li><a href="#%E4%B8%80%E5%BF%9C-pyenv-win-%E3%82%92%E5%85%A5%E3%82%8C%E3%81%A6%E3%81%8A%E3%81%8F">ä¸€å¿œ pyenv-win ã‚’å…¥ã‚Œã¦ãŠã</a></li>
      <li><a href="#cuda-%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B">CUDA ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹</a></li>
    </ul>
  </li>
  <li><a href="#pytorch-%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B">PyTorch ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹</a>
    <ul>
      <li><a href="#transformers-%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B">Transformers ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹</a></li>
      <li><a href="#diffusers-%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B">Diffusers ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹</a></li>
      <li><a href="#accelerate-%E3%82%92%E5%85%A5%E3%82%8C%E3%82%8B%E3%81%A8%E8%89%AF%E3%81%84%E3%82%88%E3%81%A8%E3%83%A1%E3%83%83%E3%82%BB%E3%83%BC%E3%82%B8%E3%81%8C%E5%87%BA%E3%81%A6%E3%81%8D%E3%81%9F%E3%81%AE%E3%81%A7%E5%85%A5%E3%82%8C%E3%82%8B">Accelerate ã‚’å…¥ã‚Œã‚‹ã¨è‰¯ã„ã‚ˆã¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå‡ºã¦ããŸã®ã§å…¥ã‚Œã‚‹</a></li>
      <li><a href="#hugging-face-%E3%81%AB%E7%99%BB%E9%8C%B2%E3%81%97%E3%81%A6-api-key-%E3%82%92%E7%99%BA%E8%A1%8C%E3%81%99%E3%82%8B">Hugging Face ã«ç™»éŒ²ã—ã¦ API Key ã‚’ç™ºè¡Œã™ã‚‹</a></li>
      <li><a href="#waifu-diffusion-%E3%82%82%E8%A9%A6%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B">Waifu Diffusion ã‚‚è©¦ã—ã¦ã¿ã‚‹</a></li>
      <li><a href="#%E4%BB%8A%E5%9B%9E%E3%81%AF%E3%82%B3%E3%82%B3%E3%81%BE%E3%81%A7">ä»Šå›ã¯ã‚³ã‚³ã¾ã§ï¼</a></li>
    </ul>
  </li>
</ul>
<h2 id="pc-ç’°å¢ƒ"><a class="header-link" href="#pc-ç’°å¢ƒ"><span class="header-link-mark"></span></a>PC ç’°å¢ƒ</h2>
<p>ä»Šå›æ¤œè¨¼ã—ãŸ PC ç’°å¢ƒã¯æ¬¡ã®ã¨ãŠã‚Šã€‚</p>
<ul>
  <li>OS : Windows 10</li>
  <li>CPU : Intel Core i7-7700K</li>
  <li>GPU : NVIDIA GeForce GTX1080</li>
</ul>
<p>GTX1080 æ­è¼‰ã® PC ã§ã€GPU ã‚’ä½¿ã£ã¦ç”»åƒç”Ÿæˆã™ã‚‹ã€‚çµæœçš„ã«ã€1æšã®ç”»åƒã¯2åˆ†ç¨‹åº¦ã§ç”Ÿæˆã§ããŸã€‚</p>
<h2 id="python-39-ç³»ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹"><a class="header-link" href="#python-39-ç³»ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹"><span class="header-link-mark"></span></a>Python 3.9 ç³»ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹</h2>
<p>ä»Šå›ã¯ <em>WSL ã‚’ä½¿ã‚ãš</em>ã€Windows ç’°å¢ƒã® PowerShell ã‚’ä½¿ã£ã¦ã€ç›´æ¥ Python ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã„ãã“ã¨ã«ã™ã‚‹ã€‚</p>
<p>Stable Diffusion ã‚’å‹•ä½œã•ã›ã‚‹ã«ã‚ãŸã£ã¦ã€<em>PyTorch</em> ã¨ã„ã†æ©Ÿæ¢°å­¦ç¿’ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚ã‚³ãƒ¬ã¯ Facebook ãŒé–‹ç™ºã—ã¦ã„ã‚‹ãƒ¢ãƒã‚‰ã—ã„ãŒã€å‹•ä½œã™ã‚‹ Python ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒ v3.9 ç³»ã¾ã§ã§ã€v3.10 ã‚„ v3.11 ç³»ã§ã¯ã†ã¾ãã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒã§ããªã‹ã£ãŸã€‚</p>
<p>è‡ªåˆ†ã®ç’°å¢ƒã§ã¯ Microsoft Store ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸ v3.10 ã¨ v3.11 ãŒå¾®å¦™ã«ä½µå­˜ã—ã¦ã„ãŸã®ã§ã€ä¸€æ—¦å…¨éƒ¨ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã€Python.org ã‹ã‚‰ v3.9.13 ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸã€‚</p>
<ul>
  <li>å‚è€ƒ : <a href="https://self-development.info/pytorch%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%AB%E5%A4%B1%E6%95%97%E3%81%97%E3%81%9F%E5%A0%B4%E5%90%88%E3%81%AB%E3%83%81%E3%82%A7%E3%83%83%E3%82%AF%E3%81%99%E3%81%B9/">PyTorchã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¤±æ•—æ™‚ã«ãƒã‚§ãƒƒã‚¯ã™ã¹ãã“ã¨ | ã‚¸ã‚³ãƒ­ã‚°</a></li>
</ul>
<pre class="language-powershell"><code class="language-powershell"><span class="token comment"># Python v3.11 ã§ PyTorch ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã‚ˆã†ã¨ã™ã‚‹ã¨æ¬¡ã®ã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹</span>
<span class="token function">PS</span>> pip install torch torchvision torchaudio <span class="token operator">--</span>extra<span class="token operator">-</span>index<span class="token operator">-</span>url https:<span class="token operator">/</span><span class="token operator">/</span>download<span class="token punctuation">.</span>pytorch<span class="token punctuation">.</span>org<span class="token operator">/</span>whl<span class="token operator">/</span>cu117
Looking in indexes: https:<span class="token operator">/</span><span class="token operator">/</span>pypi<span class="token punctuation">.</span>org<span class="token operator">/</span>simple<span class="token punctuation">,</span> https:<span class="token operator">/</span><span class="token operator">/</span>download<span class="token punctuation">.</span>pytorch<span class="token punctuation">.</span>org<span class="token operator">/</span>whl<span class="token operator">/</span>cu117
ERROR: Could not find a version that satisfies the requirement torch <span class="token punctuation">(</span><span class="token keyword">from</span> versions: none<span class="token punctuation">)</span>
ERROR: No matching distribution found <span class="token keyword">for</span> torch
</code></pre>
<ul>
  <li>å‚è€ƒ : <a href="https://www.python.org/downloads/release/python-3913/">Python Release Python 3.9.13 | Python.org</a>
    <ul>
      <li><code>python-3.9.13-amd64.exe</code> ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹</li>
    </ul>
  </li>
</ul>
<pre class="language-powershell"><code class="language-powershell">> python <span class="token operator">-</span>V
Python 3<span class="token punctuation">.</span>9<span class="token punctuation">.</span>13

> pip list
Package    Version
<span class="token operator">--</span>-<span class="token operator">--</span>-<span class="token operator">--</span>-<span class="token operator">-</span> <span class="token operator">--</span>-<span class="token operator">--</span>-<span class="token operator">-</span>
pip        22<span class="token punctuation">.</span>0<span class="token punctuation">.</span>4
setuptools 58<span class="token punctuation">.</span>1<span class="token punctuation">.</span>0

<span class="token comment"># pip ã‚’æœ€æ–°ç‰ˆã«ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã™ã‚‹</span>
> python <span class="token operator">-</span>m pip install <span class="token operator">--</span>upgrade pip setuptools
</code></pre>
<p>ã‚³ã‚³ã¾ã§æº–å‚™ã§ããŸã‚‰ Python æœ¬ä½“ã®æº–å‚™ã¯å®Œäº†ã€‚</p>
<h2 id="ä¸€å¿œ-pyenv-win-ã‚’å…¥ã‚Œã¦ãŠã"><a class="header-link" href="#ä¸€å¿œ-pyenv-win-ã‚’å…¥ã‚Œã¦ãŠã"><span class="header-link-mark"></span></a>ä¸€å¿œ pyenv-win ã‚’å…¥ã‚Œã¦ãŠã</h2>
<p>ãƒ›ã‚¹ãƒˆç’°å¢ƒã«ç›´æ¥ Python 3.9.13 ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸã®ã§ã€ä»Šå¾Œ Python ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’åˆ‡ã‚Šæ›¿ãˆãŸã‚Šã§ãã‚‹ã‚ˆã†ã«ã€<code>pyenv-win</code> ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã€åŒã˜ v3.9.13 ã‚’ä½¿ç”¨ã™ã‚‹è¨­å®šã«ã—ã¦ãŠãã€‚</p>
<ul>
  <li>å‚è€ƒ : <a href="https://www.3ryu-engineer.work/windows-pyenv/">â˜…2022å¹´æœ€æ–°â˜…å…¥é–€ï¼Windowsã§pyenvã‚’ä½¿ã†æ–¹æ³• - ï¼“æµãªSEã®ãƒ¡ãƒ¢å¸³</a></li>
</ul>
<pre class="language-powershell"><code class="language-powershell"><span class="token comment"># pyenv-win ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹</span>
> pip install pyenv<span class="token operator">-</span>win <span class="token operator">--</span>target <span class="token punctuation">.</span>pyenv
<span class="token comment"># `~/.pyenv/` (`C:\Users\ã€ãƒ¦ãƒ¼ã‚¶åã€‘\.pyenv\`) ãƒ•ã‚©ãƒ«ãƒ€ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã‚‹</span>
</code></pre>
<p>ã€Œã‚·ã‚¹ãƒ†ãƒ ç’°å¢ƒå¤‰æ•°ã€ã« <code>PYENV</code> ã‚’è¨­å®šã—ã€<code>PATH</code> ã‚’é€šã™ã€‚</p>
<ul>
  <li><code>PYENV</code> : <code>C:\Users\ã€ãƒ¦ãƒ¼ã‚¶åã€‘\.pyenv\pyenv-win</code></li>
  <li><code>PATH</code> : <code>%PYENV%\bin</code> ã‚’æœ€å„ªå…ˆã«ã—ã¦ãŠã</li>
</ul>
<p>å†èµ·å‹•å¾Œã€ä»¥ä¸‹ã®ã‚ˆã†ã« <code>pyenv</code> ã‚³ãƒãƒ³ãƒ‰ãŒå‹•ä½œã—ãŸã‚‰ã‚°ãƒ­ãƒ¼ãƒãƒ«ã« v3.9.13 ã‚’è¨­å®šã—ã¦ãŠãã€‚</p>
<pre class="language-powershell"><code class="language-powershell">> pyenv <span class="token operator">--</span>version
pyenv 3<span class="token punctuation">.</span>1<span class="token punctuation">.</span>1

> pyenv install 3<span class="token punctuation">.</span>9<span class="token punctuation">.</span>13
> pyenv versions
> pyenv global 3<span class="token punctuation">.</span>9<span class="token punctuation">.</span>13
</code></pre>
<h2 id="cuda-ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹"><a class="header-link" href="#cuda-ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹"><span class="header-link-mark"></span></a>CUDA ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹</h2>
<p>PyTorch ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒ GPU ã‚’åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã€NVIDIA ã® CUDA ã¨ã„ã†ãƒ„ãƒ¼ãƒ«ã‚­ãƒƒãƒˆã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãŠãã€‚</p>
<ul>
  <li>å‚è€ƒ : <a href="https://self-development.info/tensorflow-1%e7%b3%bbgpu%e7%89%88%e3%81%ae%e3%81%9f%e3%82%81%e3%81%abcuda-10-0%e3%82%92%e3%82%a4%e3%83%b3%e3%82%b9%e3%83%88%e3%83%bc%e3%83%ab/">TensorFlow 1ç³»(GPUç‰ˆ)ã®ãŸã‚ã«CUDA 10.0ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« | ã‚¸ã‚³ãƒ­ã‚°</a></li>
  <li><a href="https://developer.nvidia.com/cuda-toolkit-archive">CUDA Toolkit Archive | NVIDIA Developer</a>
    <ul>
      <li>CUDA Toolkit 11.7.0 : <code>cuda_11.7.0_516.01_windows.exe</code> ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹</li>
    </ul>
  </li>
</ul>
<p>ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¾Œã€ç’°å¢ƒå¤‰æ•° <code>CUDA_PATH</code> ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ãŸã‚‰ã€PowerShell ã§ <code>nvcc</code> ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ã£ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒæˆåŠŸã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹ã€‚</p>
<pre class="language-powershell"><code class="language-powershell">> nvcc <span class="token operator">-</span>V
nvcc: NVIDIA <span class="token punctuation">(</span>R<span class="token punctuation">)</span> Cuda compiler driver
Copyright <span class="token punctuation">(</span>c<span class="token punctuation">)</span> 2005<span class="token operator">-</span>2022 NVIDIA Corporation
Built on Tue_May__3_19:00:59_Pacific_Daylight_Time_2022
Cuda compilation tools<span class="token punctuation">,</span> release 11<span class="token punctuation">.</span>7<span class="token punctuation">,</span> V11<span class="token punctuation">.</span>7<span class="token punctuation">.</span>64
Build cuda_11<span class="token punctuation">.</span>7<span class="token punctuation">.</span>r11<span class="token punctuation">.</span>7<span class="token operator">/</span>compiler<span class="token punctuation">.</span>31294372_0
</code></pre>
<h1 id="pytorch-ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹"><a class="header-link" href="#pytorch-ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹"><span class="header-link-mark"></span></a>PyTorch ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹</h1>
<p>Python æœ¬ä½“ãƒ»pyenv-winãƒ»CUDA ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒçµ‚ã‚ã£ãŸã®ã§ã€ã‚ˆã†ã‚„ã PyTorch ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã‚‹ã€‚</p>
<ul>
  <li>å‚è€ƒ : <a href="https://self-development.info/%e3%80%90windows%e3%80%91gpu%e7%89%88pytorch-1-12%e7%b3%bb%e3%81%ae%e3%82%a4%e3%83%b3%e3%82%b9%e3%83%88%e3%83%bc%e3%83%ab/">ã€Windowsã€‘GPUç‰ˆPyTorch 1.12ç³»ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« | ã‚¸ã‚³ãƒ­ã‚°</a></li>
  <li>å‚è€ƒ : <a href="https://pytorch.org/get-started/locally/">Start Locally | PyTorch</a>
    <ul>
      <li>ã“ã®ã‚µã‚¤ãƒˆã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚³ãƒãƒ³ãƒ‰ã‚’çµ„ã¿ç«‹ã¦ã‚‰ã‚Œã‚‹</li>
    </ul>
  </li>
</ul>
<pre class="language-powershell"><code class="language-powershell">> pip install torch torchvision torchaudio <span class="token operator">--</span>extra<span class="token operator">-</span>index<span class="token operator">-</span>url https:<span class="token operator">/</span><span class="token operator">/</span>download<span class="token punctuation">.</span>pytorch<span class="token punctuation">.</span>org<span class="token operator">/</span>whl<span class="token operator">/</span>cu117
Installing collected packages: charset<span class="token operator">-</span>normalizer<span class="token punctuation">,</span> urllib3<span class="token punctuation">,</span> typing<span class="token operator">-</span>extensions<span class="token punctuation">,</span> pillow<span class="token punctuation">,</span> numpy<span class="token punctuation">,</span> idna<span class="token punctuation">,</span> certifi<span class="token punctuation">,</span> torch<span class="token punctuation">,</span> requests<span class="token punctuation">,</span> torchvision<span class="token punctuation">,</span> torchaudio
Successfully installed certifi<span class="token operator">-</span>2022<span class="token punctuation">.</span>12<span class="token punctuation">.</span>7 charset<span class="token operator">-</span>normalizer<span class="token operator">-</span>3<span class="token punctuation">.</span>0<span class="token punctuation">.</span>1 idna<span class="token operator">-</span>3<span class="token punctuation">.</span>4 numpy<span class="token operator">-</span>1<span class="token punctuation">.</span>24<span class="token punctuation">.</span>2 pillow<span class="token operator">-</span>9<span class="token punctuation">.</span>4<span class="token punctuation">.</span>0 requests<span class="token operator">-</span>2<span class="token punctuation">.</span>28<span class="token punctuation">.</span>2 torch<span class="token operator">-</span>1<span class="token punctuation">.</span>13<span class="token punctuation">.</span>1<span class="token operator">+</span>cu117 torchaudio<span class="token operator">-</span>0<span class="token punctuation">.</span>13<span class="token punctuation">.</span>1<span class="token operator">+</span>cu117 torchvision<span class="token operator">-</span>0<span class="token punctuation">.</span>14<span class="token punctuation">.</span>1<span class="token operator">+</span>cu117 typing<span class="token operator">-</span>extensions<span class="token operator">-</span>4<span class="token punctuation">.</span>5<span class="token punctuation">.</span>0 urllib3<span class="token operator">-</span>1<span class="token punctuation">.</span>26<span class="token punctuation">.</span>14
</code></pre>
<p>PyTorch ã®å‹•ä½œç¢ºèªç”¨ã«ã€æ¬¡ã®ã‚ˆã†ãª Python ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’æ›¸ã„ã¦ã¿ã‚‹ã€‚</p>
<ul>
  <li><code>check-pytorch.py</code></li>
</ul>
<pre class="language-python"><code class="language-python"><span class="token keyword">import</span> torch
<span class="token keyword">print</span><span class="token punctuation">(</span>torch<span class="token punctuation">.</span>__version__<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>torch<span class="token punctuation">.</span>cuda<span class="token punctuation">.</span>is_available<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<p>PowerShell ã§å®Ÿè¡Œã—ã¦ã¿ã‚‹ã€‚</p>
<pre class="language-powershell"><code class="language-powershell">> python <span class="token punctuation">.</span>\check<span class="token operator">-</span>pytorch<span class="token punctuation">.</span>py
1<span class="token punctuation">.</span>13<span class="token punctuation">.</span>1<span class="token operator">+</span>cu117
True
</code></pre>
<p>ã“ã®ã‚ˆã†ã«è¡¨ç¤ºã•ã‚ŒãŸã‚‰ã€PyTorch ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ãŠã‚Šã€GPU ã‚’åˆ©ç”¨ã§ãã‚‹ (<code>True</code>) çŠ¶æ…‹ã¨åˆ†ã‹ã‚‹ã€‚</p>
<h2 id="transformers-ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹"><a class="header-link" href="#transformers-ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹"><span class="header-link-mark"></span></a>Transformers ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹</h2>
<p>Stable Diffusion ã¯ã€Hugging Face ãŒé–‹ç™ºã™ã‚‹è‡ªç„¶è¨€èªå‡¦ç†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã® <em>Transformers</em> ã‚‚ä½¿ç”¨ã™ã‚‹ã®ã§ã€ã‚³ã‚¤ãƒ„ã‚‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãŠãã€‚</p>
<ul>
  <li>å‚è€ƒ : <a href="https://self-development.info/huggingface%e3%81%aetransformers%e3%82%92%e3%82%a4%e3%83%b3%e3%82%b9%e3%83%88%e3%83%bc%e3%83%ab%e3%81%99%e3%82%8b/">Huggingfaceã®Transformersã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ | ã‚¸ã‚³ãƒ­ã‚°</a></li>
</ul>
<pre class="language-powershell"><code class="language-powershell">> pip install transformers
Installing collected packages: tokenizers<span class="token punctuation">,</span> regex<span class="token punctuation">,</span> pyyaml<span class="token punctuation">,</span> packaging<span class="token punctuation">,</span> filelock<span class="token punctuation">,</span> colorama<span class="token punctuation">,</span> tqdm<span class="token punctuation">,</span> huggingface<span class="token operator">-</span>hub<span class="token punctuation">,</span> transformers
Successfully installed colorama<span class="token operator">-</span>0<span class="token punctuation">.</span>4<span class="token punctuation">.</span>6 filelock<span class="token operator">-</span>3<span class="token punctuation">.</span>9<span class="token punctuation">.</span>0 huggingface<span class="token operator">-</span>hub<span class="token operator">-</span>0<span class="token punctuation">.</span>12<span class="token punctuation">.</span>1 packaging<span class="token operator">-</span>23<span class="token punctuation">.</span>0 pyyaml<span class="token operator">-</span>6<span class="token punctuation">.</span>0 regex<span class="token operator">-</span>2022<span class="token punctuation">.</span>10<span class="token punctuation">.</span>31 tokenizers<span class="token operator">-</span>0<span class="token punctuation">.</span>13<span class="token punctuation">.</span>2 tqdm<span class="token operator">-</span>4<span class="token punctuation">.</span>64<span class="token punctuation">.</span>1 transformers<span class="token operator">-</span>4<span class="token punctuation">.</span>26<span class="token punctuation">.</span>1
</code></pre>
<p>ã‚³ãƒãƒ©ã‚‚ Transformers ã®å‹•ä½œç¢ºèªã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œã£ã¦ç¢ºèªã—ã¦ã‚„ã‚ã†ã€‚</p>
<ul>
  <li><code>check-transformers.py</code></li>
</ul>
<pre class="language-python"><code class="language-python"><span class="token keyword">from</span> transformers <span class="token keyword">import</span> pipeline
classifier <span class="token operator">=</span> pipeline<span class="token punctuation">(</span><span class="token string">'sentiment-analysis'</span><span class="token punctuation">)</span>
results <span class="token operator">=</span> classifier<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"We are very happy to show you the ğŸ¤— Transformers library."</span><span class="token punctuation">,</span> <span class="token string">"We hope you don't hate it."</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> result <span class="token keyword">in</span> results<span class="token punctuation">:</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"label: </span><span class="token interpolation"><span class="token punctuation">{</span>result<span class="token punctuation">[</span><span class="token string">'label'</span><span class="token punctuation">]</span><span class="token punctuation">}</span></span><span class="token string">, with score: </span><span class="token interpolation"><span class="token punctuation">{</span><span class="token builtin">round</span><span class="token punctuation">(</span>result<span class="token punctuation">[</span><span class="token string">'score'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">}</span></span><span class="token string">"</span></span><span class="token punctuation">)</span>
</code></pre>
<p>æ¬¡ã®ã‚ˆã†ã«å®Ÿè¡Œã—ã¦ã‚„ã‚‹ã¨ã€æ„Ÿæƒ…åˆ†æãŒã•ã‚Œã¦ã„ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚‹ã€‚</p>
<pre class="language-powershell"><code class="language-powershell">> python <span class="token punctuation">.</span>\check<span class="token operator">-</span>transformers<span class="token punctuation">.</span>py
No model was supplied<span class="token punctuation">,</span> defaulted to distilbert<span class="token operator">-</span>base<span class="token operator">-</span>uncased<span class="token operator">-</span>finetuned<span class="token operator">-</span>sst<span class="token operator">-</span>2<span class="token operator">-</span>english and revision af0f99b <span class="token punctuation">(</span>https:<span class="token operator">/</span><span class="token operator">/</span>huggingface<span class="token punctuation">.</span>co<span class="token operator">/</span>distilbert<span class="token operator">-</span>base<span class="token operator">-</span>uncased<span class="token operator">-</span>finetuned<span class="token operator">-</span>sst<span class="token operator">-</span>2<span class="token operator">-</span>english<span class="token punctuation">)</span><span class="token punctuation">.</span>
<span class="token keyword">Using</span> a pipeline without specifying a model name and revision in production is not recommended<span class="token punctuation">.</span>
label: POSITIVE<span class="token punctuation">,</span> with score: 0<span class="token punctuation">.</span>9998
label: NEGATIVE<span class="token punctuation">,</span> with score: 0<span class="token punctuation">.</span>5309
</code></pre>
<h2 id="diffusers-ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹"><a class="header-link" href="#diffusers-ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹"><span class="header-link-mark"></span></a>Diffusers ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹</h2>
<p>Stable Diffusion ã‚’ç´ ã®ã¾ã¾ä½¿ãŠã†ã¨ã™ã‚‹ã¨ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒè‰²ã€…ã¨æ‰‹é–“å–ã‚‹ã®ã§ã€å®Ÿè¡Œæ™‚ã«å¿…è¦ã«å¿œã˜ã¦ãƒ¢ãƒ‡ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã‚Šã—ã¦ãã‚Œã‚‹ <strong>Diffusers</strong> ã¨ã„ã†ãƒ„ãƒ¼ãƒ«ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã€‚</p>
<ul>
  <li>å‚è€ƒ : <a href="https://self-development.info/%e6%9c%80%e5%85%88%e7%ab%af%e3%81%ae%e6%a9%9f%e6%a2%b0%e5%ad%a6%e7%bf%92%e3%83%a2%e3%83%87%e3%83%ab%e3%82%92%e5%88%a9%e7%94%a8%e3%81%a7%e3%81%8d%e3%82%8bdiffusers%e3%81%ae%e3%82%a4%e3%83%b3%e3%82%b9/">æœ€å…ˆç«¯ã®æ©Ÿæ¢°å­¦ç¿’ãƒ¢ãƒ‡ãƒ«ã‚’åˆ©ç”¨ã§ãã‚‹Diffusersã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« | ã‚¸ã‚³ãƒ­ã‚°</a></li>
</ul>
<pre class="language-powershell"><code class="language-powershell">> pip install diffusers
Installing collected packages: zipp<span class="token punctuation">,</span> importlib<span class="token operator">-</span>metadata<span class="token punctuation">,</span> diffusers
Successfully installed diffusers<span class="token operator">-</span>0<span class="token punctuation">.</span>13<span class="token punctuation">.</span>1 importlib<span class="token operator">-</span>metadata<span class="token operator">-</span>6<span class="token punctuation">.</span>0<span class="token punctuation">.</span>0 zipp<span class="token operator">-</span>3<span class="token punctuation">.</span>14<span class="token punctuation">.</span>0
</code></pre>
<p>ã‚³ãƒãƒ©ã‚‚ Diffusers ã®å‹•ä½œç¢ºèªã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’æ›¸ã„ã¦ã¿ã‚‹ã€‚å¾Œè¿°ã™ã‚‹ãŒ<strong>ç¾åœ¨ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ã¯ <code>["sample"]</code> éƒ¨åˆ†ã‚’ <code>["images"]</code> ã¨ä¿®æ­£ã—ãªã„ã¨æ­£å¸¸ã«å‹•ä½œã—ãªã„ã€‚</strong></p>
<ul>
  <li><code>check-diffusers.py</code></li>
</ul>
<pre class="language-python"><code class="language-python"><span class="token keyword">from</span> diffusers <span class="token keyword">import</span> DiffusionPipeline
model_id <span class="token operator">=</span> <span class="token string">"CompVis/ldm-text2im-large-256"</span>
<span class="token comment"># load model and scheduler</span>
ldm <span class="token operator">=</span> DiffusionPipeline<span class="token punctuation">.</span>from_pretrained<span class="token punctuation">(</span>model_id<span class="token punctuation">)</span>
<span class="token comment"># run pipeline in inference (sample random noise and denoise)</span>
prompt <span class="token operator">=</span> <span class="token string">"A painting of a squirrel eating a burger"</span>
images <span class="token operator">=</span> ldm<span class="token punctuation">(</span><span class="token punctuation">[</span>prompt<span class="token punctuation">]</span><span class="token punctuation">,</span> num_inference_steps<span class="token operator">=</span><span class="token number">50</span><span class="token punctuation">,</span> eta<span class="token operator">=</span><span class="token number">0.3</span><span class="token punctuation">,</span> guidance_scale<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">"sample"</span><span class="token punctuation">]</span>  <span class="token comment"># â† `["images"]` ã¨ã—ãªã„ã¨ã„ã‘ãªã„</span>
<span class="token comment"># save images</span>
<span class="token keyword">for</span> idx<span class="token punctuation">,</span> image <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>images<span class="token punctuation">)</span><span class="token punctuation">:</span>
  image<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f"squirrel-</span><span class="token interpolation"><span class="token punctuation">{</span>idx<span class="token punctuation">}</span></span><span class="token string">.png"</span></span><span class="token punctuation">)</span>
</code></pre>
<p>å®Ÿè¡Œã—ã¦ã¿ã‚‹ã¨æ¬¡ã®ã‚ˆã†ãªã‚¨ãƒ©ãƒ¼ãŒå‡ºãŸã€‚</p>
<pre class="language-powershell"><code class="language-powershell">> python <span class="token punctuation">.</span>\check<span class="token operator">-</span>diffusers<span class="token punctuation">.</span>py
Traceback <span class="token punctuation">(</span>most recent call last<span class="token punctuation">)</span>:
  File <span class="token string">"C:\Dev\practice-stable-diffusion\check-diffusers.py"</span><span class="token punctuation">,</span> line 7<span class="token punctuation">,</span> in &#x3C;module>
    images = ldm<span class="token punctuation">(</span><span class="token namespace">[prompt]</span><span class="token punctuation">,</span> num_inference_steps=50<span class="token punctuation">,</span> eta=0<span class="token punctuation">.</span>3<span class="token punctuation">,</span> guidance_scale=6<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">"sample"</span><span class="token punctuation">]</span>
  File <span class="token string">"C:\Users\Neo\AppData\Local\Programs\Python\Python39\lib\site-packages\diffusers\utils\outputs.py"</span><span class="token punctuation">,</span> line 88<span class="token punctuation">,</span> in __getitem__
    <span class="token keyword">return</span> inner_dict<span class="token namespace">[k]</span>
KeyError: <span class="token string">'sample'</span>
</code></pre>
<ul>
  <li>å‚è€ƒ : <a href="https://qiita.com/cress_cc/items/6012ecfabb33411a3d9b#keyerror-sample">Waifu Diffusionã®Open in ColabãŒå‹•ã‹ãªã„å ´åˆã®å¯¾å‡¦æ–¹æ³• - Qiita</a></li>
</ul>
<p>ã©ã†ã‚‚ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—ã«ã‚ˆã‚Šã€<code>["sample"]</code> éƒ¨åˆ†ãŒ <code>["images"]</code> ã«å¤‰æ›´ã•ã‚Œã¦ã„ã‚‹ã‚‰ã—ã„ã®ã§ã€ä¿®æ­£ã™ã‚‹ã¨ã†ã¾ãå‹•ã„ã¦ãã‚ŒãŸã€‚</p>
<h2 id="accelerate-ã‚’å…¥ã‚Œã‚‹ã¨è‰¯ã„ã‚ˆã¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå‡ºã¦ããŸã®ã§å…¥ã‚Œã‚‹"><a class="header-link" href="#accelerate-ã‚’å…¥ã‚Œã‚‹ã¨è‰¯ã„ã‚ˆã¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå‡ºã¦ããŸã®ã§å…¥ã‚Œã‚‹"><span class="header-link-mark"></span></a>Accelerate ã‚’å…¥ã‚Œã‚‹ã¨è‰¯ã„ã‚ˆã¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå‡ºã¦ããŸã®ã§å…¥ã‚Œã‚‹</h2>
<p>å…ˆç¨‹ã® <code>check-diffusers.py</code> ã‚’å®Ÿè¡Œã—ãŸã¨ãã«ã€<code>pip install accelerate</code> ã—ã‚ã¨ã„ã†ã‚ˆã†ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå‡ºã¦ãã¦ã„ãŸã®ã§å…¥ã‚Œã¦ãŠãã€‚PyTorch ã‚’ CPUãƒ»GPU ã‚’ã¾ãŸã„ã§è‰²ã€…ãªç’°å¢ƒã§ã†ã¾ãå‹•ã‹ã™ãŸã‚ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚‰ã—ã„ã€‚</p>
<pre class="language-powershell"><code class="language-powershell">> pip install accelerate
Installing collected packages: psutil<span class="token punctuation">,</span> accelerate
Successfully installed accelerate<span class="token operator">-</span>0<span class="token punctuation">.</span>16<span class="token punctuation">.</span>0 psutil<span class="token operator">-</span>5<span class="token punctuation">.</span>9<span class="token punctuation">.</span>4
</code></pre>
<ul>
  <li>å‚è€ƒ : <a href="https://self-development.info/%E3%80%90pytorch%E3%80%91accelerate%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%A8%E8%A8%AD%E5%AE%9A/">ã€PyTorchã€‘Accelerateã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¨è¨­å®š | ã‚¸ã‚³ãƒ­ã‚°</a></li>
</ul>
<h2 id="hugging-face-ã«ç™»éŒ²ã—ã¦-api-key-ã‚’ç™ºè¡Œã™ã‚‹"><a class="header-link" href="#hugging-face-ã«ç™»éŒ²ã—ã¦-api-key-ã‚’ç™ºè¡Œã™ã‚‹"><span class="header-link-mark"></span></a>Hugging Face ã«ç™»éŒ²ã—ã¦ API Key ã‚’ç™ºè¡Œã™ã‚‹</h2>
<p>Stable Diffusion ã®ãƒ¢ãƒ‡ãƒ«ã¯ Hugging Face ã¨ã„ã†ã‚µã‚¤ãƒˆãŒå…¬é–‹ã—ã¦ãŠã‚Šã€ãƒ¢ãƒ‡ãƒ«ã®åˆ©ç”¨ã«ã¯ API Key ã®ç™ºè¡ŒãŒå¿…è¦ã«ãªã‚‹ã€‚</p>
<ul>
  <li>å‚è€ƒ : <a href="https://huggingface.co/CompVis/stable-diffusion-v1-4">CompVis/stable-diffusion-v1-4 Â· Hugging Face</a>
    <ul>
      <li>ãƒ¢ãƒ‡ãƒ«ã®ãƒšãƒ¼ã‚¸</li>
    </ul>
  </li>
  <li>å‚è€ƒ : <a href="https://huggingface.co/join">Hugging Face â€“ The AI community building the future.</a>
    <ul>
      <li>Hugging Face ã®ç™»éŒ²ãƒšãƒ¼ã‚¸ã€‚ç™»éŒ²ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹</li>
    </ul>
  </li>
  <li><a href="https://huggingface.co/settings/tokens">Hugging Face â€“ The AI community building the future.</a>
    <ul>
      <li>ãƒ­ã‚°ã‚¤ãƒ³å¾Œã€ç”»é¢å³ä¸Šã®ãƒ¦ãƒ¼ã‚¶ã‚¢ã‚¤ã‚³ãƒ³ â†’ Settings â†’ Access Token ã¨é€²ã¿ã€<em>Read æ¨©é™ã® API Key ã‚’ç™ºè¡Œã™ã‚‹</em></li>
    </ul>
  </li>
</ul>
<p>ä»Šå›ã¯ã¤ã„ã§ã«ã€*NSFW ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’å›é¿ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’æ··ãœè¾¼ã‚“ã§ã€Stable Diffusion ã‚’å‹•ã‹ã—ã¦ã¿ã‚‹ã€‚</p>
<ul>
  <li><code>check-stable-diffusion.py</code></li>
</ul>
<pre class="language-python"><code class="language-python"><span class="token keyword">import</span> torch
<span class="token keyword">from</span> diffusers <span class="token keyword">import</span> StableDiffusionPipeline
<span class="token keyword">from</span> torch <span class="token keyword">import</span> autocast

prompt <span class="token operator">=</span> <span class="token string">"a cat"</span>  <span class="token comment"># ã‚³ã‚³ã«ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’å…¥ã‚Œã‚‹</span>
YOUR_TOKEN <span class="token operator">=</span> <span class="token string">"ã€Hugging Face ã® API Keyã€‘"</span>
MODEL_ID <span class="token operator">=</span> <span class="token string">"CompVis/stable-diffusion-v1-4"</span>
DEVICE <span class="token operator">=</span> <span class="token string">"cuda"</span>

pipe <span class="token operator">=</span> StableDiffusionPipeline<span class="token punctuation">.</span>from_pretrained<span class="token punctuation">(</span>MODEL_ID<span class="token punctuation">,</span> revision<span class="token operator">=</span><span class="token string">"fp16"</span><span class="token punctuation">,</span> torch_dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span>float16<span class="token punctuation">,</span> use_auth_token<span class="token operator">=</span>YOUR_TOKEN<span class="token punctuation">)</span>
pipe<span class="token punctuation">.</span>to<span class="token punctuation">(</span>DEVICE<span class="token punctuation">)</span>

<span class="token comment"># Avoid Safety Checker : Start</span>
<span class="token keyword">def</span> <span class="token function">null_safety</span><span class="token punctuation">(</span>images<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
  <span class="token keyword">return</span> images<span class="token punctuation">,</span> <span class="token boolean">False</span>
pipe<span class="token punctuation">.</span>safety_checker <span class="token operator">=</span> null_safety
<span class="token comment"># Avoid Safety Checker : End</span>

<span class="token keyword">with</span> autocast<span class="token punctuation">(</span>DEVICE<span class="token punctuation">)</span><span class="token punctuation">:</span>
  image <span class="token operator">=</span> pipe<span class="token punctuation">(</span>prompt<span class="token punctuation">,</span> guidance_scale<span class="token operator">=</span><span class="token number">7.5</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">"images"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
  image<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token string">"test.png"</span><span class="token punctuation">)</span>
</code></pre>
<p><code>pipe.safety_checker</code> ã‚’èª¤é­”åŒ–ã™ã“ã¨ã§ã€Stable Diffusion ã® NSFW ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’å›é¿ã§ãã‚‹ã€‚æ±ºã—ã¦ã‚¤ãƒ¤ã‚‰ã—ã„ç›®çš„ã§ã¯ãªãã¦ã€èª¤è§£é‡ˆã•ã‚Œã¦ç”»åƒç”ŸæˆãŒã†ã¾ãã•ã‚Œãªã„ã“ã¨ã‚’å›é¿ã™ã‚‹ãŸã‚ã«å…¥ã‚Œã¦ã„ã‚‹ã€‚ï½—</p>
<pre class="language-powershell"><code class="language-powershell">> python <span class="token punctuation">.</span>\check<span class="token operator">-</span>stable<span class="token operator">-</span>diffusion<span class="token punctuation">.</span>py
</code></pre>
<p>åˆå›ã¯ãƒ¢ãƒ‡ãƒ«ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãŒç™ºç”Ÿã™ã‚‹ãŒã€2å›ç›®ä»¥é™ã¯çœç•¥ã•ã‚Œã‚‹ã€‚1æšã®ç”»åƒã¯2ãƒ»3åˆ†ç¨‹åº¦ã§ç”Ÿæˆã•ã‚Œã‚‹ã€‚å‡ºåŠ›ã•ã‚ŒãŸ <code>test.png</code> ã‚’è¦‹ã¦ã¿ã‚ˆã†ã€‚</p>
<p><strong>ã‚³ãƒ¬ã§ Stable Diffusion ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ãƒã‚·ãƒ³ã§å‹•ã‹ã›ã‚‹ã‚ˆã†ã«ãªã£ãŸã€‚ã‚ã¨ã¯ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’è‰²ã€…ã¨å¤‰æ›´ã—ã¦ã¿ã¦ã€å¥½ããªç”»åƒã‚’ç”Ÿæˆã—ã¦ã¿ã‚ˆã†ã€‚</strong></p>
<ul>
  <li>å‚è€ƒ : <a href="https://self-development.info/%e3%80%90%e7%b0%a1%e5%8d%98%e3%80%91%e3%83%ad%e3%83%bc%e3%82%ab%e3%83%ab%e7%92%b0%e5%a2%83%e3%81%a7stable-diffusion%e3%81%a7%e5%ae%9f%e8%a1%8c%e3%81%99%e3%82%8b%e6%96%b9%e6%b3%95/">ã€ç°¡å˜ã€‘ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§Stable Diffusionã‚’å®Ÿè¡Œã™ã‚‹æ–¹æ³• | ã‚¸ã‚³ãƒ­ã‚°</a></li>
  <li>å‚è€ƒ : <a href="https://self-development.info/stable-diffusion%e3%81%a7nsfw%e3%83%95%e3%82%a3%e3%83%ab%e3%82%bf%e3%83%bc%e3%82%92%e3%82%b9%e3%83%9e%e3%83%bc%e3%83%88%e3%81%ab%e5%9b%9e%e9%81%bf%e3%81%99%e3%82%8b%e6%96%b9%e6%b3%95/">Stable Diffusionã§NSFWãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã‚’ã‚¹ãƒãƒ¼ãƒˆã«å›é¿ã™ã‚‹æ–¹æ³• | ã‚¸ã‚³ãƒ­ã‚°</a></li>
</ul><div class="ad-rakuten">
  <div class="ad-rakuten-image">
    <a href="https://hb.afl.rakuten.co.jp/hgc/g00reb42.waxycf23.g00reb42.waxyd080/?pc=https%3A%2F%2Fitem.rakuten.co.jp%2Frakutenkobo-ebooks%2Fe7c65c56cfe531249a5fe2241d78c476%2F&amp;m=http%3A%2F%2Fm.rakuten.co.jp%2Frakutenkobo-ebooks%2Fi%2F21662691%2F">
      <img src="https://thumbnail.image.rakuten.co.jp/@0_mall/rakutenkobo-ebooks/cabinet/3265/2000012063265.jpg?_ex=128x128">
    </a>
  </div>
  <div class="ad-rakuten-info">
    <div class="ad-rakuten-title">
      <a href="https://hb.afl.rakuten.co.jp/hgc/g00reb42.waxycf23.g00reb42.waxyd080/?pc=https%3A%2F%2Fitem.rakuten.co.jp%2Frakutenkobo-ebooks%2Fe7c65c56cfe531249a5fe2241d78c476%2F&amp;m=http%3A%2F%2Fm.rakuten.co.jp%2Frakutenkobo-ebooks%2Fi%2F21662691%2F">AIã¨ã‚³ãƒ©ãƒœã—ã¦ç¥çµµå¸«ã«ãªã‚‹ è«–æ–‡ã‹ã‚‰èª­ã¿è§£ãStable Diffusionã€é›»å­æ›¸ç±ã€‘[ ç™½äº• æšå½¦ ]</a>
    </div>
    <div class="ad-rakuten-shop">
      <a href="https://hb.afl.rakuten.co.jp/hgc/g00reb42.waxycf23.g00reb42.waxyd080/?pc=https%3A%2F%2Fwww.rakuten.co.jp%2Frakutenkobo-ebooks%2F&amp;m=http%3A%2F%2Fm.rakuten.co.jp%2Frakutenkobo-ebooks%2F">æ¥½å¤©Koboé›»å­æ›¸ç±ã‚¹ãƒˆã‚¢</a>
    </div>
    <div class="ad-rakuten-price">ä¾¡æ ¼ : 1760å††</div>
  </div>
</div>
<h2 id="waifu-diffusion-ã‚‚è©¦ã—ã¦ã¿ã‚‹"><a class="header-link" href="#waifu-diffusion-ã‚‚è©¦ã—ã¦ã¿ã‚‹"><span class="header-link-mark"></span></a>Waifu Diffusion ã‚‚è©¦ã—ã¦ã¿ã‚‹</h2>
<p>ã‚¢ãƒ‹ãƒ¡çµµã‚’ã‚­ãƒ¬ã‚¤ã«ç”Ÿæˆã§ãã‚‹ã€<em>Waifu Diffusion</em> ã¨ã„ã†åˆ¥ã®ãƒ¢ãƒ‡ãƒ«ã‚‚ã‚ã£ãŸã®ã§ã€å…¬å¼ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã ã‘å‹•ã‹ã—ã¦ã¿ã‚‹ã€‚</p>
<ul>
  <li>
    <p>å‚è€ƒ : <a href="https://huggingface.co/hakurei/waifu-diffusion">hakurei/waifu-diffusion Â· Hugging Face</a></p>
    <ul>
      <li>ãƒ¢ãƒ‡ãƒ«ã®ãƒšãƒ¼ã‚¸</li>
    </ul>
  </li>
  <li>
    <p>å‚è€ƒ : <a href="https://qiita.com/azukissy/items/03f9ca67e2ef72b07b02">Waifu-Diffusionã‚’Windowsãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§è©¦ã™ - Qiita</a></p>
  </li>
  <li>
    <p><code>practice-waifu-diffusion.py</code></p>
  </li>
</ul>
<pre class="language-python"><code class="language-python"><span class="token keyword">import</span> torch
<span class="token keyword">from</span> torch <span class="token keyword">import</span> autocast
<span class="token keyword">from</span> diffusers <span class="token keyword">import</span> StableDiffusionPipeline

pipe <span class="token operator">=</span> StableDiffusionPipeline<span class="token punctuation">.</span>from_pretrained<span class="token punctuation">(</span><span class="token string">'hakurei/waifu-diffusion'</span><span class="token punctuation">,</span> torch_dtype<span class="token operator">=</span>torch<span class="token punctuation">.</span>float16<span class="token punctuation">)</span><span class="token punctuation">.</span>to<span class="token punctuation">(</span><span class="token string">'cuda'</span><span class="token punctuation">)</span>
prompt <span class="token operator">=</span> <span class="token string">"1girl, aqua eyes, baseball cap, blonde hair, closed mouth, earrings, green background, hat, hoop earrings, jewelry, looking at viewer, shirt, short hair, simple background, solo, upper body, yellow shirt"</span>
<span class="token keyword">with</span> autocast<span class="token punctuation">(</span><span class="token string">"cuda"</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
  image <span class="token operator">=</span> pipe<span class="token punctuation">(</span>prompt<span class="token punctuation">,</span> guidance_scale<span class="token operator">=</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">"images"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
image<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token string">"waifu.png"</span><span class="token punctuation">)</span>
</code></pre>
<p>ãƒ¢ãƒ‡ãƒ«ã®ãƒšãƒ¼ã‚¸ã«ã‚ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ã¯ã€<code>torch_dtype</code> éƒ¨åˆ†ãŒ <code>torch.float32</code> ã ã£ãŸã®ã ãŒã€ã‚³ãƒ¬ã ã¨ä»¥ä¸‹ã®ã‚ˆã†ã« Out Of Memory ã‚¨ãƒ©ãƒ¼ãŒå‡ºã¦ã—ã¾ã£ãŸã®ã§ã€<code>torch.float16</code> ã«å¤‰æ›´ã—ã¦ã„ã‚‹ã€‚ã‚³ãƒ¬ã ã¨ã†ã¾ãè¡Œã£ãŸã€‚</p>
<pre class="language-powershell"><code class="language-powershell">> python <span class="token punctuation">.</span>\practice<span class="token operator">-</span>waifu<span class="token operator">-</span>diffusion<span class="token punctuation">.</span>py
torch<span class="token punctuation">.</span>cuda<span class="token punctuation">.</span>OutOfMemoryError: CUDA out of memory<span class="token punctuation">.</span> Tried to allocate 640<span class="token punctuation">.</span>00 MiB <span class="token punctuation">(</span>GPU 0<span class="token punctuation">;</span> 8<span class="token punctuation">.</span>00 GiB total capacity<span class="token punctuation">;</span> 7<span class="token punctuation">.</span>18 GiB already allocated<span class="token punctuation">;</span> 0 bytes free<span class="token punctuation">;</span> 7<span class="token punctuation">.</span>23 GiB reserved in total by PyTorch<span class="token punctuation">)</span> <span class="token keyword">If</span> reserved memory is >> allocated memory <span class="token keyword">try</span> setting max_split_size_mb to avoid fragmentation<span class="token punctuation">.</span>  See documentation <span class="token keyword">for</span> Memory Management and PYTORCH_CUDA_ALLOC_CONF

<span class="token comment"># GPU ãƒ¡ãƒ¢ãƒªã®ä»•æ§˜çŠ¶æ³ã¯ä»¥ä¸‹ã§ç¢ºèªã§ãã‚‹</span>
> nvidia<span class="token operator">-</span>smi
</code></pre>
<h2 id="ä»Šå›ã¯ã‚³ã‚³ã¾ã§"><a class="header-link" href="#ä»Šå›ã¯ã‚³ã‚³ã¾ã§"><span class="header-link-mark"></span></a>ä»Šå›ã¯ã‚³ã‚³ã¾ã§ï¼</h2>
<p>ä»Šå›ã¯ PowerShell ä¸Šã§ Python ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œã™ã‚‹å½¢ã§ã€Diffusers ã‚’çµŒç”±ã—ã¦ã® Stable Diffusionãƒ»Waifu Diffusion ãƒ¢ãƒ‡ãƒ«ã‚’åˆ©ç”¨ã—ãŸç”»åƒç”ŸæˆãŒå®Ÿç¾ã§ããŸã€‚</p>
<p>è§£åƒåº¦ãªã©ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿é¡ã¯ã¾ã ã¾ã è§¦ã‚Œã¦ã„ãªã„ã—ã€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚‚äººåŠ›ã§ä½œã‚ã†ã¨ã™ã‚‹ã¨ã‹ãªã‚Šå¤§å¤‰ãªã®ã§ã€æœ¬æ°—ã§ç”»åƒç”Ÿæˆã‚’ã—ã¦ã„ã“ã†ã¨æ€ã£ãŸã‚‰ã‚‚ã£ã¨ç ”ç©¶ãŒå¿…è¦ãã†ã ã€‚</p>
<p>ä»Šå›ç´¹ä»‹ã—ãŸ Python ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ä»¥ä¸‹ã® GitHub ãƒªãƒã‚¸ãƒˆãƒªã«ã‚‚ç½®ã„ã¦ã‚ã‚‹ã®ã§ãƒ‰ã‚¦ã‚¾ã€‚</p>
<ul>
  <li><a href="https://github.com/Neos21/practice-stable-diffusion">Neos21/practice-stable-diffusion: Practice Stable Diffusion</a></li>
</ul><div class="ad-amazon">
  <div class="ad-amazon-image">
    <a href="https://www.amazon.co.jp/dp/B0BG2JX7TL?tag=neos21-22&amp;linkCode=osi&amp;th=1&amp;psc=1">
      <img src="https://m.media-amazon.com/images/I/51Uz4HMFPWL._SL160_.jpg" width="112" height="160">
    </a>
  </div>
  <div class="ad-amazon-info">
    <div class="ad-amazon-title">
      <a href="https://www.amazon.co.jp/dp/B0BG2JX7TL?tag=neos21-22&amp;linkCode=osi&amp;th=1&amp;psc=1">Artificial Imagesã€€Midjourney / Stable Diffusionã«ã‚ˆã‚‹AIã‚¢ãƒ¼ãƒˆã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ (NextPublishing)</a>
    </div>
  </div>
</div>
<div class="ad-rakuten">
  <div class="ad-rakuten-image">
    <a href="https://hb.afl.rakuten.co.jp/hgc/g00reb42.waxycf23.g00reb42.waxyd080/?pc=https%3A%2F%2Fitem.rakuten.co.jp%2Frakutenkobo-ebooks%2F8ecae243f311312790aa4f154cd94485%2F&amp;m=http%3A%2F%2Fm.rakuten.co.jp%2Frakutenkobo-ebooks%2Fi%2F21573787%2F">
      <img src="https://thumbnail.image.rakuten.co.jp/@0_mall/rakutenkobo-ebooks/cabinet/4273/2000011934273.jpg?_ex=128x128">
    </a>
  </div>
  <div class="ad-rakuten-info">
    <div class="ad-rakuten-title">
      <a href="https://hb.afl.rakuten.co.jp/hgc/g00reb42.waxycf23.g00reb42.waxyd080/?pc=https%3A%2F%2Fitem.rakuten.co.jp%2Frakutenkobo-ebooks%2F8ecae243f311312790aa4f154cd94485%2F&amp;m=http%3A%2F%2Fm.rakuten.co.jp%2Frakutenkobo-ebooks%2Fi%2F21573787%2F">Artificial Images Midjourney / Stable Diffusionã«ã‚ˆã‚‹AIã‚¢ãƒ¼ãƒˆã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã€é›»å­æ›¸ç±ã€‘[ 852è©± ]</a>
    </div>
    <div class="ad-rakuten-shop">
      <a href="https://hb.afl.rakuten.co.jp/hgc/g00reb42.waxycf23.g00reb42.waxyd080/?pc=https%3A%2F%2Fwww.rakuten.co.jp%2Frakutenkobo-ebooks%2F&amp;m=http%3A%2F%2Fm.rakuten.co.jp%2Frakutenkobo-ebooks%2F">æ¥½å¤©Koboé›»å­æ›¸ç±ã‚¹ãƒˆã‚¢</a>
    </div>
    <div class="ad-rakuten-price">ä¾¡æ ¼ : 1980å††</div>
  </div>
</div>

      </main>
      <footer id="footer">
        <div id="footer-contents">
          <div id="date-time">
            <dl>
              <dt>Created</dt>
              <dd><time>2023-02-27</time></dd>
              <dt>Last-Modified</dt>
              <dd><time>2023-02-27</time></dd>
            </dl>
          </div>
          <nav id="footer-links">
            <ul>
              <li id="footer-link-about"><a href="/about/index.html" title="About">About</a></li>
              <li id="footer-link-search"><a href="/about/search.html" title="Search">Search</a></li>
              <li id="footer-link-feeds"><a href="/feeds.xml" title="Feeds">Feeds</a></li>
              <li id="footer-link-github"><a href="https://github.com/Neos21/" title="GitHub">GitHub</a></li>
            </ul>
          </nav>
          <nav id="to-top"><a href="#" title="To Top"><span>â–² To Top</span></a></nav>
        </div>
      </footer>
    </div>
  </body>
</html>
