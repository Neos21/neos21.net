<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="theme-color" content="#0990d0">
    <!-- Google Search Console -->
    <meta name="google-site-verification" content="AvoEr3mUJFF2H_mPWWgShfmjBVP3ywRpyx9hxeeq2d4">
    <title>Bootstrap 3 の Affix を今さら勉強する - Neo's World</title>
    <link rel="icon" href="/favicon.ico">
    <link rel="stylesheet" href="/styles.css">
    <link rel="canonical" href="https://neos21.net/blog/2020/01/25-02.html">
    <link rel="search" type="application/opensearchdescription+xml" title="neos21.net" href="/opensearch.xml">
    <link rel="alternate" type="application/atom+xml" href="/feeds.xml">
    <link rel="author" href="http://www.hatena.ne.jp/neos21/">
    <!-- Global Site Tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YMHFLZP1M1"></script>
    <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date());gtag('config','G-YMHFLZP1M1');gtag('config','UA-106501-1');</script>
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6475907504235292" crossorigin="anonymous"></script>
  </head>
  <body>
    <div id="container">
      <header id="header">
        <div id="site-title"><a href="/index.html">Neo's World</a></div>
        <nav id="header-links">
          <ul>
            <li id="header-link-about"><a href="/about/index.html" title="About"><span>About</span></a></li>
            <li id="header-link-search"><a href="/about/search.html" title="Search"><span>Search</span></a></li>
            <li id="header-link-feeds"><a href="/feeds.xml" title="Feeds"><span>Feeds</span></a></li>
            <li id="header-link-to-bottom"><a href="#footer" title="To Bottom"><span>▼ To Bottom</span></a></li>
          </ul>
        </nav>
        <nav id="global-nav">
          <ul>
            <li><a href="/blog/index.html">Blog</a></li>
            <li><a href="/tech/index.html">Tech</a></li>
            <li><a href="/music/index.html">Music</a></li>
            <li><a href="/games/index.html">Games</a></li>
            <li><a href="/gallery/index.html">Gallery</a></li>
            <li><a href="/etc/index.html">Etc.</a></li>
          </ul>
        </nav>
        <nav id="path">
          <ul>
            <li><a href="/index.html">Neo's World</a></li>
            <li><a href="/blog/index.html">Blog</a></li>
            <li><a href="/blog/2020/index.html">2020年</a></li>
            <li><a href="/blog/2020/01/index.html">01月</a></li>
          </ul>
        </nav>
      </header>
      <main id="main">
        <div id="header-date"><time>2020-01-25</time></div>
        <h1 id="page-title">Bootstrap 3 の Affix を今さら勉強する</h1>

<p>Bootstrap 3 には <strong>Affix</strong> という機能が同梱されている。Bootstrap の JS (jQuery プラグイン) を併用して、画面のスクロールに合わせて動的に <code>position: sticky</code> 的な動作を切り替えるような機能だ。</p>
<p>よくウェブサイトのサイドメニューなどで見かける UI だが、自分で作ったことがなかったので、今回試してみた。</p>
<h2 id="目次"><a class="header-link" href="#目次"><span class="header-link-mark"></span></a>目次</h2>
<ul>
  <li><a href="#%E7%92%B0%E5%A2%83">環境</a></li>
  <li><a href="#data-%E5%B1%9E%E6%80%A7%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E6%8C%87%E5%AE%9A%E3%81%99%E3%82%8B%E5%9F%BA%E6%9C%AC%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3"><code>data</code> 属性を使って指定する基本パターン</a></li>
  <li><a href="#%E5%9F%BA%E7%A4%8E%E3%82%B3%E3%83%BC%E3%83%89%E3%81%AE%E3%82%A4%E3%83%9E%E3%82%A4%E3%83%81%E3%83%9D%E3%82%A4%E3%83%B3%E3%83%88">基礎コードのイマイチポイント</a></li>
  <li><a href="#javascript-jquery-%E3%81%A7-affix-%E3%82%92%E5%88%B6%E5%BE%A1%E3%81%99%E3%82%8B">JavaScript (jQuery) で Affix を制御する</a></li>
  <li><a href="#%E9%A0%91%E5%BC%B5%E3%81%A3%E3%81%A6%E5%8F%AF%E5%A4%89%E5%B9%85%E3%83%AC%E3%82%A4%E3%82%A2%E3%82%A6%E3%83%88%E3%81%AB%E5%AF%BE%E5%BF%9C%E3%81%95%E3%81%9B%E3%81%A6%E3%81%BF%E3%82%8B">頑張って可変幅レイアウトに対応させてみる</a></li>
  <li><a href="#%E4%BB%A5%E4%B8%8A">以上</a></li>
  <li><a href="#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE">参考文献</a></li>
</ul>
<h2 id="環境"><a class="header-link" href="#環境"><span class="header-link-mark"></span></a>環境</h2>
<ul>
  <li>jQuery v3.3.1
    <ul>
      <li><code>$.fn.jquery</code> で確認可能</li>
    </ul>
  </li>
  <li>Bootstrap 3.3.7
    <ul>
      <li><code>$.fn.tooltip.Constructor.VERSION</code> で確認可能</li>
    </ul>
  </li>
</ul>
<p>これらを適用した単一の HTML を作っていく。</p>
<h2 id="data-属性を使って指定する基本パターン"><a class="header-link" href="#data-属性を使って指定する基本パターン"><span class="header-link-mark"></span></a><code>data</code> 属性を使って指定する基本パターン</h2>
<p>まずは <code>data-spy="affix"</code> という <code>data</code> 属性を使用しての基本パターンを実装してみる。</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>header</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">250</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token property">margin-bottom</span><span class="token punctuation">:</span> <span class="token number">30</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token property">color</span><span class="token punctuation">:</span> <span class="token hexcode color">#fff</span><span class="token punctuation">;</span> <span class="token property">background</span><span class="token punctuation">:</span> <span class="token hexcode color">#08f</span><span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>HEADER<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>header</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>affix-target-wrapper<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token comment">&#x3C;!--
    offset-top    : 280 (px) = header 要素の height (250px) + margin-bottom (30px)
    offset-bottom : 今回は適当に、画面最下部から 1000px のところで解除する
  --></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>affix-target btn-group btn-group-justified<span class="token punctuation">"</span></span> <span class="token attr-name">data-spy</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>affix<span class="token punctuation">"</span></span> <span class="token attr-name">data-offset-top</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>280<span class="token punctuation">"</span></span> <span class="token attr-name">data-offset-bottom</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>1000<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn btn-default<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Menu 1<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>a</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn btn-default<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Menu 2<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>a</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn btn-default<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Menu 3<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>a</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>div</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dummy-contents<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">max-width</span><span class="token punctuation">:</span> <span class="token number">800</span><span class="token unit">px</span><span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token comment">&#x3C;!-- ページの高さを稼ぐために適当なダミーテキストを書き連ねておく --></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>p</span><span class="token punctuation">></span></span>Lorem ipsum……<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>p</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>div</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>footer</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">400</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token property">color</span><span class="token punctuation">:</span> <span class="token hexcode color">#fff</span><span class="token punctuation">;</span> <span class="token property">background</span><span class="token punctuation">:</span> <span class="token hexcode color">#444</span><span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>FOOTER<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>footer</span><span class="token punctuation">></span></span>
</code></pre>
<p>今回は適当に高さのあるヘッダ・フッタと、テキストコンテンツを用意してある。Affix を適用したい要素は <code>.affix-target</code> で、コレに <code>data-spy="affix"</code> という属性を振ることで Affix の効果を適用させている。</p>
<ul>
  <li><code>data-offset-top</code> の値 (px 単位) が、<code>position: sticky</code> な挙動に切り替わるスクロール位置となる
    <ul>
      <li>実際は <code>position: sticky</code> ではなく <em><code>position: fixed</code></em> が適用されている</li>
      <li>単純な <code>position: sticky</code> と違うのは、「対象要素が画面上部に張り付いたら固定する」だけではなく、任意のスクロール位置で固定を開始できる点</li>
    </ul>
  </li>
  <li><code>data-offset-bottom</code> は、<code>data-offset-top</code> で始めた Sticky を解除する位置。画面最下部からのスクロール位置を指定する
    <ul>
      <li><code>data-offset-bottom</code> を書かず <code>data-offset-top</code> だけ書いた場合は、画面最下部まで行っても Sticky したままとなる</li>
      <li>逆に <code>data-offset-top</code> を書かず <code>data-offset-bottom</code> だけ指定したい場合は、<strong><code>data-offset-top</code> に <code>-1</code> を指定する</strong>と、狙った効果を得られる</li>
      <li><code>offset-bottom</code> (<code>.affix-bottom</code>) で何をしているかというと、<code>position: fixed</code> を解除し <code>position: relative</code> に変更、スクロール量に応じて <code>top</code> 値を操作することで、その要素がスクロールに追従しているように見せている。<strong><code>position: relative</code> は対象要素に <code>style</code> 属性で埋め込む</strong>ので、後述する CSS の指定が勝つように指定しないといけない。</li>
    </ul>
  </li>
</ul>
<p><strong>Affix を使用する際、対象となる要素に次のような CSS を指定するのが必須となる。</strong>ココがドキュメントにちゃんと書かれていなくて、使い方が分かりにくかった。<em>HTML だけ書いても上手く行かないのだ。</em></p>
<pre class="language-css"><code class="language-css"><span class="token comment">/* 子要素 .affix-target が position: fixed になった時、その下にあるコンテンツの表示位置がズレないよう指定しておく */</span>
<span class="token selector"><span class="token class">.affix-target-wrapper</span></span> <span class="token punctuation">{</span>
  <span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">60</span><span class="token unit">px</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/* Affix を適用する対象の要素 */</span>
<span class="token selector"><span class="token class">.affix-target</span></span> <span class="token punctuation">{</span>
  <span class="token property">width</span><span class="token punctuation">:</span> <span class="token number">500</span><span class="token unit">px</span><span class="token punctuation">;</span>    <span class="token comment">/* position: fixed になった時、幅が狂わないよう指定しておく */</span>
  <span class="token property">z-index</span><span class="token punctuation">:</span> <span class="token number">99999</span><span class="token punctuation">;</span>  <span class="token comment">/* position: fixed になった時、他の要素の下に重ならないようにしておく */</span>
<span class="token punctuation">}</span>

<span class="token comment">/* Affix を適用する対象の要素が position: fixed になった時の指定 */</span>
<span class="token selector"><span class="token class">.affix-target</span><span class="token class">.affix</span></span> <span class="token punctuation">{</span>
  <span class="token property">position</span><span class="token punctuation">:</span> fixed <span class="token important">!important</span><span class="token punctuation">;</span>  <span class="token comment">/* .affix 自体に position: fixed 指定はあるものの、.affix-bottom が style 属性に position: relative を埋め込むので、それに勝るよう !important を指定しておく */</span>
  <span class="token property">top</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">;</span>  <span class="token comment">/* 画面上部からの位置を指定する。data-offset-top との辻褄が合う数値にしておくこと */</span>
<span class="token punctuation">}</span>
</code></pre>
<p>ついでに、効果を確認するためのデバッグ用に以下を仕込んでおく。</p>
<pre class="language-css"><code class="language-css"><span class="token comment">/* Affix の適用状態に応じて文字色を変える */</span>
<span class="token selector"><span class="token class">.affix-top</span>    *</span> <span class="token punctuation">{</span> <span class="token property">color</span><span class="token punctuation">:</span> <span class="token color">blue</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token comment">/* Affix 開始よりスクロール位置が上の場合 */</span>
<span class="token selector"><span class="token class">.affix</span>        *</span> <span class="token punctuation">{</span> <span class="token property">color</span><span class="token punctuation">:</span> <span class="token color">red</span><span class="token punctuation">;</span>   <span class="token punctuation">}</span>  <span class="token comment">/* position: fixed になった時 */</span>
<span class="token selector"><span class="token class">.affix-bottom</span> *</span> <span class="token punctuation">{</span> <span class="token property">color</span><span class="token punctuation">:</span> <span class="token color">green</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>  <span class="token comment">/* Affix を解除するスクロール位置より下の場合 */</span>

<span class="token comment">/* ページの高さを稼ぐためのコード */</span>
<span class="token selector"><span class="token class">.dummy-contents</span> p</span> <span class="token punctuation">{</span>
  <span class="token property">line-height</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">;</span>
  <span class="token property">margin-bottom</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token unit">rem</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>このように実装したサンプルは以下。</p>
<ul>
  <li><a href="https://codepen.io/Neos21/pen/ExayrvX">Practice Bootstrap 3 Affix 1</a></li>
</ul>
<p>コレでとりあえず思った動きはできた。</p>
<h2 id="基礎コードのイマイチポイント"><a class="header-link" href="#基礎コードのイマイチポイント"><span class="header-link-mark"></span></a>基礎コードのイマイチポイント</h2>
<p>上のコードで「それっぽい動き」自体はできたが、イマイチなポイントがある。</p>
<ul>
  <li>Affix する要素を囲む <code>.affix-target-wrapper</code> に <code>height</code> を指定しているが、ピクセル固定値で高さを指定するのは難しい場合も多い
    <ul>
      <li>Affix する要素が <code>position: fixed</code> になることで、後続のコンテンツの表示位置がズレるのを避けるための指定で、CSS の仕様上、<code>height</code> で高さを稼いでおかないといけないのは理解は出来る。理解は出来るが、イマイチなのだ。</li>
    </ul>
  </li>
  <li>Affix する要素に <code>width</code> を指定しないと <code>position: fixed</code> に切り替わった時に幅が狂う
    <ul>
      <li>コレも CSS の仕様上、<code>position: fixed</code> な要素は画面幅に従うので、理解はできる。しかし、Grid Layout のカラム幅に従わせたい時なんかは、かなり設定が大変だ</li>
      <li>Bootstrap 公式リファレンスのサイドバーでも Affix が使われていて、ココは幅が狂わずに表示できている。よくよく実装を見ると、メディアクエリごとに Grid Layout 内のピクセルサイズを定義することで対処していた。こんなのリファレンスで紹介してないじゃん…。</li>
    </ul>
  </li>
</ul>
<p><code>position: fixed</code> を使用するために、<em>可変幅レイアウトとの相性が良くない。</em>ただ Affix を適用しただけではダメで、かなり細かく <strong>CSS 側の調整が必要</strong>である。</p>
<p>問題点を理解したところで、次のやり方を試してみる</p>
<h2 id="javascript-jquery-で-affix-を制御する"><a class="header-link" href="#javascript-jquery-で-affix-を制御する"><span class="header-link-mark"></span></a>JavaScript (jQuery) で Affix を制御する</h2>
<p>続いて jQuery プラグインで制御してみる。</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>header</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">250</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token property">margin-bottom</span><span class="token punctuation">:</span> <span class="token number">30</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token property">color</span><span class="token punctuation">:</span> <span class="token hexcode color">#fff</span><span class="token punctuation">;</span> <span class="token property">background</span><span class="token punctuation">:</span> <span class="token hexcode color">#08f</span><span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>HEADER<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>header</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>affix-target-wrapper<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>affix-target btn-group btn-group-justified<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn btn-default<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Menu 1<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>a</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn btn-default<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Menu 2<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>a</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>btn btn-default<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Menu 3<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>a</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>div</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dummy-contents<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">max-width</span><span class="token punctuation">:</span> <span class="token number">400</span><span class="token unit">px</span><span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token comment">&#x3C;!-- ページの高さを稼ぐために適当なダミーテキストを書き連ねておく --></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>p</span><span class="token punctuation">></span></span>Lorem ipsum……<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>p</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>div</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>footer</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">500</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token property">color</span><span class="token punctuation">:</span> <span class="token hexcode color">#fff</span><span class="token punctuation">;</span> <span class="token property">background</span><span class="token punctuation">:</span> <span class="token hexcode color">#444</span><span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>FOOTER<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>footer</span><span class="token punctuation">></span></span>
</code></pre>
<p>HTML 側は、<code>.affix-target</code> に指定していた <code>data</code> 属性がなくなっている。</p>
<p>CSS 側は変更なし。JavaScript を次のように追加する。</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token function">$</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.affix-target'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">affix</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    offset<span class="token operator">:</span> <span class="token punctuation">{</span>
      top<span class="token operator">:</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'header'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">outerHeight</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">// true にすると margin を含めた値を得られる</span>
      bottom<span class="token operator">:</span> <span class="token number">600</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token comment">// Affix の適用状態に応じて文字色やフォント設定を変える</span>
    <span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'affixed-top.bs.affix'</span>   <span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'affixed-top.bs.affix'</span>   <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.affix-target *'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">css</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">'color'</span><span class="token operator">:</span> <span class="token string">'blue'</span>  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'affixed.bs.affix'</span>       <span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'affixed.bs.affix'</span>       <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.affix-target *'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">css</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">'color'</span><span class="token operator">:</span> <span class="token string">'red'</span>   <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'affixed-bottom.bs.affix'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'affixed-bottom.bs.affix'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.affix-target *'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">css</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">'color'</span><span class="token operator">:</span> <span class="token string">'green'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'affix-top.bs.affix'</span>     <span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'affix-top.bs.affix'</span>     <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.affix-target *'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">css</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">'font-weight'</span><span class="token operator">:</span> <span class="token string">'bold'</span>  <span class="token punctuation">,</span> <span class="token string">'font-style'</span><span class="token operator">:</span> <span class="token string">'normal'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'affix.bs.affix'</span>         <span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'affix.bs.affix'</span>         <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.affix-target *'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">css</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">'font-weight'</span><span class="token operator">:</span> <span class="token string">'normal'</span><span class="token punctuation">,</span> <span class="token string">'font-style'</span><span class="token operator">:</span> <span class="token string">'italic'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'affix-bottom.bs.affix'</span>  <span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'affix-bottom.bs.affix'</span>  <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.affix-target *'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">css</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token string">'font-weight'</span><span class="token operator">:</span> <span class="token string">'bold'</span>  <span class="token punctuation">,</span> <span class="token string">'font-style'</span><span class="token operator">:</span> <span class="token string">'italic'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>久々に書いたぜ jQuery。</p>
<p>このようにすると、<code>data</code> 属性で指定した時と同じ状態が再現できる。<code>.on()</code> イベントは Affix の状態変化に応じて発生するが、ページ読み込み時は発生しない様子。ちょっと使いづらい感じ。</p>
<p>とりあえず以下のようになる。</p>
<ul>
  <li><a href="https://codepen.io/Neos21/pen/MWYexjO">Practice Bootstrap 3 Affix 2</a></li>
</ul>
<h2 id="頑張って可変幅レイアウトに対応させてみる"><a class="header-link" href="#頑張って可変幅レイアウトに対応させてみる"><span class="header-link-mark"></span></a>頑張って可変幅レイアウトに対応させてみる</h2>
<p>JavaScript でも制御できることが分かったら、昔ながらのやり方で、可変幅レイアウトに無理やり対応させることはできそうだ。</p>
<p>まずは HTML。</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>header</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">250</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token property">margin-bottom</span><span class="token punctuation">:</span> <span class="token number">30</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token property">color</span><span class="token punctuation">:</span> <span class="token hexcode color">#fff</span><span class="token punctuation">;</span> <span class="token property">background</span><span class="token punctuation">:</span> <span class="token hexcode color">#08f</span><span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>HEADER<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>header</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>container-fluid<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>row<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>col-xs-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dummy-contents<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token comment">&#x3C;!-- ページの高さを稼ぐために適当なダミーテキストを書き連ねておく --></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>p</span><span class="token punctuation">></span></span>Lorem ipsum……<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>p</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>div</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>col-xs-4<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>affix-target nav nav-pills nav-stacked<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>active<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Menu 1<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>li</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>li</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Menu 2<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>li</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>li</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Menu 3<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>li</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>li</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>Menu 4<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>li</span><span class="token punctuation">></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>ul</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>div</span><span class="token punctuation">></span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>footer</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">height</span><span class="token punctuation">:</span> <span class="token number">500</span><span class="token unit">px</span><span class="token punctuation">;</span> <span class="token property">color</span><span class="token punctuation">:</span> <span class="token hexcode color">#fff</span><span class="token punctuation">;</span> <span class="token property">background</span><span class="token punctuation">:</span> <span class="token hexcode color">#444</span><span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>FOOTER<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>footer</span><span class="token punctuation">></span></span>
</code></pre>
<p><code>.container-fluid</code> を使用して、可変幅にしている。Affix したい <code>.affix-target</code> は、Grid Layout 用の <code>.col-xs-4</code> の直下にいる。<code>.affix-target-wrapper</code> はなくなった。</p>
<p>続いて CSS。</p>
<pre class="language-css"><code class="language-css"><span class="token comment">/* Affix を適用する対象の要素 */</span>
<span class="token selector"><span class="token class">.affix-target</span></span> <span class="token punctuation">{</span>
  <span class="token property">z-index</span><span class="token punctuation">:</span> <span class="token number">99999</span><span class="token punctuation">;</span>  <span class="token comment">/* position: fixed になった時、他の要素の下に重ならないようにしておく */</span>
  <span class="token comment">/* width を指定していない */</span>
<span class="token punctuation">}</span>

<span class="token comment">/* Affix を適用する対象の要素が position: fixed になった時の指定 */</span>
<span class="token selector"><span class="token class">.affix-target</span><span class="token class">.affix</span></span> <span class="token punctuation">{</span>
  <span class="token property">position</span><span class="token punctuation">:</span> fixed <span class="token important">!important</span><span class="token punctuation">;</span>  <span class="token comment">/* .affix 自体に position: fixed 指定はあるものの、.affix-bottom が style 属性に position: relative を埋め込むので、それに勝るよう !important を指定しておく */</span>
  <span class="token property">top</span><span class="token punctuation">:</span> <span class="token number">30</span><span class="token unit">px</span><span class="token punctuation">;</span>  <span class="token comment">/* 画面上部からの位置を指定する。data-offset-top との辻褄が合う数値にしておくこと */</span>
<span class="token punctuation">}</span>

<span class="token comment">/* Affix の適用状態に応じて文字色を変える */</span>
<span class="token selector"><span class="token class">.affix-top</span>    *</span> <span class="token punctuation">{</span> <span class="token property">color</span><span class="token punctuation">:</span> <span class="token color">blue</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token comment">/* Affix 開始よりスクロール位置が上の場合 */</span>
<span class="token selector"><span class="token class">.affix</span>        *</span> <span class="token punctuation">{</span> <span class="token property">color</span><span class="token punctuation">:</span> <span class="token color">red</span><span class="token punctuation">;</span>   <span class="token punctuation">}</span>  <span class="token comment">/* position: fixed になった時 */</span>
<span class="token selector"><span class="token class">.affix-bottom</span> *</span> <span class="token punctuation">{</span> <span class="token property">color</span><span class="token punctuation">:</span> <span class="token color">green</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>  <span class="token comment">/* Affix を解除するスクロール位置より下の場合 */</span>

<span class="token comment">/* ページの高さを稼ぐためのコード */</span>
<span class="token selector"><span class="token class">.dummy-contents</span> p</span> <span class="token punctuation">{</span>
  <span class="token property">line-height</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">;</span>
  <span class="token property">margin-bottom</span><span class="token punctuation">:</span> <span class="token number">3</span><span class="token unit">rem</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p><code>.affix-target</code> に書いていた <code>width</code> 指定がなくなった。あとレイアウト調整のために <code>affix-target.affix</code> で指定する <code>top</code> 値を調整した。</p>
<p>そして JavaScript。</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token function">$</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.affix-target'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">affix</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    offset<span class="token operator">:</span> <span class="token punctuation">{</span>
      top   <span class="token operator">:</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'header'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">outerHeight</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      bottom<span class="token operator">:</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'footer'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">outerHeight</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token number">400</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'affix.bs.affix'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token comment">// .affix-target の親要素の、padding の内側の幅を取得して、それを .affix-target の幅とする</span>
      <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.affix-target'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">width</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.affix-target'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'affix-top.bs.affix affix-bottom.bs.affix'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
      <span class="token comment">// .affix-top・.affix-bottom 時は上で指定した幅指定を解除し、親要素の幅に従わせる</span>
      <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.affix-target'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">width</span><span class="token punctuation">(</span><span class="token string">'auto'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// ウィンドウリサイズに対応する</span>
  <span class="token function">$</span><span class="token punctuation">(</span><span class="token dom variable">window</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">resize</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token comment">// リサイズによる文章の折り返しなどでスクロール量が変わった場合に向けて、Affix の状況を再計算させる</span>
    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.affix-target'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">affix</span><span class="token punctuation">(</span><span class="token string">'checkPosition'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// Affix 適用中の .affix-target のみ指定し、横幅を動的に設定する</span>
    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.affix-target.affix'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">width</span><span class="token punctuation">(</span><span class="token function">$</span><span class="token punctuation">(</span><span class="token string">'.affix-target'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">width</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><code>.affix('checkPosition')</code> という関数を使い、Affix の再計算をさせたりして、<code>.affix-target</code> の親要素の内側の幅に合わせるよう、動的に <code>width</code> を変更している。</p>
<p>コレで以下のようになる。</p>
<ul>
  <li><a href="https://codepen.io/Neos21/pen/xxbOBBo">Practice Bootstrap 3 Affix 3</a></li>
</ul>
<p>多分よくあるデザインだと、これくらいのことはしないといけないのかなと思われる。</p>
<h2 id="以上"><a class="header-link" href="#以上"><span class="header-link-mark"></span></a>以上</h2>
<p>最近は Angular や Vue などの SPA で開発することが多いので、このように jQuery にベッタリな実装だとつらいモノがある。当時はまだ普及していなかった <code>position: sticky</code> という「標準」ももう整備されたし、今後はあまり使うことはないのかな。</p>
<p>ただ、特定のスクロール位置で <code>position: sticky</code> を解除する動きは、今も CSS オンリーでは困難な動きなので、こうした動きを再現したい場合は <code>position: relative</code> と <code>top</code> 値の動的変更が必要になってくる (もしくは <code>position: absolute</code> に切り替えてスクロール量に合わせた <code>top</code> 値を指定するとか・いずれもリサイズに対応できないと微妙になる)。</p>
<p>Affix の挙動を理解し、ノウハウを吸収できたので、あとは必要に応じて自分で実装してみるとしよう。</p>
<h2 id="参考文献"><a class="header-link" href="#参考文献"><span class="header-link-mark"></span></a>参考文献</h2>
<ul>
  <li><a href="https://getbootstrap.com/docs/3.4/javascript/#affix">JavaScript · Bootstrap</a></li>
  <li><a href="https://hijiriworld.com/web/bootstrap-affix/">Bootstrap 2.1「Affixプラグイン」がわかりにくかったので少し紐解いてみました | hijiriworld Web</a></li>
  <li><a href="http://bootstrap3.cyberlab.info/javascript/affix.html">アフィックス ≪ JavaScript ≪ Bootstrap3日本語リファレンス</a></li>
  <li><a href="https://www.w3schools.com/bootstrap/bootstrap_affix.asp">Bootstrap Affix</a></li>
  <li><a href="http://algo13.net/bootstrap/affix.html">http://algo13.net/bootstrap/affix.html</a></li>
  <li><a href="https://am-yu.net/2014/04/20/bootstrap3-affix-scrollspy/">Bootstrap3のAffixとScrollspyを試してみた | while(isプログラマ)</a></li>
  <li><a href="https://www.tutorialrepublic.com/twitter-bootstrap-3-tutorial/bootstrap-affix.php">How to Use Bootstrap 3 Affix Plugin - Tutorial Republic</a></li>
  <li><a href="https://www.code-adviser.com/detail_18683303">リストの幅が変更されたブートストラップ3.0接辞 | 翻訳QAサービス | code adviser</a></li>
</ul>

      </main>
      <footer id="footer">
        <div id="date-time">
          <dl>
            <dt>Created</dt>
            <dd><time>2020-01-25</time></dd>
            <dt>Last-Modified</dt>
            <dd><time>2020-01-25</time></dd>
          </dl>
        </div>
        <nav id="footer-links">
          <ul>
            <li id="footer-link-about"><a href="/about/index.html" title="About">About</a></li>
            <li id="footer-link-search"><a href="/about/search.html" title="Search">Search</a></li>
            <li id="footer-link-feeds"><a href="/feeds.xml" title="Feeds">Feeds</a></li>
            <li id="footer-link-github"><a href="https://github.com/Neos21/" title="GitHub">GitHub</a></li>
          </ul>
        </nav>
        <nav id="to-top"><a href="#" title="To Top"><span>▲ To Top</span></a></nav>
      </footer>
    </div>
  </body>
</html>
