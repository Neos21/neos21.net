<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="theme-color" content="#0990d0">
    <!-- Google Search Console -->
    <meta name="google-site-verification" content="AvoEr3mUJFF2H_mPWWgShfmjBVP3ywRpyx9hxeeq2d4">
    <title>Vue 3・Vite を触ってみる - Neo's World</title>
    <link rel="icon" href="/favicon.ico">
    <link rel="stylesheet" href="/styles.css">
    <link rel="canonical" href="https://neos21.net/blog/2020/08/10-02.html">
    <link rel="search" type="application/opensearchdescription+xml" title="neos21.net" href="/opensearch.xml">
    <link rel="alternate" type="application/atom+xml" href="/feeds.xml">
    <link rel="author" href="http://www.hatena.ne.jp/neos21/">
    <!-- Global Site Tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YMHFLZP1M1"></script>
    <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date());gtag('config','G-YMHFLZP1M1');gtag('config','UA-106501-1');</script>
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6475907504235292" crossorigin="anonymous"></script>
  </head>
  <body>
    <div id="container">
      <header id="header">
        <div id="header-brand">
          <div id="header-brand-contents">
            <div id="site-title"><a href="/index.html">Neo's World</a></div>
            <nav id="header-links">
              <ul>
                <li id="header-link-about"><a href="/about/index.html" title="About"><span>About</span></a></li>
                <li id="header-link-search"><a href="/about/search.html" title="Search"><span>Search</span></a></li>
                <li id="header-link-feeds"><a href="/feeds.xml" title="Feeds"><span>Feeds</span></a></li>
                <li id="header-link-to-bottom"><a href="#footer" title="To Bottom"><span>▼ To Bottom</span></a></li>
              </ul>
            </nav>
          </div>
        </div>
        <nav id="global-nav">
          <ul>
            <li><a href="/blog/index.html">Blog</a></li>
            <li><a href="/tech/index.html">Tech</a></li>
            <li><a href="/music/index.html">Music</a></li>
            <li><a href="/games/index.html">Games</a></li>
            <li><a href="/gallery/index.html">Gallery</a></li>
            <li><a href="/etc/index.html">Etc.</a></li>
          </ul>
        </nav>
        <nav id="path">
          <ul>
            <li><a href="/index.html">Neo's World</a></li>
            <li><a href="/blog/index.html">Blog</a></li>
            <li><a href="/blog/2020/index.html">2020年</a></li>
            <li><a href="/blog/2020/08/index.html">08月</a></li>
          </ul>
        </nav>
      </header>
      <main id="main">
        <div id="header-date"><time>2020-08-10</time></div>
        <h1 id="page-title">Vue 3・Vite を触ってみる</h1>

<p>Vue 3.0 が RC (Release Candidate) になったらしいので触ってみる。</p>
<ul>
  <li>参考 : <a href="https://github.com/vuejs/rfcs/issues/189">Vue 3 is now in RC! · Issue #189 · vuejs/rfcs · GitHub</a> … 公式のアナウンス</li>
</ul>
<h2 id="目次"><a class="header-link" href="#目次"><span class="header-link-mark"></span></a>目次</h2>
<ul>
  <li><a href="#vue-%E3%81%AE%E3%83%90%E3%83%BC%E3%82%B8%E3%83%A7%E3%83%B3%E7%B4%9B%E3%82%89%E3%82%8F%E3%81%97%E3%81%84">Vue のバージョン紛らわしい</a></li>
  <li><a href="#vue-cli-%E3%81%A7%E3%81%AF%E3%81%AA%E3%81%8F-vite-%E3%82%92%E4%BD%BF%E3%81%86">Vue CLI ではなく Vite を使う</a></li>
  <li><a href="#%E6%A4%9C%E8%A8%BC%E7%92%B0%E5%A2%83">検証環境</a></li>
  <li><a href="#%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E9%9B%9B%E5%BD%A2%E3%82%92%E7%94%A8%E6%84%8F%E3%81%99%E3%82%8B">プロジェクト雛形を用意する</a></li>
  <li><a href="#%E9%9B%9B%E5%BD%A2%E3%82%92%E7%A2%BA%E8%AA%8D%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B">雛形を確認してみる</a></li>
  <li><a href="#%E5%AE%9F%E9%9A%9B%E3%81%AB%E5%8B%95%E3%81%8B%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B">実際に動かしてみる</a></li>
  <li><a href="#scss-%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B">SCSS を使ってみる</a></li>
  <li><a href="#typescript-%E3%81%A7%E3%82%B3%E3%83%BC%E3%83%87%E3%82%A3%E3%83%B3%E3%82%B0%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B">TypeScript でコーディングしてみる</a></li>
  <li><a href="#%E3%83%97%E3%83%AD%E3%83%80%E3%82%AF%E3%82%B7%E3%83%A7%E3%83%B3%E3%83%93%E3%83%AB%E3%83%89">プロダクションビルド</a></li>
  <li><a href="#%E4%BB%A5%E4%B8%8A">以上</a></li>
</ul>
<h2 id="vue-のバージョン紛らわしい"><a class="header-link" href="#vue-のバージョン紛らわしい"><span class="header-link-mark"></span></a>Vue のバージョン紛らわしい</h2>
<p>Angular は各サービスと CLI のバージョンが揃えられているが、Vue の場合は本体と Vue CLI のバージョンがバラバラである。本稿執筆時点だと</p>
<ul>
  <li>Vue CLI : v4.4.6</li>
  <li>この Vue CLI からインストールされる Vue 本体 : v2.6.11</li>
</ul>
<p>という感じ。今回試すのは Vue 本体が v3.0 になるよーという話。</p>
<h2 id="vue-cli-ではなく-vite-を使う"><a class="header-link" href="#vue-cli-ではなく-vite-を使う"><span class="header-link-mark"></span></a>Vue CLI ではなく Vite を使う</h2>
<p>上述の公式アナウンスのページを見てみると、コレまで使ってきた Vue CLI (<code>@vue/cli</code>) ではなく、Vue.js の作者が作った <strong>Vite (ヴィート)</strong> というツールを使用する方法が紹介されていた。</p>
<p>どちらかというとコチラの方が楽しみなので、やってみる。</p>
<h2 id="検証環境"><a class="header-link" href="#検証環境"><span class="header-link-mark"></span></a>検証環境</h2>
<p>今回検証した環境は次のとおり。</p>
<ul>
  <li>MacOS Catalina</li>
  <li>Node.js vt12.16.1</li>
  <li>npm v6.13.4</li>
</ul>
<h2 id="プロジェクト雛形を用意する"><a class="header-link" href="#プロジェクト雛形を用意する"><span class="header-link-mark"></span></a>プロジェクト雛形を用意する</h2>
<p>まずは、公式アナウンスの記載に従って <em><code>npm init vite-app</code></em> を叩いてみよう。</p>
<pre class="language-bash"><code class="language-bash">$ <span class="token function">npm</span> init vite-app practice-vue-3
npx: <span class="token number">7</span>個のパッケージを1.166秒でインストールしました。
Scaffolding project <span class="token keyword">in</span> /Users/Neos21/practice-vue-3<span class="token punctuation">..</span>.

Done. Now run:

  <span class="token builtin class-name">cd</span> practice-vue-3
  <span class="token function">npm</span> <span class="token function">install</span> <span class="token punctuation">(</span>or <span class="token variable"><span class="token variable">`</span><span class="token function">yarn</span><span class="token variable">`</span></span><span class="token punctuation">)</span>
  <span class="token function">npm</span> run dev <span class="token punctuation">(</span>or <span class="token variable"><span class="token variable">`</span><span class="token function">yarn</span> dev<span class="token variable">`</span></span><span class="token punctuation">)</span>

<span class="token comment"># npm init vite-app コマンドによりディレクトリが作成される</span>
$ <span class="token builtin class-name">cd</span> ./practice-vue-3/
</code></pre>
<p><code>npm init vite-app</code> ってどういうコマンドなの？と思って調べてみると、<code>npm init</code> は特定の雛形プロジェクトを作れるオプションを用意しているようだ。</p>
<ul>
  <li>参考 : <a href="https://docs.npmjs.com/cli/init">npm-init | npm Documentation</a></li>
</ul>
<p><code>$ npm init foo</code> と叩くと、内部的には <code>$ npx create-foo</code> というコマンドが実行されていて、<code>create-foo</code> パッケージにより雛形が作成されるという仕組みらしい。</p>
<p>コレを使えば <code>npx create-react-app</code> とせずに <code>npm init react-app</code> と叩いても同じ結果が得られるらしい。この <code>npm init</code> の仕様に合わせるために <code>create-</code> が接頭辞になっていたのか…！</p>
<p>というワケで、Vite に関しても <code>create-vite-app</code> という npm パッケージが別に公開されていた。コレを使ってるのね。</p>
<ul>
  <li>参考 : <a href="https://github.com/vitejs/create-vite-app">GitHub - vitejs/create-vite-app: Create a Vite-powered app in seconds!</a></li>
</ul>
<h2 id="雛形を確認してみる"><a class="header-link" href="#雛形を確認してみる"><span class="header-link-mark"></span></a>雛形を確認してみる</h2>
<p>どんなファイルが用意されたのか確認してみる。</p>
<pre class="language-bash"><code class="language-bash">$ <span class="token builtin class-name">cd</span> ./practice-vue-3/
$ tree
<span class="token builtin class-name">.</span>
├── index.html
├── package.json
├── public
│   └── favicon.ico
└── src
    ├── App.vue
    ├── assets
    │   └── logo.png
    ├── components
    │   └── HelloWorld.vue
    ├── index.css
    └── main.js

<span class="token number">4</span> directories, <span class="token number">8</span> files
</code></pre>
<p><code>index.html</code> がプロジェクトルートにある。それ以外は Vue v2 系と大して変わらないかな。</p>
<p><code>package.json</code> の中身はこんな感じ。<em>依存パッケージ少ない！</em></p>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"name"</span><span class="token operator">:</span> <span class="token string">"practice-vue-3"</span><span class="token punctuation">,</span>
  <span class="token property">"version"</span><span class="token operator">:</span> <span class="token string">"0.0.0"</span><span class="token punctuation">,</span>
  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"dev"</span><span class="token operator">:</span> <span class="token string">"vite"</span><span class="token punctuation">,</span>
    <span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"vite build"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"dependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"vue"</span><span class="token operator">:</span> <span class="token string">"^3.0.0-rc.1"</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">"devDependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"vite"</span><span class="token operator">:</span> <span class="token string">"^1.0.0-rc.1"</span><span class="token punctuation">,</span>
    <span class="token property">"@vue/compiler-sfc"</span><span class="token operator">:</span> <span class="token string">"^3.0.0-rc.1"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p><code>npm install</code> してみて実際にインストールされたバージョンは次のとおり。</p>
<pre class="language-bash"><code class="language-bash">$ <span class="token function">npm</span> <span class="token function">install</span>

$ <span class="token function">npm</span> list --depth<span class="token operator">=</span><span class="token number">0</span>
practice-vue-3@0.0.0 /Users/Neo/practice-vue-3
├── @vue/compiler-sfc@3.0.0-rc.2
├── vite@1.0.0-rc.1
└── vue@3.0.0-rc.2
</code></pre>
<h2 id="実際に動かしてみる"><a class="header-link" href="#実際に動かしてみる"><span class="header-link-mark"></span></a>実際に動かしてみる</h2>
<p>まずは雛形をそのまま動かしてみる。</p>
<pre class="language-bash"><code class="language-bash">$ <span class="token function">npm</span> run dev
</code></pre>
<p><code>http://localhost:3000/</code> で開発サーバが開く。適当に <code>src/</code> 配下のファイルを編集してみたりして、動作することを確認。</p>
<p>Vite は Rollup をベースにしていて、TypeScript のトランスパイルに爆速で知られる esbuild を使っていて、<code>.vue</code> のような SFC (Single File Component) に対応していて、HMR (Hot Module Replacement) が出来て、とかなんとか、とりあえずイマドキのチョッパヤなビルドツールってことらしい。</p>
<p>確かにそのとおりで、ファイルを編集してから開発サーバのプレビューが更新されるまでが爆速だ。コレは素敵。</p>
<ul>
  <li>参考 : <a href="https://qiita.com/jay-es/items/b3bc9c1dc077bc3f7f35">Vite は本当に早いのか ~ Vue CLI と比較 ~ - Qiita</a></li>
  <li>参考 : <a href="https://qiita.com/ryo2132/items/c1530dd590e34e68c494">【Vite】 Vue3.0もReactも！ノーバンドルなビルドツール「Vite」を試してみる - Qiita</a></li>
  <li>参考 : <a href="https://tech.smartcamp.co.jp/entry/try-vite">フロントエンドの爆速な開発サーバを実現する Vite を試してみた - SMARTCAMP Engineer Blog</a></li>
</ul>
<h2 id="scss-を使ってみる"><a class="header-link" href="#scss-を使ってみる"><span class="header-link-mark"></span></a>SCSS を使ってみる</h2>
<p><code>src/index.css</code> を見ると、素の CSS なことに気付いた。また、各コンポーネント内にも <code>style</code> 要素がなく、SCSS 対応はデフォルトではしていないようだった。</p>
<p>というワケで試しに SCSS 化してみる。</p>
<pre class="language-bash"><code class="language-bash"><span class="token comment"># css ファイルを scss にリネーム</span>
$ <span class="token function">mv</span> src/index.css src/index.scss

$ <span class="token function">vi</span> main.js
</code></pre>
<p><code>main.js</code> 内にある <em><code>import './index.css'</code></em> の行を <strong><code>import './index.scss'</code></strong> と変更したところ、<code>npm run dev</code> していたコンソールに</p>
<pre><code>Error: Cannot find module 'sass' from '/Users/Neo/practice-vue-3'
</code></pre>
<p>なるエラーが表示された。そこで一度 <code>npm run dev</code> を終了し、<code>sass</code> をインストールしてみた。</p>
<pre class="language-bash"><code class="language-bash">$ <span class="token function">npm</span> <span class="token function">install</span> -D sass
</code></pre>
<p>そしたら <code>$ npm run dev</code> してもちゃんと SCSS が解釈されるようになった。</p>
<p>コンポーネントファイル内で次のように書いても、ちゃんと SCSS がトランスパイルされることを確認した。</p>
<ul>
  <li><code>src/components/HelloWorld.vue</code> など</li>
</ul>
<pre class="language-html"><code class="language-html"><span class="token comment">&#x3C;!-- ↓ lang 属性を指定する。scoped によるスコープも、Vue v2 と同様に作れた --></span>
&#x3C;style lang="scss scoped><span class="token style"><span class="token language-css">
<span class="token selector">p</span> <span class="token punctuation">{</span>
  <span class="token selector">code</span> <span class="token punctuation">{</span>
    <span class="token property">color</span><span class="token punctuation">:</span> <span class="token hexcode color">#00f</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>style</span><span class="token punctuation">></span></span>
</code></pre>
<p>依存パッケージに <code>sass</code> (node-sass ではなく dart-sass ですな) を入れてやれば、Vite はちゃんと SCSS を解釈できるようだ。</p>
<h2 id="typescript-でコーディングしてみる"><a class="header-link" href="#typescript-でコーディングしてみる"><span class="header-link-mark"></span></a>TypeScript でコーディングしてみる</h2>
<p>続いて、素の JavaScript で書かれているところを TypeScript にしてみる。</p>
<ul>
  <li><code>src/App.vue</code></li>
</ul>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>template</span><span class="token punctuation">></span></span>
  <span class="token comment">&#x3C;!-- テキトーに data を参照する要素を配置してみる --></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>p</span><span class="token punctuation">></span></span>{{ test }}<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>p</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>template</span><span class="token punctuation">></span></span>

<span class="token comment">&#x3C;!-- ↓ lang 属性を付ける --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>script</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>ts<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
import HelloWorld from './components/HelloWorld.vue';

// 型定義をしてみる
const test: string = 'TEST';

export default {
  name: 'App',
  components: { HelloWorld },
  data: () => ({ test })
}
</code></pre>
<p>こんな感じのコードにしてみたところ、何の追加パッケージも要らずにトランスパイルされた。Vite の裏で <code>esbuild</code> がうまいことトランスパイルしてくれている様子。</p>
<p>なお、そのままだと型チェックが効かないので、</p>
<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">const</span> test<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token string">'My String'</span><span class="token punctuation">;</span>
</code></pre>
<p>のようなおかしなコードを書いてもとりあえず動いてしまう (バグる)。</p>
<p>こうした型チェックはどうしたらいいのかというと、<strong>ビルド時にやるんじゃなくて、IDE で開発中に検知しろ</strong>ってことみたい。確かにね。</p>
<p><code>tsconfig.json</code> とかを置いて制御もできるっぽいが今回は割愛。</p>
<p><code>class</code> 構文で書きたいなーと思っていたが、Vue v2 系で <code>class</code> 構文を実現していたサードパーティライブラリの開発が万全ではない。</p>
<ul>
  <li>参考 : <a href="https://github.com/vuejs/vue-class-component/issues/406">Vue v3 Changes for @Component decorator and Vue base class · Issue #406 · vuejs/vue-class-component · GitHub</a>
    <ul>
      <li>一応 Vue 公式なのだが何かまだ Issues が残っている</li>
    </ul>
  </li>
  <li>参考 : <a href="https://github.com/kaorun343/vue-property-decorator/issues/294">Vue 3.0 support · Issue #294 · kaorun343/vue-property-decorator · GitHub</a>
    <ul>
      <li>デコレータを実現するサードパーティもまだバグがあるっぽい</li>
    </ul>
  </li>
</ul>
<p>なんだろ、Vue は <code>class</code> 構文避けるよね…？と思ったら、Vue 3 ではそもそも Class Component 自体がリジェクトされてるので、非推奨っぽい。</p>
<ul>
  <li>参考 : <a href="https://github.com/vuejs/rfcs/pull/17">Abandoned Class API proposal by yyx990803 · Pull Request #17 · vuejs/rfcs · GitHub</a></li>
  <li>参考 : <a href="https://engineering.linecorp.com/ja/blog/vue-js-typescript-otoshidama/">デコレータ使わない Vue.js + TypeScript で進んだ「LINEのお年玉」キャンペーン - LINE ENGINEERING</a></li>
  <li>参考 : <a href="https://www.reddit.com/r/vuejs/comments/bs2m8t/vue_3s_class_api_proposal_has_been_dropped_in/">Vue 3's class API proposal has been dropped in favor of "composition functions" : vuejs</a></li>
  <li>参考 : <a href="https://scrapbox.io/potato4d/2020%2F07%2F28_%E6%99%82%E7%82%B9%E3%81%AE_Vue_2.x_+_TypeScript_%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6%E8%A8%80%E3%81%88%E3%82%8B%E7%A2%BA%E3%81%8B%E3%81%AA%E3%81%93%E3%81%A8">2020/07/28 時点の Vue 2.x + TypeScript について言える確かなこと - potato4d</a></li>
</ul>
<p>よー分からんけど、以下を見るに「複数の書き方が出来るのは混乱する」「TypeScript の型を厳格化するのが大変」とかそんな理由っぽい。まぁ色んな書き方できちゃうのは好かんし、<code>class</code> 構文を使わない方が型チェックが厳格にできるのであれば、それでもいいかなー。</p>
<ul>
  <li>参考 : <a href="https://github.com/vuejs/rfcs/pull/17#issuecomment-494242121">Abandoned Class API proposal by yyx990803 · Pull Request #17 · vuejs/rfcs · GitHub</a></li>
</ul>
<h2 id="プロダクションビルド"><a class="header-link" href="#プロダクションビルド"><span class="header-link-mark"></span></a>プロダクションビルド</h2>
<p><code>$ npm run dev</code> による開発ビルドではなく、ちゃんと本番ビルドするには、</p>
<pre class="language-bash"><code class="language-bash">$ <span class="token function">npm</span> run build
</code></pre>
<p>を叩く。コチラもイイカンジ。何も考えなくて良いのが使いやすい。</p>
<h2 id="以上"><a class="header-link" href="#以上"><span class="header-link-mark"></span></a>以上</h2>
<p>とにかく Vite のビルド速度が速くて驚いた。Vue 3 の正式リリース楽しみ。</p>

      </main>
      <footer id="footer">
        <div id="footer-contents">
          <div id="date-time">
            <dl>
              <dt>Created</dt>
              <dd><time>2020-08-10</time></dd>
              <dt>Last-Modified</dt>
              <dd><time>2020-08-10</time></dd>
            </dl>
          </div>
          <nav id="footer-links">
            <ul>
              <li id="footer-link-about"><a href="/about/index.html" title="About">About</a></li>
              <li id="footer-link-search"><a href="/about/search.html" title="Search">Search</a></li>
              <li id="footer-link-feeds"><a href="/feeds.xml" title="Feeds">Feeds</a></li>
              <li id="footer-link-github"><a href="https://github.com/Neos21/" title="GitHub">GitHub</a></li>
            </ul>
          </nav>
          <nav id="to-top"><a href="#" title="To Top"><span>▲ To Top</span></a></nav>
        </div>
      </footer>
    </div>
  </body>
</html>
