<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="theme-color" content="#0990d0">
    <!-- Google Search Console -->
    <meta name="google-site-verification" content="AvoEr3mUJFF2H_mPWWgShfmjBVP3ywRpyx9hxeeq2d4">
    <title>Webpack 入門 その1：Browserslist の概要把握・Webpack 環境構築 - Neo's World</title>
    <link rel="icon" href="/favicon.ico">
    <link rel="stylesheet" href="/styles.css">
    <link rel="canonical" href="https://neos21.net/blog/2020/08/25-01.html">
    <link rel="search" type="application/opensearchdescription+xml" title="neos21.net" href="/opensearch.xml">
    <link rel="alternate" type="application/atom+xml" href="/feeds.xml">
    <link rel="author" href="http://www.hatena.ne.jp/neos21/">
    <!-- Global Site Tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YMHFLZP1M1"></script>
    <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date());gtag('config','G-YMHFLZP1M1');gtag('config','UA-106501-1');</script>
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6475907504235292" crossorigin="anonymous"></script>
  </head>
  <body>
    <div id="container">
      <header id="header">
        <div id="site-title"><a href="/index.html">Neo's World</a></div>
        <nav id="header-links">
          <ul>
            <li id="header-link-about"><a href="/about/index.html" title="About"><span>About</span></a></li>
            <li id="header-link-search"><a href="/about/search.html" title="Search"><span>Search</span></a></li>
            <li id="header-link-feeds"><a href="/feeds.xml" title="Feeds"><span>Feeds</span></a></li>
            <li id="header-link-to-bottom"><a href="#footer" title="To Bottom"><span>▼ To Bottom</span></a></li>
          </ul>
        </nav>
        <nav id="global-nav">
          <ul>
            <li><a href="/blog/index.html">Blog</a></li>
            <li><a href="/tech/index.html">Tech</a></li>
            <li><a href="/music/index.html">Music</a></li>
            <li><a href="/games/index.html">Games</a></li>
            <li><a href="/gallery/index.html">Gallery</a></li>
            <li><a href="/etc/index.html">Etc.</a></li>
          </ul>
        </nav>
        <nav id="path">
          <ul>
            <li><a href="/index.html">Neo's World</a></li>
            <li><a href="/blog/index.html">Blog</a></li>
            <li><a href="/blog/2020/index.html">2020年</a></li>
            <li><a href="/blog/2020/08/index.html">08月</a></li>
          </ul>
        </nav>
      </header>
      <main id="main">
        <div id="header-date"><time>2020-08-25</time></div>
        <h1 id="page-title">Webpack 入門 その1：Browserslist の概要把握・Webpack 環境構築</h1>

<p>Browserify おじさんとしてモダン・フロントエンド界隈に入門した後、Gulp おじさんになって久しい今日この頃。Angular CLI や Vue CLI などを通じて <em>Webpack</em> をなんとなく触ってはいたが、自分でゼロから環境構築したことはなかったので、今回やってみることにした。</p>
<p>といいつつも、当初の狙いは Webpack ではなく、<strong>Browserslist</strong> を知ることだったので、その学習をメインに据えている。</p>
<h2 id="目次"><a class="header-link" href="#目次"><span class="header-link-mark"></span></a>目次</h2>
<ul>
  <li><a href="#browserslist-%E3%81%A8%E3%81%AF">Browserslist とは</a></li>
  <li><a href="#webpack-%E7%B4%A0%E6%8C%AF%E3%82%8A%E7%92%B0%E5%A2%83%E3%82%92%E6%A7%8B%E7%AF%89%E3%81%99%E3%82%8B">Webpack 素振り環境を構築する</a></li>
  <li><a href="#webpack-%E8%A8%AD%E5%AE%9A%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E6%9B%B8%E3%81%8F">Webpack 設定ファイルを書く</a></li>
  <li><a href="#%E3%83%93%E3%83%AB%E3%83%89%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B">ビルドしてみる</a></li>
  <li><a href="#%E6%AC%A1%E5%9B%9E%E3%81%AB%E7%B6%9A%E3%81%8F">次回に続く</a></li>
</ul>
<h2 id="browserslist-とは"><a class="header-link" href="#browserslist-とは"><span class="header-link-mark"></span></a>Browserslist とは</h2>
<p>Browserslist と呼ばれる設定情報が GitHub 上で共有されている。</p>
<ul>
  <li><a href="https://github.com/browserslist/browserslist">GitHub - browserslist/browserslist: 🦔 Share target browsers between different front-end tools, like Autoprefixer, Stylelint and babel-preset-env</a></li>
</ul>
<p>コレは何なのかというと、JavaScript や SCSS などをトランスパイルする時に、どのブラウザをサポートしたいか、どのバージョンのブラウザを対象外とするか、という条件を決められるモノ。</p>
<p>Browserslist に対応しているツールとしては、Babel、PostCSS などがある。これらのツールは、Browserslist が定める書式に従って用意された設定ファイルを読み取って、</p>
<ul>
  <li>「このプロジェクトは IE 対応は不要らしいから、この辺の Polyfill は含めないようにしよう」</li>
  <li>「このプロジェクトは古い Safari を対象にしたいようだから、このベンダ・プレフィックスを追加しよう」</li>
</ul>
<p>という風に、トランスパイル時に考慮してくれるワケだ。</p>
<p>Browserslist の設定は <code>.browserslistrc</code> ファイルか、<code>package.json</code> 内に書ける。自分が作ったことのある Angular CLI プロジェクトや Vue CLI プロジェクトなんかには勝手に組み込まれていて、以下のような設定が書かれていた。</p>
<ul>
  <li><code>.browserslistrc</code></li>
</ul>
<pre><code># This file is used by the build system to adjust CSS and JS output to support the specified browsers below.
# For additional information regarding the format and rule options, please see:
# https://github.com/browserslist/browserslist#queries

# You can see what browsers were selected by your queries by running:
#   npx browserslist

> 0.5%
last 2 versions
Firefox ESR
not dead
not IE 9-11 # For IE 9-11 support, remove 'not'.
</code></pre>
<ul>
  <li><code>package.json</code></li>
</ul>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token comment">// …中略…</span>
  <span class="token property">"browserslist"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"development"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">"last 1 chrome version"</span><span class="token punctuation">,</span>
      <span class="token string">"last 1 firefox version"</span><span class="token punctuation">,</span>
      <span class="token string">"last 1 safari version"</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">"production"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token string">">0.2%"</span><span class="token punctuation">,</span>
      <span class="token string">"not dead"</span><span class="token punctuation">,</span>
      <span class="token string">"not op_mini all"</span>
    <span class="token punctuation">]</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>自然言語として読みやすい指定方法だ。</p>
<ul>
  <li><code>defaults</code> を指定すると、<code>> 0.5%, last 2 versions, Firefox ESR, not dead</code> を指定したのと同じ結果になる。最近のモダンブラウザをサポートする意味となる</li>
  <li><code>> 0.5%</code> などはブラウザのシェア率を見ているらしい</li>
  <li><code>last 1 firefox version</code> など、ブラウザ別・バージョン別のサポート範囲も決められる</li>
  <li><code>dead</code> はサポートが切れているブラウザのことで、<code>not dead</code> と書くとサポートが切れているブラウザを対象外とするようだ</li>
  <li><code>not ie 9-11</code> は IE 9〜11 を対象外とする指定</li>
</ul>
<p>といった感じらしい。</p>
<p>コレがどんな風に作用するのか自分で確認したいなと思い、SCSS や TypeScript なんかをトランスパイルする環境を作ろうと思い立ち、「そういや俺ゼロから Webpack 書けねえな」と気付き、Webpack の勉強を始めることにした次第。</p>
<h2 id="webpack-素振り環境を構築する"><a class="header-link" href="#webpack-素振り環境を構築する"><span class="header-link-mark"></span></a>Webpack 素振り環境を構築する</h2>
<p>ということで、Browserslist を試すための、Webpack 素振り環境を構築する。</p>
<p>成果物は以下の GitHub リポジトリにアップしているので、ソースコードをより追いかけたい人は、コミットログを追うなどして確認して欲しい。</p>
<ul>
  <li><a href="https://github.com/Neos21/practice-browserslist">Neos21/practice-browserslist</a></li>
</ul>
<p>Webpack 公式のガイドを見ながら進めることにする。</p>
<ul>
  <li>参考：<a href="https://webpack.js.org/guides/getting-started/">Getting Started | webpack</a></li>
</ul>
<p>まずは適当な作業ディレクトリを作り、Webpack をインストールする。</p>
<pre class="language-bash"><code class="language-bash">$ <span class="token function">mkdir</span> practice-browserslist <span class="token operator">&#x26;&#x26;</span> <span class="token builtin class-name">cd</span> <span class="token variable">$_</span>
$ <span class="token function">npm</span> init -y
$ <span class="token function">npm</span> <span class="token function">install</span> -D webpack webpack-cli
</code></pre>
<ul>
  <li><code>package.json</code> : インストールされたバージョン</li>
</ul>
<pre class="language-json"><code class="language-json"><span class="token property">"devDependencies"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">"webpack"</span><span class="token operator">:</span> <span class="token string">"4.44.0"</span><span class="token punctuation">,</span>
  <span class="token property">"webpack-cli"</span><span class="token operator">:</span> <span class="token string">"3.3.12"</span>
<span class="token punctuation">}</span>
</code></pre>
<p>次にソースコードを作る。まずはテストとして、1行の JS ファイルを作る。</p>
<pre class="language-bash"><code class="language-bash">$ <span class="token function">mkdir</span> -p src/js/
$ <span class="token builtin class-name">echo</span> <span class="token string">"console.log('Test');"</span> <span class="token operator">></span> src/js/main.js
</code></pre>
<p><code>package.json</code> には次のように動作確認用の npm-scripts を書く。</p>
<pre class="language-json"><code class="language-json"><span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
  <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"npm run build &#x26;&#x26; node ./dist/js/main.js"</span><span class="token punctuation">,</span>
  <span class="token property">"build"</span><span class="token operator">:</span> <span class="token string">"webpack"</span>
<span class="token punctuation">}</span>
</code></pre>
<p><code>npm run build</code> で Webpack ビルドして、その成果物が <code>./dist/js/main.js</code> に出来る前提として、それを <code>node</code> で実行する、というモノ。</p>
<p>ちなみにココまでだったら、ソースコードを直接実行できる。</p>
<pre class="language-bash"><code class="language-bash">$ node ./src/js/main.js
Test
</code></pre>
<h2 id="webpack-設定ファイルを書く"><a class="header-link" href="#webpack-設定ファイルを書く"><span class="header-link-mark"></span></a>Webpack 設定ファイルを書く</h2>
<p>それではこのソースコードを、Webpack でバンドルするための設定ファイルを書いていく。</p>
<p><code>webpack.config.js</code> というファイルをプロジェクトディレクトリ直下に作り、次のように書いてみる。</p>
<ul>
  <li><code>webpack.config.js</code></li>
</ul>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'path'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  mode<span class="token operator">:</span> <span class="token string">'production'</span><span class="token punctuation">,</span>  <span class="token comment">// モード指定</span>
  entry<span class="token operator">:</span> <span class="token string">'./src/js/main.ts'</span><span class="token punctuation">,</span>  <span class="token comment">// エントリポイント</span>
  <span class="token comment">// 出力先パス・ファイル名</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    path    <span class="token operator">:</span> path<span class="token punctuation">.</span><span class="token method function property-access">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'dist/'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment">// 絶対パスで記述する必要がある</span>
    filename<span class="token operator">:</span> <span class="token string">'js/[name].js'</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>とりあえず、エントリポイントとなるソースファイルと、それをビルドして出力する先を指定した。</p>
<h2 id="ビルドしてみる"><a class="header-link" href="#ビルドしてみる"><span class="header-link-mark"></span></a>ビルドしてみる</h2>
<p>コレでいったんビルドして動作確認してみる。</p>
<pre class="language-bash"><code class="language-bash"><span class="token comment"># npm run build でビルドしたファイルを実行する</span>
$ <span class="token function">npm</span> start

<span class="token operator">></span> practice-browserslist@ start /Users/Neo/practice-browserslist
<span class="token operator">></span> <span class="token function">npm</span> run build <span class="token operator">&#x26;&#x26;</span> node ./dist/js/main.js

<span class="token operator">></span> practice-browserslist@ build /Users/Neo/practice-browserslist
<span class="token operator">></span> webpack

Hash: 90df6e535afa96d8701c
Version: webpack <span class="token number">4.44</span>.0
Time: 242ms
Built at: <span class="token number">2020</span>-07-28 <span class="token number">10</span>:50:18
     Asset       Size  Chunks             Chunk Names
js/main.js  <span class="token number">949</span> bytes       <span class="token number">0</span>  <span class="token punctuation">[</span>emitted<span class="token punctuation">]</span>  main
Entrypoint main <span class="token operator">=</span> js/main.js
<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> ./src/js/main.ts <span class="token number">20</span> bytes <span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span> <span class="token punctuation">[</span>built<span class="token punctuation">]</span>

Test
</code></pre>
<p>元が20バイトで、ビルドしたら949バイトって、増えてない？</p>
<p>生成された <code>./dist/js/main.js</code> を見てみると、<code>export</code> などを処理するためのコードが埋め込まれており、最後の方に <code>console.log("Test")</code> というソースコード部分が埋め込まれている。これらは1行にまとめて圧縮されている。</p>
<p>なるほど、Webpack はモジュールをバンドルするためのコードを埋め込み、コードの圧縮まではデフォルトで行ってくれるというワケだ。</p>
<h2 id="次回に続く"><a class="header-link" href="#次回に続く"><span class="header-link-mark"></span></a>次回に続く</h2>
<p>というワケで Webpack 素振り環境ができた。</p>
<p>次回はココにあれこれ設定を追加して、SCSS や ECMAScript、そして TypeScript などをトランスパイルしていきつつ、Browserslist の効果を確認していく。</p>

      </main>
      <footer id="footer">
        <div id="date-time">
          <dl>
            <dt>Created</dt>
            <dd><time>2020-08-25</time></dd>
            <dt>Last-Modified</dt>
            <dd><time>2020-08-25</time></dd>
          </dl>
        </div>
        <nav id="footer-links">
          <ul>
            <li id="footer-link-about"><a href="/about/index.html" title="About">About</a></li>
            <li id="footer-link-search"><a href="/about/search.html" title="Search">Search</a></li>
            <li id="footer-link-feeds"><a href="/feeds.xml" title="Feeds">Feeds</a></li>
            <li id="footer-link-github"><a href="https://github.com/Neos21/" title="GitHub">GitHub</a></li>
          </ul>
        </nav>
        <nav id="to-top"><a href="#" title="To Top"><span>▲ To Top</span></a></nav>
      </footer>
    </div>
  </body>
</html>
