<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="theme-color" content="#0990d0">
    <!-- Google Search Console -->
    <meta name="google-site-verification" content="AvoEr3mUJFF2H_mPWWgShfmjBVP3ywRpyx9hxeeq2d4">
    <title>iOS の「ショートカット」アプリが最強！自作 Web アプリとの通信に使ってみた - Neo's World</title>
    <link rel="icon" href="/favicon.ico">
    <link rel="stylesheet" href="/styles.css">
    <link rel="canonical" href="https://neos21.net/blog/2020/03/04-02.html">
    <link rel="search" type="application/opensearchdescription+xml" title="neos21.net" href="/opensearch.xml">
    <link rel="alternate" type="application/atom+xml" href="/feeds.xml">
    <link rel="author" href="http://www.hatena.ne.jp/neos21/">
    <!-- Global Site Tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YMHFLZP1M1"></script>
    <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date());gtag('config','G-YMHFLZP1M1');gtag('config','UA-106501-1');</script>
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6475907504235292" crossorigin="anonymous"></script>
  </head>
  <body>
    <div id="container">
      <header id="header">
        <div id="header-brand">
          <div id="header-brand-contents">
            <div id="site-title"><a href="/index.html">Neo's World</a></div>
            <nav id="header-links">
              <ul>
                <li id="header-link-about"><a href="/about/index.html" title="About"><span>About</span></a></li>
                <li id="header-link-search"><a href="/about/search.html" title="Search"><span>Search</span></a></li>
                <li id="header-link-feeds"><a href="/feeds.xml" title="Feeds"><span>Feeds</span></a></li>
                <li id="header-link-to-bottom"><a href="#footer" title="To Bottom"><span>▼ To Bottom</span></a></li>
              </ul>
            </nav>
          </div>
        </div>
        <nav id="global-nav">
          <ul>
            <li><a href="/blog/index.html">Blog</a></li>
            <li><a href="/tech/index.html">Tech</a></li>
            <li><a href="/music/index.html">Music</a></li>
            <li><a href="/games/index.html">Games</a></li>
            <li><a href="/gallery/index.html">Gallery</a></li>
            <li><a href="/etc/index.html">Etc.</a></li>
          </ul>
        </nav>
        <nav id="path">
          <ul>
            <li><a href="/index.html">Neo's World</a></li>
            <li><a href="/blog/index.html">Blog</a></li>
            <li><a href="/blog/2020/index.html">2020年</a></li>
            <li><a href="/blog/2020/03/index.html">03月</a></li>
          </ul>
        </nav>
      </header>
      <main id="main">
        <div id="header-date"><time>2020-03-04</time></div>
        <h1 id="page-title">iOS の「ショートカット」アプリが最強！自作 Web アプリとの通信に使ってみた</h1>

<ul>
  <li><a href="https://github.com/Neos21/neos-php-micro-blog">オレオレ・マイクロ・ブログ</a></li>
  <li><a href="https://github.com/Neos21/neos-ruby-bookmarks">オレオレ・ブックマーク</a></li>
</ul>
<p>という2つの Web アプリを作って、自分だけで使っている。</p>
<p>POST メソッドでフォーム送信を受け付ける他、GET メソッドで受け取った URL パラメータも「投稿」処理に使うよう実装したりしているので、ブックマークレットから URL をリクエストするだけで、つぶやきを投稿したり、ブックマークを追加したりできるようにしてある。</p>
<p>ブックマークレットでもさほど不便はしていなかったのだが、iOS の「共有メニュー」から呼び出せたり、ホーム画面にアイコンを設置して投稿フォームを表示したりできたら使いやすいかもなー、と思った。調べてみると、Apple 公式アプリの<strong>「ショートカット」</strong>というアプリを使って、イイカンジに処理ができたので、やり方を紹介する。</p>
<h2 id="目次"><a class="header-link" href="#目次"><span class="header-link-mark"></span></a>目次</h2>
<ul>
  <li><a href="#%E3%82%B7%E3%83%A7%E3%83%BC%E3%83%88%E3%82%AB%E3%83%83%E3%83%88%E3%82%A2%E3%83%97%E3%83%AA%E3%81%A8%E3%81%AF">「ショートカット」アプリとは</a></li>
  <li><a href="#%E3%81%BE%E3%81%9A%E3%81%AF%E8%87%AA%E5%88%86%E3%81%A7%E5%AE%9F%E8%A3%85%E3%81%97%E3%81%A6%E3%81%BF%E3%81%9F%E3%83%A2%E3%83%8E%E3%82%92%E7%B4%B9%E4%BB%8B">まずは自分で実装してみたモノを紹介</a>
    <ul>
      <li><a href="#%E3%82%AA%E3%83%AC%E3%82%AA%E3%83%AC%E3%83%9E%E3%82%A4%E3%82%AF%E3%83%AD%E3%83%96%E3%83%AD%E3%82%B0%E3%81%AB%E4%BB%BB%E6%84%8F%E3%83%86%E3%82%AD%E3%82%B9%E3%83%88%E3%82%92%E6%8A%95%E7%A8%BF%E3%81%99%E3%82%8B">オレオレ・マイクロ・ブログに任意テキストを投稿する</a></li>
      <li><a href="#%E9%96%B2%E8%A6%A7%E4%B8%AD%E3%81%AE-web-%E3%83%9A%E3%83%BC%E3%82%B8%E3%82%92%E3%82%AA%E3%83%AC%E3%82%AA%E3%83%AC%E3%83%9E%E3%82%A4%E3%82%AF%E3%83%AD%E3%83%96%E3%83%AD%E3%82%B0%E3%81%AB%E6%8A%95%E7%A8%BF%E3%81%99%E3%82%8B">閲覧中の Web ページをオレオレ・マイクロ・ブログに投稿する</a></li>
      <li><a href="#%E9%96%B2%E8%A6%A7%E4%B8%AD%E3%81%AE-web-%E3%83%9A%E3%83%BC%E3%82%B8%E3%81%AB%E4%BB%BB%E6%84%8F%E3%82%B3%E3%83%A1%E3%83%B3%E3%83%88%E3%82%92%E6%B2%BF%E3%81%88%E3%81%A6%E3%82%AA%E3%83%AC%E3%82%AA%E3%83%AC%E3%83%9E%E3%82%A4%E3%82%AF%E3%83%AD%E3%83%96%E3%83%AD%E3%82%B0%E3%81%AB%E6%8A%95%E7%A8%BF%E3%81%99%E3%82%8B">閲覧中の Web ページに任意コメントを沿えてオレオレ・マイクロ・ブログに投稿する</a></li>
      <li><a href="#%E3%82%AA%E3%83%AC%E3%82%AA%E3%83%AC%E3%83%96%E3%83%83%E3%82%AF%E3%83%9E%E3%83%BC%E3%82%AF%E3%81%AB%E9%96%B2%E8%A6%A7%E4%B8%AD%E3%81%AE-web-%E3%83%9A%E3%83%BC%E3%82%B8%E3%82%92%E6%8A%95%E7%A8%BF%E3%81%99%E3%82%8B">オレオレ・ブックマークに閲覧中の Web ページを投稿する</a></li>
    </ul>
  </li>
  <li><a href="#%E4%BB%8A%E6%97%A5%E3%81%AF%E3%82%B3%E3%82%B3%E3%83%9E%E3%83%87">今日はココマデ…</a></li>
</ul>
<h2 id="ショートカットアプリとは"><a class="header-link" href="#ショートカットアプリとは"><span class="header-link-mark"></span></a>「ショートカット」アプリとは</h2>
<p>iOS の「ショートカット」アプリとは、任意の操作を GUI 上で組み立てていくと、その操作を自動化できるというモノ。</p>
<ul>
  <li>複数のアプリを開いたり</li>
  <li>アプリからパラメータとか画像とかを取得してみたり</li>
  <li>値を加工・変換したり</li>
  <li>ダイアログで値が入力できたり</li>
  <li><code>if</code> 文が組み込めたり</li>
  <li><em>Web ページに任意の JavaScript を実行してみたり</em></li>
  <li>任意の URL を Safari で開いたり</li>
  <li><strong>Safari ブラウザを介さず任意の URL と通信だけしてみたり</strong></li>
</ul>
<p>と、結構色々なことができるようだった。</p>
<p>そして、そのように作成したショートカットを「共有メニュー」に追加できたり、「ウィジェット」やホーム画面にショートカットを実行するアイコンを配置できたりする。コレは可能性がありそうだ。</p>
<p>作成したショートカットは iCloud アカウントで同期されるようで、作ったそばから、複数の端末で同じショートカットを利用できるようになる。とても便利だ。</p>
<h2 id="まずは自分で実装してみたモノを紹介"><a class="header-link" href="#まずは自分で実装してみたモノを紹介"><span class="header-link-mark"></span></a>まずは自分で実装してみたモノを紹介</h2>
<p>ということで、自分でちょこちょこ実装してみたモノを紹介していく。「ショートカット」アプリは GUI で構築でき、ソースコードのようなテキストベースの成果物に落とせないので、スクショとともに、どんな動きをするモノなのかを紹介する。ショートカットを使ったことがない人も、見ていけばどんな塩梅なのか雰囲気が掴めるはずだ。</p>
<h3 id="オレオレマイクロブログに任意テキストを投稿する"><a class="header-link" href="#オレオレマイクロブログに任意テキストを投稿する"><span class="header-link-mark"></span></a>オレオレ・マイクロ・ブログに任意テキストを投稿する</h3>
<p>
  <img src="04-02-07.png" alt="ショートカットの様子">
</p>
<p>このようなショートカットを作り、ホーム画面にアイコンを設置している。</p>
<p>
  <img src="04-02-08.png" alt="ホーム画面のアイコン">
</p>
<p>コレをタップすると以下のようなダイアログが出てくる。</p>
<p>
  <img src="04-02-01.png" alt="テキスト入力欄">
</p>
<p>ココに任意テキストを入れて OK を押せば、入力した内容がオレオレ・マイクロ・ブログに向かって POST 送信される。</p>
<p>一番最後に</p>
<ul>
  <li><code>URL の内容</code> 内の <code>result</code> の <code>値</code> を取得</li>
</ul>
<p>というアクションがあるが、この後ろに<em>「スクリプティング：結果を表示」</em>というアクションを追加し、</p>
<ul>
  <li><code>辞書の値</code> を表示</li>
</ul>
<p>というアクションを置いてやれば、POST 送信のレスポンス JSON から <code>result</code> プロパティの値を取得し、OK ボタンのみのダイアログで表示してくれる。<code>{ "result": "Success!" }</code> といった JSON がレスポンスされていたら、「Success!」という文字列がダイアログ表示されるというワケだ。</p>
<p>自分はこのようなダイアログ表示のアクションを配置していないので、実行結果を確認できないが、イチイチダイアログが出るのも鬱陶しいので気にしていない。</p>
<p>最初に表示されるダイアログに何もテキストを入れずに「OK」ボタンを押下すると、</p>
<ul>
  <li>もし <code>comment</code> <code>値がない</code> ならば</li>
</ul>
<p>という「if 文」アクションで分岐しているとおり、任意の URL を Safari で開いて終了となる。</p>
<h3 id="閲覧中の-web-ページをオレオレマイクロブログに投稿する"><a class="header-link" href="#閲覧中の-web-ページをオレオレマイクロブログに投稿する"><span class="header-link-mark"></span></a>閲覧中の Web ページをオレオレ・マイクロ・ブログに投稿する</h3>
<p>
  <img src="04-02-09.png" alt="ショートカットの内容">
</p>
<p>最初の</p>
<ul>
  <li>受け入れる</li>
</ul>
<p>というアクションが重要。コレで、Safari やアプリ内ブラウザのメニューからこのショートカットを呼び出した時に、閲覧中の Web ページのタイトルや URL を取得できるようにしている。</p>
<p>
  <img src="04-02-02.png" alt="これらにチェックを入れる">
</p>
<p>↑こんな風にチェックを入れてある。</p>
<p>コレで閲覧中の Web ページのタイトルと URL を拾ったら、先程と同様に POST 送信のフォームパラメータに設定している。</p>
<h3 id="閲覧中の-web-ページに任意コメントを沿えてオレオレマイクロブログに投稿する"><a class="header-link" href="#閲覧中の-web-ページに任意コメントを沿えてオレオレマイクロブログに投稿する"><span class="header-link-mark"></span></a>閲覧中の Web ページに任意コメントを沿えてオレオレ・マイクロ・ブログに投稿する</h3>
<p>
  <img src="04-02-03.png" alt="ちょっと増えた">
</p>
<p>上2つのショートカットの結合版みたいな感じ。</p>
<p>任意コメントを入力した場合は、「任意コメント + <strong>改行</strong> + ページタイトル + URL」という形式になるように、色々と調整している。改行コードだけをうまく仕込むのが難しかったので、一旦</p>
<ul>
  <li>テキスト</li>
</ul>
<p>というアクションに、改行だけの文字列を設定し、</p>
<ul>
  <li>テキストを結合</li>
</ul>
<p>というアクションを使って、入力した任意コメントの後ろに改行コードを結合している。</p>
<p>実際にどんな風に使うと、こんな感じ。</p>
<p>
  <img src="04-02-04.png" alt="こんな風に共有メニューに出る">
</p>
<p>Safari で共有メニューを開くと、このように自分が作ったショートカット名が並ぶので、それを選択する。</p>
<p>
  <img src="04-02-05.png" alt="任意コメントを入力">
</p>
<p>するとこのようにダイアログが出るので、任意コメントを入力して OK を押すと、そのコメント付きでオレオレ・マイクロ・ブログに閲覧中の Web ページの情報が投稿されるというワケ。</p>
<h3 id="オレオレブックマークに閲覧中の-web-ページを投稿する"><a class="header-link" href="#オレオレブックマークに閲覧中の-web-ページを投稿する"><span class="header-link-mark"></span></a>オレオレ・ブックマークに閲覧中の Web ページを投稿する</h3>
<p>
  <img src="04-02-06.png" alt="ショートカット全体">
</p>
<p>オレオレ・マイクロ・ブログと違って、オレオレ・ブックマークは、GET メソッドで受け付けた URL パラメータを基にブックマークを投稿できる仕組みになっている。</p>
<p>当初は「Safari で URL を開く」アクションを利用していた。<code>http://example.com/bookmarks.rb?url=...</code> といったパラメータ付き URL を構築して Safari で開くことで、GET メソッドによる「投稿」処理を実現し、その結果を Safari で確認するような作りにしていた。</p>
<p>しかし、イチイチ Safari が開くのが鬱陶しいので、POST 送信時と同じく</p>
<ul>
  <li>URL</li>
</ul>
<p>アクションと、</p>
<ul>
  <li>URL の内容を取得</li>
</ul>
<p>アクションを組み合わせて、Safari ブラウザを開くことなく、GET 送信をバックグラウンドで行うようにした。</p>
<p>ちょっと余計な if 文とかが混じっているので、もう少し簡素に作れそうだ。</p>
<h2 id="今日はココマデ"><a class="header-link" href="#今日はココマデ"><span class="header-link-mark"></span></a>今日はココマデ…</h2>
<p>思いの他長くなってしまったので、今日はココまで。</p>
<p>次回はココで使ったアクションを分解し、もっと汎用的に「やりたいこと」を実現するためのアクション作りの方法を紹介していこう。</p>

      </main>
      <footer id="footer">
        <div id="footer-contents">
          <div id="date-time">
            <dl>
              <dt>Created</dt>
              <dd><time>2020-03-04</time></dd>
              <dt>Last-Modified</dt>
              <dd><time>2020-03-04</time></dd>
            </dl>
          </div>
          <nav id="footer-links">
            <ul>
              <li id="footer-link-about"><a href="/about/index.html" title="About">About</a></li>
              <li id="footer-link-search"><a href="/about/search.html" title="Search">Search</a></li>
              <li id="footer-link-feeds"><a href="/feeds.xml" title="Feeds">Feeds</a></li>
              <li id="footer-link-github"><a href="https://github.com/Neos21/" title="GitHub">GitHub</a></li>
            </ul>
          </nav>
          <nav id="to-top"><a href="#" title="To Top"><span>▲ To Top</span></a></nav>
        </div>
      </footer>
    </div>
  </body>
</html>
