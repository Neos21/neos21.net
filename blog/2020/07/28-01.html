<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="theme-color" content="#0990d0">
    <!-- Google Search Console -->
    <meta name="google-site-verification" content="AvoEr3mUJFF2H_mPWWgShfmjBVP3ywRpyx9hxeeq2d4">
    <title>moreutils の中の便利そうなコマンド : sponge と vidir - Neo's World</title>
    <link rel="icon" href="/favicon.ico">
    <link rel="stylesheet" href="/styles.css">
    <link rel="canonical" href="https://neos21.net/blog/2020/07/28-01.html">
    <link rel="search" type="application/opensearchdescription+xml" title="neos21.net" href="/opensearch.xml">
    <link rel="alternate" type="application/atom+xml" href="/feeds.xml">
    <link rel="author" href="http://www.hatena.ne.jp/neos21/">
    <!-- Global Site Tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YMHFLZP1M1"></script>
    <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date());gtag('config','G-YMHFLZP1M1');gtag('config','UA-106501-1');</script>
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6475907504235292" crossorigin="anonymous"></script>
  </head>
  <body>
    <div id="container">
      <header id="header">
        <div id="site-title"><a href="/index.html">Neo's World</a></div>
        <nav id="header-links">
          <ul>
            <li id="header-link-about"><a href="/about/index.html" title="About"><span>About</span></a></li>
            <li id="header-link-search"><a href="/about/search.html" title="Search"><span>Search</span></a></li>
            <li id="header-link-feeds"><a href="/feeds.xml" title="Feeds"><span>Feeds</span></a></li>
            <li id="header-link-to-bottom"><a href="#footer" title="To Bottom"><span>▼ To Bottom</span></a></li>
          </ul>
        </nav>
        <nav id="global-nav">
          <ul>
            <li><a href="/blog/index.html">Blog</a></li>
            <li><a href="/tech/index.html">Tech</a></li>
            <li><a href="/music/index.html">Music</a></li>
            <li><a href="/games/index.html">Games</a></li>
            <li><a href="/gallery/index.html">Gallery</a></li>
            <li><a href="/etc/index.html">Etc.</a></li>
          </ul>
        </nav>
        <nav id="path">
          <ul>
            <li><a href="/index.html">Neo's World</a></li>
            <li><a href="/blog/index.html">Blog</a></li>
            <li><a href="/blog/2020/index.html">2020年</a></li>
            <li><a href="/blog/2020/07/index.html">07月</a></li>
          </ul>
        </nav>
      </header>
      <main id="main">
        <div id="header-date"><time>2020-07-28</time></div>
        <h1 id="page-title">moreutils の中の便利そうなコマンド : sponge と vidir</h1>

<p><code>moreutils</code> という便利コマンド集があって、Yum とか Homebrew とかで簡単に入れられるので試してみた。今回はその中でも特に有用そうな2つのコマンド、<em><code>sponge</code></em> と <strong><code>vidir</code></strong> を紹介する。</p>
<h2 id="目次"><a class="header-link" href="#目次"><span class="header-link-mark"></span></a>目次</h2>
<ul>
  <li><a href="#moreutils-%E3%81%AE%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E6%96%B9%E6%B3%95">moreutils のインストール方法</a></li>
  <li><a href="#sponge">sponge</a></li>
  <li><a href="#vidir">vidir</a></li>
  <li><a href="#%E4%BB%A5%E4%B8%8A">以上</a></li>
</ul>
<h2 id="moreutils-のインストール方法"><a class="header-link" href="#moreutils-のインストール方法"><span class="header-link-mark"></span></a>moreutils のインストール方法</h2>
<p>moreutils は OS に合わせて以下のようなコマンドでインストールすればよい。今回は MacOS (Homebrew) でインストールしたモノで試した。</p>
<pre class="language-bash"><code class="language-bash"><span class="token comment"># MacOS (Homebrew)</span>
$ brew <span class="token function">install</span> moreutils

<span class="token comment"># CentOS (Yum)</span>
$ yum <span class="token function">install</span> -y moreutils

<span class="token comment"># Ubuntu (apt)</span>
$ <span class="token function">apt</span> <span class="token function">install</span> -y moreutils

<span class="token comment"># Windows GitSDK・Archi Linux (Pacman)</span>
$ pacman -S moreutils
</code></pre>
<h2 id="sponge"><a class="header-link" href="#sponge"><span class="header-link-mark"></span></a>sponge</h2>
<p>まず紹介するのは <code>sponge</code> コマンド。コレを使うと、入力と出力に同じファイルを利用できる。</p>
<p>例えば、<code>example.txt</code> の内容を読み込み、変換処理を加えて、結果を同じ <code>example.txt</code> に出力したくて、以下のようなコマンドを書いたとする。</p>
<pre class="language-bash"><code class="language-bash">$ <span class="token function">sed</span> <span class="token string">'s/aaa/AAA/g'</span> <span class="token operator">&#x3C;</span> example.txt <span class="token operator">></span> example.txt
</code></pre>
<p>このコマンドを実行すると、<code>example.txt</code> の中身は空になってしまう。まぁ <code>sed</code> に関しては <code>-i</code> オプションで上書き保存はできるのだが、あくまで一例として。</p>
<p>で、リダイレクト <code>></code> の代わりに、パイプ <code>|</code> と <em><code>sponge</code></em> コマンドを使うと、上のようなことが思ったとおりに実現できるようになる。</p>
<pre class="language-bash"><code class="language-bash">$ <span class="token function">sed</span> <span class="token string">'s/aaa/AAA/g'</span> <span class="token operator">&#x3C;</span> example.txt  <span class="token operator">|</span> sponge example.txt 
</code></pre>
<p>こんな感じ。</p>
<h2 id="vidir"><a class="header-link" href="#vidir"><span class="header-link-mark"></span></a>vidir</h2>
<p><strong><code>vidir</code></strong> は、Vim っぽい画面でカレントディレクトリ配下のファイルやディレクトリ名をリネーム・削除できるツール。</p>
<pre class="language-bash"><code class="language-bash">$ vidir
</code></pre>
<p>と叩くと Vim 風な画面が現れ、カレントディレクトリ配下のファイルとディレクトリが見える。ココまでは <code>$ vi ./</code> と叩いた時と似たように見える。</p>
<p>この状態で編集モードに入ると、ファイル名を書き換えたりでき、それを保存して終了すると実際にファイルがリネームされている。</p>
<p><strong>Vim の矩形選択</strong>を覚えれば、<em>複数ファイルの一括リネーム</em>が可能になるので、Vim における矩形選択の手順を紹介しよう。</p>
<ul>
  <li>
    <p>文字を一括で追加する場合</p>
    <ol>
      <li>矩形選択で文字を追加したい箇所にカーソルを移動させておく</li>
      <li><code>Ctrl + v</code> を押下し、「ビジュアル矩形 (Visual Block)」モードに入る</li>
      <li>矩形選択したい行を <code>jk</code> (↑↓) で選択する</li>
      <li><code>Shift + i</code> や <code>Shift + a</code> で編集モードに入る</li>
      <li>この状態で文字を打つと、選択した1行目にのみ変更が反映されていくが、一旦気にせず書く</li>
      <li>追記が終わったら <code>Esc</code> を押す。すると追記した内容が選択していた行全てに反映される</li>
    </ol>
  </li>
  <li>
    <p>文字を一括で削除する場合</p>
    <ol>
      <li>矩形選択で文字を削除したい箇所にカーソルを移動させておく</li>
      <li><code>Ctrl + v</code> を押下し、「ビジュアル矩形 (Visual Block)」モードに入る</li>
      <li>矩形選択で削除したい範囲 (文字数) を <code>hl</code> (←→) で選択する</li>
      <li>矩形選択で削除する行を <code>jk</code> (↑↓) で選択する</li>
      <li><code>d</code> を押下すると矩形選択した文字が削除される</li>
    </ol>
  </li>
  <li>
    <p>参考：<a href="https://qiita.com/mekagazira/items/e5c415632362b3b72f33">vimを使った矩形選択 - Qiita</a></p>
  </li>
</ul>
<p>保存時は <code>wq</code> で終了すれば良いし、取り消したければ <code>q!</code> でキャンセルして終了すれば良い。</p>
<p>ディレクトリやファイルの削除にも対応していて、行ごと削除すればファイル削除される。ただし、ディレクトリは中が空でないと削除できない。</p>
<h2 id="以上"><a class="header-link" href="#以上"><span class="header-link-mark"></span></a>以上</h2>
<p>シェル芸の幅が広がりそうなので、moreutils 覚えておこう。</p>
<ul>
  <li>参考：<a href="https://blog.black-cat.jp/2018/11/moreutils/">moreutilsについて学ぶ</a></li>
  <li>参考：<a href="https://qiita.com/ngyuki/items/ad7d52186a84cc973438">シェル芸力向上のため moreutils を一通り試してみた - Qiita</a></li>
</ul>

      </main>
      <footer id="footer">
        <div id="date-time">
          <dl>
            <dt>Created</dt>
            <dd><time>2020-07-28</time></dd>
            <dt>Last-Modified</dt>
            <dd><time>2020-07-28</time></dd>
          </dl>
        </div>
        <nav id="footer-links">
          <ul>
            <li id="footer-link-about"><a href="/about/index.html" title="About">About</a></li>
            <li id="footer-link-search"><a href="/about/search.html" title="Search">Search</a></li>
            <li id="footer-link-feeds"><a href="/feeds.xml" title="Feeds">Feeds</a></li>
            <li id="footer-link-github"><a href="https://github.com/Neos21/" title="GitHub">GitHub</a></li>
          </ul>
        </nav>
        <nav id="to-top"><a href="#" title="To Top"><span>▲ To Top</span></a></nav>
      </footer>
    </div>
  </body>
</html>
