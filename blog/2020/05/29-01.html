<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="theme-color" content="#0990d0">
    <!-- Google Search Console -->
    <meta name="google-site-verification" content="AvoEr3mUJFF2H_mPWWgShfmjBVP3ywRpyx9hxeeq2d4">
    <title>XREA で Python・MeCab を触ってみる・ついでに Python CGI で動かしてみる - Neo's World</title>
    <link rel="icon" href="/favicon.ico">
    <link rel="stylesheet" href="/styles.css">
    <link rel="canonical" href="https://neos21.net/blog/2020/05/29-01.html">
    <link rel="search" type="application/opensearchdescription+xml" title="neos21.net" href="/opensearch.xml">
    <link rel="alternate" type="application/atom+xml" href="/feeds.xml">
    <link rel="author" href="http://www.hatena.ne.jp/neos21/">
    <!-- Global Site Tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YMHFLZP1M1"></script>
    <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date());gtag('config','G-YMHFLZP1M1');gtag('config','UA-106501-1');</script>
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6475907504235292" crossorigin="anonymous"></script>
  </head>
  <body>
    <div id="container">
      <header id="header">
        <div id="site-title"><a href="/index.html">Neo's World</a></div>
        <nav id="header-links">
          <ul>
            <li id="header-link-about"><a href="/about/index.html" title="About"><span>About</span></a></li>
            <li id="header-link-search"><a href="/about/search.html" title="Search"><span>Search</span></a></li>
            <li id="header-link-feeds"><a href="/feeds.xml" title="Feeds"><span>Feeds</span></a></li>
            <li id="header-link-to-bottom"><a href="#footer" title="To Bottom"><span>▼ To Bottom</span></a></li>
          </ul>
        </nav>
        <nav id="global-nav">
          <ul>
            <li><a href="/blog/index.html">Blog</a></li>
            <li><a href="/tech/index.html">Tech</a></li>
            <li><a href="/music/index.html">Music</a></li>
            <li><a href="/games/index.html">Games</a></li>
            <li><a href="/gallery/index.html">Gallery</a></li>
            <li><a href="/etc/index.html">Etc.</a></li>
          </ul>
        </nav>
        <nav id="path">
          <ul>
            <li><a href="/index.html">Neo's World</a></li>
            <li><a href="/blog/index.html">Blog</a></li>
            <li><a href="/blog/2020/index.html">2020年</a></li>
            <li><a href="/blog/2020/05/index.html">05月</a></li>
          </ul>
        </nav>
      </header>
      <main id="main">
        <div id="header-date"><time>2020-05-29</time></div>
        <h1 id="page-title">XREA で Python・MeCab を触ってみる・ついでに Python CGI で動かしてみる</h1>

<p>s15 サーバの頃からお世話になり続けている XREA。Perl・PHP・Ruby・Python などの言語で実装した CGI の他、MySQL・PostgreSQL が使える。さらに、ひっそりと形態素解析ツールの <strong>MeCab</strong> までプリインストールされている。</p>
<p>コレは使うっきゃない、ということで確かめてみた。</p>
<h2 id="目次"><a class="header-link" href="#目次"><span class="header-link-mark"></span></a>目次</h2>
<ul>
  <li><a href="#mecab-%E3%82%92%E8%A9%A6%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B">MeCab を試してみる</a></li>
  <li><a href="#python-%E3%81%8B%E3%82%89-mecab-%E3%82%92%E8%A7%A6%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B">Python から MeCab を触ってみる</a></li>
  <li><a href="#htaccess-%E3%82%92%E7%B7%A8%E9%9B%86%E3%81%97%E3%81%A6-python-cgi-%E3%82%92%E6%9C%89%E5%8A%B9%E3%81%AB%E3%81%99%E3%82%8B"><code>.htaccess</code> を編集して Python CGI を有効にする</a></li>
  <li><a href="#mecab-%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B-python-cgi-%E3%82%92%E6%9B%B8%E3%81%84%E3%81%A6%E3%81%BF%E3%82%8B">MeCab を使用する Python CGI を書いてみる</a></li>
  <li><a href="#%E4%BB%8A%E5%9B%9E%E3%81%AF%E3%82%B3%E3%82%B3%E3%81%BE%E3%81%A7">今回はココまで</a></li>
</ul>
<h2 id="mecab-を試してみる"><a class="header-link" href="#mecab-を試してみる"><span class="header-link-mark"></span></a>MeCab を試してみる</h2>
<p>まずは XREA サーバに SSH 接続して、MeCab を試してみる。XREA サーバに SSH 接続する方法は以下の記事で紹介したとおり。</p>
<ul>
  <li><a href="/blog/2019/08/12-02.html">XREA のサーバに SSH 接続する</a></li>
</ul>
<pre class="language-bash"><code class="language-bash"><span class="token comment"># LANG 環境変数は以下のとおりであること・設定されていなければ設定しておく</span>
$ <span class="token builtin class-name">echo</span> <span class="token environment constant">$LANG</span>
ja_JP.UTF-8

<span class="token comment"># MeCab が入っていることを確認する</span>
$ mecab --version
mecab of <span class="token number">0.996</span>

<span class="token comment"># UTF-8 でエンコードされた辞書ファイルを参照してコマンドラインで動かしてみる</span>
$ mecab -d /usr/lib64/mecab/dic/ipadic/
<span class="token comment"># Ctrl + D で抜ける</span>
</code></pre>
<p>こんな感じ。</p>
<h2 id="python-から-mecab-を触ってみる"><a class="header-link" href="#python-から-mecab-を触ってみる"><span class="header-link-mark"></span></a>Python から MeCab を触ってみる</h2>
<p>続いて、XREA にプリインストールされている Python の環境を確認する。</p>
<pre class="language-bash"><code class="language-bash">$ <span class="token builtin class-name">type</span> python
python は /usr/local/bin/python です
$ python --version
Python <span class="token number">2.7</span>.5

$ <span class="token builtin class-name">type</span> python3
python3 は /usr/local/bin/python3 です
$ python3 --version
Python <span class="token number">3.6</span>.8
</code></pre>
<p>このように、Python2 系と Python3 系が導入されている。</p>
<p>Python3 で MeCab を使うため、次のように <code>mecab-python3</code> をインストールする。</p>
<pre class="language-bash"><code class="language-bash">$ python3 -m pip <span class="token function">install</span> mecab-python3 --user
</code></pre>
<p>この時点で、<code>python3</code> コマンドで対話式プロンプトを立ち上げると、<code>import mecab</code> と出来るようになっている。</p>
<p>今回はもう少し進んで、Python CGI として実行してみる。</p>
<h2 id="htaccess-を編集して-python-cgi-を有効にする"><a class="header-link" href="#htaccess-を編集して-python-cgi-を有効にする"><span class="header-link-mark"></span></a><code>.htaccess</code> を編集して Python CGI を有効にする</h2>
<p><code>.htaccess</code> ファイルを作り、<code>.py</code> 形式のファイルを CGI として処理するようにしておく。コレを書かないと、<code>.py</code> ファイルにアクセスしてもその内容がテキストファイルのようにそのままレスポンスされて終わってしまう。</p>
<pre class="language-bash"><code class="language-bash"><span class="token comment"># `public_html/` 直下に配置する</span>
$ <span class="token function">touch</span> .htaccess
</code></pre>
<ul>
  <li><code>public_html/.htaccess</code></li>
</ul>
<pre class="language-apacheconf"><code class="language-apacheconf"><span class="token comment"># 以下を記す</span>
<span class="token directive-inline property">AddHandler</span> cgi-script .py
</code></pre>
<h2 id="mecab-を使用する-python-cgi-を書いてみる"><a class="header-link" href="#mecab-を使用する-python-cgi-を書いてみる"><span class="header-link-mark"></span></a>MeCab を使用する Python CGI を書いてみる</h2>
<p>次のように Python CGI を書いてみよう。</p>
<ul>
  <li><code>public_html/example-mecab.py</code></li>
</ul>
<pre class="language-python"><code class="language-python"><span class="token comment">#!/usr/local/bin/python3</span>

<span class="token comment"># 日本語文字を表示するための設定</span>
<span class="token keyword">import</span> sys
<span class="token keyword">import</span> io
sys<span class="token punctuation">.</span>stdout <span class="token operator">=</span> io<span class="token punctuation">.</span>TextIOWrapper<span class="token punctuation">(</span>sys<span class="token punctuation">.</span>stdout<span class="token punctuation">.</span><span class="token builtin">buffer</span><span class="token punctuation">,</span> encoding <span class="token operator">=</span> <span class="token string">'utf-8'</span><span class="token punctuation">)</span>

<span class="token keyword">import</span> cgi
<span class="token keyword">import</span> MeCab
mecab <span class="token operator">=</span> MeCab<span class="token punctuation">.</span>Tagger<span class="token punctuation">(</span><span class="token string">'-d /usr/lib64/mecab/dic/ipadic/'</span><span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'Content-type: text/html; charset=UTF-8\n'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>mecab<span class="token punctuation">.</span>parse<span class="token punctuation">(</span><span class="token string">'MeCab を使った形態素解析のテストです'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<p>固定文言を <code>mecab.parse()</code> し、その結果を出力しているだけ。</p>
<pre class="language-bash"><code class="language-bash">$ <span class="token function">chmod</span> <span class="token number">755</span> example-mecab.py
</code></pre>
<p>と<em>実行権限を付与</em>したら、ブラウザでアクセスして動作確認してみよう。</p>
<p>もしも上手く動作していない場合は、<code>import cgi</code> の次の行あたりに以下を追加し、スタックトレースを表示できるようにして詳細を確認してみると良いだろう。構文エラーなどは検知できないが、実行時エラーは確認できる。</p>
<pre class="language-python"><code class="language-python"><span class="token comment"># CGI エラー時にデバッグ情報を表示する</span>
<span class="token keyword">import</span> cgitb
cgitb<span class="token punctuation">.</span>enable<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<p>ココまでの内容で参考にした文献は以下のとおり。特に<em>「日本語文字を表示するための設定」</em>というのがないと、日本語文字列を <code>print</code> した瞬間に以降の行が動かなくなってしまって困っていた。</p>
<ul>
  <li>参考：<a href="https://qiita.com/eleven-junichi2/items/f3fcb6abe7fe21a4d89a">PythonのCGIで日本語が文字化けしたときの対処法 - Qiita</a> … 日本語文字を表示するための設定</li>
  <li>参考：<a href="https://techacademy.jp/magazine/21488">PythonでCGIスクリプトを書く方法【初心者向け】 | TechAcademyマガジン</a> … CGI エラー時にデバッグ情報を表示する</li>
  <li>参考：<a href="https://qiita.com/sirogane/items/d095d0f59c3ac498442aa">https://qiita.com/sirogane/items/d095d0f59c3ac498442aa</a> … Python MeCab を使用する</li>
  <li>参考：<a href="https://karupoimou.hatenablog.com/entry/2019/05/21/184126">pythonファイルをCGIとしてレンタルサーバー上でphp経由でCorn実行することで「500 Internal Server Error」を回避する方法 - なろう分析記録</a> … Content-Type 指定</li>
</ul>
<h2 id="今回はココまで"><a class="header-link" href="#今回はココまで"><span class="header-link-mark"></span></a>今回はココまで</h2>
<p>というワケで、XREA にプリインストールされている MeCab を使ってみた。ついでに XREA 上で Python を CGI として実行できることまで確認した。</p>
<p>スクリプトを調整していけば、リクエストパラメータを <code>mecab-python3</code> 経由でパースさせることもできるので、様々な使い道が考えられそうだ。</p>

      </main>
      <footer id="footer">
        <div id="date-time">
          <dl>
            <dt>Created</dt>
            <dd><time>2020-05-29</time></dd>
            <dt>Last-Modified</dt>
            <dd><time>2020-05-29</time></dd>
          </dl>
        </div>
        <nav id="footer-links">
          <ul>
            <li id="footer-link-about"><a href="/about/index.html" title="About">About</a></li>
            <li id="footer-link-search"><a href="/about/search.html" title="Search">Search</a></li>
            <li id="footer-link-feeds"><a href="/feeds.xml" title="Feeds">Feeds</a></li>
            <li id="footer-link-github"><a href="https://github.com/Neos21/" title="GitHub">GitHub</a></li>
          </ul>
        </nav>
        <nav id="to-top"><a href="#" title="To Top"><span>▲ To Top</span></a></nav>
      </footer>
    </div>
  </body>
</html>
