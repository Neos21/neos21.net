<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="theme-color" content="#0990d0">
    <!-- Google Search Console -->
    <meta name="google-site-verification" content="AvoEr3mUJFF2H_mPWWgShfmjBVP3ywRpyx9hxeeq2d4">
    <!-- Open Graph・Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="Neo's World">
    <meta property="og:title" content="ThinkPad X250 の CPU ファンがうるさいので回転数を制御してみる (Windows・Ubuntu 両方) - Neo's World">
    <meta property="og:description" content="ThinkPad X250 の CPU ファンがうるさいので回転数を制御してみる (Windows・Ubuntu 両方) - Neo's World">
    <meta property="og:url" content="https://neos21.net/blog/2020/05/10-02.html">
    <meta property="og:image" content="https://neos21.net/ogp.png">
    <meta property="og:locale" content="ja_JP">
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:title" content="ThinkPad X250 の CPU ファンがうるさいので回転数を制御してみる (Windows・Ubuntu 両方) - Neo's World">
    <meta property="twitter:description" content="ThinkPad X250 の CPU ファンがうるさいので回転数を制御してみる (Windows・Ubuntu 両方) - Neo's World">
    <meta property="twitter:url" content="https://neos21.net/blog/2020/05/10-02.html">
    <meta property="twitter:image" content="https://neos21.net/ogp.png">
    <title>ThinkPad X250 の CPU ファンがうるさいので回転数を制御してみる (Windows・Ubuntu 両方) - Neo's World</title>
    <link rel="icon" href="/favicon.ico">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    <link rel="manifest" href="/manifest.webmanifest">
    <link rel="stylesheet" href="/styles.css">
    <link rel="canonical" href="https://neos21.net/blog/2020/05/10-02.html">
    <link rel="search" type="application/opensearchdescription+xml" title="neos21.net" href="/opensearch.xml">
    <link rel="alternate" type="application/atom+xml" title="Feeds" href="/feeds.xml">
    <link rel="author" href="http://www.hatena.ne.jp/neos21/">
    <script src="/scripts.js"></script>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-MZCGD23');</script>
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6475907504235292" crossorigin="anonymous"></script>
  </head>
  <body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MZCGD23" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <div id="container">
      <header id="header">
        <div id="header-brand">
          <div id="header-brand-contents">
            <div id="site-title"><a href="/index.html">Neo's World</a></div>
            <nav id="header-links">
              <ul>
                <li id="header-link-theme"><a href="#" title="Toggle Theme"><span>Toggle Theme</span></a></li>
                <li id="header-link-about"><a href="/about/index.html" title="About"><span>About</span></a></li>
                <li id="header-link-search"><a href="/about/search.html" title="Search"><span>Search</span></a></li>
                <li id="header-link-feeds"><a href="/feeds.xml" title="Feeds"><span>Feeds</span></a></li>
                <li id="header-link-to-bottom"><a href="#footer" title="To Bottom"><span>▼ To Bottom</span></a></li>
              </ul>
            </nav>
          </div>
        </div>
        <nav id="global-nav">
          <ul>
            <li><a href="/blog/index.html">Blog</a></li>
            <li><a href="/tech/index.html">Tech</a></li>
            <li><a href="/music/index.html">Music</a></li>
            <li><a href="/games/index.html">Games</a></li>
            <li><a href="/gallery/index.html">Gallery</a></li>
            <li><a href="/etc/index.html">Etc.</a></li>
          </ul>
        </nav>
        <nav id="path">
          <ul>
            <li><a href="/index.html">Neo's World</a></li>
            <li><a href="/blog/index.html">Blog</a></li>
            <li><a href="/blog/2020/index.html">2020年</a></li>
            <li><a href="/blog/2020/05/index.html">05月</a></li>
          </ul>
        </nav>
      </header>
      <main id="main">
        <div id="header-date"><time>2020-05-10</time></div>
        <h1 id="page-title">ThinkPad X250 の CPU ファンがうるさいので回転数を制御してみる (Windows・Ubuntu 両方)</h1>

<p>M.2 SSD に Windows 10 Pro、SATA SSD に Ubuntu 18.04 がインストールされている、物理的に分断されたデュアルブート環境の ThinkPad X250 君。</p>
<p>この個体の前に買った1台目の X250 は CPU が Core i5 だったためか、さほど CPU ファンの音は気にならなかったのだが、この2台目 X250 は Core i7 なためか、CPU ファンがやたらと回る。</p>
<p>ファンの音が結構うるさいので、回転数を制御して静音化できないか調べてみた。</p>
<h2 id="目次"><a class="header-link" href="#目次"><span class="header-link-mark"></span></a>目次</h2>
<ul>
  <li><a href="#windows-%E3%81%A7%E3%81%AE%E5%AF%BE%E5%BF%9C%E6%B3%95--tpfancontrol-%E3%82%92%E4%BD%BF%E3%81%86">Windows での対応法 : TPFanControl を使う</a></li>
  <li><a href="#ubuntu-%E3%81%A7%E3%81%AE%E5%AF%BE%E5%BF%9C%E6%B3%95--thinkpad_acpi-%E3%81%A8-thinkfan-%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%82%92%E4%BD%BF%E3%81%86">Ubuntu での対応法 : <code>thinkpad_acpi</code> と <code>thinkfan</code> コマンドを使う</a></li>
  <li><a href="#%E4%BB%A5%E4%B8%8A">以上</a></li>
</ul>
<h2 id="windows-での対応法--tpfancontrol-を使う"><a class="header-link" href="#windows-での対応法--tpfancontrol-を使う"><span class="header-link-mark"></span></a>Windows での対応法 : TPFanControl を使う</h2>
<p>Windows で ThinkPad の CPU ファンを制御するには、<strong>TPFanControl</strong> というフリーソフトが使いやすい。</p>
<p>どうも既に開発が終了しているっぽいが、v0.62 (<code>tpfc_v062.zip</code>) をインストールしたらちゃんと動いた。</p>
<ul>
  <li><a href="https://thinkwiki.de/TPFanControl">TPFanControl – ThinkPad-Wiki</a></li>
</ul>
<p>↑上のページから最新版をダウンロードし、インストールすれば使える。</p>
<p>最初イマイチ使い方が分からなかったのだが、標準で選択されている Smart モードは、<code>.ini</code> ファイルで閾値を詳細に設定できる。内容は以下の日本語訳が参考になるかと。</p>
<ul>
  <li><a href="http://www.gulf.or.jp/~too/machine/tpfuncontroller2_ini.html">http://www.gulf.or.jp/~too/machine/tpfuncontroller2_ini.html</a></li>
</ul>
<p>Manual モードは、0 〜 7 の8段階でファンの回転数を制御できる。ただし、既に CPU 温度が閾値以上に高い状態だと、自動的に Smart モードに切り替わってファンが回り出す。</p>
<p>コレを使って CPU 温度を見てみると、ちょっとブラウジングしているだけで90度超え、いくつかタブを開いたりするとすぐに<strong>98度前後</strong>まで上昇していたので、CPU ファンを回転させないようにするのはちょっと怖いかな、と思った。何でこんな冷却性能悪いんだ…？</p>
<ul>
  <li>参考 : <a href="https://popupmlv.hatenablog.com/entry/2018/11/14/123000">TPFanControl （TPFC）でThinkPadのファンを静音にする話 - popup mlv</a></li>
  <li>参考 : <a href="http://thinkpadlover.blog112.fc2.com/blog-entry-21.html">ThinkPadな日々 ファン調整ソフト / TPFanControl</a></li>
  <li>参考 : <a href="https://nasunoblog.blogspot.com/2012/03/thinkpad_21.html">ThinkPad ファンを手動制御できるソフトウェアを導入してみた - 元「なんでもエンジニ屋」のダメ日記</a></li>
  <li>参考 : <a href="https://sourceforge.net/projects/tp4xfancontrol/">Thinkpad Fan Controller (tpfancontrol) download | SourceForge.net</a></li>
</ul>
<h2 id="ubuntu-での対応法--thinkpad_acpi-と-thinkfan-コマンドを使う"><a class="header-link" href="#ubuntu-での対応法--thinkpad_acpi-と-thinkfan-コマンドを使う"><span class="header-link-mark"></span></a>Ubuntu での対応法 : <code>thinkpad_acpi</code> と <code>thinkfan</code> コマンドを使う</h2>
<p>ThinkPad に Linux をインストールすると、<em><code>thinkpad_acpi</code></em> というカーネルモジュールがインストールされていて、コイツで CPU ファンの回転数を制御できるようだ。</p>
<p>まずはコイツを有効にするため、以下のファイルを作成し、<code>fan_control=1</code> と書いて機能を有効化する。</p>
<pre class="language-bash"><code class="language-bash">$ <span class="token function">sudo</span> <span class="token function">vi</span> /etc/modprobe.d/thinkpad_acpi.conf

<span class="token comment"># 次の1行を書く</span>
options thinkpad_acpi <span class="token assign-left variable">fan_control</span><span class="token operator">=</span><span class="token number">1</span>
</code></pre>
<p>設定後、次の擬似ファイルを見ると CPU の様子が分かる。</p>
<pre class="language-bash"><code class="language-bash">$ <span class="token function">cat</span> /proc/acpi/ibm/fan
</code></pre>
<p>この擬似ファイルに対して <code>level</code> を書き込むと、ファンの回転数を指定したレベルに設定できる。</p>
<pre class="language-bash"><code class="language-bash"><span class="token comment"># 0 (ファン停止) 〜 7 (高速) の8段階</span>
$ <span class="token builtin class-name">echo</span> level <span class="token number">0</span> <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> /proc/acpi/ibm/fan
$ <span class="token builtin class-name">echo</span> level <span class="token number">7</span> <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> /proc/acpi/ibm/fan

<span class="token comment"># 自動</span>
$ <span class="token builtin class-name">echo</span> level auto <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> /proc/acpi/ibm/fan
</code></pre>
<p>コレで手動操作できるようになった。続いて、CPU 温度に合わせてファンの回転数を自動操作するために、<strong><code>thinkfan</code></strong> というデーモンをインストールする。</p>
<pre class="language-bash"><code class="language-bash">$ <span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> -y lm-sensors thinkfan

<span class="token comment"># センサー類をファイルに記録する</span>
<span class="token comment"># 以下のコマンドを実行後、質問にひたすら Enter で答えていく</span>
$ <span class="token function">sudo</span> sensors-detect
<span class="token comment"># …中略…</span>
<span class="token comment"># 最後に以下の質問が出たら「yes」と入力して終える</span>
Do you want to <span class="token function">add</span> these lines automatically to /etc/modules? <span class="token punctuation">(</span>yes/NO<span class="token punctuation">)</span>yes
Successful<span class="token operator">!</span>
<span class="token comment"># 後略…</span>

<span class="token comment"># 以下を見て、`coretemp` の文字が記録されていれば良い</span>
$ <span class="token function">cat</span> /etc/modules

<span class="token comment"># 次のコマンドで CPU 温度などが分かる</span>
$ sensors
coretemp-isa-0000
Adapter: ISA adapter
Package <span class="token function">id</span> <span class="token number">0</span>:  +49.0°C  <span class="token punctuation">(</span>high <span class="token operator">=</span> +105.0°C, crit <span class="token operator">=</span> +105.0°C<span class="token punctuation">)</span>
Core <span class="token number">0</span>:        +48.0°C  <span class="token punctuation">(</span>high <span class="token operator">=</span> +105.0°C, crit <span class="token operator">=</span> +105.0°C<span class="token punctuation">)</span>
Core <span class="token number">1</span>:        +47.0°C  <span class="token punctuation">(</span>high <span class="token operator">=</span> +105.0°C, crit <span class="token operator">=</span> +105.0°C<span class="token punctuation">)</span>

<span class="token comment"># 以下でデバイス認識を確認できる</span>
$ <span class="token function">sudo</span> <span class="token function">find</span> /sys/devices -type f -name <span class="token string">'temp*_input'</span> <span class="token operator">|</span> <span class="token function">sort</span>
/sys/devices/platform/coretemp.0/hwmon/hwmon4/temp1_input
/sys/devices/platform/coretemp.0/hwmon/hwmon4/temp2_input
/sys/devices/platform/coretemp.0/hwmon/hwmon4/temp3_input
/sys/devices/platform/thinkpad_hwmon/hwmon/hwmon6/temp1_input
/sys/devices/platform/thinkpad_hwmon/hwmon/hwmon6/temp2_input
/sys/devices/platform/thinkpad_hwmon/hwmon/hwmon6/temp3_input
/sys/devices/platform/thinkpad_hwmon/hwmon/hwmon6/temp4_input
/sys/devices/platform/thinkpad_hwmon/hwmon/hwmon6/temp5_input
/sys/devices/platform/thinkpad_hwmon/hwmon/hwmon6/temp6_input
/sys/devices/platform/thinkpad_hwmon/hwmon/hwmon6/temp7_input
/sys/devices/platform/thinkpad_hwmon/hwmon/hwmon6/temp8_input
/sys/devices/virtual/thermal/thermal_zone0/hwmon1/temp1_input
/sys/devices/virtual/thermal/thermal_zone1/hwmon5/temp1_input
/sys/devices/virtual/thermal/thermal_zone2/hwmon7/temp1_input

<span class="token comment"># thinkfan の閾値は以下で設定できる</span>
$ <span class="token function">sudo</span> <span class="token function">vi</span> /etc/thinkfan.conf

<span class="token comment"># 手動で起動する場合</span>
$ <span class="token function">sudo</span> thinkfan -n

<span class="token comment"># サービスとして起動しておく</span>
$ <span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> thinkfan
$ <span class="token function">sudo</span> systemctl start thinkfan

<span class="token comment"># ステータス確認。こんな感じ</span>
$ <span class="token function">sudo</span> systemctl status thinkfan
● thinkfan.service - simple and lightweight fan control program
   Loaded: loaded <span class="token punctuation">(</span>/lib/systemd/system/thinkfan.service<span class="token punctuation">;</span> enabled<span class="token punctuation">;</span> vendor preset: enabled<span class="token punctuation">)</span>
   Active: active <span class="token punctuation">(</span>running<span class="token punctuation">)</span> since Tue <span class="token number">2020</span>-03-31 00:12:27 JST<span class="token punctuation">;</span> 1min 0s ago
  Process: <span class="token number">6451</span> <span class="token assign-left variable">ExecStart</span><span class="token operator">=</span>/usr/sbin/thinkfan <span class="token variable">$DAEMON_ARGS</span> <span class="token punctuation">(</span>code<span class="token operator">=</span>exited, <span class="token assign-left variable">status</span><span class="token operator">=</span><span class="token number">0</span>/SUCCESS<span class="token punctuation">)</span>
 Main PID: <span class="token number">6452</span> <span class="token punctuation">(</span>thinkfan<span class="token punctuation">)</span>
    Tasks: <span class="token number">1</span> <span class="token punctuation">(</span>limit: <span class="token number">4915</span><span class="token punctuation">)</span>
   CGroup: /system.slice/thinkfan.service
           └─6452 /usr/sbin/thinkfan -q
 <span class="token number">3</span>月 <span class="token number">31</span> 00:12:27 Neos-ThinkPad systemd<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: Starting simple and lightweight fan control program<span class="token punctuation">..</span>.
 <span class="token number">3</span>月 <span class="token number">31</span> 00:12:27 Neos-ThinkPad thinkfan<span class="token punctuation">[</span><span class="token number">6451</span><span class="token punctuation">]</span>: thinkfan <span class="token number">0.9</span>.1 starting<span class="token punctuation">..</span>.
 <span class="token number">3</span>月 <span class="token number">31</span> 00:12:27 Neos-ThinkPad thinkfan<span class="token punctuation">[</span><span class="token number">6451</span><span class="token punctuation">]</span>: WARNING: Using default fan control <span class="token keyword">in</span> /proc/acpi/ibm/fan.
 <span class="token number">3</span>月 <span class="token number">31</span> 00:12:27 Neos-ThinkPad thinkfan<span class="token punctuation">[</span><span class="token number">6451</span><span class="token punctuation">]</span>: WARNING: Using default temperature inputs <span class="token keyword">in</span> /proc/acpi/ibm/thermal.
 <span class="token number">3</span>月 <span class="token number">31</span> 00:12:27 Neos-ThinkPad thinkfan<span class="token punctuation">[</span><span class="token number">6451</span><span class="token punctuation">]</span>: WARNING: You're using simple temperature limits without correction values, and your fan will only start at <span class="token number">55</span> °C. This can be dangerous <span class="token keyword">for</span> your hard drive.
 <span class="token number">3</span>月 <span class="token number">31</span> 00:12:27 Neos-ThinkPad systemd<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>: Started simple and lightweight fan control program.
</code></pre>
<p>コレで設定自体はおけおけ。</p>
<p>Ubuntu で見ると、CPU 温度が50度程度で済んでいるように見える。CPU ファンの回転も、Windows よりは大人しい。温度計測が間違っているのか、ホントに温度が違ってるのか…？よく分からない。ただ、動作は Windows よりも Ubuntu の方が快適なので、Ubuntu 使用時の CPU ファンの動作には問題はないと思っている。</p>
<ul>
  <li>参考 : <a href="https://booleestreet.net/archives/11263">ThinkPad X1 Ubuntu GnomeでCPUファンをコントロール | BOOLEE STREET.net</a></li>
  <li>参考 : <a href="https://khiker.hatenablog.jp/entry/20130329/thinkfan">thinkfan - とりあえず暇だったし何となくはじめたブログ</a></li>
  <li>参考 : <a href="http://architect-wat.hatenablog.jp/entry/20120102/1327752731">Ubuntu 11.10 on ThinkPad X220 でファン制御 - アーキテクチャをスマートに。</a></li>
</ul>
<h2 id="以上"><a class="header-link" href="#以上"><span class="header-link-mark"></span></a>以上</h2>
<p>以上の方法で、Windows でも Linux でも、CPU ファンの回転数が制御できて、静音化できるようにはなった。</p>
<p>Ubuntu の時は温度が低く見えるが、Windows 10 Pro だと普段から CPU 温度が90度近くなっているみたいなので、物理的な問題よね。どうしたものか…。</p>
<ul>
  <li>参考 : <a href="https://support.lenovo.com/jp/ja/solutions/ht077046">ファンの回転速度が速すぎる - Windows - ThinkPad, ThinkCentre, ideapad, ideacentre - Lenovo Support JP</a></li>
</ul>

      </main>
      <footer id="footer">
        <div id="footer-contents">
          <div id="date-time">
            <dl>
              <dt>Created</dt>
              <dd><time>2020-05-10</time></dd>
              <dt>Last-Modified</dt>
              <dd><time>2020-05-10</time></dd>
            </dl>
          </div>
          <nav id="footer-links">
            <ul>
              <li id="footer-link-about"><a href="/about/index.html" title="About">About</a></li>
              <li id="footer-link-search"><a href="/about/search.html" title="Search">Search</a></li>
              <li id="footer-link-feeds"><a href="/feeds.xml" title="Feeds">Feeds</a></li>
              <li id="footer-link-github"><a href="https://github.com/Neos21/" title="GitHub">GitHub</a></li>
            </ul>
          </nav>
          <nav id="to-top"><a href="#" title="To Top"><span>▲ To Top</span></a></nav>
        </div>
      </footer>
    </div>
  </body>
</html>
