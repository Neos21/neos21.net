<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="theme-color" content="#0990d0">
    <!-- Google Search Console -->
    <meta name="google-site-verification" content="AvoEr3mUJFF2H_mPWWgShfmjBVP3ywRpyx9hxeeq2d4">
    <title>Create React App + TypeScript + SCSS 環境を構築してみる - Neo's World</title>
    <link rel="icon" href="/favicon.ico">
    <link rel="stylesheet" href="/styles.css">
    <link rel="canonical" href="https://neos21.net/blog/2020/05/22-03.html">
    <link rel="search" type="application/opensearchdescription+xml" title="neos21.net" href="/opensearch.xml">
    <link rel="alternate" type="application/atom+xml" href="/feeds.xml">
    <link rel="author" href="http://www.hatena.ne.jp/neos21/">
    <!-- Global Site Tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YMHFLZP1M1"></script>
    <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date());gtag('config','G-YMHFLZP1M1');gtag('config','UA-106501-1');</script>
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6475907504235292" crossorigin="anonymous"></script>
  </head>
  <body>
    <div id="container">
      <header id="header">
        <div id="header-brand">
          <div id="header-brand-contents">
            <div id="site-title"><a href="/index.html">Neo's World</a></div>
            <nav id="header-links">
              <ul>
                <li id="header-link-about"><a href="/about/index.html" title="About"><span>About</span></a></li>
                <li id="header-link-search"><a href="/about/search.html" title="Search"><span>Search</span></a></li>
                <li id="header-link-feeds"><a href="/feeds.xml" title="Feeds"><span>Feeds</span></a></li>
                <li id="header-link-to-bottom"><a href="#footer" title="To Bottom"><span>▼ To Bottom</span></a></li>
              </ul>
            </nav>
          </div>
        </div>
        <nav id="global-nav">
          <ul>
            <li><a href="/blog/index.html">Blog</a></li>
            <li><a href="/tech/index.html">Tech</a></li>
            <li><a href="/music/index.html">Music</a></li>
            <li><a href="/games/index.html">Games</a></li>
            <li><a href="/gallery/index.html">Gallery</a></li>
            <li><a href="/etc/index.html">Etc.</a></li>
          </ul>
        </nav>
        <nav id="path">
          <ul>
            <li><a href="/index.html">Neo's World</a></li>
            <li><a href="/blog/index.html">Blog</a></li>
            <li><a href="/blog/2020/index.html">2020年</a></li>
            <li><a href="/blog/2020/05/index.html">05月</a></li>
          </ul>
        </nav>
      </header>
      <main id="main">
        <div id="header-date"><time>2020-05-22</time></div>
        <h1 id="page-title">Create React App + TypeScript + SCSS 環境を構築してみる</h1>

<p>2016年に create-react-app 単体で試したことがあった。</p>
<ul>
  <li><a href="/blog/2016/12/16-01.html">React.js を手軽に触りたくて create-react-app を試してみた</a></li>
</ul>
<p>あれから3年半が経過。React がもてはやされていた中で「Angular はちょっと重たいよねー」「とはいえ React も難解になってきたよねー」とか言っていると Vue.js の手軽さで SPA 全体が完全に主流になったと思う。Next.js や Nuxt.js、Angular CLI などの発展で、統一感のある CLI に沿った開発環境というのも安定してきたと思う。</p>
<p>そして何より、TypeScript を使った開発というのが、もはや「モダン」でもなんでもない「スタンダード」にすらなったかなと思う。</p>
<p>以前の記事では TypeScript などを試さなかったので、今回は最新の Create React App をベースに、TypeScript + SCSS を使った環境を作ってみる。そこで遭遇したトラブルも記録するのでご参考までに。</p>
<h2 id="目次"><a class="header-link" href="#目次"><span class="header-link-mark"></span></a>目次</h2>
<ul>
  <li><a href="#create-react-app-%E3%81%A7%E3%83%97%E3%83%AD%E3%82%B8%E3%82%A7%E3%82%AF%E3%83%88%E3%81%AE%E9%9B%9B%E5%BD%A2%E3%82%92%E4%BD%9C%E3%82%8B">Create React App でプロジェクトの雛形を作る</a></li>
  <li><a href="#scss-%E3%82%92%E6%9B%B8%E3%81%91%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%99%E3%82%8B">SCSS を書けるようにする</a></li>
  <li><a href="#linux-%E7%92%B0%E5%A2%83%E3%81%A7-npm-start-%E5%AE%9F%E8%A1%8C%E6%99%82%E3%81%ABsystem-limit-for-number-of-file-watchers-reached%E3%82%A8%E3%83%A9%E3%83%BC%E3%81%8C%E5%87%BA%E3%81%9F">Linux 環境で <code>npm start</code> 実行時に「System limit for number of file watchers reached」エラーが出た</a></li>
  <li><a href="#packagejson-%E3%81%AB-homepage-%E3%83%97%E3%83%AD%E3%83%91%E3%83%86%E3%82%A3%E3%82%92%E6%8C%87%E5%AE%9A%E3%81%99%E3%82%8B%E3%81%A8-npm-start-%E3%81%8C%E6%AD%A3%E5%B8%B8%E3%81%AB%E5%8B%95%E4%BD%9C%E3%81%97%E3%81%AA%E3%81%8F%E3%81%AA%E3%82%8B"><code>package.json</code> に <code>homepage</code> プロパティを指定すると <code>npm start</code> が正常に動作しなくなる</a></li>
  <li><a href="#%E3%83%93%E3%83%AB%E3%83%89%E3%81%97%E3%81%9F%E3%83%A2%E3%83%8E%E3%82%92%E5%8B%95%E3%81%8B%E3%81%99">ビルドしたモノを動かす</a></li>
  <li><a href="#npm-start-%E6%99%82%E3%81%A8-npm-run-build-%E6%99%82%E3%81%A8%E3%81%A7-homepage-%E3%82%92%E5%A4%89%E3%81%88%E3%81%9F%E3%81%84"><code>npm start</code> 時と <code>npm run build</code> 時とで <code>homepage</code> を変えたい</a></li>
  <li><a href="#service-worker-%E3%82%92%E4%BD%BF%E3%82%8F%E3%81%AA%E3%81%84%E5%A0%B4%E5%90%88%E3%81%AF%E5%AE%8C%E5%85%A8%E5%89%8A%E9%99%A4%E3%81%97%E3%81%A6%E8%89%AF%E3%81%84">Service Worker を使わない場合は完全削除して良い</a></li>
  <li><a href="#component-%E3%82%AF%E3%83%A9%E3%82%B9%E3%81%AE%E9%96%A2%E6%95%B0%E3%81%AF%E3%82%A2%E3%83%AD%E3%83%BC%E9%96%A2%E6%95%B0%E3%81%A7%E6%9B%B8%E3%81%8F%E3%81%A8%E3%82%88%E3%81%95%E3%81%92">Component クラスの関数はアロー関数で書くとよさげ</a></li>
  <li><a href="#%E6%9D%A1%E4%BB%B6%E4%BB%98%E3%81%8D%E3%83%AC%E3%83%B3%E3%83%80">条件付きレンダ</a></li>
  <li><a href="#kuromoji-%E3%82%92%E4%BD%BF%E3%81%86">kuromoji を使う</a></li>
  <li><a href="#ts-node-%E3%81%AE%E3%82%B3%E3%83%B3%E3%83%91%E3%82%A4%E3%83%A9%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3%E3%82%92%E4%B8%8A%E6%9B%B8%E3%81%8D%E3%81%99%E3%82%8B">ts-node のコンパイラオプションを上書きする</a></li>
  <li><a href="#%E4%BB%A5%E4%B8%8A">以上</a></li>
</ul>
<h2 id="create-react-app-でプロジェクトの雛形を作る"><a class="header-link" href="#create-react-app-でプロジェクトの雛形を作る"><span class="header-link-mark"></span></a>Create React App でプロジェクトの雛形を作る</h2>
<p>npm の <code>npx</code> コマンドを使えば、<code>create-react-app</code> のグローバルインストールは不要。もちろん、事前に <code>$ npm i -g create-react-app</code> としても問題はない。</p>
<pre class="language-bash"><code class="language-bash"><span class="token comment"># 以下のコマンドで雛形を作成する</span>
$ npx create-react-app example-my-app --use-npm --typescript
</code></pre>
<p>Yarn が別に好きではないので、個人的な趣味で npm を使う <code>--use-npm</code> オプションを設定。</p>
<p>TypeScript ベースのプロジェクトにするため <code>--typescript</code> オプションを付けたが、ワーニングで「今後は <em><code>--template typescript</code></em> オプションを使え」と出ていた。今後は</p>
<pre class="language-bash"><code class="language-bash">$ npx create-react-app example-my-app --use-npm --template typescript
</code></pre>
<p>が雛形作成コマンドになるな。</p>
<pre class="language-bash"><code class="language-bash">$ <span class="token builtin class-name">cd</span> ./example-my-app/
$ <span class="token function">npm</span> start
</code></pre>
<p>プロジェクトを作成したら、上のようにすることで <code>http://localhost:3000/</code> に簡易サーバが起動する。</p>
<ul>
  <li>参考：<a href="https://ja.reactjs.org/docs/create-a-new-react-app.html">新しい React アプリを作る – React</a> … 公式</li>
  <li>参考：<a href="https://s8a.jp/create-react-app-use-npm">Create React AppでパッケージマネージャーにYarnではなくnpmを使用する方法 | 綺麗に死ぬITエンジニア</a> … 標準の Yarn の代わりに npm を使う</li>
</ul>
<h2 id="scss-を書けるようにする"><a class="header-link" href="#scss-を書けるようにする"><span class="header-link-mark"></span></a>SCSS を書けるようにする</h2>
<p>上述のように TypeScript ベースのプロジェクトを作っても、CSS 周りは標準的な CSS しかサポートされていない。</p>
<p>SCSS を書けるようにするには、<strong><code>node-sass</code> をインストールしておくだけ</strong>で良い。とてもお手軽！</p>
<pre class="language-bash"><code class="language-bash">$ <span class="token function">npm</span> <span class="token function">install</span> --save node-sass
</code></pre>
<p>で <code>node-sass</code> をインストールするだけ。</p>
<p>あとは <code>index.css</code> や <code>App.css</code> の拡張子を <code>.scss</code> にリネームし、<code>import</code> 部分も <code>.css</code> から <code>.scss</code> に直せば、自動的に SCSS のコンパイルを行って動作してくれるようになる。</p>
<h2 id="linux-環境で-npm-start-実行時にsystem-limit-for-number-of-file-watchers-reachedエラーが出た"><a class="header-link" href="#linux-環境で-npm-start-実行時にsystem-limit-for-number-of-file-watchers-reachedエラーが出た"><span class="header-link-mark"></span></a>Linux 環境で <code>npm start</code> 実行時に「System limit for number of file watchers reached」エラーが出た</h2>
<p>Ubuntu 18.04 環境で React プロジェクトを立ち上げたところ、<code>npm start</code> 時に</p>
<pre><code>Error: ENOSPC: System limit for number of file watchers reached,
</code></pre>
<p>このようなエラーメッセージが出た。</p>
<p>以下のとおり対応すれば良い。</p>
<pre class="language-bash"><code class="language-bash"><span class="token comment"># inotify が小さいと思われる</span>
$ <span class="token function">cat</span> /proc/sys/fs/inotify/max_user_watches
<span class="token number">8192</span>

<span class="token comment"># 上限値を増やす</span>
$ <span class="token builtin class-name">echo</span> fs.inotify.max_user_watches<span class="token operator">=</span><span class="token number">524288</span> <span class="token operator">|</span> <span class="token function">sudo</span> <span class="token function">tee</span> -a /etc/sysctl.conf
$ <span class="token function">sudo</span> sysctl -p
</code></pre>
<p>コレで <code>npm start</code> してもエラーが出なくなる。</p>
<ul>
  <li>参考：<a href="https://www.virment.com/how-to-fix-system-limit-for-number-of-file-watchers-reached/">LinuxでSystem limit for number of file watchers reachedが出る原因と対策</a></li>
</ul>
<h2 id="packagejson-に-homepage-プロパティを指定すると-npm-start-が正常に動作しなくなる"><a class="header-link" href="#packagejson-に-homepage-プロパティを指定すると-npm-start-が正常に動作しなくなる"><span class="header-link-mark"></span></a><code>package.json</code> に <code>homepage</code> プロパティを指定すると <code>npm start</code> が正常に動作しなくなる</h2>
<p><code>npm init</code> で <code>package.json</code> を生成すると、<code>homepage</code> プロパティが記録される。コレに合わせて、Create React App が作った <code>package.json</code> にも <code>homepage</code> プロパティを書いた。すると <code>npm start</code> 時に URL の階層構造が狂ってしまった。</p>
<p>どうやら <em>React は <code>package.json</code> の <code>homepage</code> プロパティを見てパス解決を調整している</em>ようなので、通常の npm パッケージの感覚でこのプロパティを書かないようにしないといけない。最終的にアプリが動作する URL、例えば GitHub Pages の URL などを書いておくのが適切だろう。</p>
<h2 id="ビルドしたモノを動かす"><a class="header-link" href="#ビルドしたモノを動かす"><span class="header-link-mark"></span></a>ビルドしたモノを動かす</h2>
<p><code>npm start</code> による簡易サーバ・ホットリロードではなく、一度ちゃんとビルドして、それを動作させてみる場合。<code>serve</code> というパッケージを使うのが公式で紹介されていた。</p>
<pre class="language-bash"><code class="language-bash">$ <span class="token function">npm</span> run build

$ npx serve -s ./build/
<span class="token comment"># http://localhost:5000/</span>
</code></pre>
<h2 id="npm-start-時と-npm-run-build-時とで-homepage-を変えたい"><a class="header-link" href="#npm-start-時と-npm-run-build-時とで-homepage-を変えたい"><span class="header-link-mark"></span></a><code>npm start</code> 時と <code>npm run build</code> 時とで <code>homepage</code> を変えたい</h2>
<p>前述のとおり、<code>package.json</code> の <code>homepage</code> プロパティは、<code>npm run build</code> でビルドした資材を公開する場所に合わせておくことが望ましい。</p>
<p>しかしそれだと、<code>npm start</code> で開発したい時にこの URL が適用されてしまい、パス解決に不具合が出る場合がある。</p>
<p>その場合は、次のように <code>PUBLIC_URL</code> 環境変数を指定して <code>npm start</code> を実行すれば良い。</p>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"start"</span><span class="token operator">:</span> <span class="token string">"PUBLIC_URL='.' react-scripts start"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="service-worker-を使わない場合は完全削除して良い"><a class="header-link" href="#service-worker-を使わない場合は完全削除して良い"><span class="header-link-mark"></span></a>Service Worker を使わない場合は完全削除して良い</h2>
<p>標準だと、<code>index.tsx</code> より <code>serviceWorker.tsx</code> がインポートされているが、いきなり有効化されないように、<code>unregister()</code> としかしていない。</p>
<pre class="language-typescript"><code class="language-typescript"><span class="token comment">// src/index.tsx 抜粋</span>

<span class="token keyword">import</span> <span class="token imports"><span class="token operator">*</span> <span class="token keyword">as</span> serviceWorker</span> <span class="token keyword">from</span> <span class="token string">'./serviceWorker'</span><span class="token punctuation">;</span>  
serviceWorker<span class="token punctuation">.</span><span class="token method function property-access">unregister</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>Service Worker を使わないことが確定している場合は、これらの記述をすべて削除し、<code>serviceWorker.tsx</code> ごと削除しても問題なかった。</p>
<ul>
  <li>参考：<a href="https://qiita.com/pepo/items/9b25068a3123b99bcf18">create-react-appで作った雛形のコードがService Workerで何をしているのか - Qiita</a></li>
</ul>
<h2 id="component-クラスの関数はアロー関数で書くとよさげ"><a class="header-link" href="#component-クラスの関数はアロー関数で書くとよさげ"><span class="header-link-mark"></span></a>Component クラスの関数はアロー関数で書くとよさげ</h2>
<p>イマイチ分かっていないのだが、Component クラスに独自に定義する関数について。</p>
<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">App</span></span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token maybe-class-name">React</span></span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">Component</span></span> <span class="token punctuation">{</span>
  <span class="token comment">// State の型を宣言しておく</span>
  state<span class="token operator">:</span> <span class="token maybe-class-name">Readonly</span><span class="token operator">&#x3C;</span><span class="token builtin">any</span><span class="token operator">></span><span class="token punctuation">;</span>
  
  <span class="token comment">// 画面から呼び出す予定の関数を定義</span>
  <span class="token function">onSubmit</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> hoge<span class="token operator">:</span> <span class="token string">'FUGA'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ← コレができない</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>上のように、関数を <code>onSubmit() {}</code> という風に定義し、<code>this.setState()</code> を呼び出して値を変更しようとすると、なぜか <code>undefined</code> となってしまう。</p>
<p><code>this</code> が解決できていないんだろうなーとは思ったが、何でコレがダメなんだっけ？というのが分かっていない。</p>
<p>とりあず回避するには、</p>
<ul>
  <li><strong><code>onSubmit() {}</code></strong> のようにクラスのメソッドとして書くのではなく、</li>
  <li><em><code>onSubmit = () => {}</code></em> のように<strong>アロー関数</strong>で書いてやると</li>
</ul>
<p>エラーを回避できる。</p>
<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">App</span></span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token maybe-class-name">React</span></span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">Component</span></span> <span class="token punctuation">{</span>
  <span class="token comment">// State の型を宣言しておく</span>
  state<span class="token operator">:</span> <span class="token maybe-class-name">Readonly</span><span class="token operator">&#x3C;</span><span class="token builtin">any</span><span class="token operator">></span><span class="token punctuation">;</span>
  
  <span class="token comment">// 画面から呼び出す予定の関数を定義</span>
  <span class="token function-variable function">onSubmit</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token method function property-access">setState</span><span class="token punctuation">(</span><span class="token punctuation">{</span> hoge<span class="token operator">:</span> <span class="token string">'FUGA'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ← コレなら OK</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
  <li>参考：<a href="https://qiita.com/kilo/items/714287a3ea41b4187545">React.js で setState が undefined - Qiita</a></li>
</ul>
<h2 id="条件付きレンダ"><a class="header-link" href="#条件付きレンダ"><span class="header-link-mark"></span></a>条件付きレンダ</h2>
<p>Component の <code>render()</code> メソッドは、最終的に JSX を <code>return</code> すれば良いので、<code>return</code> キーワードを書くまでに <code>if</code> 文を組み合わせてみたりしても良い。状態に応じて大きく HTML 構造が変わる場合は、<code>if</code> 文で処理して複数の <code>return</code> を書いたりした方がスッキリするかもしれない。</p>
<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token keyword">class</span> <span class="token class-name"><span class="token maybe-class-name">App</span></span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token maybe-class-name">React</span></span><span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">Component</span></span> <span class="token punctuation">{</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// ローディング中の HTML</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token property-access">state</span><span class="token punctuation">.</span><span class="token property-access">isLoading</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">(</span>
        <span class="token operator">&#x3C;</span>div<span class="token operator">></span><span class="token maybe-class-name">Loading</span><span class="token spread operator">...</span><span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// ロード完了後の HTML…</span>
    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token operator">&#x3C;</span>div<span class="token operator">></span>…<span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>一方、JSX の中で条件分岐を行いたい場合は、<em>「条件付きレンダ」</em>で書けば良い。</p>
<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">return</span> <span class="token punctuation">(</span>
  <span class="token operator">&#x3C;</span>div<span class="token operator">></span>
    <span class="token punctuation">{</span> messages<span class="token punctuation">.</span><span class="token property-access">length</span> <span class="token operator">===</span> <span class="token number">0</span> <span class="token operator">&#x26;&#x26;</span>
      <span class="token operator">&#x3C;</span>p<span class="token operator">></span>表示できるメッセージはありません<span class="token operator">&#x3C;</span><span class="token operator">/</span>p<span class="token operator">></span>
    <span class="token punctuation">}</span>
  <span class="token operator">&#x3C;</span><span class="token operator">/</span>div<span class="token operator">></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>ブレース <code>{}</code> 内は JavaScript の構文を直接書けるので、JavaScript のイディオムである <code>&#x26;&#x26;</code> や <code>||</code> の他、三項演算子を組み合わせたりもできる。覚えておこう。</p>
<ul>
  <li>参考：<a href="https://ja.reactjs.org/docs/conditional-rendering.html">条件付きレンダー – React</a></li>
</ul>
<h2 id="kuromoji-を使う"><a class="header-link" href="#kuromoji-を使う"><span class="header-link-mark"></span></a>kuromoji を使う</h2>
<p><strong>nemui-gacha-js</strong> を作った時のメモ。<code>kuromoji</code> という形態素解析ツールを React 内で使うためにやったこと。</p>
<ul>
  <li><a href="https://github.com/Neos21/nemui-gacha-js">GitHub - Neos21/nemui-gacha-js: ねむいガチャ.js</a></li>
  <li><a href="https://neos21.github.io/nemui-gacha-js/">Nemui Gacha JS</a></li>
</ul>
<p>まずはインストール。<code>@types</code> での型定義もあるので一緒にインストールしておくと良い。</p>
<pre class="language-bash"><code class="language-bash">$ <span class="token function">npm</span> <span class="token function">install</span> -S kuromoji
$ <span class="token function">npm</span> <span class="token function">install</span> -D @types/kuromoji
</code></pre>
<ul>
  <li>参考：<a href="https://suzaku-tec.hatenadiary.jp/entry/2018/03/16/143748">kuromoji.jsを使ってみる - エンターテイメント！！</a></li>
</ul>
<p>同梱の <code>dict/</code> ディレクトリを、<code>./public/dict/</code> でアクセスできるように移動しておく。</p>
<pre class="language-bash"><code class="language-bash">$ <span class="token function">cp</span> -a ./node_modules/kuromoji/dict/ ./public/
</code></pre>
<p>そうすれば、次のように書くことで kuromoji が使えるようになる。</p>
<pre class="language-typescript"><code class="language-typescript"><span class="token keyword">import</span> <span class="token imports"><span class="token operator">*</span> <span class="token keyword">as</span> kuromoji</span> <span class="token keyword">from</span> <span class="token string">'kuromoji'</span><span class="token punctuation">;</span>

kuromoji<span class="token punctuation">.</span><span class="token method function property-access">builder</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  dicPath<span class="token operator">:</span> <span class="token string">'./dict'</span>  <span class="token comment">// 予め kuromoji の dict/ ディレクトリを public/ 配下にコピーしておく</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">build</span><span class="token punctuation">(</span><span class="token punctuation">(</span>error<span class="token operator">:</span> <span class="token known-class-name class-name">Error</span><span class="token punctuation">,</span> tokenizer<span class="token operator">:</span> kuromoji<span class="token punctuation">.</span><span class="token property-access"><span class="token maybe-class-name">Tokenizer</span></span><span class="token operator">&#x3C;</span><span class="token builtin">any</span><span class="token operator">></span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// tokenizer を使って処理…</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<ul>
  <li>参考：<a href="https://qiita.com/torao@github/items/45ad9640cf94d3169cae">Kuromoji を使ってブラウザ上で形態素解析を行う (Reactあり/なし) - Qiita</a></li>
  <li>参考：<a href="https://takumon.com/wordcloud-with-kuromoji-d3cloud-react">https://takumon.com/wordcloud-with-kuromoji-d3cloud-react</a></li>
</ul>
<h2 id="ts-node-のコンパイラオプションを上書きする"><a class="header-link" href="#ts-node-のコンパイラオプションを上書きする"><span class="header-link-mark"></span></a>ts-node のコンパイラオプションを上書きする</h2>
<p>React ベースのプロジェクト内で、ちょっとだけ <code>ts-node</code> を使って CLI 向けスクリプトを動かしたい場面があった。そんな時、React 向けの <code>tsconfig.json</code> だと <code>ts-node</code> が動作しなかった。</p>
<p>調べてみると、次のように環境変数 <code>TS_NODE_COMPILER_OPTIONS</code> で <code>tsconfig.json</code> の設定を上書きしてやれば動作した。</p>
<pre class="language-bash"><code class="language-bash">$ <span class="token assign-left variable">TS_NODE_COMPILER_OPTIONS</span><span class="token operator">=</span><span class="token string">'{"module":"commonjs"}'</span> ts-node HOGE.ts
</code></pre>
<p><code>package.json</code> に定義するならこんな感じ。</p>
<pre class="language-json"><code class="language-json"><span class="token punctuation">{</span>
  <span class="token property">"scripts"</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">"exec-cli"</span><span class="token operator">:</span> <span class="token string">"TS_NODE_COMPILER_OPTIONS='{\"module\":\"commonjs\"}' ts-node HOGE.ts"</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
  <li>参考：<a href="https://stackoverflow.com/questions/40635956/overriding-tsconfig-json-for-ts-node-in-mocha">node.js - Overriding `tsconfig.json` for ts-node in mocha - Stack Overflow</a></li>
</ul>
<h2 id="以上"><a class="header-link" href="#以上"><span class="header-link-mark"></span></a>以上</h2>
<p>こんな感じ～。TypeScript と SCSS が使えるようにできたので、Angular CLI や Vue CLI と同じく、React も Create-React-App で良い感じですね～。</p>

      </main>
      <footer id="footer">
        <div id="footer-contents">
          <div id="date-time">
            <dl>
              <dt>Created</dt>
              <dd><time>2020-05-22</time></dd>
              <dt>Last-Modified</dt>
              <dd><time>2020-05-22</time></dd>
            </dl>
          </div>
          <nav id="footer-links">
            <ul>
              <li id="footer-link-about"><a href="/about/index.html" title="About">About</a></li>
              <li id="footer-link-search"><a href="/about/search.html" title="Search">Search</a></li>
              <li id="footer-link-feeds"><a href="/feeds.xml" title="Feeds">Feeds</a></li>
              <li id="footer-link-github"><a href="https://github.com/Neos21/" title="GitHub">GitHub</a></li>
            </ul>
          </nav>
          <nav id="to-top"><a href="#" title="To Top"><span>▲ To Top</span></a></nav>
        </div>
      </footer>
    </div>
  </body>
</html>
