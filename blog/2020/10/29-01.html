<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="theme-color" content="#0990d0">
    <!-- Google Search Console -->
    <meta name="google-site-verification" content="AvoEr3mUJFF2H_mPWWgShfmjBVP3ywRpyx9hxeeq2d4">
    <title>XREA サーバで最新の Node.js を使う - Neo's World</title>
    <link rel="icon" href="/favicon.ico">
    <link rel="stylesheet" href="/styles.css">
    <link rel="canonical" href="https://neos21.net/blog/2020/10/29-01.html">
    <link rel="search" type="application/opensearchdescription+xml" title="neos21.net" href="/opensearch.xml">
    <link rel="alternate" type="application/atom+xml" href="/feeds.xml">
    <link rel="author" href="http://www.hatena.ne.jp/neos21/">
    <!-- Global Site Tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YMHFLZP1M1"></script>
    <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date());gtag('config','G-YMHFLZP1M1');gtag('config','UA-106501-1');</script>
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6475907504235292" crossorigin="anonymous"></script>
  </head>
  <body>
    <div id="container">
      <header id="header">
        <div id="header-brand">
          <div id="header-brand-contents">
            <div id="site-title"><a href="/index.html">Neo's World</a></div>
            <nav id="header-links">
              <ul>
                <li id="header-link-about"><a href="/about/index.html" title="About"><span>About</span></a></li>
                <li id="header-link-search"><a href="/about/search.html" title="Search"><span>Search</span></a></li>
                <li id="header-link-feeds"><a href="/feeds.xml" title="Feeds"><span>Feeds</span></a></li>
                <li id="header-link-to-bottom"><a href="#footer" title="To Bottom"><span>▼ To Bottom</span></a></li>
              </ul>
            </nav>
          </div>
        </div>
        <nav id="global-nav">
          <ul>
            <li><a href="/blog/index.html">Blog</a></li>
            <li><a href="/tech/index.html">Tech</a></li>
            <li><a href="/music/index.html">Music</a></li>
            <li><a href="/games/index.html">Games</a></li>
            <li><a href="/gallery/index.html">Gallery</a></li>
            <li><a href="/etc/index.html">Etc.</a></li>
          </ul>
        </nav>
        <nav id="path">
          <ul>
            <li><a href="/index.html">Neo's World</a></li>
            <li><a href="/blog/index.html">Blog</a></li>
            <li><a href="/blog/2020/index.html">2020年</a></li>
            <li><a href="/blog/2020/10/index.html">10月</a></li>
          </ul>
        </nav>
      </header>
      <main id="main">
        <div id="header-date"><time>2020-10-29</time></div>
        <h1 id="page-title">XREA サーバで最新の Node.js を使う</h1>

<p>以前紹介したとおり、ちょっと頑張れば SSH 接続ができる XREA。</p>
<ul>
  <li><a href="/blog/2019/08/12-02.html">XREA のサーバに SSH 接続する</a></li>
</ul>
<p>XREA サーバにはデフォルトで Node.js と npm が入っているのだが、少々バージョンが古い。</p>
<pre class="language-bash"><code class="language-bash">$ /usr/bin/node -v
v6.17.1

$ /usr/bin/npm -v
<span class="token number">3.10</span>.10
</code></pre>
<p>そこで、最新の Node.js を導入してみる。</p>
<h2 id="目次"><a class="header-link" href="#目次"><span class="header-link-mark"></span></a>目次</h2>
<ul>
  <li><a href="#ssh-%E6%8E%A5%E7%B6%9A%E3%81%97%E5%88%B6%E9%99%90%E3%81%AA%E3%81%97%E3%81%AE-bash-%E3%82%92%E4%BD%BF%E3%81%88%E3%82%8B%E3%82%88%E3%81%86%E3%81%AB%E3%81%99%E3%82%8B">SSH 接続し、制限なしの Bash を使えるようにする</a></li>
  <li><a href="#%E6%9C%80%E6%96%B0%E3%81%AE-nodejs-%E3%82%92%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89%E3%81%99%E3%82%8B">最新の Node.js をダウンロードする</a></li>
  <li><a href="#%E8%A7%A3%E5%87%8D%E3%81%97%E9%85%8D%E7%BD%AE%E3%81%99%E3%82%8B">解凍し配置する</a></li>
  <li><a href="#path-%E3%82%92%E9%80%9A%E3%81%99">PATH を通す</a></li>
  <li><a href="#%E6%9C%80%E6%96%B0%E7%89%88%E3%81%AE-nodejs-%E3%82%92-cgi-%E3%81%A8%E3%81%97%E3%81%A6%E4%BD%BF%E3%81%88%E3%82%8B%E3%81%8B%E7%A2%BA%E8%AA%8D%E3%81%99%E3%82%8B">最新版の Node.js を CGI として使えるか確認する</a></li>
</ul>
<h2 id="ssh-接続し制限なしの-bash-を使えるようにする"><a class="header-link" href="#ssh-接続し制限なしの-bash-を使えるようにする"><span class="header-link-mark"></span></a>SSH 接続し、制限なしの Bash を使えるようにする</h2>
<p>以前紹介した記事に沿って SSH 接続する。デフォルトでは rbash という制限付きのシェルで、<code>cd</code> などができないので、制限がない Bash に切り替える。</p>
<pre class="language-bash"><code class="language-bash">$ chsh -s /bin/bash
<span class="token comment"># パスワードを入力する</span>
<span class="token comment"># 変更後、再ログインすれば反映される様子</span>

<span class="token comment"># うまくいかなかったら以下のいずれかで Bash を開けば行けた</span>
$ <span class="token function">bash</span>
$ /bin/bash

<span class="token comment"># /usr/bin/bash だと rbash になってしまうようなので確認しておく</span>
$ <span class="token builtin class-name">echo</span> <span class="token string">"<span class="token variable">${<span class="token environment constant">BASH</span>}</span>"</span>
/bin/bash
</code></pre>
<h2 id="最新の-nodejs-をダウンロードする"><a class="header-link" href="#最新の-nodejs-をダウンロードする"><span class="header-link-mark"></span></a>最新の Node.js をダウンロードする</h2>
<p>Node.js の公式ページから、「Linux Binaries (x64)」のリンク URL を取得する。LTS でも良いし、Current でも良い。自分は v14.13.1 (Current) を選択した。</p>
<ul>
  <li><a href="https://nodejs.org/en/download/">Download | Node.js</a></li>
</ul>
<p>そしたらダウンロードする。</p>
<pre class="language-bash"><code class="language-bash">$ <span class="token function">curl</span> -sSL -O https://nodejs.org/dist/v14.13.1/node-v14.13.1-linux-x64.tar.xz

$ <span class="token function">ls</span> -lh
-rw-r--r--  <span class="token number">1</span> neo hpusers 21M <span class="token number">2020</span>-10-14 <span class="token number">10</span>:41 node-v14.13.1-linux-x64.tar.xz
</code></pre>
<h2 id="解凍し配置する"><a class="header-link" href="#解凍し配置する"><span class="header-link-mark"></span></a>解凍し配置する</h2>
<p>ファイルをダウンロードしたら、解凍して適当なところに配置する。今回は <code>~/.local/lib/</code> 配下に配置することにした。</p>
<pre class="language-bash"><code class="language-bash"><span class="token comment"># 拡張子のとおり XZ 形式</span>
$ <span class="token function">file</span> ./node-v14.13.1-linux-x64.tar.xz 
node-v14.13.1-linux-x64.tar.xz: XZ compressed data

<span class="token comment"># まずはその場 (ホームディレクトリ) に解凍してみる</span>
$ <span class="token function">tar</span> xvf ./node-v14.13.1-linux-x64.tar.xz

<span class="token comment"># ディレクトリを用意し、移動する</span>
$ <span class="token function">mkdir</span> -p ~/.local/lib
$ <span class="token function">mv</span> ./node-v14.13.1-linux-x64/ ~/.local/lib/

<span class="token comment"># 配置できたか確認する</span>
$ <span class="token function">ls</span> -lh ~/.local/lib/
drwxr-xr-x <span class="token number">6</span> neo hpusers <span class="token number">9</span> <span class="token number">2020</span>-10-08 02:58 node-v14.13.1-linux-x64/

$ <span class="token function">ls</span> -lh ~/.local/lib/node-v14.13.1-linux-x64/
-rw-r--r-- <span class="token number">1</span> neo hpusers 52K <span class="token number">2020</span>-10-08 02:58 CHANGELOG.md
-rw-r--r-- <span class="token number">1</span> neo hpusers 79K <span class="token number">2020</span>-10-08 02:58 LICENSE
-rw-r--r-- <span class="token number">1</span> neo hpusers 28K <span class="token number">2020</span>-10-08 02:58 README.md
drwxr-xr-x <span class="token number">2</span> neo hpusers   <span class="token number">5</span> <span class="token number">2020</span>-10-08 02:58 bin/
drwxr-xr-x <span class="token number">3</span> neo hpusers   <span class="token number">3</span> <span class="token number">2020</span>-10-08 02:58 include/
drwxr-xr-x <span class="token number">3</span> neo hpusers   <span class="token number">3</span> <span class="token number">2020</span>-10-08 02:58 lib/
drwxr-xr-x <span class="token number">5</span> neo hpusers   <span class="token number">5</span> <span class="token number">2020</span>-10-08 02:58 share/
</code></pre>
<h2 id="path-を通す"><a class="header-link" href="#path-を通す"><span class="header-link-mark"></span></a>PATH を通す</h2>
<p>以上で配置ができたので、PATH を通す。<code>~/.bash_profile</code> あたりで以下のように書き、反映する。rbash だと環境変数 PATH は読み取り専用だと怒られるので注意。</p>
<pre class="language-bash"><code class="language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token string">"<span class="token variable">${<span class="token environment constant">HOME</span>}</span>/.local/lib/node-v14.13.1-linux-x64/bin:<span class="token variable">${<span class="token environment constant">PATH</span>}</span>"</span>
</code></pre>
<pre class="language-bash"><code class="language-bash"><span class="token comment"># 反映する</span>
$ <span class="token builtin class-name">source</span> ~/.bash_profile

<span class="token comment"># 最新版になっている</span>
$ node -v
v14.13.1

$ <span class="token function">npm</span> -v
<span class="token number">6.14</span>.8
</code></pre>
<h2 id="最新版の-nodejs-を-cgi-として使えるか確認する"><a class="header-link" href="#最新版の-nodejs-を-cgi-として使えるか確認する"><span class="header-link-mark"></span></a>最新版の Node.js を CGI として使えるか確認する</h2>
<p>今回は <code>~/.local/lib/</code> 配下に雑に配置したのだが、フルパスで指定すれば Node.js を CGI として使用できる。</p>
<pre class="language-bash"><code class="language-bash"><span class="token comment"># フルパスを確認しておく。${HOME} は /virtual/【ユーザ名】/ となる</span>
$ <span class="token builtin class-name">type</span> node
node はハッシュされています <span class="token punctuation">(</span>/virtual/neo/.local/lib/node-v14.13.1-linux-x64/bin/node<span class="token punctuation">)</span>

<span class="token comment"># Node.js v12 以降で使える async・await を使った簡単な CGI を書いてみる</span>
$ <span class="token function">cat</span> <span class="token operator">&#x3C;&#x3C;</span><span class="token string">EOL<span class="token bash punctuation"> <span class="token operator">></span> ~/public_html/test.cgi </span>
#!/virtual/neo/.local/lib/node-v14.13.1-linux-x64/bin/node

process.stdout.write('Content-Type: text/html<span class="token entity" title="\n">\n</span><span class="token entity" title="\n">\n</span>');
(async () => {
  await new Promise(r => setTimeout(r, 2000));
  console.log(process.version);
})();
EOL</span>

<span class="token comment"># 実行権限を付与する</span>
$ <span class="token function">chmod</span> <span class="token number">777</span> ~/public_html/test.cgi

<span class="token comment"># ブラウザや curl でアクセスしてみる。2秒ほど待たされた後に、インストールした Node.js のバージョンが表示されたら OK</span>
$ <span class="token function">curl</span> http://neo.s21.xrea.com/test.cgi
v14.13.1
</code></pre>
<ul>
  <li>参考：<a href="https://otti.xyz/2020/07/install-nodejs-on-xrea.html">XreaにNode.jsをインストール | No title</a></li>
  <li>参考：<a href="https://twitter.com/hakosiratama/status/914167879150342144">𝘴𝘴𝘮 on Twitter: "xreaの無料プランでnode.js導入できました fast-cgi-bin内にnodeのディレクトリを手動で放り込んで、下記の"対話環境でhello worldしてみる"で確認しました https://t.co/mqIlfzUl2O …#xrea #Node… https://t.co/56VQzAE8Kl"</a></li>
  <li>参考：<a href="https://asiamoth.com/200801242353/">Xrea.com で「制限無し」 BASH を使う（と問題あり？） | 亜細亜ノ蛾</a></li>
  <li>参考：<a href="https://www.imuza.com/entry/xrea-ssh">XREA に SSH 接続する - IMUZA.com</a></li>
</ul>
<p>ついでに。</p>
<p>XREA の無料サーバ (s21) の内容はこんな感じだった。</p>
<pre class="language-bash"><code class="language-bash">$ <span class="token function">cat</span> /etc/os-release
<span class="token assign-left variable">NAME</span><span class="token operator">=</span><span class="token string">"CentOS Linux"</span>
<span class="token assign-left variable">VERSION</span><span class="token operator">=</span><span class="token string">"7 (Core)"</span>
<span class="token assign-left variable">ID</span><span class="token operator">=</span><span class="token string">"centos"</span>
<span class="token assign-left variable">ID_LIKE</span><span class="token operator">=</span><span class="token string">"rhel fedora"</span>
<span class="token assign-left variable">VERSION_ID</span><span class="token operator">=</span><span class="token string">"7"</span>
<span class="token assign-left variable">PRETTY_NAME</span><span class="token operator">=</span><span class="token string">"CentOS Linux 7 (Core)"</span>
<span class="token assign-left variable">ANSI_COLOR</span><span class="token operator">=</span><span class="token string">"0;31"</span>
<span class="token assign-left variable">CPE_NAME</span><span class="token operator">=</span><span class="token string">"cpe:/o:centos:centos:7"</span>
<span class="token assign-left variable">HOME_URL</span><span class="token operator">=</span><span class="token string">"https://www.centos.org/"</span>
<span class="token assign-left variable">BUG_REPORT_URL</span><span class="token operator">=</span><span class="token string">"https://bugs.centos.org/"</span>

<span class="token assign-left variable">CENTOS_MANTISBT_PROJECT</span><span class="token operator">=</span><span class="token string">"CentOS-7"</span>
<span class="token assign-left variable">CENTOS_MANTISBT_PROJECT_VERSION</span><span class="token operator">=</span><span class="token string">"7"</span>
<span class="token assign-left variable">REDHAT_SUPPORT_PRODUCT</span><span class="token operator">=</span><span class="token string">"centos"</span>
<span class="token assign-left variable">REDHAT_SUPPORT_PRODUCT_VERSION</span><span class="token operator">=</span><span class="token string">"7"</span>

$ lscpu
アーキテクチャ: x86_64
CPU op-mode<span class="token punctuation">(</span>s<span class="token punctuation">)</span>:        <span class="token number">32</span>-bit, <span class="token number">64</span>-bit
Byte Order:            Little Endian
CPU<span class="token punctuation">(</span>s<span class="token punctuation">)</span>:                <span class="token number">48</span>
On-line CPU<span class="token punctuation">(</span>s<span class="token punctuation">)</span> list:   <span class="token number">0</span>-47
コアあたりのスレッド数:2
ソケットあたりのコア数:12
Socket<span class="token punctuation">(</span>s<span class="token punctuation">)</span>:             <span class="token number">2</span>
NUMAノード:         <span class="token number">2</span>
ベンダーID:        GenuineIntel
CPUファミリー:    <span class="token number">6</span>
モデル:             <span class="token number">79</span>
Model name:            Intel<span class="token punctuation">(</span>R<span class="token punctuation">)</span> Xeon<span class="token punctuation">(</span>R<span class="token punctuation">)</span> CPU E5-2650 v4 @ <span class="token number">2</span>.20GHz
ステッピング:    <span class="token number">1</span>
CPU MHz:               <span class="token number">2500.007</span>
CPU max MHz:           <span class="token number">2900.0000</span>
CPU min MHz:           <span class="token number">1200.0000</span>
BogoMIPS:              <span class="token number">4400.42</span>
仮想化:             VT-x
L1d キャッシュ:   32K
L1i キャッシュ:   32K
L2 キャッシュ:    256K
L3 キャッシュ:    30720K
NUMAノード <span class="token number">0</span> CPU:   <span class="token number">0,2</span>,4,6,8,10,12,14,16,18,20,22,24,26,28,30,32,34,36,38,40,42,44,46
NUMAノード <span class="token number">1</span> CPU:   <span class="token number">1,3</span>,5,7,9,11,13,15,17,19,21,23,25,27,29,31,33,35,37,39,41,43,45,47
Flags:                 fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe syscall nx pdpe1gb rdtscp lm constant_tsc arch_perfmon pebs bts rep_good nopl xtopology nonstop_tsc aperfmperf pni pclmulqdq dtes64 monitor ds_cpl vmx smx est tm2 ssse3 sdbg fma cx16 xtpr pdcm pcid dca sse4_1 sse4_2 x2apic movbe popcnt tsc_deadline_timer aes xsave avx f16c rdrand lahf_lm abm 3dnowprefetch epb invpcid_single intel_pt ssbd ibrs ibpb stibp kaiser tpr_shadow vnmi flexpriority ept vpid fsgsbase tsc_adjust bmi1 hle avx2 smep bmi2 erms invpcid rtm cqm rdseed adx smap xsaveopt cqm_llc cqm_occup_llc cqm_mbm_total cqm_mbm_local dtherm ida arat pln pts md_clear flush_l1d

$ lsmem
RANGE                                  SIZE  STATE REMOVABLE BLOCK
0x0000000000000000-0x000000007fffffff    2G online        no     <span class="token number">0</span>
0x0000000100000000-0x000000207fffffff  126G online        no  <span class="token number">2</span>-64

Memory block size:         2G
Total online memory:     128G
Total offline memory:      0B

$ <span class="token function">free</span> -h
              total        used        <span class="token function">free</span>      shared  buff/cache   available
Mem:           125G        <span class="token number">2</span>.5G        122G         30G        696M        122G
Swap:          127G        118G        <span class="token number">9</span>.1G

$ <span class="token function">df</span> -h
ファイルシス       サイズ  使用  残り 使用% マウント位置
lxd/containers/s21   <span class="token number">4</span>.7T   56G  <span class="token number">4</span>.7T    <span class="token number">2</span>% /
none                 492K  <span class="token number">4</span>.0K  488K    <span class="token number">1</span>% /dev
udev                  63G     <span class="token number">0</span>   63G    <span class="token number">0</span>% /dev/tty
tmpfs                100K     <span class="token number">0</span>  100K    <span class="token number">0</span>% /dev/lxd
tmpfs                100K     <span class="token number">0</span>  100K    <span class="token number">0</span>% /dev/.lxd-mounts
tmpfs                 63G  <span class="token number">4</span>.0K   63G    <span class="token number">1</span>% /dev/shm
tmpfs                 63G  <span class="token number">4</span>.4G   59G    <span class="token number">7</span>% /run
tmpfs                 63G     <span class="token number">0</span>   63G    <span class="token number">0</span>% /sys/fs/cgroup
/dev/shm             <span class="token number">4</span>.0G  140K  <span class="token number">4</span>.0G    <span class="token number">1</span>% /mnt/ram
/dev/shm              64M     <span class="token number">0</span>   64M    <span class="token number">0</span>% /mnt/ram2
tmpfs                 13G     <span class="token number">0</span>   13G    <span class="token number">0</span>% /run/user/1501
tmpfs                 13G     <span class="token number">0</span>   13G    <span class="token number">0</span>% /run/user/0
tmpfs                 13G     <span class="token number">0</span>   13G    <span class="token number">0</span>% /run/user/10002
</code></pre>

      </main>
      <footer id="footer">
        <div id="footer-contents">
          <div id="date-time">
            <dl>
              <dt>Created</dt>
              <dd><time>2020-10-29</time></dd>
              <dt>Last-Modified</dt>
              <dd><time>2020-10-29</time></dd>
            </dl>
          </div>
          <nav id="footer-links">
            <ul>
              <li id="footer-link-about"><a href="/about/index.html" title="About">About</a></li>
              <li id="footer-link-search"><a href="/about/search.html" title="Search">Search</a></li>
              <li id="footer-link-feeds"><a href="/feeds.xml" title="Feeds">Feeds</a></li>
              <li id="footer-link-github"><a href="https://github.com/Neos21/" title="GitHub">GitHub</a></li>
            </ul>
          </nav>
          <nav id="to-top"><a href="#" title="To Top"><span>▲ To Top</span></a></nav>
        </div>
      </footer>
    </div>
  </body>
</html>
