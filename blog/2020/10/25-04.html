<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="theme-color" content="#0990d0">
    <!-- Google Search Console -->
    <meta name="google-site-verification" content="AvoEr3mUJFF2H_mPWWgShfmjBVP3ywRpyx9hxeeq2d4">
    <!-- Open Graph・Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="Neo's World">
    <meta property="og:title" content="Selenium Webdriver ではなく Puppeteer を使ってみる - Neo's World">
    <meta property="og:description" content="Selenium Webdriver ではなく Puppeteer を使ってみる - Neo's World">
    <meta property="og:url" content="https://neos21.net/blog/2020/10/25-04.html">
    <meta property="og:image" content="https://neos21.net/ogp.png">
    <meta property="og:locale" content="ja_JP">
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:title" content="Selenium Webdriver ではなく Puppeteer を使ってみる - Neo's World">
    <meta property="twitter:description" content="Selenium Webdriver ではなく Puppeteer を使ってみる - Neo's World">
    <meta property="twitter:url" content="https://neos21.net/blog/2020/10/25-04.html">
    <meta property="twitter:image" content="https://neos21.net/ogp.png">
    <title>Selenium Webdriver ではなく Puppeteer を使ってみる - Neo's World</title>
    <link rel="icon" href="/favicon.ico">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    <link rel="manifest" href="/manifest.webmanifest">
    <link rel="stylesheet" href="/styles.css">
    <link rel="canonical" href="https://neos21.net/blog/2020/10/25-04.html">
    <link rel="search" type="application/opensearchdescription+xml" title="neos21.net" href="/opensearch.xml">
    <link rel="alternate" type="application/atom+xml" title="Feeds" href="/feeds.xml">
    <link rel="author" href="http://www.hatena.ne.jp/neos21/">
    <script src="/scripts.js"></script>
    <!-- Global Site Tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YMHFLZP1M1"></script>
    <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date());gtag('config','G-YMHFLZP1M1');gtag('config','UA-106501-1');</script>
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6475907504235292" crossorigin="anonymous"></script>
  </head>
  <body>
    <div id="container">
      <header id="header">
        <div id="header-brand">
          <div id="header-brand-contents">
            <div id="site-title"><a href="/index.html">Neo's World</a></div>
            <nav id="header-links">
              <ul>
                <li id="header-link-theme"><a href="#" title="Toggle Theme"><span>Toggle Theme</span></a></li>
                <li id="header-link-about"><a href="/about/index.html" title="About"><span>About</span></a></li>
                <li id="header-link-search"><a href="/about/search.html" title="Search"><span>Search</span></a></li>
                <li id="header-link-feeds"><a href="/feeds.xml" title="Feeds"><span>Feeds</span></a></li>
                <li id="header-link-to-bottom"><a href="#footer" title="To Bottom"><span>▼ To Bottom</span></a></li>
              </ul>
            </nav>
          </div>
        </div>
        <nav id="global-nav">
          <ul>
            <li><a href="/blog/index.html">Blog</a></li>
            <li><a href="/tech/index.html">Tech</a></li>
            <li><a href="/music/index.html">Music</a></li>
            <li><a href="/games/index.html">Games</a></li>
            <li><a href="/gallery/index.html">Gallery</a></li>
            <li><a href="/etc/index.html">Etc.</a></li>
          </ul>
        </nav>
        <nav id="path">
          <ul>
            <li><a href="/index.html">Neo's World</a></li>
            <li><a href="/blog/index.html">Blog</a></li>
            <li><a href="/blog/2020/index.html">2020年</a></li>
            <li><a href="/blog/2020/10/index.html">10月</a></li>
          </ul>
        </nav>
      </header>
      <main id="main">
        <div id="header-date"><time>2020-10-25</time></div>
        <h1 id="page-title">Selenium Webdriver ではなく Puppeteer を使ってみる</h1>

<p>最近とんと聞かなくなった Selenium Webdriver。最近は <strong>Puppeteer</strong> というヤツが流行っているらしい。なんか綴りが難しいな。ｗ</p>
<h2 id="目次"><a class="header-link" href="#目次"><span class="header-link-mark"></span></a>目次</h2>
<ul>
  <li><a href="#puppeteer-%E3%81%AE%E6%A6%82%E8%A6%81">Puppeteer の概要</a></li>
  <li><a href="#%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%A8%E5%AE%9F%E8%A3%85">インストールと実装</a></li>
  <li><a href="#%E5%AE%9F%E8%A1%8C%E6%99%82%E3%81%AE%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3%E8%A7%A3%E8%AA%AC">実行時のオプション解説</a>
    <ul>
      <li><a href="#%E3%83%96%E3%83%A9%E3%82%A6%E3%82%B6%E3%81%AE%E5%AE%9F%E8%A1%8C%E3%83%91%E3%82%B9%E3%82%92%E6%8C%87%E5%AE%9A%E3%81%99%E3%82%8B">ブラウザの実行パスを指定する</a></li>
      <li><a href="#%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%97%E3%83%AD%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E6%8C%87%E5%AE%9A%E3%81%99%E3%82%8B">ユーザプロファイルを指定する</a></li>
      <li><a href="#%E6%93%8D%E4%BD%9C%E3%81%AE%E9%96%93%E9%9A%94">操作の間隔</a></li>
      <li><a href="#%E8%B5%B7%E5%8B%95%E5%BC%95%E6%95%B0">起動引数</a></li>
    </ul>
  </li>
  <li><a href="#%E7%94%BB%E9%9D%A2%E6%93%8D%E4%BD%9C">画面操作</a></li>
  <li><a href="#%E6%9C%AA%E8%A7%A3%E6%B1%BA--wsl-%E3%81%A7%E3%81%AE%E5%88%A9%E7%94%A8">未解決 : WSL での利用</a></li>
  <li><a href="#%E4%BB%A5%E4%B8%8A">以上</a></li>
  <li><a href="#%E5%8F%82%E8%80%83%E6%96%87%E7%8C%AE">参考文献</a></li>
</ul>
<h2 id="puppeteer-の概要"><a class="header-link" href="#puppeteer-の概要"><span class="header-link-mark"></span></a>Puppeteer の概要</h2>
<p>Puppeteer は、Selenium などと同じく、ブラウザの操作をプログラミングできるツール。主にヘッドレス Chrome を動かせて、最近 Firefox にも対応したとか。</p>
<ul>
  <li><a href="https://github.com/puppeteer/puppeteer">GitHub - puppeteer/puppeteer: Headless Chrome Node.js API</a></li>
</ul>
<p>Node.js 製で、npm からインストールできる。</p>
<p><code>puppeteer</code> と <code>puppeteer-core</code> という2つのパッケージがある。<code>puppeteer</code> の方は、Chromium ブラウザを一緒に落としてきて、内部に持つ作りになっている。一方の <code>puppeteer-core</code> は、ブラウザをダウンロードしない。<code>puppeteer-core</code> が Puppeteer 本体で、<code>puppeteer</code> は「Puppeteer 本体 + ブラウザ」というワケ。ブラウザを内部に持っていれば、実行するマシン環境に依存しにくいのだが、ブラウザが 2・300MB 近くあるので、頻繁にインストールするには少々重たい感じ。一長一短。</p>
<p>今回、自分はホストマシンにインストール済の Chrome ブラウザを流用したかったので、<code>puppeteer-core</code> をメインに使うことにした。</p>
<h2 id="インストールと実装"><a class="header-link" href="#インストールと実装"><span class="header-link-mark"></span></a>インストールと実装</h2>
<p>お試しリポジトリは以下に作った。</p>
<ul>
  <li><a href="https://github.com/Neos21/practice-puppeteer">Neos21/practice-puppeteer</a></li>
</ul>
<p>まずは <code>puppeteer-core</code> をインストールする。本稿執筆時点では v5.2.1 が最新だった。</p>
<pre class="language-bash"><code class="language-bash">$ <span class="token function">npm</span> i -S puppeteer-core
</code></pre>
<p>続いてコードを書いていく。最もシンプルなコードはこんな感じでいいかな。</p>
<ul>
  <li><code>index.js</code></li>
</ul>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> puppeteer <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'puppeteer-core'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> browser <span class="token operator">=</span> <span class="token keyword null nil">null</span><span class="token punctuation">;</span>
  
  <span class="token keyword control-flow">try</span> <span class="token punctuation">{</span>
    browser <span class="token operator">=</span> <span class="token keyword control-flow">await</span> puppeteer<span class="token punctuation">.</span><span class="token method function property-access">launch</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      headless<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>  <span class="token comment">// ヘッドレスにしない</span>
      executablePath<span class="token operator">:</span> <span class="token string">'/PATH/TO/chrome.exe'</span><span class="token punctuation">,</span>  <span class="token comment">// Chrome ブラウザのパス</span>
      <span class="token comment">// Chrome の仕様で、userDataDir もしくは --user-data-dir (どちらでも良い) で指定したディレクトリの直下の「Default」ディレクトリを探しに行ってしまう</span>
      <span class="token comment">// --profile-directory もうまく効かないので、利用したいユーザデータを「…/User Data/Default」ディレクトリで配置するようにしておく</span>
      userDataDir<span class="token operator">:</span> <span class="token string">'/PATH/TO/User Data'</span><span class="token punctuation">,</span>
      <span class="token comment">// page.type() の文字ごとにこの間隔 (ms) が開く</span>
      slowMo<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span>
      ignoreHTTPSErrors<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
      defaultViewport<span class="token operator">:</span> <span class="token punctuation">{</span>
        width<span class="token operator">:</span> <span class="token number">1280</span><span class="token punctuation">,</span>
        height<span class="token operator">:</span> <span class="token number">720</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      args<span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">'--no-sandbox'</span><span class="token punctuation">,</span>
        <span class="token string">'--disable-infobars'</span><span class="token punctuation">,</span>
        <span class="token string">'--disable-session-crashed-bubble'</span><span class="token punctuation">,</span>  <span class="token comment">// セッションを復元するダイアログを非表示にする…効かない</span>
        <span class="token comment">//'--kiosk',  // 最大化表示・メニューバーがなくなる。--disable-session-crashed-bubble と併用するとダイアログを消せる</span>
        <span class="token string">'--restore-last-session'</span><span class="token punctuation">,</span>  <span class="token comment">// --disable-session-crashed-bubble が効かないのでリストアさせることにする</span>
        <span class="token string">'--window-position=0,0'</span><span class="token punctuation">,</span>
        <span class="token string">'--window-size=1280,720'</span><span class="token punctuation">,</span>
        <span class="token comment">// 起動済のブラウザにアタッチする時 (puppeteer.connect() 時) に以下のようなオプションがあるが、うまくいかず</span>
        <span class="token comment">//'--remote-debugging-address=0.0.0.0',</span>
        <span class="token comment">//'--remote-debugging-port=9222',</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">const</span> page <span class="token operator">=</span> <span class="token keyword control-flow">await</span> browser<span class="token punctuation">.</span><span class="token method function property-access">newPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">await</span> page<span class="token punctuation">.</span><span class="token method function property-access">setViewport</span><span class="token punctuation">(</span><span class="token punctuation">{</span> width<span class="token operator">:</span> <span class="token number">1280</span><span class="token punctuation">,</span> height<span class="token operator">:</span> <span class="token number">720</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 任意のページに遷移する : 画面遷移と読み込みを待つ</span>
    <span class="token keyword control-flow">await</span> <span class="token known-class-name class-name">Promise</span><span class="token punctuation">.</span><span class="token method function property-access">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
      page<span class="token punctuation">.</span><span class="token method function property-access">goto</span><span class="token punctuation">(</span><span class="token string">'https://google.co.jp/'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      page<span class="token punctuation">.</span><span class="token method function property-access">waitForNavigation</span><span class="token punctuation">(</span><span class="token punctuation">{</span> waitUntil<span class="token operator">:</span> <span class="token string">'networkidle2'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token keyword">const</span> pageTitle <span class="token operator">=</span> <span class="token keyword control-flow">await</span> page<span class="token punctuation">.</span><span class="token method function property-access">title</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'遷移しました'</span><span class="token punctuation">,</span> pageTitle<span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// 適当に待って終了する</span>
    <span class="token keyword control-flow">await</span> page<span class="token punctuation">.</span><span class="token method function property-access">waitFor</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">catch</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">finally</span> <span class="token punctuation">{</span>
    <span class="token comment">// ブラウザを閉じる</span>
    <span class="token keyword control-flow">if</span><span class="token punctuation">(</span>browser<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">await</span> browser<span class="token punctuation">.</span><span class="token method function property-access">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>基本 Promise なので、async・await で同期的に書けるようにしておくと楽。<code>browser</code> や <code>page</code> は、グローバルな変数にしておくと、関数に切り出しやすいかもしれない。</p>
<p>細かいところは以下で説明していく。</p>
<h2 id="実行時のオプション解説"><a class="header-link" href="#実行時のオプション解説"><span class="header-link-mark"></span></a>実行時のオプション解説</h2>
<p><code>puppeteer.launch()</code> で色々とブラウザの設定をしているので、まずはそこの解説。</p>
<h3 id="ブラウザの実行パスを指定する"><a class="header-link" href="#ブラウザの実行パスを指定する"><span class="header-link-mark"></span></a>ブラウザの実行パスを指定する</h3>
<p><code>executablePath</code> オプションで、Chrome ブラウザの実行パスを指定している。Windows と MacOS の標準的なパスは以下のとおり。</p>
<ul>
  <li>Windows : <code>C:\Program Files (x86)\Google\Chrome\Application\chrome.exe</code>
    <ul>
      <li>JS で書く時はバックスラッシュをエスケープする : <code>C:\\Program Files (x86)\\Google\\Chrome\\Application\\chrome.exe</code></li>
      <li>GitBash など Cygwin 環境 : <code>/c/Program Files (x86)/Google/Chrome/Application/chrome.exe</code></li>
      <li>WSL から Windows 側のブラウザを指定する場合 : <code>/mnt/c/Program Files (x86)/Google/Chrome/Application/chrome.exe</code></li>
    </ul>
  </li>
  <li>MacOS : <code>/Applications/Google Chrome.app/Contents/MacOS/Google Chrome</code></li>
</ul>
<h3 id="ユーザプロファイルを指定する"><a class="header-link" href="#ユーザプロファイルを指定する"><span class="header-link-mark"></span></a>ユーザプロファイルを指定する</h3>
<p>今回は、普段使っている Chrome ブラウザのプロファイルを流用して、ウェブサービスへのログインを省略しようと思う。通常、Chrome の起動引数で指定する場合は <code>--user-data-dir</code> と <code>--profile-directory</code> で指定するが、Puppeteer のバグなのか、一癖あった。</p>
<p>まず、<code>--profile-directory</code> オプションが効かない。なので <code>--user-data-dir</code> で渡したパスの直下にある <code>Default/</code> ディレクトリが参照される前提で、構成を用意しないといけない。通常のユーザプロファイルは以下のようなパスにある。</p>
<ul>
  <li>Windows : <code>C:\Users\【ユーザ名】\AppData\Local\Google\Chrome\User Data</code>
    <ul>
      <li>エスケープ : <code>C:\\Users\\【ユーザ名】\\AppData\\Local\\Google\\Chrome\\User Data</code></li>
      <li>Cygwin 形式 : <code>/c/Users/【ユーザ名】/AppData/Local/Google/Chrome/User Data</code></li>
      <li>WSL から利用 : <code>/mnt/c/Users/【ユーザ名】/AppData/Local/Google/Chrome/User Data</code></li>
    </ul>
  </li>
  <li>MacOS : <code>~/Library/Application Support/Google/Chrome</code></li>
</ul>
<p>上のパスの直下に、<code>Default</code> ディレクトリが用意されている状態にしたい。場合によっては目的のプロファイルが <code>Profile 2</code> などというディレクトリ名で存在する場合もあるので、そういう時はディレクトリ名を <code>Default</code> にリネームしてしまう。</p>
<h3 id="操作の間隔"><a class="header-link" href="#操作の間隔"><span class="header-link-mark"></span></a>操作の間隔</h3>
<p><code>slowMo</code> オプションは、クリックや文字入力などの操作の間隔をミリ秒で指定するモノ。</p>
<p>文字入力時の遅延は <code>page.type()</code> メソッドのオプションで指定できるので、この <code>slowMo</code> オプションはその他の全般的な操作の間隔を早めにするか遅めにするか、の設定と思った方が良いだろう。</p>
<p>PC の処理性能やネットワーク通信速度、対象のウェブサイトの都合に合わせて、100ms とか 500ms とか、ゆっくりめに操作してあげた方が安定するかもしれない。</p>
<h3 id="起動引数"><a class="header-link" href="#起動引数"><span class="header-link-mark"></span></a>起動引数</h3>
<p><code>args</code> プロパティは Chrome が受け取れる引数を指定する場所。画面サイズやら何やらを指定できる。</p>
<p>Puppeteer で操作すると、セッションを復元するかどうか尋ねるダイアログがよく出てしまう。コレを消すにはいくつか方法がある。</p>
<ol>
  <li><code>--kiosk</code> と <code>--disable-session-crashed-bubble</code> オプションを併用する。代わりに全画面表示になる
    <ul>
      <li>全画面表示はちょっとキモいので避けたい</li>
      <li><code>--disable-session-crashed-bubble</code> オプション単体だと効果がない</li>
    </ul>
  </li>
  <li><code>--kiosk</code> と <code>--incognito</code> オプションを併用する。代わりに全画面表示・かつシークレットモードになる
    <ul>
      <li>今回は既存のクッキーを利用したいので却下</li>
    </ul>
  </li>
  <li><code>--restore-last-session</code> オプションを使う。代わりに最後に開いていたタブが復元されるので、タブ数が増える
    <ul>
      <li>タブ数が増えるのがキモいが、まだマシかな</li>
    </ul>
  </li>
</ol>
<p>ということで、今回は 3. の方法を採用している。</p>
<h2 id="画面操作"><a class="header-link" href="#画面操作"><span class="header-link-mark"></span></a>画面操作</h2>
<p><code>puppeteer.launch()</code> で <code>browser</code> を用意したら、<code>browser.newPage()</code> 新たなページを開いて、変数 <code>page</code> を使用していく。</p>
<p>任意の URL に遷移するには <code>page.goto()</code> を使用するが、ページの読み込みが完了するまで待つため、以下のイディオムを使う。</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword control-flow">await</span> <span class="token known-class-name class-name">Promise</span><span class="token punctuation">.</span><span class="token method function property-access">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
  page<span class="token punctuation">.</span><span class="token method function property-access">goto</span><span class="token punctuation">(</span><span class="token string">'https://google.co.jp/'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  page<span class="token punctuation">.</span><span class="token method function property-access">waitForNavigation</span><span class="token punctuation">(</span><span class="token punctuation">{</span> waitUntil<span class="token operator">:</span> <span class="token string">'networkidle2'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><code>waitForNavigation()</code> は <code>goto()</code> の完了後に呼んでも意味がないので、<code>Promise.all()</code> で両方の Resolve を待機する。</p>
<p>後は色々な API があるので詳細は割愛するが、Selenium と似たような感じで、CSS セレクタで要素を指定して要素を操作したり、内容を参照したりできる。</p>
<h2 id="未解決--wsl-での利用"><a class="header-link" href="#未解決--wsl-での利用"><span class="header-link-mark"></span></a>未解決 : WSL での利用</h2>
<p>WSL2 側で Node.js と Puppeteer を用意し、Windows 側の Chrome を操作したかったのだが、両者のネットワークを飛び越えられずに断念した。Windows → WSL2 の通信では <code>localhost</code> が上手く解決されるのだが、 WSL2 → Windows の通信は <code>localhost</code> ではダメなので、上手くいかないみたい。<code>/etc/resolv.conf</code> に記載されているのが Windows 側の <code>localhost</code> 相当なので、コレを利用して <code>puppeteer.connect()</code> で繋いでみようとかしたけど、コレも上手くいかず断念している。</p>
<p>結局 GitSDK を Windows 側に入れ、ポータブルな Node.js を Windows 側に用意して、WSL2 を使わずに運用している。コレなら Windows 側の Chrome をヘッドありで動かせるのだが、なんだかなぁ…。</p>
<p>ヘッドレスで良くて、Windows 側の Chrome ブラウザを使う気がなければ、WSL2 側に Chromium をインストールしてしまってヘッドレスで動かすのもアリだろう。WSL2 のみで完結させるということ。</p>
<p>今のところ、Windows と WSL をまたいだ Puppeteer 操作はできていない。</p>
<h2 id="以上"><a class="header-link" href="#以上"><span class="header-link-mark"></span></a>以上</h2>
<p>今回はココまで。</p>
<p>Chrome ブラウザを内蔵した <code>puppeteer</code> パッケージもあり、基本は Chrome ブラウザしか扱えないものの、その代わり環境構築が簡単で、Selenium のように Java や Selenium Hub や何やらを用意せずとも、Node.js だけで完結できる手軽さが魅力。</p>
<p>DOM 操作を行う API は覚え直しになるし、<code>textContent</code> の扱いなんかにちょっと面倒臭さはあるものの、Selenium よりは気楽な感じがある。</p>
<p>Windows と WSL をまたいだ操作は、WSL の都合でまだ上手くいっていないが、夢がある。今後に期待。</p>
<h2 id="参考文献"><a class="header-link" href="#参考文献"><span class="header-link-mark"></span></a>参考文献</h2>
<ul>
  <li><a href="https://qiita.com/bezeklik/items/c6448d50ff0efb45829e">ヘッドレス Chrome Node API 「Puppeteer」 - Qiita</a>
    <ul>
      <li>起動オプションなど</li>
    </ul>
  </li>
  <li><a href="https://yanor.net/wiki/?Windows-%E3%82%A2%E3%83%97%E3%83%AA%E3%82%B1%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3/Chrome/%E3%83%A6%E3%83%BC%E3%82%B6%E3%83%BC%E3%83%97%E3%83%AD%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%83%95%E3%82%A9%E3%83%AB%E3%83%80%E3%81%AE%E7%A2%BA%E8%AA%8D">Windows-アプリケーション/Chrome/ユーザープロファイルフォルダの確認 - yanor.net/wiki</a>
    <ul>
      <li><code>--user-data-dir</code> の指定方法と確認方法。<code>chrome://version</code> の「プロフィールパス」で確認できる</li>
    </ul>
  </li>
  <li><a href="https://stackoverflow.com/questions/57623828/in-puppeteer-how-to-switch-to-chrome-window-from-default-profile-to-desired-prof/57662769#57662769">javascript - In Puppeteer how to switch to chrome window from default profile to desired profile - Stack Overflow</a>
    <ul>
      <li><code>--user-data-dir</code> と <code>--profile-directory</code>。結局 <code>--user-data-dir</code> 直下の <code>Default</code> ディレクトリを参照しようとするみたい</li>
    </ul>
  </li>
  <li><a href="https://qiita.com/hnw/items/a07e6b88d95d1656e02f">Puppeteerで次ページへの遷移を待つ - Qiita</a>
    <ul>
      <li>ページ遷移の待ち方</li>
    </ul>
  </li>
  <li><a href="https://qiita.com/go_sagawa/items/85f97deab7ccfdce53ea">puppeteerでの要素の取得方法 - Qiita</a>
    <ul>
      <li>複数要素の取得方法。<code>$$eval()</code> を使って <code>textContent</code> を取るのが良さそう</li>
    </ul>
  </li>
  <li><a href="https://stackoverflow.com/questions/40538197/chrome-remote-debugging-from-another-machine">Chrome remote debugging from another machine - Stack Overflow</a>
    <ul>
      <li><code>--remote-debugging-port</code> と <code>--remote-debugging-address</code> オプション</li>
    </ul>
  </li>
  <li><a href="https://github.com/puppeteer/puppeteer/issues/5957">WSL2 refusing to connect to chrome.exe · Issue #5957 · puppeteer/puppeteer · GitHub</a>
    <ul>
      <li>WSL から呼ぶ時は <code>--remote-debugging-address</code> を指定するらしいが、上手く行かなかった</li>
    </ul>
  </li>
  <li><a href="https://hiroqn.hatenablog.com/entry/2018/12/12/235919">puppeteer.connectを試す - hiroqn's Data.ByteString.Lazy.ByteString</a>
    <ul>
      <li><code>puppeteer.connect()</code></li>
    </ul>
  </li>
</ul>

      </main>
      <footer id="footer">
        <div id="footer-contents">
          <div id="date-time">
            <dl>
              <dt>Created</dt>
              <dd><time>2020-10-25</time></dd>
              <dt>Last-Modified</dt>
              <dd><time>2020-10-25</time></dd>
            </dl>
          </div>
          <nav id="footer-links">
            <ul>
              <li id="footer-link-about"><a href="/about/index.html" title="About">About</a></li>
              <li id="footer-link-search"><a href="/about/search.html" title="Search">Search</a></li>
              <li id="footer-link-feeds"><a href="/feeds.xml" title="Feeds">Feeds</a></li>
              <li id="footer-link-github"><a href="https://github.com/Neos21/" title="GitHub">GitHub</a></li>
            </ul>
          </nav>
          <nav id="to-top"><a href="#" title="To Top"><span>▲ To Top</span></a></nav>
        </div>
      </footer>
    </div>
  </body>
</html>
