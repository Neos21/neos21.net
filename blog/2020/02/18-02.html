<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="theme-color" content="#0990d0">
    <!-- Google Search Console -->
    <meta name="google-site-verification" content="AvoEr3mUJFF2H_mPWWgShfmjBVP3ywRpyx9hxeeq2d4">
    <title>OCI Always Free Instance に Xfce をインストールして GUI 化する - Neo's World</title>
    <link rel="icon" href="/favicon.ico">
    <link rel="stylesheet" href="/styles.css">
    <link rel="canonical" href="https://neos21.net/blog/2020/02/18-02.html">
    <link rel="search" type="application/opensearchdescription+xml" title="neos21.net" href="/opensearch.xml">
    <link rel="alternate" type="application/atom+xml" href="/feeds.xml">
    <link rel="author" href="http://www.hatena.ne.jp/neos21/">
    <!-- Global Site Tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YMHFLZP1M1"></script>
    <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date());gtag('config','G-YMHFLZP1M1');gtag('config','UA-106501-1');</script>
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6475907504235292" crossorigin="anonymous"></script>
  </head>
  <body>
    <div id="container">
      <header id="header">
        <div id="header-brand">
          <div id="header-brand-contents">
            <div id="site-title"><a href="/index.html">Neo's World</a></div>
            <nav id="header-links">
              <ul>
                <li id="header-link-about"><a href="/about/index.html" title="About"><span>About</span></a></li>
                <li id="header-link-search"><a href="/about/search.html" title="Search"><span>Search</span></a></li>
                <li id="header-link-feeds"><a href="/feeds.xml" title="Feeds"><span>Feeds</span></a></li>
                <li id="header-link-to-bottom"><a href="#footer" title="To Bottom"><span>▼ To Bottom</span></a></li>
              </ul>
            </nav>
          </div>
        </div>
        <nav id="global-nav">
          <ul>
            <li><a href="/blog/index.html">Blog</a></li>
            <li><a href="/tech/index.html">Tech</a></li>
            <li><a href="/music/index.html">Music</a></li>
            <li><a href="/games/index.html">Games</a></li>
            <li><a href="/gallery/index.html">Gallery</a></li>
            <li><a href="/etc/index.html">Etc.</a></li>
          </ul>
        </nav>
        <nav id="path">
          <ul>
            <li><a href="/index.html">Neo's World</a></li>
            <li><a href="/blog/index.html">Blog</a></li>
            <li><a href="/blog/2020/index.html">2020年</a></li>
            <li><a href="/blog/2020/02/index.html">02月</a></li>
          </ul>
        </nav>
      </header>
      <main id="main">
        <div id="header-date"><time>2020-02-18</time></div>
        <h1 id="page-title">OCI Always Free Instance に Xfce をインストールして GUI 化する</h1>

<p>OCI の Always Free な Compute Instance に Xfce をインストールし、GUI 環境を作る。ベースとなる OS は Oracle Linux 7。</p>
<p>ほぼ以下の記事を参考に作業した。</p>
<ul>
  <li><a href="http://knopp.hatenablog.jp/entry/2019/12/12/000000">Computeインスタンス(Oracle Linux7)をGUI化する - KNOPP's blog</a></li>
</ul>
<h2 id="目次"><a class="header-link" href="#目次"><span class="header-link-mark"></span></a>目次</h2>
<ul>
  <li><a href="#compute-instance-%E3%81%A7%E3%81%AE%E4%BD%9C%E6%A5%AD">Compute Instance での作業</a></li>
  <li><a href="#macos-%E3%81%8B%E3%82%89-rdp-%E6%8E%A5%E7%B6%9A%E3%81%99%E3%82%8B">MacOS から RDP 接続する</a></li>
  <li><a href="#windows-%E3%81%8B%E3%82%89-rdp-%E6%8E%A5%E7%B6%9A%E3%81%99%E3%82%8B">Windows から RDP 接続する</a></li>
  <li><a href="#%E3%83%96%E3%83%A9%E3%82%A6%E3%82%B6%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B">ブラウザをインストールする</a></li>
  <li><a href="#%E3%82%BF%E3%82%B9%E3%82%AF%E3%83%9E%E3%83%8D%E3%83%BC%E3%82%B8%E3%83%A3-xfce4-taskmanager-%E3%82%92%E5%85%A5%E3%82%8C%E3%82%8B">タスクマネージャ xfce4-taskmanager を入れる</a></li>
  <li><a href="#%E4%BB%A5%E4%B8%8A">以上</a></li>
</ul>
<h2 id="compute-instance-での作業"><a class="header-link" href="#compute-instance-での作業"><span class="header-link-mark"></span></a>Compute Instance での作業</h2>
<p>順にコマンドだけ掲載する。</p>
<pre class="language-bash"><code class="language-bash"><span class="token comment"># Xfce をインストールする</span>
$ <span class="token function">sudo</span> yum groupinstall -y <span class="token string">'X Window System'</span>
$ <span class="token function">sudo</span> yum groupinstall -y Xfce

<span class="token comment"># XRDP をインストールする</span>
$ <span class="token function">sudo</span> yum -y <span class="token function">install</span> xrdp
$ <span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> xrdp
$ <span class="token function">sudo</span> systemctl start xrdp

<span class="token comment"># 日本語フォントをインストールする</span>
$ <span class="token function">sudo</span> yum <span class="token function">install</span> -y vlgothic-* ipa-gothic-fonts ipa-mincho-fonts ipa-pgothic-fonts ipa-pmincho-fonts

<span class="token comment"># 日本語入力メソッドをインストールする</span>
$ <span class="token function">sudo</span> yum <span class="token function">install</span> -y ibus-kkc

<span class="token comment"># ロケールを日本語に変更する</span>
$ <span class="token function">sudo</span> localectl set-locale <span class="token assign-left variable"><span class="token environment constant">LANG</span></span><span class="token operator">=</span>ja_JP.UTF-8

<span class="token comment"># XRDP 接続時に Xfce セッションが起動するようにする</span>
$ <span class="token function">cat</span> <span class="token operator">></span> <span class="token string">'/home/opc/.Xclients'</span> <span class="token operator">&#x3C;&#x3C;</span> <span class="token string">EOL
#!/bin/bash

export LANG='ja_JP.UTF-8'
export XMODIFIERS='@im=ibus'
export XMODIFIER='@im=ibus'
export GTK_IM_MODULE='ibus'
export QT_IM_MODULE='ibus'
export DefaultIMModule='ibus'
ibus-daemon -drx
exec xfce4-session
EOL</span>

<span class="token comment"># ファイルに権限を付与する</span>
$ <span class="token function">chmod</span> +x <span class="token string">'/home/opc/.Xclients'</span>

<span class="token comment"># opc ユーザにパスワードを設定する (XRDP 用)</span>
$ <span class="token function">passwd</span> opc
</code></pre>
<p>XRDP を使用して接続するので、Security List で <em>3389 番ポート</em>へのアクセスを許可しておく。</p>
<p>VM 側の準備ができたら、クライアント PC から接続してみる。</p>
<h2 id="macos-から-rdp-接続する"><a class="header-link" href="#macos-から-rdp-接続する"><span class="header-link-mark"></span></a>MacOS から RDP 接続する</h2>
<p>MacOS の場合は AppStore より「Microsoft Remote Desktop 10」をダウンロードし、以下のように設定する。</p>
<ul>
  <li>Hostname : OCI VM の Public IP</li>
  <li>User Account : 新規作成し「opc」、先程指定したパスワードを入力する</li>
</ul>
<p>
  <img src="18-02-04.png" alt="RDP 接続">
</p>
<p>接続時、次のような警告が出るが、構わず進む。</p>
<p>
  <img src="18-02-05.png" alt="Continue で無視">
</p>
<p>コレで接続できる。</p>
<p>
  <img src="18-02-01.png" alt="接続できた">
</p>
<h2 id="windows-から-rdp-接続する"><a class="header-link" href="#windows-から-rdp-接続する"><span class="header-link-mark"></span></a>Windows から RDP 接続する</h2>
<p>Windows の場合は、標準で入っている「リモートデスクトップ接続」を利用する。</p>
<p>
  <img src="18-02-02.png" alt="リモートデスクトップ接続">
</p>
<p>初回接続時にパスワードを入力する。</p>
<p>
  <img src="18-02-06.png" alt="パスワードは初回に入れる">
</p>
<p>以下のとおり。</p>
<p>
  <img src="18-02-03.png" alt="開けた">
</p>
<h2 id="ブラウザをインストールする"><a class="header-link" href="#ブラウザをインストールする"><span class="header-link-mark"></span></a>ブラウザをインストールする</h2>
<p>このままだとウェブブラウザがないので、デスクトップから「ターミナル」を開き、次のように叩いていく。</p>
<pre class="language-bash"><code class="language-bash"><span class="token comment"># Firefox はデフォルトで入れられる</span>
$ <span class="token function">sudo</span> yum <span class="token function">install</span> -y firefox

<span class="token comment"># Chrome は次のようにリポジトリを追加する</span>
$ <span class="token function">sudo</span> <span class="token function">vi</span> /etc/yum.repos.d/google.chrome.repo
</code></pre>
<ul>
  <li><code>/etc/yum.repos.d/google.chrome.repo</code></li>
</ul>
<pre class="language-properties"><code class="language-properties">[google-chrome]
<span class="token attr-name">name</span><span class="token punctuation">=</span><span class="token attr-value">google-chrome</span>
<span class="token attr-name">baseurl</span><span class="token punctuation">=</span><span class="token attr-value">http://dl.google.com/linux/chrome/rpm/stable/$basearch</span>
<span class="token attr-name">enabled</span><span class="token punctuation">=</span><span class="token attr-value">1</span>
<span class="token attr-name">gpgcheck</span><span class="token punctuation">=</span><span class="token attr-value">1</span>
<span class="token attr-name">gpgkey</span><span class="token punctuation">=</span><span class="token attr-value">https://dl-ssl.google.com/linux/linux_signing_key.pub</span>
</code></pre>
<pre class="language-bash"><code class="language-bash">$ <span class="token function">sudo</span> yum update -y
$ <span class="token function">sudo</span> yum <span class="token function">install</span> -y google-chrome-stable
</code></pre>
<p>こうすると「ウェブブラウザー」のアイコンから Firefox と Chrome (表記は Chromium) が起動できるようになる。</p>
<ul>
  <li>参考 : <a href="https://qiita.com/shadowhat/items/af6b973df43d75abfe8e">CentOS7にChromeをインストール - Qiita</a></li>
</ul>
<h2 id="タスクマネージャ-xfce4-taskmanager-を入れる"><a class="header-link" href="#タスクマネージャ-xfce4-taskmanager-を入れる"><span class="header-link-mark"></span></a>タスクマネージャ xfce4-taskmanager を入れる</h2>
<p>ついでにタスクマネージャも入れておく。ターミナルで以下のようにインストールする。</p>
<pre class="language-bash"><code class="language-bash">$ <span class="token function">sudo</span> yum <span class="token function">install</span> -y xfce4-taskmanager
</code></pre>
<p>左上の「アプリケーション」 → システム → タスクマネージャー が追加される。</p>
<p>Chrome なんかのブラウザを開くと、CPU 使用率が 4・50% くらい跳ね上がり、もっさりしすぎて使い物にならない。Windows 95 マシンに Windows Me を入れて頑張っていた頃のようだ…。笑</p>
<h2 id="以上"><a class="header-link" href="#以上"><span class="header-link-mark"></span></a>以上</h2>
<p>Always Free インスタンスだとやはりだいぶモッサリするが、出先でとりあえず GUI 環境が欲しくなった時に使える…かも…？</p>

      </main>
      <footer id="footer">
        <div id="footer-contents">
          <div id="date-time">
            <dl>
              <dt>Created</dt>
              <dd><time>2020-02-18</time></dd>
              <dt>Last-Modified</dt>
              <dd><time>2020-02-18</time></dd>
            </dl>
          </div>
          <nav id="footer-links">
            <ul>
              <li id="footer-link-about"><a href="/about/index.html" title="About">About</a></li>
              <li id="footer-link-search"><a href="/about/search.html" title="Search">Search</a></li>
              <li id="footer-link-feeds"><a href="/feeds.xml" title="Feeds">Feeds</a></li>
              <li id="footer-link-github"><a href="https://github.com/Neos21/" title="GitHub">GitHub</a></li>
            </ul>
          </nav>
          <nav id="to-top"><a href="#" title="To Top"><span>▲ To Top</span></a></nav>
        </div>
      </footer>
    </div>
  </body>
</html>
