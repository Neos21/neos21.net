<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="theme-color" content="#0990d0">
    <!-- Google Search Console -->
    <meta name="google-site-verification" content="AvoEr3mUJFF2H_mPWWgShfmjBVP3ywRpyx9hxeeq2d4">
    <!-- Open Graph・Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="Neo's World">
    <meta property="og:title" content="Go 言語を触ってみる - Neo's World">
    <meta property="og:description" content="Go 言語を触ってみる - Neo's World">
    <meta property="og:url" content="https://neos21.net/blog/2019/09/16-03.html">
    <meta property="og:image" content="https://neos21.net/ogp.png">
    <meta property="og:locale" content="ja_JP">
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:title" content="Go 言語を触ってみる - Neo's World">
    <meta property="twitter:description" content="Go 言語を触ってみる - Neo's World">
    <meta property="twitter:url" content="https://neos21.net/blog/2019/09/16-03.html">
    <meta property="twitter:image" content="https://neos21.net/ogp.png">
    <title>Go 言語を触ってみる - Neo's World</title>
    <link rel="icon" href="/favicon.ico">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    <link rel="manifest" href="/manifest.webmanifest">
    <link rel="stylesheet" href="/styles.css">
    <link rel="canonical" href="https://neos21.net/blog/2019/09/16-03.html">
    <link rel="search" type="application/opensearchdescription+xml" title="neos21.net" href="/opensearch.xml">
    <link rel="alternate" type="application/atom+xml" title="Feeds" href="/feeds.xml">
    <link rel="author" href="http://www.hatena.ne.jp/neos21/">
    <script src="/scripts.js"></script>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-MZCGD23');</script>
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6475907504235292" crossorigin="anonymous"></script>
  </head>
  <body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MZCGD23" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <div id="container">
      <header id="header">
        <div id="header-brand">
          <div id="header-brand-contents">
            <div id="site-title"><a href="/index.html">Neo's World</a></div>
            <nav id="header-links">
              <ul>
                <li id="header-link-theme"><a href="#" title="Toggle Theme"><span>Toggle Theme</span></a></li>
                <li id="header-link-about"><a href="/about/index.html" title="About"><span>About</span></a></li>
                <li id="header-link-search"><a href="/about/search.html" title="Search"><span>Search</span></a></li>
                <li id="header-link-feeds"><a href="/feeds.xml" title="Feeds"><span>Feeds</span></a></li>
                <li id="header-link-to-bottom"><a href="#footer" title="To Bottom"><span>▼ To Bottom</span></a></li>
              </ul>
            </nav>
          </div>
        </div>
        <nav id="global-nav">
          <ul>
            <li><a href="/blog/index.html">Blog</a></li>
            <li><a href="/tech/index.html">Tech</a></li>
            <li><a href="/music/index.html">Music</a></li>
            <li><a href="/games/index.html">Games</a></li>
            <li><a href="/gallery/index.html">Gallery</a></li>
            <li><a href="/etc/index.html">Etc.</a></li>
          </ul>
        </nav>
        <nav id="path">
          <ul>
            <li><a href="/index.html">Neo's World</a></li>
            <li><a href="/blog/index.html">Blog</a></li>
            <li><a href="/blog/2019/index.html">2019年</a></li>
            <li><a href="/blog/2019/09/index.html">09月</a></li>
          </ul>
        </nav>
      </header>
      <main id="main">
        <div id="header-date"><time>2019-09-16</time></div>
        <h1 id="page-title">Go 言語を触ってみる</h1>

<p>最近 GitHub で見かけるコマンドラインツールの多くで、<em>Python</em> か <strong>Go 言語</strong>が採用されているのを見かける。最終的にシングルバイナリにビルドできるっぽくて、OS 間の差異も上手く吸収できそうなので、少し触ってみることにした。</p>
<p>今回はネットで見つけた入門系記事を試してみただけだが、その中でも少しつまづくポイントがあったので、記事にした次第。</p>
<h2 id="目次"><a class="header-link" href="#目次"><span class="header-link-mark"></span></a>目次</h2>
<ul>
  <li><a href="#go-%E8%A8%80%E8%AA%9E%E3%81%AE%E9%96%8B%E7%99%BA%E7%92%B0%E5%A2%83%E5%AE%9F%E8%A1%8C%E7%92%B0%E5%A2%83%E3%81%AE%E6%BA%96%E5%82%99">Go 言語の開発環境・実行環境の準備</a></li>
  <li><a href="#%E7%B0%A1%E5%8D%98%E3%81%AA%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E6%9B%B8%E3%81%84%E3%81%A6%E3%81%BF%E3%82%8B">簡単なコードを書いてみる</a></li>
  <li><a href="#echo-%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E7%9A%84%E3%81%AA%E3%83%A2%E3%83%8E%E3%82%92%E4%BD%9C%E3%81%A3%E3%81%A6%E3%81%BF%E3%82%8B"><code>echo</code> コマンド的なモノを作ってみる</a></li>
  <li><a href="#%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%82%92%E8%AA%AD%E3%81%BF%E8%BE%BC%E3%82%93%E3%81%A7%E3%81%BF%E3%82%8B">ファイルを読み込んでみる</a></li>
  <li><a href="#%E4%BB%8A%E6%97%A5%E3%81%AF%E3%82%B3%E3%82%B3%E3%81%BE%E3%81%A7">今日はココまで</a></li>
</ul>
<h2 id="go-言語の開発環境実行環境の準備"><a class="header-link" href="#go-言語の開発環境実行環境の準備"><span class="header-link-mark"></span></a>Go 言語の開発環境・実行環境の準備</h2>
<p>MacOS Mojave の場合は、Homebrew を使ってインストールすると楽。</p>
<pre class="language-bash"><code class="language-bash">$ brew <span class="token function">install</span> go
</code></pre>
<ul>
  <li>参考 : <a href="https://qiita.com/Noah0x00/items/63e024f9b5a27276401b">GO言語をMacで使ってみる インストール - Qiita</a></li>
</ul>
<p>Windows の場合は未検証だが、Chocolatey で同じようにインストールできる様子。</p>
<pre class="language-batch"><code class="language-batch">> choco install golang
</code></pre>
<ul>
  <li>参考 : <a href="https://qiita.com/yoskeoka/items/0dcc62a07bf5eb48dc4b">WindowsにGo言語をインストールする方法まとめ - Qiita</a></li>
</ul>
<p>インストールができたら、PATH を通すため <code>~/.bash_profile</code> 辺りに以下のように追記する。</p>
<pre class="language-bash"><code class="language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable">GOPATH</span><span class="token operator">=</span><span class="token string">"<span class="token variable">${<span class="token environment constant">HOME</span>}</span>/go"</span>
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token string">"<span class="token variable">${GOPATH}</span>/bin:<span class="token variable">${<span class="token environment constant">PATH</span>}</span>"</span>
</code></pre>
<p>ターミナル上で <code>$ go version</code> コマンドが通るようになっていれば OK。</p>
<pre class="language-bash"><code class="language-bash"><span class="token comment"># MacOS での例</span>
$ go version
go version go1.12.5 darwin/amd64
</code></pre>
<p>コレで Go 言語のファイルをビルドしたり実行したりする基盤はできた。</p>
<p>今回は特別な IDE 等は用意せず、VSCode を使う。特に拡張機能も使わないので、CotEditor や NotePad++ など、簡単なエディタとターミナルツールだけあれば良い。</p>
<h2 id="簡単なコードを書いてみる"><a class="header-link" href="#簡単なコードを書いてみる"><span class="header-link-mark"></span></a>簡単なコードを書いてみる</h2>
<p>まずは最も簡単な、Hello World を出力するだけのプログラムを書いてみる。以下のような内容の <code>hello.go</code> ファイルを作る。</p>
<pre class="language-go"><code class="language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token string">"fmt"</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"hello, world!"</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<p>ココでの留意点は以下のとおり。</p>
<ul>
  <li><code>package</code> : このプログラムを外部に公開する際に使用する、<em>パッケージ名</em>を指定する</li>
  <li><code>import</code> : 外部ライブラリ等をインポートする。ココではコンソール出力に使う <code>fmt</code> をインポートしている</li>
  <li><code>func main()</code> : <code>func</code> で関数宣言。<code>main()</code> 関数は Java などと同じく、自動的に実行されるメイン関数</li>
  <li>行末のセミコロンは付けなくて良い。書いても問題ないので、イメージ的には改行がセミコロン代わりになる、JavaScript の言語仕様っぽい感じかな</li>
</ul>
<p>ということで、コレを実行してみる。</p>
<p>ビルドしてバイナリファイルを作り、それを実行する場合は以下のとおり。</p>
<pre class="language-bash"><code class="language-bash">$ go build ./hello.go
</code></pre>
<p>コレで 2MB 程度の <code>hello</code> というバイナリファイルがコンパイルされる。</p>
<pre class="language-bash"><code class="language-bash">$ ./hello
hello, world<span class="token operator">!</span>
</code></pre>
<p>あとは上のように実行すれば良い。</p>
<p>他にも、<code>.go</code> ファイルをコンパイルせず直接実行する方法もある。<code>import</code> 等の制約があるので、依存関係があるファイルでは上手くいかないこともあるようだが、今回のレベルであれば問題なし。</p>
<pre class="language-bash"><code class="language-bash">$ go run ./hello.go
hello, world<span class="token operator">!</span>
</code></pre>
<ul>
  <li>参考 : <a href="https://news.mynavi.jp/article/gogogo-1/">ゼロからはじめるGo言語(1) Go言語をはじめよう | マイナビニュース</a></li>
  <li>参考 : <a href="http://nununu.hatenablog.jp/entry/2016/09/20/210000">go run と go buildの違い - PONCOTSU</a></li>
</ul>
<h2 id="echo-コマンド的なモノを作ってみる"><a class="header-link" href="#echo-コマンド的なモノを作ってみる"><span class="header-link-mark"></span></a><code>echo</code> コマンド的なモノを作ってみる</h2>
<p>続いて、<code>echo</code> コマンドのように、引数を受け取ってコンソール出力する、というプログラムを作ってみる。</p>
<pre class="language-go"><code class="language-go"><span class="token keyword">package</span> main

<span class="token keyword">import</span> <span class="token punctuation">(</span>
  <span class="token string">"os"</span>
  <span class="token string">"flag"</span>  <span class="token comment">// コマンドラインオプションのパーサ</span>
<span class="token punctuation">)</span>

<span class="token comment">// -n オプションを用意する。指定した場合は最後に改行を含めないで出力する</span>
<span class="token keyword">var</span> omitNewline <span class="token operator">=</span> flag<span class="token punctuation">.</span><span class="token function">Bool</span><span class="token punctuation">(</span><span class="token string">"n"</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token string">"don't print final newline"</span><span class="token punctuation">)</span>

<span class="token comment">// 定数宣言</span>
<span class="token keyword">const</span> <span class="token punctuation">(</span>
  Space   <span class="token operator">=</span> <span class="token string">" "</span>
  Newline <span class="token operator">=</span> <span class="token string">"\n"</span>
<span class="token punctuation">)</span>

<span class="token comment">// メイン関数</span>
<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// パラメータリストを調べて flag に設定する</span>
  flag<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  
  <span class="token comment">// 変数宣言</span>
  <span class="token keyword">var</span> s <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">""</span>
  
  <span class="token comment">// 引数を順に処理する</span>
  <span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&#x3C;</span> flag<span class="token punctuation">.</span><span class="token function">NArg</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> i <span class="token operator">></span> <span class="token number">0</span> <span class="token punctuation">{</span>
      s <span class="token operator">+=</span> Space
    <span class="token punctuation">}</span>
    s <span class="token operator">+=</span> flag<span class="token punctuation">.</span><span class="token function">Arg</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  
  <span class="token comment">// -n オプションによるフラグがなければ改行を付与する</span>
  <span class="token keyword">if</span> <span class="token operator">!</span><span class="token operator">*</span>omitNewline <span class="token punctuation">{</span>
    s <span class="token operator">+=</span> Newline
  <span class="token punctuation">}</span>
  
  <span class="token comment">// コンソール出力する</span>
  os<span class="token punctuation">.</span>Stdout<span class="token punctuation">.</span><span class="token function">WriteString</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<p>ココでの留意点は以下のとおり。</p>
<ul>
  <li><code>import</code>・<code>var</code>・<code>const</code> などは、カッコ <code>()</code> でまとめて宣言できる</li>
</ul>
<pre class="language-go"><code class="language-go"><span class="token keyword">import</span> <span class="token punctuation">(</span>
  <span class="token string">"os"</span><span class="token punctuation">;</span>    <span class="token comment">// ← セミコロンはこの位置に打っても、打たなくても良い</span>
  <span class="token string">"flag"</span><span class="token punctuation">;</span>
<span class="token punctuation">)</span>
<span class="token keyword">const</span> <span class="token punctuation">(</span>
  Space   <span class="token operator">=</span> <span class="token string">" "</span>
  Newline <span class="token operator">=</span> <span class="token string">"\n"</span>
<span class="token punctuation">)</span>

<span class="token comment">// 以下のように書いたのと同じ</span>
<span class="token keyword">import</span> <span class="token string">"os"</span>
<span class="token keyword">import</span> <span class="token string">"flag"</span>
<span class="token keyword">const</span> Space   <span class="token operator">=</span> <span class="token string">" "</span>
<span class="token keyword">const</span> Newline <span class="token operator">=</span> <span class="token string">"\n"</span>
</code></pre>
<ul>
  <li>変数の型宣言は省略できる</li>
</ul>
<pre class="language-go"><code class="language-go"><span class="token keyword">var</span> s <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">""</span>

<span class="token comment">// コレでも代入している値から string 型と分かる</span>
<span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token string">""</span>

<span class="token comment">// var 宣言は以下のように省略して書ける (コード中では for 文で使用している)</span>
s <span class="token operator">:=</span> <span class="token string">""</span>
</code></pre>
<ul>
  <li>ループは <code>for</code> のみ、<code>while</code> は存在しない</li>
  <li><code>if</code> や <code>for</code> の条件部分は、カッコ <code>()</code> で囲まない。ココは Java などの言語と大きく違う点。コードブロックはブレース <code>{}</code> で囲む必要がある</li>
  <li><code>if !*omitNewline</code> 部分のアスタリスク <code>*</code> は、<strong>ポインタ</strong>を示すモノらしい。ポインタはサッパリ分からないので要勉強…
    <ul>
      <li>参考 : <a href="https://qiita.com/tmzkysk/items/1b73eaf415fee91aaad3">Go言語におけるポインタのアンパサンド(&#x26;amp;)とアスタリスク(<code>*</code>)の違い - Qiita</a></li>
    </ul>
  </li>
  <li>何らかの条件によって異常終了させたい場合は、<code>os.Exit(1)</code> という風に書けば良い</li>
</ul>
<p>このコードを <code>myecho.go</code> として保存したら、以下のように実行できる。</p>
<pre class="language-bash"><code class="language-bash">$ go run ./myecho.go HOGE FUGA
HOGE FUGA
</code></pre>
<ul>
  <li>参考 : <a href="http://golang.jp/go_tutorial">Goプログラミング言語のチュートリアル - golang.jp</a></li>
</ul>
<h2 id="ファイルを読み込んでみる"><a class="header-link" href="#ファイルを読み込んでみる"><span class="header-link-mark"></span></a>ファイルを読み込んでみる</h2>
<p>今回の最後は、ファイルを読み込むサンプルコード。ココでかなりつまづいた。</p>
<p>先に動作する正解のコードを載せておく。</p>
<ul>
  <li><code>./mylib/myfile.go</code> … サブディレクトリ <code>./mylib/</code> を作りそこに置く</li>
</ul>
<pre class="language-go"><code class="language-go"><span class="token keyword">package</span> myFile  <span class="token comment">// パッケージ名</span>
<span class="token keyword">import</span> <span class="token string">"syscall"</span>

<span class="token comment">// 型定義</span>
<span class="token keyword">type</span> File <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  fd   <span class="token builtin">int</span>     <span class="token comment">// ファイル記述子番号</span>
  name <span class="token builtin">string</span>  <span class="token comment">// ファイルを開く時の名前</span>
<span class="token punctuation">}</span>

<span class="token comment">// インスタンスを生成するファクトリ関数</span>
<span class="token keyword">func</span> <span class="token function">newFile</span><span class="token punctuation">(</span>fd <span class="token builtin">int</span><span class="token punctuation">,</span> name <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">*</span>File <span class="token punctuation">{</span>
  <span class="token keyword">if</span> fd <span class="token operator">&#x3C;</span> <span class="token number">0</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token boolean">nil</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token operator">&#x26;</span>File<span class="token punctuation">{</span>fd<span class="token punctuation">,</span> name<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// ファイルを開き File 型のインスタンスとして返す</span>
<span class="token keyword">func</span> <span class="token function">Open</span><span class="token punctuation">(</span>name <span class="token builtin">string</span><span class="token punctuation">,</span> mode <span class="token builtin">int</span><span class="token punctuation">,</span> perm <span class="token builtin">uint32</span><span class="token punctuation">)</span> <span class="token punctuation">(</span>file <span class="token operator">*</span>File<span class="token punctuation">,</span> err <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  r<span class="token punctuation">,</span> e <span class="token operator">:=</span> syscall<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> mode<span class="token punctuation">,</span> perm<span class="token punctuation">)</span>
  err <span class="token operator">=</span> e
  <span class="token keyword">return</span> <span class="token function">newFile</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">,</span> err
<span class="token punctuation">}</span>
</code></pre>
<ul>
  <li><code>./read.go</code> … 上の <code>./mylib/myfile.go</code> を読み込んで利用している</li>
</ul>
<pre class="language-go"><code class="language-go"><span class="token keyword">package</span> main
<span class="token keyword">import</span> <span class="token punctuation">(</span>
  <span class="token string">"./mylib"</span>  <span class="token comment">// ディレクトリを読み込む</span>
  <span class="token string">"fmt"</span>
  <span class="token string">"os"</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 開きたいファイルのフルパスを指定する</span>
  <span class="token keyword">var</span> path <span class="token operator">=</span> <span class="token string">"/does/not/exist"</span>
  
  <span class="token comment">// パッケージ名 myFile を指定する</span>
  file<span class="token punctuation">,</span> err <span class="token operator">:=</span> myFile<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>path<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
  
  <span class="token keyword">if</span> file <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"can't open file; err=%s\n"</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
    os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">"OK"</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>コードとしてはこんな感じ。</p>
<pre class="language-bash"><code class="language-bash">$ go run ./read.go
</code></pre>
<p>と実行すると、変数 <code>path</code> で指定したファイルを読み込み、「OK」だったり「can't open file」エラーだったりを出力する、というモノ。</p>
<p>このコードのベースにしたのは、以下の記事。</p>
<ul>
  <li>参考 : <a href="http://go.shibu.jp/go_tutorial.html#i-o-package">Let's Go — プログラミング言語 Go ドキュメント v0.1 documentation</a></li>
</ul>
<p>この記事では、<code>os</code> パッケージを <code>import</code> し、<code>Open()</code> 関数のエラーを <code>os.Error</code> 型で返そうとしていたが、どうも<strong>最近の Go 言語では <code>os.Error</code> がなくなっているらしく、このコードはエラーが出て動かなかった</strong>ので、なんとなくで直した。元はこんなコードが含まれていた。</p>
<pre class="language-go"><code class="language-go"><span class="token comment">// 上の動作するコードでは「err = e」とした部分は、代わりにこうなっていた</span>
<span class="token keyword">if</span> e <span class="token operator">!=</span> <span class="token number">0</span> <span class="token punctuation">{</span>
  err <span class="token operator">=</span> os<span class="token punctuation">.</span><span class="token function">Errno</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre>
<p><code>err = e</code> と直したら動いたが、コレでいいのかはよく分かっていない。</p>
<ul>
  <li>参考 : <a href="http://shinriyo.hateblo.jp/entry/2014/09/23/Web%E3%82%92Golang%E3%81%A7%E3%83%8F%E3%83%9E%E3%81%A3%E3%81%9F">WebをGolangで作ろうとハマった - 万年素人からHackerへの道</a></li>
</ul>
<p>あと <code>Open()</code> 関数の引数 <code>perm</code> は、<code>int</code> 型では <code>cannot use perm (type int) as type uint32 in argument to syscall.Open</code> とかいうエラーが出てしまったので、<code>unit32</code> 型に変更した。コレもイマイチ分かってない。</p>
<p>大きな変更点はこのくらい。あとは言語仕様について学んだこと。</p>
<ul>
  <li><code>type File struct</code> : <code>type</code> で型定義ができる</li>
  <li><code>type</code> や <code>const</code>、<code>func</code> などの名前を<em>大文字で始める</em>と、その要素をパッケージ外部に公開できる。コレにより、<code>import</code> した側がその要素を参照できるようになる
    <ul>
      <li>Node.js でいうと、大文字始まりの定数や関数などが <code>module.exports</code> に自動追加される、みたいな言語仕様になっているようだ。コレは便利かも</li>
      <li>例えば <code>func newFile()</code> は小文字の <code>n</code> で始まっているので、<code>read.go</code> から参照することはできない。しかし、<code>func Open()</code> は大文字の <code>O</code> で始まっているのでエクスポートされており、<code>read.go</code> で <code>myFile.Open()</code> と利用できている</li>
    </ul>
  </li>
  <li><code>func newFile()</code> はアンパサンド <code>&#x26;</code> やアスタリスク <code>*</code> が登場している。これらはポインタを示す何やららしいが、よく分かっていない。関数の処理的には以下のようにも書けるので、この方が Java の「DTO」っぽい記述の仕方で、慣れてる人の方が多いかも</li>
</ul>
<pre class="language-go"><code class="language-go"><span class="token comment">// newFile() 関数を以下のように書いても同じ</span>
<span class="token keyword">func</span> <span class="token function">newFile</span><span class="token punctuation">(</span>fd <span class="token builtin">int</span><span class="token punctuation">,</span> name <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token operator">*</span>File <span class="token punctuation">{</span>
  <span class="token keyword">var</span> myFile <span class="token operator">=</span> <span class="token function">new</span><span class="token punctuation">(</span>File<span class="token punctuation">)</span>
  myFile<span class="token punctuation">.</span>fd <span class="token operator">=</span> fd
  myFile<span class="token punctuation">.</span>name <span class="token operator">=</span> name
  <span class="token keyword">return</span> myFile
<span class="token punctuation">}</span>
</code></pre>
<ul>
  <li><code>func Open()</code> は、引数指定のあとに <code>(file *File, err error)</code> と書いてある。コレは正常終了時の戻り値と異常終了時の戻り値の2つをセットで宣言しているモノ。Go 言語では戻り値をこのように2つ指定できるようだ</li>
  <li><code>func Open()</code> 内の <code>r, e := syscall.Open(name, mode, perm)</code> 部分も同じことで、<code>syscall.Open()</code> 関数が2つの戻り値を返しているので、<code>r (= result)</code> と <code>e (= error)</code> の2つを変数で受け取っているのだ</li>
  <li>自分が実装した他のファイルをインポートして利用したい場合は、<code>read.go</code> ファイルに書いたように、<code>import "./mylib"</code> と<em>ディレクトリパス</em>を指定する
    <ul>
      <li>こうすると、そのディレクトリ配下にある <code>.go</code> ファイルを読み込めるようになる</li>
    </ul>
  </li>
  <li>ディレクトリごと読み込んだ後は、各 <code>.go</code> ファイルの <code>package</code> 宣言で指定した名前を使い、<code>myFile.Open()</code> といった要領で、関数や定数などを参照できる</li>
  <li>インポートしたファイルたちの中に <code>main()</code> 関数があると、複数の <code>main()</code> 関数が存在するとして実行できないので注意</li>
  <li><code>null</code> は <code>nil</code> と表記。Ruby っぽい</li>
  <li><code>if</code> 文における <code>else</code> 句は、<strong><code>} else {</code></strong> と1行で書かないとエラーになる。個人的には Java や JS で普段このように1行では書かないので、慣れない…
    <ul>
      <li>参考 : <a href="http://sugilog.hatenablog.com/entry/2014/12/29/000855">Go言語 : 条件分岐 : if - sugilogのブログ</a></li>
    </ul>
  </li>
</ul>
<pre class="language-go"><code class="language-go"><span class="token keyword">if</span> file <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  <span class="token comment">// 処理</span>
<span class="token punctuation">}</span>
<span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token comment">// ↑ このように「}」と「else {」を別の行に分けて書くとエラーになる</span>
<span class="token punctuation">}</span>
</code></pre>
<h2 id="今日はココまで"><a class="header-link" href="#今日はココまで"><span class="header-link-mark"></span></a>今日はココまで</h2>
<p>今回はこの辺りにしておこう。</p>
<p>Go 言語は実行環境のインストールも簡単で、言語仕様も色々と理にかなった作りになっていてとっつきやすそうだ。</p>
<p>ネット上の文献は古今混在しているようで、最後の「ファイル読み込み」の例のように、現在では動かなくなっているコードもあるので、情報の鮮度を見極めて学習していきたい。</p>

      </main>
      <footer id="footer">
        <div id="footer-contents">
          <div id="date-time">
            <dl>
              <dt>Created</dt>
              <dd><time>2019-09-16</time></dd>
              <dt>Last-Modified</dt>
              <dd><time>2019-09-16</time></dd>
            </dl>
          </div>
          <nav id="footer-links">
            <ul>
              <li id="footer-link-about"><a href="/about/index.html" title="About">About</a></li>
              <li id="footer-link-search"><a href="/about/search.html" title="Search">Search</a></li>
              <li id="footer-link-feeds"><a href="/feeds.xml" title="Feeds">Feeds</a></li>
              <li id="footer-link-github"><a href="https://github.com/Neos21/" title="GitHub">GitHub</a></li>
            </ul>
          </nav>
          <nav id="to-top"><a href="#" title="To Top"><span>▲ To Top</span></a></nav>
        </div>
      </footer>
    </div>
  </body>
</html>
