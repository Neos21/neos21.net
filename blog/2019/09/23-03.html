<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="theme-color" content="#0990d0">
    <!-- Google Search Console -->
    <meta name="google-site-verification" content="AvoEr3mUJFF2H_mPWWgShfmjBVP3ywRpyx9hxeeq2d4">
    <title>ConEmu と Cmder を使ってみたけど GitBash に戻った - Neo's World</title>
    <link rel="icon" href="/favicon.ico">
    <link rel="stylesheet" href="/styles.css">
    <link rel="canonical" href="https://neos21.net/blog/2019/09/23-03.html">
    <link rel="search" type="application/opensearchdescription+xml" title="neos21.net" href="/opensearch.xml">
    <link rel="alternate" type="application/atom+xml" href="/feeds.xml">
    <link rel="author" href="http://www.hatena.ne.jp/neos21/">
    <!-- Global Site Tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YMHFLZP1M1"></script>
    <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date());gtag('config','G-YMHFLZP1M1');gtag('config','UA-106501-1');</script>
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6475907504235292" crossorigin="anonymous"></script>
  </head>
  <body>
    <div id="container">
      <header id="header">
        <div id="header-brand">
          <div id="header-brand-contents">
            <div id="site-title"><a href="/index.html">Neo's World</a></div>
            <nav id="header-links">
              <ul>
                <li id="header-link-about"><a href="/about/index.html" title="About"><span>About</span></a></li>
                <li id="header-link-search"><a href="/about/search.html" title="Search"><span>Search</span></a></li>
                <li id="header-link-feeds"><a href="/feeds.xml" title="Feeds"><span>Feeds</span></a></li>
                <li id="header-link-to-bottom"><a href="#footer" title="To Bottom"><span>▼ To Bottom</span></a></li>
              </ul>
            </nav>
          </div>
        </div>
        <nav id="global-nav">
          <ul>
            <li><a href="/blog/index.html">Blog</a></li>
            <li><a href="/tech/index.html">Tech</a></li>
            <li><a href="/music/index.html">Music</a></li>
            <li><a href="/games/index.html">Games</a></li>
            <li><a href="/gallery/index.html">Gallery</a></li>
            <li><a href="/etc/index.html">Etc.</a></li>
          </ul>
        </nav>
        <nav id="path">
          <ul>
            <li><a href="/index.html">Neo's World</a></li>
            <li><a href="/blog/index.html">Blog</a></li>
            <li><a href="/blog/2019/index.html">2019年</a></li>
            <li><a href="/blog/2019/09/index.html">09月</a></li>
          </ul>
        </nav>
      </header>
      <main id="main">
        <div id="header-date"><time>2019-09-23</time></div>
        <h1 id="page-title">ConEmu と Cmder を使ってみたけど GitBash に戻った</h1>

<p>これまで Windows 環境では <strong>ConEmu</strong> を使って Git For Windows ないしは Git SDK を動かしていた。</p>
<ul>
  <li><a href="/blog/2016/10/19-01.html">Windows のターミナル環境を劇的に改善する「ConEmu」を入れてみた</a></li>
</ul>
<p>しかし、<code>tmux</code> を導入するにあたって不具合が多く、色々と試した結果、「<strong>標準の GitBash (<code>git-bash.exe</code>) が最善なんじゃねえの…？</strong>」となったので、その軌跡を残しておく。</p>
<h2 id="目次"><a class="header-link" href="#目次"><span class="header-link-mark"></span></a>目次</h2>
<ul>
  <li><a href="#conemu-%E3%81%AE%E5%8B%95%E4%BD%9C">ConEmu の動作</a>
    <ul>
      <li><a href="#conemu-%E3%81%A7-tmux-%E3%81%AE%E8%A1%A8%E7%A4%BA%E3%81%8C%E3%83%90%E3%82%B0%E3%82%8B">ConEmu で tmux の表示がバグる</a></li>
      <li><a href="#%E9%81%95%E3%81%86-task-%E5%AE%9A%E7%BE%A9%E3%81%A7%E5%8B%95%E3%81%8B%E3%81%99%E3%81%A8-tmux-%E3%81%8C%E4%BD%BF%E3%81%88%E3%81%AA%E3%81%8F%E3%81%AA%E3%82%8B">違う Task 定義で動かすと tmux が使えなくなる</a></li>
    </ul>
  </li>
  <li><a href="#cmder">Cmder</a>
    <ul>
      <li><a href="#cygwin-connector-%E3%82%92%E6%8C%9F%E3%82%93%E3%81%A7%E3%81%84%E3%82%8B%E3%81%A8tmux-%E3%81%AF%E6%AD%A3%E5%B8%B8%E3%81%AB%E5%8B%95%E4%BD%9C%E3%81%99%E3%82%8B%E3%81%8C%E6%97%A5%E6%9C%AC%E8%AA%9E%E5%85%A5%E5%8A%9B%E3%81%8C%E3%83%90%E3%82%B0%E3%82%8B">cygwin-connector を挟んでいると、tmux は正常に動作するが、日本語入力がバグる</a></li>
      <li><a href="#cygwin-connector-%E3%82%92%E6%8C%9F%E3%81%BE%E3%81%AA%E3%81%84%E3%81%A8%E3%82%84%E3%81%A3%E3%81%B1%E3%82%8A-tmux-%E3%81%8C%E4%BD%BF%E3%81%88%E3%81%AA%E3%81%84">cygwin-connector を挟まないとやっぱり tmux が使えない</a></li>
    </ul>
  </li>
  <li><a href="#gitbash">GitBash</a></li>
  <li><a href="#3%E8%80%85%E3%81%AE%E3%81%BE%E3%81%A8%E3%82%81">3者のまとめ</a></li>
  <li><a href="#minttyrc-%E3%82%92%E6%9C%AC%E8%85%B0%E5%85%A5%E3%82%8C%E3%81%A6%E7%9B%B4%E3%81%97%E3%81%A6%E3%81%8A%E3%81%8F"><code>.minttyrc</code> を本腰入れて直しておく</a></li>
</ul>
<h2 id="conemu-の動作"><a class="header-link" href="#conemu-の動作"><span class="header-link-mark"></span></a>ConEmu の動作</h2>
<h3 id="conemu-で-tmux-の表示がバグる"><a class="header-link" href="#conemu-で-tmux-の表示がバグる"><span class="header-link-mark"></span></a>ConEmu で tmux の表示がバグる</h3>
<p>以下の記事で紹介した Task 定義で、ConEmu から GitBash を開いてみた。</p>
<ul>
  <li><a href="/blog/2019/02/05-01.html">Git SDK を ConEmu で使う設定</a></li>
</ul>
<pre class="language-bash"><code class="language-bash"><span class="token builtin class-name">set</span> <span class="token string">"PATH=C:\git-sdk-64\usr<span class="token entity" title="\b">\b</span>in;%PATH%"</span> <span class="token operator">&#x26;</span> <span class="token string">"C:\git-sdk-64\git-cmd.exe"</span> --no-cd --command<span class="token operator">=</span>%ConEmuBaseDirShort%<span class="token punctuation">\</span>conemu-msys2-64.exe /usr/bin/bash.exe -l -i -new_console:p%
</code></pre>
<p>↑コレ。元はというと以下の記事で書いたように、256色表示とかを上手くやるための <code>conemu-msys2-64.exe</code> (<strong><a href="https://github.com/Maximus5/cygwin-connector">cygwin-connector</a></strong>) を噛ませて <code>bash.exe</code> を起動している。</p>
<ul>
  <li><a href="/blog/2016/11/05-01.html">GitBash in ConEmu で256色を表示させるまでの軌跡</a></li>
</ul>
<p>この状態で <code>tmux</code> を開くと、画面がどんどん上にスクロールしていくかのような描画になり、画面がバグってまともに使えない。</p>
<p>また、<code>tmux</code> を使っていない通常時も<strong>日本語 (全角) 文字を入力したり消したりしているとカーソル位置がおかしくなるバグ</strong>があり、かなりつらい。</p>
<h3 id="違う-task-定義で動かすと-tmux-が使えなくなる"><a class="header-link" href="#違う-task-定義で動かすと-tmux-が使えなくなる"><span class="header-link-mark"></span></a>違う Task 定義で動かすと tmux が使えなくなる</h3>
<p>続いて、以下のような Task 定義に修正してみた。</p>
<pre class="language-bash"><code class="language-bash"><span class="token builtin class-name">set</span> <span class="token string">"PATH=C:\git-sdk-64\usr<span class="token entity" title="\b">\b</span>in;%PATH%"</span> <span class="token operator">&#x26;</span> cmd /c <span class="token string">"C:\git-sdk-64\usr<span class="token entity" title="\b">\b</span>in<span class="token entity" title="\b">\b</span>ash -l -i"</span> -new_console:p
</code></pre>
<p>コチラは Windows コマンドの <code>cmd /c</code> コマンドを使い、直接 <code>bash.exe</code> を実行している。</p>
<p>コレでターミナルを起動すると、日本語入力時にカーソル位置がバグる問題は解消するが、<code>tmux</code> を起動しようとすると以下のようなエラーが出てしまう。</p>
<pre class="language-bash"><code class="language-bash">$ tmux
<span class="token function">open</span> terminal failed: not a terminal
</code></pre>
<p>どうも <code>$TERM</code> が <code>xterm-256color</code> ではなく <code>cygwin</code> になっていることが原因っぽいが、環境変数を後から書き換えたりするだけでは使えるようにできなかった。</p>
<h2 id="cmder"><a class="header-link" href="#cmder"><span class="header-link-mark"></span></a>Cmder</h2>
<p>ココで登場したのが <strong>Cmder</strong>。ConEmu を改良したモノに、Git For Windows を同梱しているというツール。</p>
<ul>
  <li><a href="https://cmder.net/">Cmder | Console Emulator</a></li>
</ul>
<p>内部的には ConEmu なのだが、細部が異なっている。例えば、同梱されている cygwin-connector <code>conemu-msys2-64.exe</code> の詳細を見ると、バージョン番号が違う。</p>
<ul>
  <li>ConEmu 同梱版 : v1.2.0.0</li>
  <li>Cmder 同梱版 : v1.2.5.0</li>
</ul>
<p>両者でファイルを入れ替えて使ってみたりしたが、正常に起動しなくなるため、Cmder 特有の調整が入っているようだ。</p>
<p>ConEmu で発生する日本語文字の表示が崩れる問題が、Cmder だと発生しなくなる、ということで入れてみた。</p>
<h3 id="cygwin-connector-を挟んでいるとtmux-は正常に動作するが日本語入力がバグる"><a class="header-link" href="#cygwin-connector-を挟んでいるとtmux-は正常に動作するが日本語入力がバグる"><span class="header-link-mark"></span></a>cygwin-connector を挟んでいると、tmux は正常に動作するが、日本語入力がバグる</h3>
<p>さて、cygwin-connector 入りの Task を Cmder で使ってみる。すると、<code>tmux</code> が正常に動作した。</p>
<p><em><code>tmux</code> の罫線が消えたりする問題は、僕がお気に入りで使っている MeiryoKe などの和文フォントではなく、Consolas や Menlo など英文フォントを指定すれば回避できる。</em></p>
<p>コレはやったか？！と思ったら、<strong>日本語入力時のバグり方が ConEmu よりひどい。</strong></p>
<ul>
  <li>参考：<a href="https://qiita.com/kenji0x02/items/c85466cfb6df25f0724e">cmderでカーソル位置が一文字ずれたときの対処法 - Qiita</a></li>
  <li>参考：<a href="https://qiita.com/imidorf/items/309c989aa44d0cd670e8">Windows Creaters Update(バージョン1703)でconemuの全角文字のカーソル位置がずれる(解決済) - Qiita</a></li>
</ul>
<p>事象は上の記事のスクショを見てもらうと分かりやすいだろう。</p>
<blockquote>
  <p>コマンドプロンプトの設定で従来のコンソールを使うのチェックを入れると何故かなおる。</p>
</blockquote>
<p>というのもやってみたが、直らず。</p>
<p>実は cygwin-connector 自体の GitHub Issues に、CJK 文字に関するバグは挙がっているのだが、対応がされていないようなのだ。</p>
<ul>
  <li>参考：<a href="https://github.com/Maximus5/cygwin-connector/issues/18">CJK is not handled properly · Issue #18 · Maximus5/cygwin-connector · GitHub</a></li>
</ul>
<p>コレまでのどこかのタイミングでは、Windows OS 側と何か上手く都合が付けられるタイミングがあり、不具合が解消できたのかもしれないが、本稿執筆時点では上手く制御できなくなっていた。日本語が壊滅的に使えないのはダメだなぁ…。</p>
<h3 id="cygwin-connector-を挟まないとやっぱり-tmux-が使えない"><a class="header-link" href="#cygwin-connector-を挟まないとやっぱり-tmux-が使えない"><span class="header-link-mark"></span></a>cygwin-connector を挟まないとやっぱり tmux が使えない</h3>
<p>それでは <code>cmd /c</code> で <code>bash.exe</code> を直起動したらどうかというと、日本語入力はバグらずできるようになるが、代わりに ConEmu 同様 tmux が起動できなくなる。</p>
<h2 id="gitbash"><a class="header-link" href="#gitbash"><span class="header-link-mark"></span></a>GitBash</h2>
<p>それじゃあ Git SDK に同梱の GitBash (<code>git-bash.exe</code>) の動きも見ておこうか、ということで試してみた。</p>
<p><code>tmux</code> は難なく起動する。罫線が崩れる件は英文フォントを指定することで回避。</p>
<p>英文フォントにない日本語文字は、<strong>フォントリンク</strong>というレジストリをイジってやれば、お気に入りなメイリオ改を使わせたりできるのだが、なんだか間延びして表示されていて、<em>実害はないが見た目がダサい。</em></p>
<ul>
  <li>参考：<a href="http://tm.root-n.com/misc:consolas">欧文フォントを日本語に対応させる Tipsというかメモ</a></li>
  <li>参考：<a href="https://mohmongar.net/?p=1549">Windowsの欧文フォントを日本語に対応させる – Mohmongar</a></li>
  <li>参考：<a href="http://desktopcustomize.blog37.fc2.com/blog-entry-20.html">フォントリンクの方法 - Desktop Customize Lab.</a></li>
</ul>
<p>見た目のダサさはおいておくと、日本語入力してもカーソル位置がバグったりしないし、<code>tmux</code> も動作する。一番実害が少なく使えるソフトは、GitBash だったのだ…。</p>
<h2 id="3者のまとめ"><a class="header-link" href="#3者のまとめ"><span class="header-link-mark"></span></a>3者のまとめ</h2>
<p>ということで3者の挙動をまとめる。</p><table>
  <thead>
    <tr>
      <th colspan="3">ソフト情報</th>
      <th colspan="3">接続方式別の挙動</th>
    </tr>
    <tr>
      <th>ソフト名</th>
      <th>タブ機能</th>
      <th>日本語描画</th>
      <th>接続方式</th>
      <th>日本語入力</th>
      <th>tmux</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>GitBash</th>
      <td>×</td>
      <td>△ 汚い (崩れはなし)</td>
      <td>-</td>
      <td>○ 正常</td>
      <td>○ 動作する</td>
    </tr>
    <tr>
      <th rowspan="2">ConEmu</th>
      <td rowspan="2">○</td>
      <td rowspan="2">○ 正常</td>
      <td>cygwin-connector 使用</td>
      <td>× バグあり</td>
      <td>○ 動作する</td>
    </tr>
    <tr>
      <td>cygwin-connector 未使用</td>
      <td>○ 正常</td>
      <td>× 起動しない</td>
    </tr>
    <tr>
      <th rowspan="2">Cmder</th>
      <td rowspan="2">○</td>
      <td rowspan="2">○ 正常</td>
      <td>cygwin-connector 使用</td>
      <td>× ひどいバグ</td>
      <td>○ 動作する</td>
    </tr>
    <tr>
      <td>cygwin-connector 未使用</td>
      <td>○ 正常</td>
      <td>× 起動しない</td>
    </tr>
  </tbody>
</table>
<p>「日本語表示」は、いずれの環境も「Consolas」あたりの英字フォントを選択していることが前提。<code>tmux</code> の罫線記号も、日本語フォントを指定していると崩れやすい。この辺、日本語含めてターミナル利用で最適なフォントの決定版を見付けたいところ…。</p>
<p>GitBash はタブ機能がないが、<code>tmux</code> が一番まともに動く。ConEmu や Cmder は本体にタブ機能があり <code>tmux</code> 相当のことができるが、<code>tmux</code> を正常に動かせてかつ日本語入力もまともにできる環境はない。</p>
<p>色々と天秤にかけてみたけど、MacOS の「ターミナル.app」の「タブ機能」をどのくらい使うか考えたところ、結局「ウィンドウ」に分けて使うことの方が多いので、別にソフト側がタブ機能を持たなくても良い気がしてきた。</p>
<p>そもそも GitBash なら本体付属でポータブルだし、ConEmu や Cmder のような別ソフトをさらにいれる手間は省ける。日本語の文字が汚いのが難点だが、Windows VSCode のターミナルだとマシだから、より使用頻度の少ないターミナル本体は GitBash で良いかな、と思うことにした。</p>
<h2 id="minttyrc-を本腰入れて直しておく"><a class="header-link" href="#minttyrc-を本腰入れて直しておく"><span class="header-link-mark"></span></a><code>.minttyrc</code> を本腰入れて直しておく</h2>
<p>つーわけで、<code>tmux</code> を使うために ConEmu と Cmder を捨て、Git SDK に統一することにした。</p>
<ul>
  <li><a href="/blog/2018/10/11-02.html">Git For Windows よりコマンドが豊富な Git For Windows SDK を試してみる</a></li>
</ul>
<p>ついでに <code>.minttyrc</code> をイジって、MacOS ターミナルの「Homebrew」カラーをもう少しドギツくしたカラーリングにしてみた。フォントは Consolas を使うと日本語もまぁまぁ見られる。</p>
<pre class="language-bash"><code class="language-bash"><span class="token comment"># ================================================================================</span>
<span class="token comment"># .minttyrc</span>
<span class="token comment"># ================================================================================</span>

Charset  <span class="token operator">=</span> UTF-8
Language <span class="token operator">=</span> ja
Locale   <span class="token operator">=</span> ja_JP

Columns  <span class="token operator">=</span> <span class="token number">120</span>
Rows     <span class="token operator">=</span> <span class="token number">25</span>

Font          <span class="token operator">=</span> Consolas
FontHeight    <span class="token operator">=</span> <span class="token number">11</span>
FontWeight    <span class="token operator">=</span> <span class="token number">700</span>
FontIsBold    <span class="token operator">=</span> <span class="token function">yes</span>
FontSmoothing <span class="token operator">=</span> full
BoldAsColour  <span class="token operator">=</span> <span class="token function">yes</span>
BoldAsFont    <span class="token operator">=</span> <span class="token function">yes</span>

AllowBlinking     <span class="token operator">=</span> <span class="token function">yes</span>
CursorType        <span class="token operator">=</span> block
OpaqueWhenFocused <span class="token operator">=</span> <span class="token function">yes</span>
Term              <span class="token operator">=</span> xterm-256color
ThemeFile         <span class="token operator">=</span>

ForegroundColour <span class="token operator">=</span> <span class="token number">240,240</span>,240
BackgroundColour <span class="token operator">=</span>   <span class="token number">0</span>,  <span class="token number">0</span>,  <span class="token number">0</span>
CursorColour     <span class="token operator">=</span> <span class="token number">240,240</span>,240
Black            <span class="token operator">=</span> <span class="token number">100,100</span>,100
BoldBlack        <span class="token operator">=</span> <span class="token number">100,100</span>,100
Red              <span class="token operator">=</span> <span class="token number">240</span>,  <span class="token number">0</span>,  <span class="token number">0</span>
BoldRed          <span class="token operator">=</span> <span class="token number">240</span>,  <span class="token number">0</span>,  <span class="token number">0</span>
Green            <span class="token operator">=</span>   <span class="token number">0,220</span>,  <span class="token number">0</span>
BoldGreen        <span class="token operator">=</span>   <span class="token number">0,220</span>,  <span class="token number">0</span>
Yellow           <span class="token operator">=</span> <span class="token number">255,255</span>,  <span class="token number">0</span>
BoldYellow       <span class="token operator">=</span> <span class="token number">255,255</span>,  <span class="token number">0</span>
Blue             <span class="token operator">=</span>   <span class="token number">0,140</span>,255
BoldBlue         <span class="token operator">=</span>   <span class="token number">0,140</span>,255
Magenta          <span class="token operator">=</span> <span class="token number">255</span>,  <span class="token number">0,240</span>
BoldMagenta      <span class="token operator">=</span> <span class="token number">255</span>,  <span class="token number">0,240</span>
Cyan             <span class="token operator">=</span>   <span class="token number">0,240</span>,240
BoldCyan         <span class="token operator">=</span>   <span class="token number">0,240</span>,240
White            <span class="token operator">=</span> <span class="token number">255,255</span>,255
BoldWhite        <span class="token operator">=</span> <span class="token number">255,255</span>,255
</code></pre>
<ul>
  <li><a href="https://github.com/Neos21/dotfiles/blob/master/Windows/.minttyrc">dotfiles/.minttyrc at master · Neos21/dotfiles · GitHub</a></li>
</ul>
<p>
  <img src="23-03-01.png" alt="GitBash がちょうどいい">
</p>
<p>以上！</p>

      </main>
      <footer id="footer">
        <div id="footer-contents">
          <div id="date-time">
            <dl>
              <dt>Created</dt>
              <dd><time>2019-09-23</time></dd>
              <dt>Last-Modified</dt>
              <dd><time>2019-09-23</time></dd>
            </dl>
          </div>
          <nav id="footer-links">
            <ul>
              <li id="footer-link-about"><a href="/about/index.html" title="About">About</a></li>
              <li id="footer-link-search"><a href="/about/search.html" title="Search">Search</a></li>
              <li id="footer-link-feeds"><a href="/feeds.xml" title="Feeds">Feeds</a></li>
              <li id="footer-link-github"><a href="https://github.com/Neos21/" title="GitHub">GitHub</a></li>
            </ul>
          </nav>
          <nav id="to-top"><a href="#" title="To Top"><span>▲ To Top</span></a></nav>
        </div>
      </footer>
    </div>
  </body>
</html>
