<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="theme-color" content="#0990d0">
    <!-- Google Search Console -->
    <meta name="google-site-verification" content="AvoEr3mUJFF2H_mPWWgShfmjBVP3ywRpyx9hxeeq2d4">
    <title>Windows・Chrome で游ゴシックフォントを少しだけ太く見せる JavaScript と CSS - Neo's World</title>
    <link rel="icon" href="/favicon.ico">
    <link rel="stylesheet" href="/styles.css">
    <link rel="canonical" href="https://neos21.net/blog/2019/01/27-01.html">
    <link rel="search" type="application/opensearchdescription+xml" title="neos21.net" href="/opensearch.xml">
    <link rel="alternate" type="application/atom+xml" title="Feeds" href="/feeds.xml">
    <link rel="author" href="http://www.hatena.ne.jp/neos21/">
    <script src="/scripts.js"></script>
    <!-- Global Site Tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YMHFLZP1M1"></script>
    <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date());gtag('config','G-YMHFLZP1M1');gtag('config','UA-106501-1');</script>
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6475907504235292" crossorigin="anonymous"></script>
  </head>
  <body>
    <div id="container">
      <header id="header">
        <div id="header-brand">
          <div id="header-brand-contents">
            <div id="site-title"><a href="/index.html">Neo's World</a></div>
            <nav id="header-links">
              <ul>
                <li id="header-link-theme"><a href="#" title="Toggle Theme"><span>Toggle Theme</span></a></li>
                <li id="header-link-about"><a href="/about/index.html" title="About"><span>About</span></a></li>
                <li id="header-link-search"><a href="/about/search.html" title="Search"><span>Search</span></a></li>
                <li id="header-link-feeds"><a href="/feeds.xml" title="Feeds"><span>Feeds</span></a></li>
                <li id="header-link-to-bottom"><a href="#footer" title="To Bottom"><span>▼ To Bottom</span></a></li>
              </ul>
            </nav>
          </div>
        </div>
        <nav id="global-nav">
          <ul>
            <li><a href="/blog/index.html">Blog</a></li>
            <li><a href="/tech/index.html">Tech</a></li>
            <li><a href="/music/index.html">Music</a></li>
            <li><a href="/games/index.html">Games</a></li>
            <li><a href="/gallery/index.html">Gallery</a></li>
            <li><a href="/etc/index.html">Etc.</a></li>
          </ul>
        </nav>
        <nav id="path">
          <ul>
            <li><a href="/index.html">Neo's World</a></li>
            <li><a href="/blog/index.html">Blog</a></li>
            <li><a href="/blog/2019/index.html">2019年</a></li>
            <li><a href="/blog/2019/01/index.html">01月</a></li>
          </ul>
        </nav>
      </header>
      <main id="main">
        <div id="header-date"><time>2019-01-27</time></div>
        <h1 id="page-title">Windows・Chrome で游ゴシックフォントを少しだけ太く見せる JavaScript と CSS</h1>

<p>以前、「<a href="/blog/2019/01/05-02.html">ウェブサイトに適用する游ゴシックフォントを見直しまくった最終解</a>」という記事を書いた。</p>
<p>おかげさまで、はてブで77ブクマ (本稿執筆時点) いただき、皆様もこの件について苦労なさっていることが伺い知れた。</p>
<p>今回はこの続報。<strong>Windows・Chrome 環境で、游ゴシックフォントが適用されている場合のみ、フォントを少しだけ太く表示させる JavaScript と CSS</strong> を作ったので紹介する。開発者が自分のサイトに組み込んで調整いただけるだろう。</p>
<h2 id="目次"><a class="header-link" href="#目次"><span class="header-link-mark"></span></a>目次</h2>
<ul>
  <li><a href="#%E5%89%8D%E5%9B%9E%E3%81%AE%E3%81%8A%E3%81%95%E3%82%89%E3%81%84">前回のおさらい</a>
    <ul>
      <li><a href="#%E5%95%8F%E9%A1%8C%E3%81%AE%E6%A6%82%E8%A6%81">問題の概要</a></li>
      <li><a href="#%E3%82%A6%E3%82%A7%E3%83%96%E3%82%B5%E3%82%A4%E3%83%88%E9%96%8B%E7%99%BA%E8%80%85%E3%81%8C%E3%81%A7%E3%81%8D%E3%82%8B%E5%AF%BE%E5%87%A6%E6%B3%95">ウェブサイト開発者ができる対処法</a></li>
      <li><a href="#%E3%82%AF%E3%83%A9%E3%82%A4%E3%82%A2%E3%83%B3%E3%83%88%E3%82%B5%E3%82%A4%E3%83%89%E3%81%A7%E3%81%A7%E3%81%8D%E3%82%8B%E5%AF%BE%E5%87%A6%E6%B3%95">クライアントサイドでできる対処法</a></li>
    </ul>
  </li>
  <li><a href="#text-shadow-%E3%81%A7%E3%81%AF%E3%81%AA%E3%81%8F--webkit-text-stroke-width-%E3%82%92%E4%BD%BF%E3%81%86"><code>text-shadow</code> ではなく <code>-webkit-text-stroke-width</code> を使う</a></li>
  <li><a href="#windowgetcomputedstyle-%E3%81%A7%E3%81%AF%E4%BD%BF%E3%82%8F%E3%82%8C%E3%81%A6%E3%81%84%E3%82%8B%E3%83%95%E3%82%A9%E3%83%B3%E3%83%88%E3%81%8C%E5%88%86%E3%81%8B%E3%82%89%E3%81%AA%E3%81%84"><code>window.getComputedStyle()</code> では使われているフォントが分からない</a></li>
  <li><a href="#canvas-%E8%A6%81%E7%B4%A0%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%83%95%E3%82%A9%E3%83%B3%E3%83%88%E3%83%AC%E3%83%B3%E3%83%80%E3%83%AA%E3%83%B3%E3%82%B0%E3%82%92%E3%83%81%E3%82%A7%E3%83%83%E3%82%AF%E3%81%99%E3%82%8B"><code>canvas</code> 要素を使ってフォントレンダリングをチェックする</a></li>
  <li><a href="#ua-%E3%81%8B%E3%82%89-os-%E3%81%A8%E3%83%96%E3%83%A9%E3%82%A6%E3%82%B6%E3%82%92%E5%88%A4%E5%AE%9A%E3%81%99%E3%82%8B">UA から OS とブラウザを判定する</a></li>
  <li><a href="#windowschrome%E6%B8%B8%E3%82%B4%E3%82%B7%E3%83%83%E3%82%AF%E9%81%A9%E7%94%A8%E6%B8%88%E3%81%AE%E5%A0%B4%E5%90%88%E3%81%AE%E3%81%BF%E3%83%95%E3%82%A9%E3%83%B3%E3%83%88%E3%82%92%E5%B0%91%E3%81%97%E5%A4%AA%E3%81%8F%E3%81%99%E3%82%8B%E3%82%B3%E3%83%BC%E3%83%89">Windows・Chrome・游ゴシック適用済の場合のみ、フォントを少し太くするコード</a></li>
  <li><a href="#%E4%BB%A5%E4%B8%8A">以上</a></li>
</ul>
<h2 id="前回のおさらい"><a class="header-link" href="#前回のおさらい"><span class="header-link-mark"></span></a>前回のおさらい</h2>
<p>「Windows の游ゴシックフォントが細くて見づらい問題」の概要と、前回の記事で紹介した対処法をおさらいする。</p>
<h3 id="問題の概要"><a class="header-link" href="#問題の概要"><span class="header-link-mark"></span></a>問題の概要</h3>
<ul>
  <li>「游ゴシック」フォントは Windows と Mac にプリインストールされており、OS 間で表示差異がなくせるのでは、と期待されたが、上手くいっていない。</li>
  <li>MacOS にインストールされている「游ゴシック体」は、「Medium」ウェイトが一番細いフォントなので、特に調整する必要はない。</li>
  <li>Windows には、「Medium」より細い「Light」「Regular」というフォントが搭載されており、標準では「Regular」が適用されてしまう。OS のガンマ補正の違いもあり、コレが<strong>細く、かすれて見づらい。</strong></li>
  <li>Windows で「Regular」ウェイトではなく「Medium」ウェイトの游ゴシックを使わせたいのだが、そのための CSS 指定が大変。</li>
</ul>
<h3 id="ウェブサイト開発者ができる対処法"><a class="header-link" href="#ウェブサイト開発者ができる対処法"><span class="header-link-mark"></span></a>ウェブサイト開発者ができる対処法</h3>
<ul>
  <li><em><code>font-family</code> に <code>"游ゴシック Medium", "Yu Gothic Medium"</code></em> とウェイト込みで指定する (<code>@font-face</code> を使う手法も込み)
    <ul>
      <li><strong>最近の Windows Chrome ではウェイト込みで記述すると無効になってしまう。</strong></li>
      <li>他のブラウザでは Medium ウェイトになるのだが、<code>font-weight: bold</code> 指定している要素に対して「游ゴシック Bold」が適用されず、「游ゴシック Medium」を太くレンダリングして表示されるので、少々違和感がある。</li>
    </ul>
  </li>
  <li><code>font-family: "游ゴシック", "Yu Gothic"</code> と同時に <strong><code>font-weight: 500</code></strong> と指定する
    <ul>
      <li>Windows のどのブラウザでも、「游ゴシック Medium」が適用されるので、一見すると問題が解決したように見える。</li>
      <li>もし游ゴシックが適用されないユーザ環境で、「ヒラギノ角ゴ」が適用されてしまうと、<em><code>font-weight: 500</code> 指定のせいで太字のヒラギノ角ゴで表示</em>されてしまう。コレによって Mac ユーザが困る事態がわりかしあるので、使いづらい。</li>
    </ul>
  </li>
  <li>次の CSS で、フォントを少し太めに表示する
    <ul>
      <li>Chrome であることの判定は CSS ハックでできるが、OS 判定をしていないので、Mac Chrome でも太く見えてしまう。また、<code>text-shadow</code> で黒色のシャドウをかぶせているため、<strong>黒以外の文字色に適用すると色が若干くすんで見える。</strong></li>
    </ul>
  </li>
</ul>
<pre class="language-css"><code class="language-css"><span class="token comment">/* Chrome でのみフォントを太めに表示する */</span>
<span class="token atrule"><span class="token rule">@media</span> screen <span class="token keyword">and</span> <span class="token punctuation">(</span><span class="token property">-webkit-min-device-pixel-ratio</span><span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">)</span></span> <span class="token punctuation">{</span>
  <span class="token selector">*</span> <span class="token punctuation">{</span>
    <span class="token property">text-shadow</span><span class="token punctuation">:</span> <span class="token color">transparent</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token color"><span class="token function">rgba</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">.7</span><span class="token punctuation">)</span></span> <span class="token number">0</span> <span class="token number">0</span> <span class="token number">0</span> <span class="token important">!important</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
  <li><strong>游ゴシック Medium を使うことを諦める</strong>
    <ul>
      <li>自分のサイトはこの方針にした。単に <code>font-family: "Yu Gothic"</code> とだけ指定しており、「游ゴシック Regular」が使われることを諦めた。</li>
    </ul>
  </li>
</ul>
<h3 id="クライアントサイドでできる対処法"><a class="header-link" href="#クライアントサイドでできる対処法"><span class="header-link-mark"></span></a>クライアントサイドでできる対処法</h3>
<ul>
  <li>Chrome 拡張機能の「<a href="https://chrome.google.com/webstore/detail/font-rendering-enhancer/hmbmmdjlcdediglgfcdkhinjdelkiock?hl=ja">Chrome Font Rendering Enhancer</a>」をインストールする
    <ul>
      <li>前述の <code>text-shadow</code> を追加するモノ。OS 判定をしないこと、黒以外の文字色に対して使うと汚く見える点は同じ。</li>
      <li>自分は「<a href="https://chrome.google.com/webstore/detail/stylish-custom-themes-for/fjnbnpbmkenffdnngjfgmeleoegfcffe?hl=ja">Stylish</a>」拡張機能でこの指定を入れるようにして使っていた</li>
    </ul>
  </li>
  <li><strong>レジストリをイジって Regular・Light ウェイトのフォントを Medium フォントに置換する</strong>
    <ul>
      <li>「游ゴシック Regular」というフォント名が利用するフォントファイルを、「游ゴシック Medium」のフォントファイルに差し替えてしまう、というモノ。やり方は前回の記事で詳しく紹介しているのでドウゾ。</li>
      <li>クライアント OS 全体で「游ゴシック Regular」「游ゴシック Light」フォントが実質存在しなくなり、全てが「游ゴシック Medium」ウェイトで見えるようになるので、効果はてきめんだが、ユーザが自分の環境を調整する必要がある。</li>
    </ul>
  </li>
  <li>「MacType」というフリーソフトを使う
    <ul>
      <li><strong>Chrome には効かない。</strong></li>
      <li>参考 : <a href="https://github.com/snowie2000/mactype/wiki/Google-Chrome">Google Chrome · snowie2000/mactype Wiki · GitHub</a></li>
      <li>参考 : <a href="https://github.com/snowie2000/mactype/wiki/DirectWrite">DirectWrite · snowie2000/mactype Wiki · GitHub</a></li>
      <li>参考 : <a href="https://uwagakisimasuka.blog.fc2.com/blog-entry-4781.html">Chrome で MacType を効かせる MacTypePatch がすごい のこと - ウィンドウズをカスタマイズしたりゲームコントローラーを改造したまとめ</a></li>
    </ul>
  </li>
</ul>
<hr>
<p>おさらいココまで。</p>
<h2 id="text-shadow-ではなく--webkit-text-stroke-width-を使う"><a class="header-link" href="#text-shadow-ではなく--webkit-text-stroke-width-を使う"><span class="header-link-mark"></span></a><code>text-shadow</code> ではなく <code>-webkit-text-stroke-width</code> を使う</h2>
<p>途中で紹介した <code>text-shadow</code> による太字化は、若干レンダリング結果が汚く見えてしまう。</p>
<p>そこで調べていると、<strong><code>-webkit-text-stroke-width</code></strong> という、WebKit 向けのプロパティを使うテクニックを見つけた。</p>
<pre class="language-css"><code class="language-css"><span class="token selector">body</span> <span class="token punctuation">{</span>
  <span class="token property">-webkit-text-stroke-width</span><span class="token punctuation">:</span> <span class="token number">.4</span><span class="token unit">px</span> <span class="token important">!important</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p><em>コレがなかなかキレイに見える</em>。要素に指定した <code>color</code> を利用して上手く縁取りしてくれるので、<code>text-shadow</code> のように文字色が濁ったりはしない。<strong>クライアントサイドの拡張機能で <code>text-shadow</code> 指定を使っていた人は、よりキレイに見える <code>-webkit-text-stroke-width</code> 指定に切り替えることをオススメする。</strong></p>
<p><code>.4px</code> (= <code>0.4px</code>) 部分の指定を少しだけ増やせば、もう少し太く見えるが、やりすぎは禁物。</p>
<ul>
  <li>参考 : <a href="http://kachua.hatenablog.com/entry/2018/10/07/202006">2018/10/07 Google Chrome＋MacTypeで綺麗に表示させたい - カチュア はてなBLOG</a></li>
</ul>
<p><code>text-shadow</code> 指定とどのくらい違いがあるのかは、以下のデモページで確認できるだろう。</p>
<ul>
  <li><a href="https://neos21.github.io/poc-perfect-yu-gothic/testing-05.html">Perfect Yu Gothic - Testing 05</a></li>
</ul>
<p>ついでに、各ブラウザで <code>text-shadow</code> 指定と <code>-webkit-text-stroke-width</code> 指定とを比較してみた。<code>text-shadow</code> 指定はギザギザしがちなのに対して、<code>-webkit-text-stroke-width</code> はもう少しなめらかに表示される。</p>
<ul>
  <li><strong>Chrome</strong> : デフォルト表示が他のブラウザと比べてもより細く見えていることが分かるだろう
    <ul>
      <li>
        <img src="27-01-04.png" alt="Chrome は細め">
      </li>
    </ul>
  </li>
  <li><strong>Firefox</strong> : <code>text-shadow</code> の、色付きの文字が特に滲んで見える
    <ul>
      <li>
        <img src="27-01-03.png" alt="Firefox は text-shadow がにじむ">
      </li>
    </ul>
  </li>
  <li><strong>Edge</strong> : WebKit 系ではないのだが <code>-webkit-stroke-width</code> 指定が効く
    <ul>
      <li>
        <img src="27-01-02.png" alt="なぜか WebKit 向けのオプションが効く">
      </li>
    </ul>
  </li>
  <li><strong>IE</strong> : <code>-webkit-stroke-width</code> 指定が効かないので、デフォルト表示と同じ
    <ul>
      <li>
        <img src="27-01-01.png" alt="新しいことはできない">
      </li>
    </ul>
  </li>
</ul>
<p>このとおり、<code>-webkit-text-stroke-width</code> はなかなか太く・キレイに見えるのだが、このような指定をしなくても普通に見えている Firefox や、なぜか <code>-webkit</code> なプロパティを認識できる Edge でも有効になってしまう他、游ゴシックフォント以外に適用すると今度は太すぎて文字が潰れて見えてしまう。</p>
<p>ということは、この CSS を適用する OS・ブラウザを特定し、さらに「<strong>実際に游ゴシックフォントでレンダリングされているのかどうか</strong>」を調べてからでないと、<code>-webkit-text-stroke-width</code> を指定して良いかどうか、判断できないということだ。</p>
<h2 id="windowgetcomputedstyle-では使われているフォントが分からない"><a class="header-link" href="#windowgetcomputedstyle-では使われているフォントが分からない"><span class="header-link-mark"></span></a><code>window.getComputedStyle()</code> では使われているフォントが分からない</h2>
<p>OS・ブラウザ判定は、<code>navigator.userAgent</code> の文字列を見ていけば分かりそうだが、実際に使われているフォント名を知るのは、一筋縄では行かない。</p>
<p>以前紹介したが、DOM 要素に実際に指定されているスタイル定義を取得できる、<code>window.getComputedStyle()</code> という API がある。しかし、<em><code>font-family</code> については、この API を使っても正確な情報が分からない</em>のだ。</p>
<ul>
  <li><a href="/blog/2017/08/08-04.html">window.getComputedStyle を今更知った</a></li>
</ul>
<p>どういうことか確認できるサンプルを用意した。</p>
<ul>
  <li><a href="https://neos21.github.io/frontend-sandboxes/detect-actual-font-family/index.html">Detect Actual Font Family</a></li>
</ul>
<p>上のデモページの「チェック 1」ボタンを押下すると、<code>window.getComputedStyle()</code> を使って、ある要素の <code>font-family</code> 値を取得する。対象の要素の CSS は、<code>font-family: "デタラメゴシック", "游ゴシック";</code> と指定されており、<strong><code>window.getComputedStyle()</code> は <code>"デタラメゴシック", "游ゴシック"</code> という文字列を取得してしまう。</strong></p>
<p>もちろん、「デタラメゴシック」なんてフォントは存在しない。それなのにこのフォント名が取得できてしまうし、「游ゴシック」という文字列も一緒に取れてしまう。それぞれのフォントが実際に使われてレンダリングされているのかどうかは、<code>window.getComputedStyle()</code> では分からないのだ。</p>
<h2 id="canvas-要素を使ってフォントレンダリングをチェックする"><a class="header-link" href="#canvas-要素を使ってフォントレンダリングをチェックする"><span class="header-link-mark"></span></a><code>canvas</code> 要素を使ってフォントレンダリングをチェックする</h2>
<p>そこで見つけたのが、<code>canvas</code> 要素にそのフォント名を使ってテキストを描画し、ピクセル単位でレンダリング状況をチェックするというコード。</p>
<ul>
  <li>参考 : <a href="https://stackoverflow.com/a/38910481">javascript - How to get the actual rendered font when it's not defined in CSS? - Stack Overflow</a></li>
</ul>
<p>少し今っぽいコードに調整したのが以下。</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token doc-comment comment">/**
 * 指定の要素に実際に適用されているフォント名を特定する
 * 
 * https://stackoverflow.com/a/38910481
 * 
 * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token operator">*</span><span class="token punctuation">}</span></span> <span class="token parameter">element</span> DOM 要素
 * <span class="token keyword">@return</span> <span class="token class-name"><span class="token punctuation">{</span>string<span class="token punctuation">}</span></span> フォント名
 */</span>
<span class="token keyword">function</span> <span class="token function">detectFontName</span><span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// スタイル未指定時のブラウザデフォルトフォント名を取得する</span>
  <span class="token keyword">const</span> <span class="token function-variable function">detectDefaultFonts</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> iframe <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span><span class="token string">'iframe'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">.</span><span class="token method function property-access">appendChild</span><span class="token punctuation">(</span>iframe<span class="token punctuation">)</span><span class="token punctuation">;</span>
    iframe<span class="token punctuation">.</span><span class="token property-access">contentWindow</span><span class="token punctuation">.</span><span class="token property-access">document</span><span class="token punctuation">.</span><span class="token method function property-access">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    iframe<span class="token punctuation">.</span><span class="token property-access">contentWindow</span><span class="token punctuation">.</span><span class="token property-access">document</span><span class="token punctuation">.</span><span class="token method function property-access">write</span><span class="token punctuation">(</span><span class="token string">'&#x3C;html>&#x3C;body>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> subElement <span class="token operator">=</span> iframe<span class="token punctuation">.</span><span class="token property-access">contentWindow</span><span class="token punctuation">.</span><span class="token property-access">document</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span>element<span class="token punctuation">.</span><span class="token property-access">tagName</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    iframe<span class="token punctuation">.</span><span class="token property-access">contentWindow</span><span class="token punctuation">.</span><span class="token property-access">document</span><span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">.</span><span class="token method function property-access">appendChild</span><span class="token punctuation">(</span>subElement<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> defaultFonts <span class="token operator">=</span> <span class="token function">getComputedStyle</span><span class="token punctuation">(</span>subElement<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'font-family'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">.</span><span class="token method function property-access">removeChild</span><span class="token punctuation">(</span>iframe<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> defaultFonts<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  
  <span class="token keyword">const</span> fonts <span class="token operator">=</span> <span class="token function">getComputedStyle</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'font-family'</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">','</span> <span class="token operator">+</span> <span class="token function">detectDefaultFonts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> fontsArray <span class="token operator">=</span> fonts<span class="token punctuation">.</span><span class="token method function property-access">split</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> canvas <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span><span class="token string">'canvas'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> context <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token method function property-access">getContext</span><span class="token punctuation">(</span><span class="token string">"2d"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> testString <span class="token operator">=</span> <span class="token string">"abcdefghijklmnopqrstuvwxyz!@#$%^&#x26;*()ñ"</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> prevImageData<span class="token punctuation">;</span>
  <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">.</span><span class="token method function property-access">appendChild</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span><span class="token property-access">width</span> <span class="token operator">=</span> <span class="token number">500</span><span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span><span class="token property-access">height</span> <span class="token operator">=</span> <span class="token number">300</span><span class="token punctuation">;</span>
  fontsArray<span class="token punctuation">.</span><span class="token method function property-access">unshift</span><span class="token punctuation">(</span><span class="token string">'"Font That Doesnt Exists '</span> <span class="token operator">+</span> <span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'"'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword control-flow">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&#x3C;</span> fontsArray<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> fontName <span class="token operator">=</span> fontsArray<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token method function property-access">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    context<span class="token punctuation">.</span><span class="token method function property-access">clearRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span><span class="token property-access">width</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span><span class="token property-access">height</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    context<span class="token punctuation">.</span><span class="token property-access">font</span> <span class="token operator">=</span> <span class="token string">'16px '</span> <span class="token operator">+</span> fontName <span class="token operator">+</span> <span class="token string">', monospace'</span><span class="token punctuation">;</span>
    context<span class="token punctuation">.</span><span class="token method function property-access">fillText</span><span class="token punctuation">(</span>testString<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> imageData <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token method function property-access">getImageData</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span><span class="token property-access">width</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span><span class="token property-access">height</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> data <span class="token operator">=</span> imageData<span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">if</span><span class="token punctuation">(</span>prevImageData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&#x3C;</span> data<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">;</span> j <span class="token operator">+=</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">if</span><span class="token punctuation">(</span>prevImageData<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">!==</span> data<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">.</span><span class="token method function property-access">removeChild</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword control-flow">return</span> fontName<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    prevImageData <span class="token operator">=</span> data<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">.</span><span class="token method function property-access">removeChild</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token string">'monospace'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>使い方は以下のとおり。</p>
<pre class="language-css"><code class="language-css"><span class="token comment">/* こんな CSS 指定があったとして */</span>
<span class="token selector"><span class="token class">.example</span></span> <span class="token punctuation">{</span>
  <span class="token property">font-family</span><span class="token punctuation">:</span> <span class="token string">"デタラメゴシック"</span><span class="token punctuation">,</span> <span class="token string">"游ゴシック"</span><span class="token punctuation">,</span> sans-serif<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<pre class="language-html"><code class="language-html"><span class="token comment">&#x3C;!-- こんな要素が配置されていたとして --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>example<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>テキストテキスト<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>div</span><span class="token punctuation">></span></span>
</code></pre>
<pre class="language-javascript"><code class="language-javascript"><span class="token comment">// 前述の関数を以下のように呼び出す</span>
<span class="token keyword">const</span> targetElement <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span><span class="token string">'.example'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> actualFontName <span class="token operator">=</span> <span class="token function">detectFontName</span><span class="token punctuation">(</span>targetElement<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// → '游ゴシック' と取得できる</span>
</code></pre>
<p>このように、「デタラメゴシック」という指定は効いていないので無効、次の「游ゴシック」という指定はちゃんとフォントが変わって適用されているので、このフォントが有効だろう、と上手く判断できている。</p>
<p>このコードも完璧ではなく、対象の要素の CSS 指定によっては、<code>sans-serif</code> など総称ファミリが返ってくる場合もあるし、完璧ではないのだが、「<em>実際に游ゴシックでレンダリングされているか否か</em>」を判断するシチュエーションに限れば、今のところ特に問題はない。</p>
<p>コードを見て分かるとおり、<code>canvas</code> 要素や <code>iframe</code> 要素を埋め込んで各種判定をするので、DOM を一時的に汚す点はご容赦。</p>
<h2 id="ua-から-os-とブラウザを判定する"><a class="header-link" href="#ua-から-os-とブラウザを判定する"><span class="header-link-mark"></span></a>UA から OS とブラウザを判定する</h2>
<p>さて、実際に游ゴシックでレンダリングされているのかどうかは、以上の方法で調べられそうだ。あとは OS とブラウザ判定である。</p>
<p>お手軽なのは <a href="https://github.com/faisalman/ua-parser-js">ua-parser-js</a> などの npm パッケージを使う方法だが、<code>navigator.userAgent</code> から取得した文字列から <code>String.prototype.match()</code> で判定するだけでも十分だ。</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">function</span> <span class="token function">bolderYuGothicOnWindowsChrome</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// User-Agent 文字列を取得する</span>
  <span class="token keyword">const</span> ua <span class="token operator">=</span> <span class="token dom variable">navigator</span><span class="token punctuation">.</span><span class="token property-access">userAgent</span><span class="token punctuation">;</span>
  
  <span class="token comment">// Windows かどうかの判定</span>
  <span class="token keyword">const</span> isWindows  <span class="token operator">=</span> ua<span class="token punctuation">.</span><span class="token method function property-access">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">Windows</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// Chrome ブラウザかどうかの判定</span>
  <span class="token keyword">const</span> isChrome   <span class="token operator">=</span> ua<span class="token punctuation">.</span><span class="token method function property-access">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">Chrome</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span> <span class="token operator">&#x26;&#x26;</span> <span class="token operator">!</span>ua<span class="token punctuation">.</span><span class="token method function property-access">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">Edge</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 前述の関数を使って、body 要素に「Yu Gothic」か「游ゴシック」(いずれも Windows 向けの游ゴシックフォント名) が適用されているか判定する</span>
  <span class="token keyword">const</span> fontName <span class="token operator">=</span> <span class="token function">detectFontName</span><span class="token punctuation">(</span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> isYuGothic <span class="token operator">=</span> fontName<span class="token punctuation">.</span><span class="token method function property-access">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">Yu Gothic</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span> <span class="token operator">||</span> fontName<span class="token punctuation">.</span><span class="token method function property-access">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">游ゴシック</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// Windows・Chrome ブラウザで游ゴシックフォントが使われていれば、文字を太くする</span>
  <span class="token keyword control-flow">if</span><span class="token punctuation">(</span>isWindows <span class="token operator">&#x26;&#x26;</span> isChrome <span class="token operator">&#x26;&#x26;</span> isYuGothic<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 文字を太くするためのコード…</span>
  <span class="token punctuation">}</span>
</code></pre>
<p>Chrome ブラウザかどうかの判定がちょっと変わっているところ。実は、Edge のユーザエージェント文字列は、次のようになっている。</p>
<pre><code>Mozilla/5.0 (Windows NT 10.0; Win64; x64; ServiceUI 13.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/64.0.3282.140 Safari/537.36 Edge/17.17134
</code></pre>
<p>なんと、Edge ブラウザの UA なのに、<em><code>AppleWebKit</code> やら <code>Chrome</code> やら <code>Safari</code> やら</em>という文言が登場する。コレは、WebKit 系のブラウザと互換性を持たせるための策らしいが、なんとも鬱陶しい。</p>
<ul>
  <li>参考 : <a href="https://qiita.com/tonkotsuboy_com/items/7b36bdfc3a9a0970d23b">Microsoft Edgeのユーザーエージェントがカオスなので注意 - Qiita</a></li>
  <li>参考 : <a href="https://qiita.com/Tzalik/items/980316d11c55acecbfa5">Edge のユーザーエージェントがいろいろとひどい - Qiita</a></li>
</ul>
<p>とりあえず、コレで、クライアント環境を「Windows かつ Chrome ブラウザかつ、指定の要素に游ゴシックフォントが適用されていること」という条件で絞り込むことができた。</p>
<h2 id="windowschrome游ゴシック適用済の場合のみフォントを少し太くするコード"><a class="header-link" href="#windowschrome游ゴシック適用済の場合のみフォントを少し太くするコード"><span class="header-link-mark"></span></a>Windows・Chrome・游ゴシック適用済の場合のみ、フォントを少し太くするコード</h2>
<p>ということで、次のコードを突っ込めば、<strong>Windows Chrome で游ゴシックフォントが使われている時のみ、<code>-webkit-text-stroke-width</code> プロパティを利用して文字を少し太く表示する</strong>ことができるようになる。</p>
<ul>
  <li>CSS は次のような要領で設定しておく</li>
</ul>
<pre class="language-css"><code class="language-css"><span class="token comment">/* ページ全体には游ゴシックを指定しておく */</span>
<span class="token selector">body</span> <span class="token punctuation">{</span>
  <span class="token property">font-family</span><span class="token punctuation">:</span> YuGothic<span class="token punctuation">,</span> <span class="token string">"游ゴシック体"</span><span class="token punctuation">,</span> <span class="token string">"Yu Gothic"</span><span class="token punctuation">,</span> <span class="token string">"游ゴシック"</span><span class="token punctuation">,</span> sans-serif<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/* 等幅フォント指定など… */</span>
<span class="token selector">code<span class="token punctuation">,</span> kbd<span class="token punctuation">,</span> samp<span class="token punctuation">,</span> var<span class="token punctuation">,</span> pre<span class="token punctuation">,</span> textarea</span> <span class="token punctuation">{</span>
  <span class="token property">font-family</span><span class="token punctuation">:</span> MeiryoKe_Gothic<span class="token punctuation">,</span> <span class="token string">"Ricty Diminished"</span><span class="token punctuation">,</span> Osaka-mono<span class="token punctuation">,</span> <span class="token string">"MS Gothic"</span><span class="token punctuation">,</span> <span class="token string">"Courier New"</span><span class="token punctuation">,</span> monospace<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
  <li>JavaScript は次のように記述する</li>
</ul>
<pre class="language-javascript"><code class="language-javascript"><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'DOMContentLoaded'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token comment">// Windows・Chrome で游ゴシックを指定していれば太く見せる</span>
  <span class="token function">bolderYuGothicOnWindowsChrome</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token doc-comment comment">/**
 * Windows・Chrome で游ゴシックを指定している場合に
 * -webkit-text-stroke-width を指定してフォントを少し太くする
 * 
 * OS・ブラウザ・body 要素に指定しているフォントが条件に合致しなかった場合は何もしない
 */</span>
<span class="token keyword">function</span> <span class="token function">bolderYuGothicOnWindowsChrome</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> ua <span class="token operator">=</span> <span class="token dom variable">navigator</span><span class="token punctuation">.</span><span class="token property-access">userAgent</span><span class="token punctuation">;</span>
  
  <span class="token keyword">const</span> isWindows  <span class="token operator">=</span> ua<span class="token punctuation">.</span><span class="token method function property-access">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">Windows</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> isChrome   <span class="token operator">=</span> ua<span class="token punctuation">.</span><span class="token method function property-access">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">Chrome</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span> <span class="token operator">&#x26;&#x26;</span> <span class="token operator">!</span>ua<span class="token punctuation">.</span><span class="token method function property-access">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">Edge</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// Windows 環境ではないか、Chrome ブラウザでない場合は処理を中止する</span>
  <span class="token keyword control-flow">if</span><span class="token punctuation">(</span><span class="token operator">!</span>isWindows <span class="token operator">||</span> <span class="token operator">!</span>isChrome<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token keyword">const</span> fontName <span class="token operator">=</span> <span class="token function">detectFontName</span><span class="token punctuation">(</span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// body 要素に游ゴシックが適用されているかどうかで判定する</span>
  <span class="token keyword">const</span> isYuGothic <span class="token operator">=</span> fontName<span class="token punctuation">.</span><span class="token method function property-access">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">Yu Gothic</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span> <span class="token operator">||</span> fontName<span class="token punctuation">.</span><span class="token method function property-access">match</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">游ゴシック</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 游ゴシックフォントが適用されていないようであれば太字化しないで終了する</span>
  <span class="token keyword control-flow">if</span><span class="token punctuation">(</span><span class="token operator">!</span>isYuGothic<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token keyword">const</span> bolderStyle <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
    &#x3C;style id="bolder-style">
      /* 太字化する */
      body {
        -webkit-text-stroke-width: .4px;
      }
      
      /* 等幅フォントなど、游ゴシックを使わない要素には指定しない (この辺の調整はお好みで…) */
      code, kbd, samp, var, pre, textarea {
        -webkit-text-stroke-width: 0;
      }
    &#x3C;/style>
  </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
  <span class="token comment">// head 要素の末尾に style 要素を追加する</span>
  <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementsByTagName</span><span class="token punctuation">(</span><span class="token string">'head'</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token method function property-access">insertAdjacentHTML</span><span class="token punctuation">(</span><span class="token string">'beforeend'</span><span class="token punctuation">,</span> bolderStyle<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token doc-comment comment">/**
 * 指定の要素に実際に適用されているフォント名を特定する
 * 
 * https://stackoverflow.com/a/38910481
 * 
 * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token operator">*</span><span class="token punctuation">}</span></span> <span class="token parameter">element</span> DOM 要素
 * <span class="token keyword">@return</span> <span class="token class-name"><span class="token punctuation">{</span>string<span class="token punctuation">}</span></span> フォント名
 */</span>
<span class="token keyword">function</span> <span class="token function">detectFontName</span><span class="token punctuation">(</span><span class="token parameter">element</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// スタイル未指定時のブラウザデフォルトフォント名を取得する</span>
  <span class="token keyword">const</span> <span class="token function-variable function">detectDefaultFonts</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> iframe <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span><span class="token string">'iframe'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">.</span><span class="token method function property-access">appendChild</span><span class="token punctuation">(</span>iframe<span class="token punctuation">)</span><span class="token punctuation">;</span>
    iframe<span class="token punctuation">.</span><span class="token property-access">contentWindow</span><span class="token punctuation">.</span><span class="token property-access">document</span><span class="token punctuation">.</span><span class="token method function property-access">open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    iframe<span class="token punctuation">.</span><span class="token property-access">contentWindow</span><span class="token punctuation">.</span><span class="token property-access">document</span><span class="token punctuation">.</span><span class="token method function property-access">write</span><span class="token punctuation">(</span><span class="token string">'&#x3C;html>&#x3C;body>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> subElement <span class="token operator">=</span> iframe<span class="token punctuation">.</span><span class="token property-access">contentWindow</span><span class="token punctuation">.</span><span class="token property-access">document</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span>element<span class="token punctuation">.</span><span class="token property-access">tagName</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    iframe<span class="token punctuation">.</span><span class="token property-access">contentWindow</span><span class="token punctuation">.</span><span class="token property-access">document</span><span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">.</span><span class="token method function property-access">appendChild</span><span class="token punctuation">(</span>subElement<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> defaultFonts <span class="token operator">=</span> <span class="token function">getComputedStyle</span><span class="token punctuation">(</span>subElement<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'font-family'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">.</span><span class="token method function property-access">removeChild</span><span class="token punctuation">(</span>iframe<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> defaultFonts<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  
  <span class="token keyword">const</span> fonts <span class="token operator">=</span> <span class="token function">getComputedStyle</span><span class="token punctuation">(</span>element<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'font-family'</span><span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">','</span> <span class="token operator">+</span> <span class="token function">detectDefaultFonts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> fontsArray <span class="token operator">=</span> fonts<span class="token punctuation">.</span><span class="token method function property-access">split</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> canvas <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">createElement</span><span class="token punctuation">(</span><span class="token string">'canvas'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> context <span class="token operator">=</span> canvas<span class="token punctuation">.</span><span class="token method function property-access">getContext</span><span class="token punctuation">(</span><span class="token string">"2d"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> testString <span class="token operator">=</span> <span class="token string">"abcdefghijklmnopqrstuvwxyz!@#$%^&#x26;*()ñ"</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> prevImageData<span class="token punctuation">;</span>
  <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">.</span><span class="token method function property-access">appendChild</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span><span class="token property-access">width</span> <span class="token operator">=</span> <span class="token number">500</span><span class="token punctuation">;</span>
  canvas<span class="token punctuation">.</span><span class="token property-access">height</span> <span class="token operator">=</span> <span class="token number">300</span><span class="token punctuation">;</span>
  fontsArray<span class="token punctuation">.</span><span class="token method function property-access">unshift</span><span class="token punctuation">(</span><span class="token string">'"Font That Doesnt Exists '</span> <span class="token operator">+</span> <span class="token known-class-name class-name">Math</span><span class="token punctuation">.</span><span class="token method function property-access">random</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">'"'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token keyword control-flow">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&#x3C;</span> fontsArray<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> fontName <span class="token operator">=</span> fontsArray<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token method function property-access">trim</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    context<span class="token punctuation">.</span><span class="token method function property-access">clearRect</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span><span class="token property-access">width</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span><span class="token property-access">height</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    context<span class="token punctuation">.</span><span class="token property-access">font</span> <span class="token operator">=</span> <span class="token string">'16px '</span> <span class="token operator">+</span> fontName <span class="token operator">+</span> <span class="token string">', monospace'</span><span class="token punctuation">;</span>
    context<span class="token punctuation">.</span><span class="token method function property-access">fillText</span><span class="token punctuation">(</span>testString<span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> imageData <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token method function property-access">getImageData</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span><span class="token property-access">width</span><span class="token punctuation">,</span> canvas<span class="token punctuation">.</span><span class="token property-access">height</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> data <span class="token operator">=</span> imageData<span class="token punctuation">.</span><span class="token property-access">data</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">if</span><span class="token punctuation">(</span>prevImageData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&#x3C;</span> data<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">;</span> j <span class="token operator">+=</span> <span class="token number">3</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword control-flow">if</span><span class="token punctuation">(</span>prevImageData<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">!==</span> data<span class="token punctuation">[</span>j <span class="token operator">+</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">.</span><span class="token method function property-access">removeChild</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token keyword control-flow">return</span> fontName<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    prevImageData <span class="token operator">=</span> data<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  
  <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">.</span><span class="token method function property-access">removeChild</span><span class="token punctuation">(</span>canvas<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">return</span> <span class="token string">'monospace'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>実際にこのようなコードを埋め込んだサンプルを以下に作った。「有効にする」ボタンで効き目をトグルできるので、確認してほしい (Windows マシンで、Chrome ブラウザ上で確認すること)。游ゴシックフォントが使われていない <code>pre</code> 要素は、ボタンを押しても文字が太くならないことを確認できるだろう。</p>
<ul>
  <li><a href="https://neos21.github.io/poc-perfect-yu-gothic/testing-06.html">Perfect Yu Gothic - Testing 06</a></li>
</ul>
<h2 id="以上"><a class="header-link" href="#以上"><span class="header-link-mark"></span></a>以上</h2>
<p>結局、JavaScript を組み合わせないとうまいことフォントの判定ができなかったが、ココまで組み込めば、游ゴシックフォントが細く見えてしまう Windows 環境向けに、かなり良い感じの調整を効かせることはできた。</p>
<p>今回は特に細く見えてしまう Chrome ブラウザに絞ったが、UA 判定を調整すれば IE でも Edge でも Firefox でも適用することはできる。<code>-webkit-text-stroke-width</code> で指定する数値についても、お好みで太さを調整してもらえればと思う。</p>

      </main>
      <footer id="footer">
        <div id="footer-contents">
          <div id="date-time">
            <dl>
              <dt>Created</dt>
              <dd><time>2019-01-27</time></dd>
              <dt>Last-Modified</dt>
              <dd><time>2019-01-27</time></dd>
            </dl>
          </div>
          <nav id="footer-links">
            <ul>
              <li id="footer-link-about"><a href="/about/index.html" title="About">About</a></li>
              <li id="footer-link-search"><a href="/about/search.html" title="Search">Search</a></li>
              <li id="footer-link-feeds"><a href="/feeds.xml" title="Feeds">Feeds</a></li>
              <li id="footer-link-github"><a href="https://github.com/Neos21/" title="GitHub">GitHub</a></li>
            </ul>
          </nav>
          <nav id="to-top"><a href="#" title="To Top"><span>▲ To Top</span></a></nav>
        </div>
      </footer>
    </div>
  </body>
</html>
