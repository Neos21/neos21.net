<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="theme-color" content="#0990d0">
    <!-- Google Search Console -->
    <meta name="google-site-verification" content="AvoEr3mUJFF2H_mPWWgShfmjBVP3ywRpyx9hxeeq2d4">
    <!-- Open Graph・Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="Neo's World">
    <meta property="og:title" content="Perl 再入門 : 配列・連想配列 (ハッシュ)・関数呼び出し・例外処理 - Neo's World">
    <meta property="og:description" content="Perl 再入門 : 配列・連想配列 (ハッシュ)・関数呼び出し・例外処理 - Neo's World">
    <meta property="og:url" content="https://neos21.net/blog/2019/01/29-01.html">
    <meta property="og:image" content="https://neos21.net/ogp.png">
    <meta property="og:locale" content="ja_JP">
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:title" content="Perl 再入門 : 配列・連想配列 (ハッシュ)・関数呼び出し・例外処理 - Neo's World">
    <meta property="twitter:description" content="Perl 再入門 : 配列・連想配列 (ハッシュ)・関数呼び出し・例外処理 - Neo's World">
    <meta property="twitter:url" content="https://neos21.net/blog/2019/01/29-01.html">
    <meta property="twitter:image" content="https://neos21.net/ogp.png">
    <title>Perl 再入門 : 配列・連想配列 (ハッシュ)・関数呼び出し・例外処理 - Neo's World</title>
    <link rel="icon" href="/favicon.ico">
    <link rel="apple-touch-icon" href="/apple-touch-icon.png">
    <link rel="manifest" href="/manifest.webmanifest">
    <link rel="stylesheet" href="/styles.css">
    <link rel="canonical" href="https://neos21.net/blog/2019/01/29-01.html">
    <link rel="search" type="application/opensearchdescription+xml" title="neos21.net" href="/opensearch.xml">
    <link rel="alternate" type="application/atom+xml" title="Feeds" href="/feeds.xml">
    <link rel="author" href="http://www.hatena.ne.jp/neos21/">
    <script src="/scripts.js"></script>
    <!-- Google Tag Manager -->
    <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-MZCGD23');</script>
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6475907504235292" crossorigin="anonymous"></script>
  </head>
  <body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-MZCGD23" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <div id="container">
      <header id="header">
        <div id="header-brand">
          <div id="header-brand-contents">
            <div id="site-title"><a href="/index.html">Neo's World</a></div>
            <nav id="header-links">
              <ul>
                <li id="header-link-theme"><a href="#" title="Toggle Theme"><span>Toggle Theme</span></a></li>
                <li id="header-link-about"><a href="/about/index.html" title="About"><span>About</span></a></li>
                <li id="header-link-search"><a href="/about/search.html" title="Search"><span>Search</span></a></li>
                <li id="header-link-feeds"><a href="/feeds.xml" title="Feeds"><span>Feeds</span></a></li>
                <li id="header-link-to-bottom"><a href="#footer" title="To Bottom"><span>▼ To Bottom</span></a></li>
              </ul>
            </nav>
          </div>
        </div>
        <nav id="global-nav">
          <ul>
            <li><a href="/blog/index.html">Blog</a></li>
            <li><a href="/tech/index.html">Tech</a></li>
            <li><a href="/music/index.html">Music</a></li>
            <li><a href="/games/index.html">Games</a></li>
            <li><a href="/gallery/index.html">Gallery</a></li>
            <li><a href="/etc/index.html">Etc.</a></li>
          </ul>
        </nav>
        <nav id="path">
          <ul>
            <li><a href="/index.html">Neo's World</a></li>
            <li><a href="/blog/index.html">Blog</a></li>
            <li><a href="/blog/2019/index.html">2019年</a></li>
            <li><a href="/blog/2019/01/index.html">01月</a></li>
          </ul>
        </nav>
      </header>
      <main id="main">
        <div id="header-date"><time>2019-01-29</time></div>
        <h1 id="page-title">Perl 再入門 : 配列・連想配列 (ハッシュ)・関数呼び出し・例外処理</h1>

<p>Perl 再入門、第2弾。</p>
<h2 id="目次"><a class="header-link" href="#目次"><span class="header-link-mark"></span></a>目次</h2>
<ul>
  <li><a href="#%E9%85%8D%E5%88%97%E3%82%92%E6%89%B1%E3%81%86">配列を扱う</a></li>
  <li><a href="#%E9%80%A3%E6%83%B3%E9%85%8D%E5%88%97-%E3%83%8F%E3%83%83%E3%82%B7%E3%83%A5-%E3%82%92%E6%89%B1%E3%81%86">連想配列 (ハッシュ) を扱う</a>
    <ul>
      <li><a href="#%E3%83%8F%E3%83%83%E3%82%B7%E3%83%A5%E3%81%8B%E3%82%89%E5%80%A4%E3%82%92%E5%8F%96%E3%82%8A%E5%87%BA%E3%81%99">ハッシュから値を取り出す</a></li>
      <li><a href="#%E9%80%A3%E6%83%B3%E9%85%8D%E5%88%97%E3%81%8B%E3%82%89%E3%82%AD%E3%83%BC%E3%82%84%E5%80%A4%E3%82%92%E5%85%A8%E9%83%A8%E5%8F%96%E3%82%8A%E5%87%BA%E3%81%99">連想配列からキーや値を全部取り出す</a></li>
      <li><a href="#%E7%92%B0%E5%A2%83%E5%A4%89%E6%95%B0%E3%82%92%E5%BC%95%E3%81%A3%E3%81%93%E6%8A%9C%E3%81%8F%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB">環境変数を引っこ抜くサンプル</a></li>
    </ul>
  </li>
  <li><a href="#%E3%82%AB%E3%83%AC%E3%83%B3%E3%83%88%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E9%85%8D%E4%B8%8B%E3%81%AE%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%90%8D%E3%82%92%E5%8F%96%E5%BE%97%E3%81%99%E3%82%8B%E3%82%B3%E3%83%BC%E3%83%89%E3%82%92%E5%85%83%E3%81%AB%E9%96%A2%E6%95%B0%E3%81%AE%E5%91%BC%E3%81%B3%E5%87%BA%E3%81%97%E6%96%B9%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6">カレントディレクトリ配下のファイル名を取得するコードを元に、関数の呼び出し方について</a></li>
  <li><a href="#%E4%BE%8B%E5%A4%96%E5%87%A6%E7%90%86">例外処理</a></li>
  <li><a href="#%E4%BB%8A%E5%9B%9E%E3%81%AF%E3%82%B3%E3%82%B3%E3%81%BE%E3%81%A7">今回はココまで</a></li>
</ul>
<h2 id="配列を扱う"><a class="header-link" href="#配列を扱う"><span class="header-link-mark"></span></a>配列を扱う</h2>
<p>Perl での配列の扱い方。</p>
<pre class="language-perl"><code class="language-perl"><span class="token comment"># 配列の定義 : 「@」で定義する</span>
<span class="token keyword">my</span> <span class="token variable">@fruits</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token string">"apple"</span><span class="token punctuation">,</span> <span class="token string">"orange"</span><span class="token punctuation">,</span> <span class="token string">"banana"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment"># 添字で指定して取り出す : 単一要素を取得する際は「$」を使う</span>
<span class="token keyword">print</span> <span class="token variable">$fruits</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token comment"># 配列の長さを取得する (JavaScript でいう array.length)</span>
<span class="token keyword">print</span> <span class="token variable">@fruits</span><span class="token punctuation">;</span>

<span class="token comment"># 配列の最終要素の添字を取得する (JavaScript でいう array.length - 1)</span>
<span class="token keyword">print</span> <span class="token variable">$#fruits</span><span class="token punctuation">;</span>

<span class="token comment"># for を使って順に表示する</span>
<span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">my</span> <span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&#x3C;</span> <span class="token variable">@fruits</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">print</span> <span class="token variable">$fruits</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment"># next; → Java でいう continue 相当</span>
<span class="token comment"># last; → Java でいう break 相当</span>

<span class="token comment"># foreach を使って順に表示する</span>
<span class="token keyword">foreach</span> <span class="token keyword">my</span> <span class="token variable">$fruit</span> <span class="token punctuation">(</span><span class="token variable">@fruits</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">print</span> <span class="token variable">$fruit</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

push<span class="token punctuation">(</span><span class="token variable">@fruits</span><span class="token punctuation">,</span> <span class="token string">"peach"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token comment"># 末尾に追加</span>
pop<span class="token punctuation">(</span><span class="token variable">@fruits</span><span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token comment"># 末尾から削除</span>
unshift<span class="token punctuation">(</span><span class="token variable">@fruits</span><span class="token punctuation">,</span> <span class="token string">"peach"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment"># 先頭に追加</span>
shift<span class="token punctuation">(</span><span class="token variable">@fruits</span><span class="token punctuation">)</span><span class="token punctuation">;</span>             <span class="token comment"># 先頭から削除</span>
</code></pre>
<p>こんな感じ。個人的についつい JavaScript との比較になってしまうが、よく似ているかなと思う。</p>
<p>特徴的なのは、<strong>配列変数の宣言時にアットマーク <code>@</code> を使う</strong>点。変数を見るだけで配列だなと分かるのはありがたい。</p>
<p><code>use strict;</code> 前提で書いているので、<code>for</code> 文における <code>$i</code>、<code>foreach</code> 文における <code>$fruit</code> の宣言時にも <code>my</code> を使用している。</p>
<h2 id="連想配列-ハッシュ-を扱う"><a class="header-link" href="#連想配列-ハッシュ-を扱う"><span class="header-link-mark"></span></a>連想配列 (ハッシュ) を扱う</h2>
<p>Perl で連想配列、いわゆるハッシュを作るには、以下のように書く。</p>
<pre class="language-perl"><code class="language-perl"><span class="token comment"># 変数定義はドル「$」ではなくパーセント「%」</span>
<span class="token keyword">my</span> <span class="token variable">%myHash</span> <span class="token operator">=</span> <span class="token punctuation">(</span>
  <span class="token string">"name"</span> <span class="token operator">=></span> <span class="token string">"my-hash"</span><span class="token punctuation">,</span>
  <span class="token string">"version"</span> <span class="token operator">=></span> <span class="token string">"0.0.0"</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment"># とりあえず全部出力する</span>
<span class="token keyword">print</span> <span class="token variable">%myHash</span><span class="token punctuation">;</span>
</code></pre>
<p>他に、無名ハッシュ <code>{}</code> というモノを使って、ハッシュへのリファレンス (参照) を作るやり方もある。</p>
<pre class="language-perl"><code class="language-perl"><span class="token comment"># 変数定義はドル「$」、つまりスカラ変数</span>
<span class="token keyword">my</span> <span class="token variable">$myRecord</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">"name"</span> <span class="token operator">=></span> <span class="token string">"my-record"</span><span class="token punctuation">,</span>
  <span class="token string">"version"</span> <span class="token operator">=></span> <span class="token string">"0.0.0"</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment"># とりあえず全部出力する (リファレンスをデリファレンスして取り出す)</span>
<span class="token keyword">print</span> <span class="token variable">%</span><span class="token punctuation">{</span><span class="token variable">$myRecord</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>リファレンスっていうのが謎い。</p>
<h3 id="ハッシュから値を取り出す"><a class="header-link" href="#ハッシュから値を取り出す"><span class="header-link-mark"></span></a>ハッシュから値を取り出す</h3>
<p>ハッシュから特定の値を取り出すには以下のように書く。</p>
<pre class="language-perl"><code class="language-perl"><span class="token comment"># ハッシュ</span>
<span class="token keyword">my</span> <span class="token variable">%myHash</span> <span class="token operator">=</span> <span class="token punctuation">(</span>
  <span class="token string">"name"</span> <span class="token operator">=></span> <span class="token string">"my-hash"</span><span class="token punctuation">,</span>
  <span class="token string">"version"</span> <span class="token operator">=></span> <span class="token string">"0.0.0"</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">print</span> <span class="token variable">$myHash</span><span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment"># ハッシュのリファレンス</span>
<span class="token keyword">my</span> <span class="token variable">$myRecord</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">"name"</span> <span class="token operator">=></span> <span class="token string">"my-record"</span><span class="token punctuation">,</span>
  <span class="token string">"version"</span> <span class="token operator">=></span> <span class="token string">"0.0.0"</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">print</span> <span class="token variable">$myRecord</span><span class="token operator">-></span><span class="token punctuation">{</span><span class="token string">'name'</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre>
<p>JavaScript の <code>myHash.name</code> とか <code>myHash['name']</code> みたいな書き方と同じ。ハッシュのリファレンスから取り出す時は <code>-></code> が必要になるのが違い。</p>
<h3 id="連想配列からキーや値を全部取り出す"><a class="header-link" href="#連想配列からキーや値を全部取り出す"><span class="header-link-mark"></span></a>連想配列からキーや値を全部取り出す</h3>
<p>Key と Value を全部取り出して順に出力したりするには、<code>each</code> 関数を使ってこんな感じに書く。</p>
<pre class="language-perl"><code class="language-perl"><span class="token comment"># ハッシュ</span>
<span class="token keyword">my</span> <span class="token variable">%myHash</span> <span class="token operator">=</span> <span class="token punctuation">(</span>
  <span class="token string">"name"</span> <span class="token operator">=></span> <span class="token string">"my-hash"</span><span class="token punctuation">,</span>
  <span class="token string">"version"</span> <span class="token operator">=></span> <span class="token string">"0.0.0"</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token keyword">my</span> <span class="token punctuation">(</span><span class="token variable">$hashKey</span><span class="token punctuation">,</span> <span class="token variable">$hashValue</span><span class="token punctuation">)</span> <span class="token operator">=</span> each <span class="token variable">%myHash</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">print</span> <span class="token variable">$hashKey</span> <span class="token operator">.</span> <span class="token string">" : "</span> <span class="token operator">.</span> <span class="token variable">$hashValue</span> <span class="token operator">.</span> <span class="token string">"\n"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment"># ハッシュのリファレンス</span>
<span class="token keyword">my</span> <span class="token variable">$myRecord</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token string">"name"</span> <span class="token operator">=></span> <span class="token string">"my-record"</span><span class="token punctuation">,</span>
  <span class="token string">"version"</span> <span class="token operator">=></span> <span class="token string">"0.0.0"</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token keyword">my</span> <span class="token punctuation">(</span><span class="token variable">$recordKey</span><span class="token punctuation">,</span> <span class="token variable">$recordValue</span><span class="token punctuation">)</span> <span class="token operator">=</span> each <span class="token variable">%</span><span class="token punctuation">{</span><span class="token variable">$myRecord</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">print</span> <span class="token variable">$recordKey</span> <span class="token operator">.</span> <span class="token string">" : "</span> <span class="token operator">.</span> <span class="token variable">$recordValue</span> <span class="token operator">.</span> <span class="token string">"\n"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>キーだけ取るなら <code>keys</code>・値だけ取るなら <code>values</code> 関数がある。</p>
<p>JavaScript の場合、連想配列の順序はわりかし保たれている印象があるが、Perl だと実行する度にコロコロと順序が変わる。</p>
<h3 id="環境変数を引っこ抜くサンプル"><a class="header-link" href="#環境変数を引っこ抜くサンプル"><span class="header-link-mark"></span></a>環境変数を引っこ抜くサンプル</h3>
<p>ハッシュの扱い方が分かってきたので、試しに環境変数のハッシュである <code>%ENV</code> の中身を画面に表形式で出力してみる。</p>
<pre class="language-perl"><code class="language-perl"><span class="token keyword">print</span> <span class="token string">"&#x3C;table border=\"1\">"</span><span class="token punctuation">;</span>
<span class="token keyword">while</span><span class="token punctuation">(</span><span class="token keyword">my</span> <span class="token punctuation">(</span><span class="token variable">$hashKey</span><span class="token punctuation">,</span> <span class="token variable">$hashValue</span><span class="token punctuation">)</span> <span class="token operator">=</span> each <span class="token variable">%ENV</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">print</span> <span class="token string">"&#x3C;tr>&#x3C;th>"</span> <span class="token operator">.</span> <span class="token variable">$hashKey</span> <span class="token operator">.</span> <span class="token string">"&#x3C;/th>&#x3C;td>"</span> <span class="token operator">.</span> <span class="token variable">$hashValue</span> <span class="token operator">.</span> <span class="token string">"&#x3C;/td>&#x3C;/tr>"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">print</span> <span class="token string">"&#x3C;/table>"</span><span class="token punctuation">;</span>
</code></pre>
<p>コレだと出力順序がコロコロ変わるので、<code>keys</code> 関数でキーを先に取得し、それを <code>sort</code> してから出力してみよう。</p>
<pre class="language-perl"><code class="language-perl"><span class="token comment"># %ENV からキーを取得し昇順にソートする</span>
<span class="token keyword">my</span> <span class="token variable">@keys</span> <span class="token operator">=</span> keys <span class="token variable">%ENV</span><span class="token punctuation">;</span>
<span class="token keyword">my</span> <span class="token variable">@keys</span> <span class="token operator">=</span> sort <span class="token punctuation">{</span> <span class="token variable">$a</span> <span class="token operator">cmp</span> <span class="token variable">$b</span> <span class="token punctuation">}</span> <span class="token variable">@keys</span><span class="token punctuation">;</span>

<span class="token keyword">print</span> <span class="token string">"&#x3C;table border=\"1\">"</span><span class="token punctuation">;</span>
<span class="token keyword">foreach</span> <span class="token keyword">my</span> <span class="token variable">$key</span> <span class="token punctuation">(</span><span class="token variable">@keys</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">print</span> <span class="token string">"&#x3C;tr>&#x3C;th>"</span> <span class="token operator">.</span> <span class="token variable">$key</span> <span class="token operator">.</span> <span class="token string">"&#x3C;/th>&#x3C;td>"</span> <span class="token operator">.</span> <span class="token variable">$ENV</span><span class="token punctuation">{</span><span class="token variable">$key</span><span class="token punctuation">}</span> <span class="token operator">.</span> <span class="token string">"&#x3C;/td>&#x3C;/tr>"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">print</span> <span class="token string">"&#x3C;/table>"</span><span class="token punctuation">;</span>
</code></pre>
<p>コレで良い感じ。<code>REQUEST_METHOD</code> とか <code>QUERY_STRING</code> とかが見えるので、CGI での処理も良い感じにできそう。</p>
<ul>
  <li>参考 : <a href="http://d.hatena.ne.jp/perlcodesample/20161013/1476359060">Perlのハッシュを理解しよう - Perlゼミ(サンプルコードPerl入門)</a></li>
  <li>参考 : <a href="http://perldoc.jp/docs/perl/5.8.8/perldata.pod">perldata - Perl のデータ型 - perldoc.jp</a></li>
  <li>参考 : <a href="http://d.hatena.ne.jp/perlcodesample/20180208/1518094902">ハッシュのリファレンス - Perlゼミ(サンプルコードPerl入門)</a></li>
  <li>参考 : <a href="http://d.hatena.ne.jp/perlcodesample/20180510/1527165235">環境変数を取得・設定する %ENV - Perlゼミ(サンプルコードPerl入門)</a></li>
</ul>
<h2 id="カレントディレクトリ配下のファイル名を取得するコードを元に関数の呼び出し方について"><a class="header-link" href="#カレントディレクトリ配下のファイル名を取得するコードを元に関数の呼び出し方について"><span class="header-link-mark"></span></a>カレントディレクトリ配下のファイル名を取得するコードを元に、関数の呼び出し方について</h2>
<p>Perl の <code>opendir</code> という関数を使うと、Perl CGI ファイルがあるディレクトリを起点に、ディレクトリとファイルの一覧が取得できる。</p>
<pre class="language-perl"><code class="language-perl"><span class="token comment"># 変数 $dir はファイルハンドル。ココではディレクトリを読み込んだり閉じたりする時に使う</span>
<span class="token keyword">my</span> <span class="token variable">$dir</span><span class="token punctuation">;</span>
opendir <span class="token variable">$dir</span><span class="token punctuation">,</span> <span class="token string">"./"</span><span class="token punctuation">;</span>
<span class="token keyword">my</span> <span class="token variable">@files</span> <span class="token operator">=</span> readdir <span class="token variable">$dir</span><span class="token punctuation">;</span>
closedir <span class="token variable">$dir</span><span class="token punctuation">;</span>

<span class="token comment"># 取得したファイル名を順に表示する</span>
<span class="token keyword">foreach</span> <span class="token keyword">my</span> <span class="token variable">$file</span> <span class="token punctuation">(</span><span class="token variable">@files</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">print</span> <span class="token variable">$file</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p><code>opendir</code>・<code>readdir</code>・<code>closedir</code> は組み込みの関数。<strong>関数呼び出しはカッコ <code>()</code> を付けても付けなくても呼べる。</strong></p>
<pre class="language-perl"><code class="language-perl"><span class="token keyword">my</span> <span class="token variable">$dir</span><span class="token punctuation">;</span>
opendir<span class="token punctuation">(</span><span class="token variable">$dir</span><span class="token punctuation">,</span> <span class="token string">"./"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">@files</span> <span class="token operator">=</span> readdir<span class="token punctuation">(</span><span class="token variable">$dir</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
closedir<span class="token punctuation">(</span><span class="token variable">$dir</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>カッコの有無は、標準関数やモジュールからインポートした時の場合は特に変わりがない。<code>sub</code> でサブルーチンを定義した場合に、関数定義よりも手前に関数呼び出しがある場合は、カッコ <code>()</code> が必須。</p>
<p>また、関数名の手前にアンパサンド <code>&#x26;</code> を指定しても関数呼び出しができる。</p>
<pre class="language-perl"><code class="language-perl"><span class="token function"><span class="token keyword">sub</span> myTest</span> <span class="token punctuation">{</span>
  <span class="token keyword">print</span> <span class="token string">"\nmyTest\n"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment"># 関数定義が手前にあるので、以下のどれでも動く</span>
myTest<span class="token punctuation">;</span>
myTest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">&#x26;myTest</span><span class="token punctuation">;</span>
<span class="token variable">&#x26;myTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<pre class="language-perl"><code class="language-perl"><span class="token comment"># 関数定義が後にあるので、コチラは実行されない</span>
myTest<span class="token punctuation">;</span>
<span class="token comment"># ↓ コチラなら実行される</span>
myTest<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">&#x26;myTest</span><span class="token punctuation">;</span>
<span class="token variable">&#x26;myTest</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function"><span class="token keyword">sub</span> myTest</span> <span class="token punctuation">{</span>
  <span class="token keyword">print</span> <span class="token string">"\nmyTest\n"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>どういう使い分けのルールがあるのかよく分からないが、こんな意見もあった。</p>
<blockquote>
  <p>◆ 関数名の後の『()』小カッコについて<br>組み込み関数やインポートしたモジュール関数は、『()』小カッコを付けない方がよい。<br>カッコを付けてもＯＫですが、<em>ユーザ定義関数以外であることを明示するために『()』を付けない</em>方がよい。</p>
  <p>ユーザが定義できる関数（サブルーチン）は、『()』小カッコを付ける。<br>関数をロジックの前置きに定義すると、カッコなしでもＯＫですが、そうしない。<strong>『()』小カッコを付けてユーザ定義関数を明示する。</strong></p>
  <ul>
    <li>参考 : <a href="http://d.hatena.ne.jp/chaichanPaPa/20090720/1248088182">Perlの謎（その１０）サブルーチンの呼び出し方 - 燈明日記</a></li>
  </ul>
</blockquote>
<p>呼び出し元の書き方の違いで、ユーザ定義関数だと分かるように、ユーザ定義関数にはカッコを付ける、というのが良いのかも。</p>
<h2 id="例外処理"><a class="header-link" href="#例外処理"><span class="header-link-mark"></span></a>例外処理</h2>
<p>Perl の標準では、<code>try</code>・<code>catch</code> という構文はない。代わりに <code>eval</code> と <code>if</code> を使った書き方が多い。</p>
<pre class="language-perl"><code class="language-perl"><span class="token keyword">my</span> <span class="token variable">$dir</span><span class="token punctuation">;</span>
<span class="token keyword">eval</span> <span class="token punctuation">{</span>
  opendir<span class="token punctuation">(</span><span class="token variable">$dir</span><span class="token punctuation">,</span> <span class="token string">"./no-dir"</span><span class="token punctuation">)</span> <span class="token operator">or</span> <span class="token keyword">die</span> <span class="token string">"Can't open the directory. $!"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$@</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"MyError : $@"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  exit <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment"># 正常時の処理…</span>
<span class="token keyword">my</span> <span class="token variable">@files</span> <span class="token operator">=</span> readdir<span class="token punctuation">(</span><span class="token variable">$dir</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
closedir<span class="token punctuation">(</span><span class="token variable">$dir</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><code>eval</code> が <code>try</code> 部分。例外を吐きそうなところには <code>or die()</code> という関数を使い、<code>throw</code> するエラーメッセージを用意しておく感じ。<code>$!</code> とすると標準のエラーメッセージが返せるので、<code>or die($!)</code> が一番シンプル。<code>eval</code> はブレースで囲まれているがセミコロンが必要なので、<code>eval {};</code> となる。</p>
<p>直後の <code>if</code> ブロックが <code>catch</code> 相当。<code>$@</code> がエラーメッセージになるので、その有無で判定する。</p>
<p>もし上手くいかない場合は、こんな内容が <code>print</code> される。</p>
<pre><code>MyError : Can't open the directory. at /Library/WebServer/CGI-Executables/test.cgi line 16.
</code></pre>
<p><code>line 16</code> というのは <code>opendir</code> 部分のこと。</p>
<ul>
  <li>参考 : <a href="http://d.hatena.ne.jp/perlcodesample/20171002/1506911388">opendir関数 - ディレクトリをオープンする - Perlゼミ(サンプルコードPerl入門)</a>
    <ul>
      <li><code>opendir</code> 関数について</li>
    </ul>
  </li>
  <li>参考 : <a href="http://d.hatena.ne.jp/perlcodesample/20101130/1298764341">サブルーチンの作成方法 - Perlゼミ(サンプルコードPerl入門)</a></li>
  <li>参考 : <a href="http://www.kent-web.com/perl/chap8.html">Perl基礎入門 | KentWeb</a>
    <ul>
      <li>サブルーチンの定義と呼び出し方について</li>
    </ul>
  </li>
  <li>参考 : <a href="http://d.hatena.ne.jp/noissefnoc/20110901/p1">Perlのエラートラップ(例外処理)私的まとめ - OPS(元)-DEV(現)なEngineerの日記</a>
    <ul>
      <li>例外処理について。他のモジュールを入れれば <code>try</code>・<code>catch</code> 風なこともできる</li>
    </ul>
  </li>
</ul>
<h2 id="今回はココまで"><a class="header-link" href="#今回はココまで"><span class="header-link-mark"></span></a>今回はココまで</h2>
<p>配列や連想配列の扱い、ファイルやディレクトリの操作、例外のハンドリング方法などが分かってきて、段々と CGI でよくやる処理への備えができてきた感じ。</p>

      </main>
      <footer id="footer">
        <div id="footer-contents">
          <div id="date-time">
            <dl>
              <dt>Created</dt>
              <dd><time>2019-01-29</time></dd>
              <dt>Last-Modified</dt>
              <dd><time>2019-01-29</time></dd>
            </dl>
          </div>
          <nav id="footer-links">
            <ul>
              <li id="footer-link-about"><a href="/about/index.html" title="About">About</a></li>
              <li id="footer-link-search"><a href="/about/search.html" title="Search">Search</a></li>
              <li id="footer-link-feeds"><a href="/feeds.xml" title="Feeds">Feeds</a></li>
              <li id="footer-link-github"><a href="https://github.com/Neos21/" title="GitHub">GitHub</a></li>
            </ul>
          </nav>
          <nav id="to-top"><a href="#" title="To Top"><span>▲ To Top</span></a></nav>
        </div>
      </footer>
    </div>
  </body>
</html>
