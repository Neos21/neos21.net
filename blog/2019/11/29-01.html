<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="theme-color" content="#0990d0">
    <!-- Google Search Console -->
    <meta name="google-site-verification" content="AvoEr3mUJFF2H_mPWWgShfmjBVP3ywRpyx9hxeeq2d4">
    <title>Amazon AWS に登録する・1円も課金したくないので請求アラームも設定する - Neo's World</title>
    <link rel="icon" href="/favicon.ico">
    <link rel="stylesheet" href="/styles.css">
    <link rel="canonical" href="https://neos21.net/blog/2019/11/29-01.html">
    <link rel="search" type="application/opensearchdescription+xml" title="neos21.net" href="/opensearch.xml">
    <link rel="alternate" type="application/atom+xml" href="/feeds.xml">
    <link rel="author" href="http://www.hatena.ne.jp/neos21/">
    <!-- Global Site Tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YMHFLZP1M1"></script>
    <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date());gtag('config','G-YMHFLZP1M1');gtag('config','UA-106501-1');</script>
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6475907504235292" crossorigin="anonymous"></script>
  </head>
  <body>
    <div id="container">
      <header id="header">
        <div id="header-brand">
          <div id="header-brand-contents">
            <div id="site-title"><a href="/index.html">Neo's World</a></div>
            <nav id="header-links">
              <ul>
                <li id="header-link-about"><a href="/about/index.html" title="About"><span>About</span></a></li>
                <li id="header-link-search"><a href="/about/search.html" title="Search"><span>Search</span></a></li>
                <li id="header-link-feeds"><a href="/feeds.xml" title="Feeds"><span>Feeds</span></a></li>
                <li id="header-link-to-bottom"><a href="#footer" title="To Bottom"><span>▼ To Bottom</span></a></li>
              </ul>
            </nav>
          </div>
        </div>
        <nav id="global-nav">
          <ul>
            <li><a href="/blog/index.html">Blog</a></li>
            <li><a href="/tech/index.html">Tech</a></li>
            <li><a href="/music/index.html">Music</a></li>
            <li><a href="/games/index.html">Games</a></li>
            <li><a href="/gallery/index.html">Gallery</a></li>
            <li><a href="/etc/index.html">Etc.</a></li>
          </ul>
        </nav>
        <nav id="path">
          <ul>
            <li><a href="/index.html">Neo's World</a></li>
            <li><a href="/blog/index.html">Blog</a></li>
            <li><a href="/blog/2019/index.html">2019年</a></li>
            <li><a href="/blog/2019/11/index.html">11月</a></li>
          </ul>
        </nav>
      </header>
      <main id="main">
        <div id="header-date"><time>2019-11-29</time></div>
        <h1 id="page-title">Amazon AWS に登録する・1円も課金したくないので請求アラームも設定する</h1>

<p>この前、GCP (Google Cloud Platform) に登録し、永久無料枠だけを使うため1円も課金されないよう予算アラートを設定した。</p>
<ul>
  <li><a href="/blog/2019/08/01-01.html">永久無料枠で Google Compute Engine (GCE) インスタンスを立ち上げる : その1</a></li>
  <li><a href="/blog/2019/08/02-01.html">永久無料枠で Google Compute Engine (GCE) インスタンスを立ち上げる : その2</a></li>
</ul>
<p>今回は <strong>AWS</strong> に登録して、コチラも永久無料枠だけを使う狙いで、1円も課金されないよう、請求アラームを設定してみる。画像多めでお送り。</p>
<h2 id="目次"><a class="header-link" href="#目次"><span class="header-link-mark"></span></a>目次</h2>
<ul>
  <li><a href="#aws-%E3%81%AB%E7%99%BB%E9%8C%B2%E3%81%99%E3%82%8B">AWS に登録する</a></li>
  <li><a href="#%E8%AB%8B%E6%B1%82%E3%82%A2%E3%83%A9%E3%83%BC%E3%83%88%E3%81%AE%E5%8F%97%E4%BF%A1%E8%A8%AD%E5%AE%9A">請求アラートの受信設定</a></li>
  <li><a href="#1%E5%86%86%E3%81%A7%E3%82%82%E8%AA%B2%E9%87%91%E3%81%95%E3%82%8C%E3%81%9F%E3%82%89%E3%82%A2%E3%83%A9%E3%83%BC%E3%83%A0%E3%82%92%E9%80%9A%E7%9F%A5%E3%81%99%E3%82%8B">1円でも課金されたらアラームを通知する</a></li>
  <li><a href="#%E4%BB%A5%E4%B8%8A">以上</a></li>
</ul>
<h2 id="aws-に登録する"><a class="header-link" href="#aws-に登録する"><span class="header-link-mark"></span></a>AWS に登録する</h2>
<p>まずは AWS に登録しよう。以下のページに飛び、「コンソールにサインイン」を選んだら「新しい AWS アカウントの作成」を選ぶ。</p>
<ul>
  <li><a href="https://aws.amazon.com/jp/">クラウドならアマゾン ウェブ サービス 【AWS 公式】</a></li>
</ul>
<p>
  <img src="29-01-01.png" alt="AWS 登録">
</p>
<p>AWS アカウントは、Amazon.com や Amazon.co.jp のアカウントとは全く別に作成する。</p>
<p>
  <img src="29-01-02.png" alt="連絡先">
</p>
<p>住所入力。</p>
<p>
  <img src="29-01-03.png" alt="支払情報">
</p>
<p>請求用のクレジットカードを入力。</p>
<p>
  <img src="29-01-04.png" alt="携帯電話番号">
</p>
<p>本人確認のため携帯電話番号を入れる。</p>
<p>
  <img src="29-01-05.png" alt="SMS 認証">
</p>
<p>SMS で認証コードが届くので、それを入れる。</p>
<p>
  <img src="29-01-06.png" alt="できた">
</p>
<p>認証完了。</p>
<p>
  <img src="29-01-07.png" alt="サポート">
</p>
<p>サポートプランは無料の「ベーシックプラン」を選択。</p>
<p>
  <img src="29-01-08.png" alt="登録できた">
</p>
<p>登録ができたら、トップ画面に戻るのでログインする。</p>
<p>
  <img src="29-01-09.png" alt="ログインした">
</p>
<p>ログインできたら問題なく登録完了。</p>
<h2 id="請求アラートの受信設定"><a class="header-link" href="#請求アラートの受信設定"><span class="header-link-mark"></span></a>請求アラートの受信設定</h2>
<p>続いて請求アラートを設定する。AWS トップ画面の右上、「アカウント」メニューから「請求情報とコスト管理」を選ぶ。</p>
<p>
  <img src="29-01-10.png" alt="右上から請求情報に移る">
</p>
<p>「請求情報とコスト管理ダッシュボード」画面に移動したら、左メニューから「Billing の設定」を選ぶ。</p>
<p>
  <img src="29-01-11.png" alt="Billing の設定">
</p>
<p>この「設定画面」の「コスト管理設定」より、</p>
<ul>
  <li>無料利用枠の使用のアラートの受信</li>
  <li>請求アラートを受け取る</li>
</ul>
<p>にチェックを入れて「設定の保存」を選ぶ。</p>
<p>
  <img src="29-01-12.png" alt="チェックを付ける">
</p>
<p>コレで無料枠を超えた時にメールでアラートを受信できるようになる。</p>
<h2 id="1円でも課金されたらアラームを通知する"><a class="header-link" href="#1円でも課金されたらアラームを通知する"><span class="header-link-mark"></span></a>1円でも課金されたらアラームを通知する</h2>
<p>ココまでの画面では「アラート」と表現しているのだが、ココから先の画面では「アラーム」という表現になる。CloudWatch という AWS の請求額などを監視するサービスを利用して、1円でも課金された時にアラームを鳴らすようにする。公式のガイドは以下。</p>
<ul>
  <li>参考：<a href="https://docs.aws.amazon.com/ja_jp/AmazonCloudWatch/latest/monitoring/monitor_estimated_charges_with_cloudwatch.html">AWS の予想請求額をモニタリングする請求アラームの作成 - Amazon CloudWatch</a></li>
</ul>
<p>先程の「設定」画面にある「<em>請求アラートを管理する</em>」リンクなどから、CloudWatch コンソールを開く。開き方が分からなければ以下のリンクに遷移する。</p>
<ul>
  <li><a href="https://console.aws.amazon.com/cloudwatch/">https://console.aws.amazon.com/cloudwatch/</a></li>
</ul>
<p>
  <img src="29-01-13.png" alt="CloudWatch を開く">
</p>
<p>上のような画面に移動できれば OK。右上のリージョンで「バージニア北部」が選ばれていること。</p>
<p>左メニューから「アラーム」を選び、「アラームの作成」を選択する。</p>
<p>
  <img src="29-01-14.png" alt="アラーム">
</p>
<p>「メトリクスと条件の指定」画面に移動したら「メトリクスの選択」ボタンを押下する。</p>
<p>
  <img src="29-01-15.png" alt="メトリクスを作成する">
</p>
<p>「メトリクスの選択」ダイアログが開いたら「請求」メトリクスを選択する。</p>
<p>
  <img src="29-01-16.png" alt="請求">
</p>
<p>続いて「概算合計請求額」を選択する。</p>
<p>
  <img src="29-01-17.png" alt="概算合計請求額">
</p>
<p>出てきた画面で「通貨」から「USD」(メトリクス名「EstimatedCharges」) にチェックを入れ、「メトリクスの選択」ボタンを押下する。</p>
<p>
  <img src="29-01-18.png" alt="選ぶ">
</p>
<p>次の画面に移動したら、前半は基本的にはデフォルトのまま進めて良い。</p>
<ul>
  <li>統計：最大</li>
  <li>期間：6時間</li>
</ul>
<p>「条件」欄で、</p>
<ul>
  <li>しきい値の種類：静的</li>
  <li>アラーム条件を定義：以上</li>
  <li>しきい値：<strong><code>0.01</code> USD</strong></li>
</ul>
<p>という風に指定する。コレで、0.01ドル、だいたい1円程度の課金がされた時に、アラームを鳴らす設定になる。</p>
<p>
  <img src="29-01-19.png" alt="しきい値">
</p>
<p>次の画面で、アラーム通知を送る先を指定する。登録直後だと SNS トピックを作っていないと思うので、</p>
<ul>
  <li>新しいトピックの作成</li>
</ul>
<p>を選択し、</p>
<ul>
  <li>通知を受け取る E メールエンドポイント</li>
</ul>
<p>に任意のメルアドを入れて「トピックの作成」を選択する。</p>
<p>
  <img src="29-01-20.png" alt="トピックを作成する">
</p>
<p>SNS トピックが作成できたら次に進む。</p>
<p>
  <img src="29-01-21.png" alt="作る">
</p>
<p>最後に「説明の追加」画面で適当な名前をつける。</p>
<p>
  <img src="29-01-22.png" alt="名前など">
</p>
<p>コレで OK。最後にプレビューを確認して、登録する。</p>
<p>
  <img src="29-01-23.png" alt="プレビュー">
</p>
<p>以下のように自分が作った請求アラームが追加されていれば完了。</p>
<p>
  <img src="29-01-24.png" alt="できた">
</p>
<p>この請求アラーム、<strong>0.01ドルを超過した時にメールをよこすだけ</strong>なので、その後課金が続いている時に気付きにくい。そこで、500円分くらい請求額が増えた時にも同様にアラームを鳴らすようにしておくと、不要な課金が増えていることに気が付きやすくなる。</p>
<p>ということで、同様の手順を踏み、<code>0.01 USD</code> ではなく <code>5.00 USD</code> を条件に設定した請求アラームをもう一つ作っておく。</p>
<p>
  <img src="29-01-25.png" alt="同様にもうひとつ追加">
</p>
<p>こんな感じ。</p>
<p>最初は「データ不足」みたいな表示になっているが、しばらくすると請求額をきちんと監視できるようになる。何も使っていなければ当然請求額は0円なので、この CloudWatch コンソールでは全てが正常に見えているはずだ。</p>
<h2 id="以上"><a class="header-link" href="#以上"><span class="header-link-mark"></span></a>以上</h2>
<p>コレで AWS への登録と、不要な課金に気が付くための請求アラームの設定が完了した。</p>
<p>AWS は永久無料枠 (ティアタイプ「無期限無料」) で</p>
<ul>
  <li>Amazon DynamoDB : 25GB 分</li>
  <li>AWS Lambda : 100万リクエスト/月</li>
</ul>
<p>などが使えるので、無料枠内でうまく活用していきたい。</p>
<ul>
  <li>参考：<a href="https://qiita.com/Kento75/items/ca53d4266bc132cc13c6">【AWSメモ②】請求アラーム機能の設定 - Qiita</a></li>
</ul>

      </main>
      <footer id="footer">
        <div id="footer-contents">
          <div id="date-time">
            <dl>
              <dt>Created</dt>
              <dd><time>2019-11-29</time></dd>
              <dt>Last-Modified</dt>
              <dd><time>2019-11-29</time></dd>
            </dl>
          </div>
          <nav id="footer-links">
            <ul>
              <li id="footer-link-about"><a href="/about/index.html" title="About">About</a></li>
              <li id="footer-link-search"><a href="/about/search.html" title="Search">Search</a></li>
              <li id="footer-link-feeds"><a href="/feeds.xml" title="Feeds">Feeds</a></li>
              <li id="footer-link-github"><a href="https://github.com/Neos21/" title="GitHub">GitHub</a></li>
            </ul>
          </nav>
          <nav id="to-top"><a href="#" title="To Top"><span>▲ To Top</span></a></nav>
        </div>
      </footer>
    </div>
  </body>
</html>
