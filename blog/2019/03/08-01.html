<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="theme-color" content="#0990d0">
    <!-- Google Search Console -->
    <meta name="google-site-verification" content="AvoEr3mUJFF2H_mPWWgShfmjBVP3ywRpyx9hxeeq2d4">
    <title>Kubernetes とか XaaS とかの概念整理 - Neo's World</title>
    <link rel="icon" href="/favicon.ico">
    <link rel="stylesheet" href="/styles.css">
    <link rel="canonical" href="https://neos21.net/blog/2019/03/08-01.html">
    <link rel="search" type="application/opensearchdescription+xml" title="neos21.net" href="/opensearch.xml">
    <link rel="alternate" type="application/atom+xml" href="/feeds.xml">
    <link rel="author" href="http://www.hatena.ne.jp/neos21/">
    <!-- Global Site Tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YMHFLZP1M1"></script>
    <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date());gtag('config','G-YMHFLZP1M1');gtag('config','UA-106501-1');</script>
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6475907504235292" crossorigin="anonymous"></script>
  </head>
  <body>
    <div id="container">
      <header id="header">
        <div id="header-brand">
          <div id="header-brand-contents">
            <div id="site-title"><a href="/index.html">Neo's World</a></div>
            <nav id="header-links">
              <ul>
                <li id="header-link-about"><a href="/about/index.html" title="About"><span>About</span></a></li>
                <li id="header-link-search"><a href="/about/search.html" title="Search"><span>Search</span></a></li>
                <li id="header-link-feeds"><a href="/feeds.xml" title="Feeds"><span>Feeds</span></a></li>
                <li id="header-link-to-bottom"><a href="#footer" title="To Bottom"><span>▼ To Bottom</span></a></li>
              </ul>
            </nav>
          </div>
        </div>
        <nav id="global-nav">
          <ul>
            <li><a href="/blog/index.html">Blog</a></li>
            <li><a href="/tech/index.html">Tech</a></li>
            <li><a href="/music/index.html">Music</a></li>
            <li><a href="/games/index.html">Games</a></li>
            <li><a href="/gallery/index.html">Gallery</a></li>
            <li><a href="/etc/index.html">Etc.</a></li>
          </ul>
        </nav>
        <nav id="path">
          <ul>
            <li><a href="/index.html">Neo's World</a></li>
            <li><a href="/blog/index.html">Blog</a></li>
            <li><a href="/blog/2019/index.html">2019年</a></li>
            <li><a href="/blog/2019/03/index.html">03月</a></li>
          </ul>
        </nav>
      </header>
      <main id="main">
        <div id="header-date"><time>2019-03-08</time></div>
        <h1 id="page-title">Kubernetes とか XaaS とかの概念整理</h1>

<p>Kubernetes の概念の理解が大変だったので、雑多にまとめる。また、コレに関連して「XaaS」(「なんたら as a Service」系) の話も、自分が調べた範囲でまとめてみる。</p>
<h2 id="kubernetes-全般"><a class="header-link" href="#kubernetes-全般"><span class="header-link-mark"></span></a>Kubernetes 全般</h2>
<ul>
  <li>Kubernetes は、1つの Master Node が統制を司り (マスター)、複数の Worker Node がその下で動く (スレーブ)。
    <ul>
      <li>Kubernetes と書くのが長いので K8s と略して書かれたりする。読み方は「クバネテス」「クーバーネイティス」あたり。よく分からん。</li>
    </ul>
  </li>
  <li>そもそも <em>Node</em> とは何を指しているかというと、1台のサーバマシンのこと。クラウド時代なので VM (仮想マシン) の場合が多いが、イメージ的には「1台の物理的な PC」を「ノード」と考えて良い。
    <ul>
      <li>全体を管理するマスターのパソコンと、その下で冗長構成を取る複数のワーカーパソコンがいる、という感覚で良い。</li>
    </ul>
  </li>
  <li>「Kubernetes クラスタ」というと、Worker ノードが複数いる環境・状況を指す。「クラスタ」はブドウの房のこと。何かいっぱい付いてる感。</li>
  <li><code>kubectl</code> は Master ノードの API Server に対して命令を送るコマンド。Worker ノードへの変更なども Master ノードを経由して実現されている。</li>
  <li>Worker ノードには1つ以上の Pod と、Master と通信するための <code>kubelet</code> というプロセス、Docker などを動かすコンテナランタイムが同梱されている。</li>
  <li>Pod は<strong>デプロイ</strong>の単位。Kubernetes の構成要素の中で最小単位。
    <ul>
      <li>大抵は1つの Pod に1つの Docker コンテナを格納させて使うことが多いので、「1 Pod = 1 Container」とみなせる。</li>
      <li>しかし、1つの Pod に複数のコンテナを持たせることもできる。その際は <code>kubectl exec 【Pod 名】 --container 【コンテナ名】</code> といったコマンドを叩くことで、1つの Pod 内の Docker コンテナを指定してアクセスすることになる。</li>
    </ul>
  </li>
</ul>
<h2 id="マネージド-kubernetes-サービス"><a class="header-link" href="#マネージド-kubernetes-サービス"><span class="header-link-mark"></span></a>マネージド Kubernetes サービス</h2>
<ul>
  <li>Master ノードに対する各種のインストール作業や、ネットワーク周りの設定をよき感じに自動化してくれたり、フォローしてくれたりするクラウドサービスが、「マネージド Kubernetes」。Google の GKE とか AWS の EKS とか。
    <ul>
      <li>僕はいきなりマネージド K8s から入ってしまったので、未だに <code>etcd</code> とかなんとかがよく分からない。実体を見ずに使ってしまっている感がある…。</li>
    </ul>
  </li>
  <li>マネージド K8s だと、<strong>Node Pool</strong> という言葉が出てくる。コレは、Worker ノードをスケールさせるための機能。
    <ul>
      <li><code>deployment.yaml</code> を設定して Pod 数をスケール (増減) させるにしても、Pod (Docker コンテナ) を複数動かす Woker ノードのマシンスペックは超えられない。</li>
      <li>物理的にマシンを増やしてスペックを上げたいね → Worker ノードを増やしたいね。ということで登場するのが、ノード・プールという機能。</li>
      <li>予め「こういうスペックのワーカーノードを増やしたい」という設定をしておくと、クラウドサービスがいい感じにインスタンス (≒ ワーカーノード) を作ったり消したりしてくれる、というのがノードプール。</li>
      <li>サービスによっては各ノード (= ワーカーノード) のスペックが違ったりしても上手く協調できるようにしてくれる。よりスケーリングしやすいね、という話。</li>
    </ul>
  </li>
</ul>
<h2 id="サーバレスfaas"><a class="header-link" href="#サーバレスfaas"><span class="header-link-mark"></span></a>サーバレス・FaaS</h2>
<ul>
  <li>マネージド K8s は IaaS がメインになる。
    <ul>
      <li>Kubernetes 自体はコンテナを使うので CaaS (Container as a Service) なんて言われることもあるが、その実行環境をクラウドに用意するとなると、IaaS が多いかな。</li>
      <li>「空っぽのサーバマシンを貸してあげるから好きに設定して使ってね」というのが IaaS (Infrastructure as a Service)。</li>
      <li>仮想化技術を使って、1つの物理サーバ内に VM (仮想マシン) を立てて、それが提供されることが基本。昔からある安価な「レンタルサーバ」とよく似ている。</li>
      <li>「ベアメタル」という、専有マシンを借りられるサービスもある。昔からある「専用サーバ」というヤツがクラウドサービスとしてより迅速に・便利に提供されている、って感じ。</li>
    </ul>
  </li>
  <li><em>サーバレス</em>というのは、サーバやインフラの管理をクラウドに任せられる、という意味。</li>
  <li>サーバレスの考え方・仕組みを発展させたのが FaaS (Function as a Service)。
    <ul>
      <li>あるイベントに応じて、「この関数を実行する」という設定をするだけ。</li>
      <li>イベントが発生するごとに仮想コンテナが生成され、関数の実行が終わったらコンテナは破棄される。</li>
      <li>実行に必要なサーバはサービス側で自動的にスケールされる。</li>
    </ul>
  </li>
  <li>PaaS (Platform as a Service) は HTTP リクエストに応じてアプリケーション全体を起動する。FaaS は必要なサービスごと・関数単位で起動・停止を管理できる違いがある。
    <ul>
      <li>IaaS が一番広く OS や VM・ネットワークから使える。PaaS はアプリの実行環境。FaaS はスクリプトの実行環境。ぐらいの提供範囲が違う。</li>
    </ul>
  </li>
  <li>FaaS はイベントドリブンなので、どれだけ高速に処理されるとしても、コンテナの起動に時間がかかる点が気にされる。負荷量が頻繁に変わるようなイベントの場合は、クラウドサービスに任せてスケーリングできるのが便利ではあるが、一つの処理を高速に行うことを追求するなら IaaS になっていくことが多いかも。</li>
</ul>
<h2 id="参考資料"><a class="header-link" href="#参考資料"><span class="header-link-mark"></span></a>参考資料</h2>
<ul>
  <li><a href="https://ts0818.hatenablog.com/entry/2018/07/29/233208">Kubernetesに出てくるKubernetes cluster って何のこっちゃ？クラスタリング（Clustering）の概念が関わっているんではなかろうか。 - ts0818のブログ</a></li>
  <li><a href="https://www.slideshare.net/HammoudiSamir/google-container-engine-gke-kubernetes">Google Container Engine (GKE) &#x26; Kubernetes のアーキテクチャ解説</a></li>
  <li><a href="https://cloud.google.com/kubernetes-engine/docs/node-pools?hl=ja">ノードプール  |  Kubernetes Engine  |  Google Cloud</a></li>
  <li><a href="https://qiita.com/mumoshu/items/39e2e89db8ce8e8fe7cf">kube-awsにノードプール機能が追加されました - Qiita</a></li>
  <li><a href="https://www.slideshare.net/YoshidaShingo/thefuturewillbeserverless">Kubernetesのない世界 すべてがサーバーレスになる</a></li>
  <li><a href="https://www.itmedia.co.jp/enterprise/articles/1701/16/news026.html">コレ1枚で分かる「サーバレスとFaaS」 - ITmedia エンタープライズ</a></li>
  <li><a href="https://boxil.jp/mag/a3692/#3692-12">FaaS（Function as a Service）とは | サーバレス・意味・メリット・クラウドサービスとの違い - 開発 | ボクシルマガジン</a></li>
  <li><a href="https://www.konosumi.net/entry/2018/08/03/013538">CaaS、Paas、サーバーレス(FaaS,BaaS)の違い あなたはどのサービスを利用しますか - このすみろぐ</a></li>
</ul>

      </main>
      <footer id="footer">
        <div id="footer-contents">
          <div id="date-time">
            <dl>
              <dt>Created</dt>
              <dd><time>2019-03-08</time></dd>
              <dt>Last-Modified</dt>
              <dd><time>2019-03-08</time></dd>
            </dl>
          </div>
          <nav id="footer-links">
            <ul>
              <li id="footer-link-about"><a href="/about/index.html" title="About">About</a></li>
              <li id="footer-link-search"><a href="/about/search.html" title="Search">Search</a></li>
              <li id="footer-link-feeds"><a href="/feeds.xml" title="Feeds">Feeds</a></li>
              <li id="footer-link-github"><a href="https://github.com/Neos21/" title="GitHub">GitHub</a></li>
            </ul>
          </nav>
          <nav id="to-top"><a href="#" title="To Top"><span>▲ To Top</span></a></nav>
        </div>
      </footer>
    </div>
  </body>
</html>
