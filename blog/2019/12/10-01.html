<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Google Search Console -->
    <meta name="google-site-verification" content="AvoEr3mUJFF2H_mPWWgShfmjBVP3ywRpyx9hxeeq2d4">
    <title>EC ナビ・PeX の「まいにちニュース」に気持ちを自動で回答するブックマークレットを作った - Neo's World</title>
    <link rel="icon" href="/favicon.ico">
    <link rel="stylesheet" href="/styles.css">
    <link rel="canonical" href="https://neos21.net/blog/2019/12/10-01.html">
    <link rel="search" type="application/opensearchdescription+xml" title="neos21.net" href="/opensearch.xml">
    <link rel="alternate" type="application/atom+xml" href="/feeds.xml">
    <link rel="author" href="http://www.hatena.ne.jp/neos21/">
    <!-- Global Site Tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YMHFLZP1M1"></script>
    <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date());gtag('config','G-YMHFLZP1M1');gtag('config','UA-106501-1');</script>
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6475907504235292" crossorigin="anonymous"></script>
  </head>
  <body>
    <div id="container">
      <header id="header">
        <div id="site-title"><a href="/index.html">Neo's World</a></div>
        <nav id="header-links">
          <ul>
            <li id="header-link-about"><a href="/about/index.html" title="About"><span>About</span></a></li>
            <li id="header-link-search"><a href="/about/search.html" title="Search"><span>Search</span></a></li>
            <li id="header-link-feeds"><a href="/feeds.xml" title="Feeds"><span>Feeds</span></a></li>
            <li id="header-link-to-bottom"><a href="#footer" title="To Bottom"><span>▼ To Bottom</span></a></li>
          </ul>
        </nav>
        <nav id="global-nav">
          <ul>
            <li><a href="/blog/index.html">Blog</a></li>
            <li><a href="/tech/index.html">Tech</a></li>
            <li><a href="/music/index.html">Music</a></li>
            <li><a href="/games/index.html">Games</a></li>
            <li><a href="/gallery/index.html">Gallery</a></li>
            <li><a href="/etc/index.html">Etc.</a></li>
          </ul>
        </nav>
        <nav id="path">
          <ul>
            <li><a href="/index.html">Neo's World</a></li>
            <li><a href="/blog/index.html">Blog</a></li>
            <li><a href="/blog/2019/index.html">2019年</a></li>
            <li><a href="/blog/2019/12/index.html">12月</a></li>
          </ul>
        </nav>
      </header>
      <main id="main">
        <div id="header-date"><time>2019-12-10</time></div>
        <h1 id="page-title">EC ナビ・PeX の「まいにちニュース」に気持ちを自動で回答するブックマークレットを作った</h1>

<p>「EC ナビ」と「PeX」というポイントサイトを、2003年頃から使っている。その中に「まいにちニュース」というコンテンツがある。これは、ニュース記事の末尾に「いいね」ボタンや「Bad」ボタンなどがあり、記事を読んだ気持ちを答えることでポイントがもらえる仕組みだ。</p>
<p>今回はこのボタンを自動的に押下するブックマークレットを作ってみた。</p>
<h2 id="目次"><a class="header-link" href="#目次"><span class="header-link-mark"></span></a>目次</h2>
<ul>
  <li><a href="#%E5%AE%8C%E6%88%90%E5%BD%A2">完成形</a></li>
  <li><a href="#%E4%BB%A5%E4%B8%8B%E3%80%81%E9%96%8B%E7%99%BA%E7%B5%8C%E7%B7%AF">以下、開発経緯</a>
    <ul>
      <li><a href="#%E6%9C%80%E5%88%9D%E3%81%AB%E4%BD%9C%E3%81%A3%E3%81%9F%E3%82%B3%E3%83%BC%E3%83%89">最初に作ったコード</a></li>
      <li><a href="#%E5%AF%BE%E8%B1%A1%E8%A6%81%E7%B4%A0%E3%81%AE%E9%85%8D%E5%88%97%E3%82%92%E7%9F%AD%E7%B8%AE%E5%8C%96">対象要素の配列を短縮化</a></li>
      <li><a href="#for%E3%83%BBbreak-%E3%81%AE%E3%82%A4%E3%83%87%E3%82%A3%E3%82%AA%E3%83%A0%E3%82%92-arrayprototypesome-%E3%81%AB%E5%A4%89%E6%9B%B4"><code>for</code>・<code>break</code> のイディオムを <code>Array.prototype.some()</code> に変更</a></li>
      <li><a href="#%E5%AE%8C%E6%88%90%E5%BD%A2%E3%81%AE%E3%81%8A%E3%81%95%E3%82%89%E3%81%84">完成形のおさらい</a></li>
    </ul>
  </li>
  <li><a href="#%E3%81%9D%E3%81%AE%E4%BB%96">その他</a></li>
</ul>
<h2 id="完成形"><a class="header-link" href="#完成形"><span class="header-link-mark"></span></a>完成形</h2>
<p>完成形は以下。以下のブックマークレットを EC ナビや PeX の「まいにちニュース」の記事ページで実行すれば、「いいね」ボタンがあるところまでスクロールして「いいね」ボタンをクリックしてくれる。</p>
<pre class="language-javascript"><code class="language-javascript">javascript<span class="token operator">:</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token arrow operator">=></span><span class="token punctuation">[</span><span class="token string">'angry'</span><span class="token punctuation">,</span><span class="token string">'sad'</span><span class="token punctuation">,</span><span class="token string">'cool'</span><span class="token punctuation">,</span><span class="token string">'like'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token arrow operator">=></span><span class="token string">'#submit-'</span><span class="token operator">+</span>x<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'bad'</span><span class="token punctuation">,</span><span class="token string">'sad'</span><span class="token punctuation">,</span><span class="token string">'glad'</span><span class="token punctuation">,</span><span class="token string">'good'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token arrow operator">=></span><span class="token punctuation">[</span><span class="token string">'.btn_'</span><span class="token operator">+</span>x<span class="token punctuation">,</span><span class="token string">'.btn_feeling_'</span><span class="token operator">+</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">flat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">some</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token arrow operator">=></span><span class="token punctuation">(</span>e<span class="token operator">=</span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&#x26;&#x26;</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token method function property-access">scrollIntoView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>e<span class="token punctuation">.</span><span class="token method function property-access">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">!</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="以下、開発経緯"><a class="header-link" href="#以下、開発経緯"><span class="header-link-mark"></span></a>以下、開発経緯</h2>
<h3 id="最初に作ったコード"><a class="header-link" href="#最初に作ったコード"><span class="header-link-mark"></span></a>最初に作ったコード</h3>
<p>まずは押下したいボタンの要素を特定する。EC ナビの PC 版は <code>.btn_feeling_XXX</code>、EC ナビのスマホ版は <code>.btn_XXX</code>、PeX は <code>#submit-XXX</code> という名前のボタンを押下すれば良いことが分かった。ただし、EC ナビは「bad」「sad」「glad」「good」の4種類であるのに対して、PeX は「angry」「sad」「cool」「like」と、<code>XXX</code> 部分に入れる「感情」の文言が若干異なっていた。</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token punctuation">[</span>
  <span class="token comment">// EC ナビ PC        // スマホ    // PeX</span>
  <span class="token string">'.btn_feeling_bad'</span> <span class="token punctuation">,</span> <span class="token string">'.btn_bad'</span> <span class="token punctuation">,</span> <span class="token string">'#submit-angry'</span><span class="token punctuation">,</span>
  <span class="token string">'.btn_feeling_sad'</span> <span class="token punctuation">,</span> <span class="token string">'.btn_sad'</span> <span class="token punctuation">,</span> <span class="token string">'#submit-sad'</span>  <span class="token punctuation">,</span>
  <span class="token string">'.btn_feeling_glad'</span><span class="token punctuation">,</span> <span class="token string">'.btn_glad'</span><span class="token punctuation">,</span> <span class="token string">'#submit-cool'</span> <span class="token punctuation">,</span>
  <span class="token string">'.btn_feeling_good'</span><span class="token punctuation">,</span> <span class="token string">'.btn_good'</span><span class="token punctuation">,</span> <span class="token string">'#submit-like'</span>
<span class="token punctuation">]</span>
</code></pre>
<p>最初に作ったのは以下のようなコード。配列を順に走査し、要素が見つかれば <code>scrollIntoView()</code> でその要素のところまでスクロールし、クリックするという動きにした。<code>break</code> を使って、一度クリックできたらループから抜けるようにした。</p>
<pre class="language-javascript"><code class="language-javascript">javascript<span class="token operator">:</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">s<span class="token punctuation">,</span> i<span class="token punctuation">,</span> e</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">for</span><span class="token punctuation">(</span>i <span class="token operator">=</span> s<span class="token punctuation">.</span><span class="token property-access">length</span><span class="token punctuation">;</span> i<span class="token operator">--</span><span class="token punctuation">;</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword control-flow">if</span><span class="token punctuation">(</span>e <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span>s<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      e<span class="token punctuation">.</span><span class="token method function property-access">scrollIntoView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      e<span class="token punctuation">.</span><span class="token method function property-access">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword control-flow">break</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span>
  <span class="token punctuation">[</span>
    <span class="token string">'.btn_feeling_bad'</span> <span class="token punctuation">,</span> <span class="token string">'.btn_bad'</span> <span class="token punctuation">,</span> <span class="token string">'#submit-angry'</span><span class="token punctuation">,</span>
    <span class="token string">'.btn_feeling_sad'</span> <span class="token punctuation">,</span> <span class="token string">'.btn_sad'</span> <span class="token punctuation">,</span> <span class="token string">'#submit-sad'</span>  <span class="token punctuation">,</span>
    <span class="token string">'.btn_feeling_glad'</span><span class="token punctuation">,</span> <span class="token string">'.btn_glad'</span><span class="token punctuation">,</span> <span class="token string">'#submit-cool'</span> <span class="token punctuation">,</span>
    <span class="token string">'.btn_feeling_good'</span><span class="token punctuation">,</span> <span class="token string">'.btn_good'</span><span class="token punctuation">,</span> <span class="token string">'#submit-like'</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>変数 <code>i</code> と <code>e</code> はローカル変数として使うため、ド頭に宣言だけしている。<code>if</code> 文の中で代入しながら存在チェックを行っているところがコード短縮化のミソ。1行にまとめた際は、<code>for</code> 文のブレース <code>{}</code> が除去できる。なお、<code>for</code> ループは文字数短縮のために末尾から順にループするイディオムを利用しているので、配列末尾の方に優先的にクリックさせたい要素を並べておくと良いだろう。</p>
<p>コレでも動作するのだが、なんとなく冗長な気がして、もう少し文字数を減らせないか試してみた。</p>
<h3 id="対象要素の配列を短縮化"><a class="header-link" href="#対象要素の配列を短縮化"><span class="header-link-mark"></span></a>対象要素の配列を短縮化</h3>
<p>まず、<code>.btn_feeling_</code> や <code>$submit-</code> といった文言が重複しているので、ココを自動生成できないか考えてみた。</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> pexElems <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'angry'</span><span class="token punctuation">,</span> <span class="token string">'sad'</span><span class="token punctuation">,</span> <span class="token string">'cool'</span><span class="token punctuation">,</span> <span class="token string">'like'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token string">'#submit-'</span> <span class="token operator">+</span> name<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> ecNaviElems <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'bad'</span><span class="token punctuation">,</span> <span class="token string">'sad'</span><span class="token punctuation">,</span> <span class="token string">'glad'</span><span class="token punctuation">,</span> <span class="token string">'good'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">return</span> <span class="token punctuation">[</span><span class="token string">'.btn_'</span> <span class="token operator">+</span> name<span class="token punctuation">,</span> <span class="token string">'.btn_feeling_'</span> <span class="token operator">+</span> name<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> useFlat        <span class="token operator">=</span> pexElems<span class="token punctuation">.</span><span class="token method function property-access">concat</span><span class="token punctuation">(</span>ecNaviElems<span class="token punctuation">.</span><span class="token method function property-access">flat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> useConcatApply <span class="token operator">=</span> <span class="token class-name">Array</span><span class="token punctuation">.</span><span class="token property-access">prototype</span><span class="token punctuation">.</span><span class="token method function property-access">concat</span><span class="token punctuation">.</span><span class="token method function property-access">apply</span><span class="token punctuation">(</span>pexElems<span class="token punctuation">,</span> ecNaviElems<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>このように、共通する文言を <code>map()</code> で付与して配列を生成してみた。EC ナビの方は <code>.btn_XXX</code> (スマホ版) と <code>.btn_feeling_XXX</code> (PC 版) とを同時に生成してみたかったのだが、上の変数 <code>ecNaviElems</code> は二重の配列として生成されている。</p>
<p>二重の配列を展開・フラット化するには、<code>Array.prototype.flat()</code> という関数が策定されている。コレを使って <code>ecNaviElems</code> を平たくし、<code>pexElems</code> と結合すれば良い。</p>
<p>別の方法で、<code>Array.prototype.concat.apply(baseArray, nestedArray)</code> といったイディオムもある。<code>Array.prototype.flat()</code> が動かないブラウザではコチラが使えるだろう。</p>
<p>というワケで、配列の宣言部分は次のようなコードに短縮化できた。</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token punctuation">[</span><span class="token string">'angry'</span><span class="token punctuation">,</span> <span class="token string">'sad'</span><span class="token punctuation">,</span> <span class="token string">'cool'</span><span class="token punctuation">,</span> <span class="token string">'like'</span><span class="token punctuation">]</span>
  <span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token arrow operator">=></span> <span class="token string">'#submit-'</span> <span class="token operator">+</span> x<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token method function property-access">concat</span><span class="token punctuation">(</span>
    <span class="token punctuation">[</span><span class="token string">'bad'</span><span class="token punctuation">,</span> <span class="token string">'sad'</span><span class="token punctuation">,</span> <span class="token string">'glad'</span><span class="token punctuation">,</span> <span class="token string">'good'</span><span class="token punctuation">]</span>
      <span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token arrow operator">=></span> <span class="token punctuation">[</span><span class="token string">'.btn_'</span> <span class="token operator">+</span> x<span class="token punctuation">,</span> <span class="token string">'.btn_feeling_'</span> <span class="token operator">+</span>x <span class="token punctuation">]</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token method function property-access">flat</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>外側の <code>map().concat()</code> しているのが PeX 向けの配列で、内側で <code>map().flat()</code> しているのが EC ナビ向けの配列だ。</p>
<h3 id="for・break-のイディオムを-arrayprototypesome-に変更"><a class="header-link" href="#for・break-のイディオムを-arrayprototypesome-に変更"><span class="header-link-mark"></span></a><code>for</code>・<code>break</code> のイディオムを <code>Array.prototype.some()</code> に変更</h3>
<p>次に、<code>for</code> と <code>break</code> で処理していた部分を短くできないか見てみた。</p>
<p>配列を順に操作している時にループを抜ける方法には、<code>Array.prototype.some()</code> も存在することに気付いた。要素が見つかって、クリックができたら <code>return true</code> してやれば、以降の要素は走査されないワケだ。</p>
<pre class="language-javascript"><code class="language-javascript">allElems<span class="token punctuation">.</span><span class="token method function property-access">some</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">if</span><span class="token punctuation">(</span>elem <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    elem<span class="token punctuation">.</span><span class="token method function property-access">scrollIntoView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    elem<span class="token punctuation">.</span><span class="token method function property-access">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p><code>if</code> 文に合致しなかった場合は何も返していないので <code>undefined</code> (Falsy な値) が返ったことになり、ループ処理が続く。</p>
<p>コレをこのまま1行にしても、イマイチ短くならない。しかし、<code>&#x26;&#x26;</code> 演算子を使った書き方にかえてやると、短くできそうだ。ちなみにこの <code>&#x26;&#x26;</code> 演算子のことは<em>「論理積」「論理 AND」演算子</em>と呼ぶ。バイナリ論理演算子の一種だ。</p>
<ul>
  <li>参考：<a href="https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Operators/Logical_Operators#Logical_AND">論理演算子 - JavaScript | MDN</a></li>
</ul>
<pre class="language-javascript"><code class="language-javascript">allElems<span class="token punctuation">.</span><span class="token method function property-access">some</span><span class="token punctuation">(</span> <span class="token parameter">name</span> <span class="token arrow operator">=></span> <span class="token punctuation">(</span>elem <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&#x26;&#x26;</span> <span class="token punctuation">(</span>elem<span class="token punctuation">.</span><span class="token method function property-access">scrollIntoView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> elem<span class="token punctuation">.</span><span class="token method function property-access">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<ul>
  <li><code>(elem = document.querySelector(name))</code> で代入と存在チェックを兼ねる
    <ul>
      <li>要素が存在しない場合はこの時点で <code>false</code> になるので、<code>&#x26;&#x26;</code> 演算子以降は処理されない</li>
    </ul>
  </li>
  <li>要素が存在すると <code>(elem.scrollIntoView(), elem.click(), true)</code> 部分が実行され、最後の <code>true</code> が返るので、<code>some()</code> のループがココで中断される
    <ul>
      <li>最後の <code>true</code> を忘れると、<code>(elem.scrollIntoView(), elem.click())</code> だけでは <code>undefined</code> (Falsy) となり、<code>some()</code> のループが全要素に対して行われてしまう</li>
    </ul>
  </li>
</ul>
<h3 id="完成形のおさらい"><a class="header-link" href="#完成形のおさらい"><span class="header-link-mark"></span></a>完成形のおさらい</h3>
<p>というワケで、全体を結合するとこのようなコードになる。</p>
<pre class="language-javascript"><code class="language-javascript">javascript<span class="token operator">:</span><span class="token punctuation">(</span><span class="token parameter">e</span> <span class="token arrow operator">=></span> 
  <span class="token punctuation">[</span><span class="token string">'angry'</span><span class="token punctuation">,</span> <span class="token string">'sad'</span><span class="token punctuation">,</span> <span class="token string">'cool'</span><span class="token punctuation">,</span> <span class="token string">'like'</span><span class="token punctuation">]</span>
    <span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token arrow operator">=></span> <span class="token string">'#submit-'</span> <span class="token operator">+</span> x<span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token method function property-access">concat</span><span class="token punctuation">(</span>
      <span class="token punctuation">[</span><span class="token string">'bad'</span><span class="token punctuation">,</span> <span class="token string">'sad'</span><span class="token punctuation">,</span> <span class="token string">'glad'</span><span class="token punctuation">,</span> <span class="token string">'good'</span><span class="token punctuation">]</span>
        <span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token arrow operator">=></span> <span class="token punctuation">[</span><span class="token string">'.btn_'</span> <span class="token operator">+</span> x<span class="token punctuation">,</span> <span class="token string">'.btn_feeling_'</span> <span class="token operator">+</span> x<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token method function property-access">flat</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token method function property-access">some</span><span class="token punctuation">(</span><span class="token parameter">x</span> <span class="token arrow operator">=></span>
      <span class="token punctuation">(</span>e <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&#x26;&#x26;</span> <span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token method function property-access">scrollIntoView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span><span class="token method function property-access">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token operator">!</span><span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<ul>
  <li>全体の即時関数は <code>(() => {})();</code> と書くより、適当な仮引数を1つ与えて <code>(e => {})();</code> とする方が <code>()</code> より1文字減らせる。今回は <code>e = document.querySelector()</code> で DOM 要素を代入する変数のために仮引数を1つ用意できた</li>
  <li>やっていることは <code>allElems.some()</code> の1処理だけなので、即時関数のブレース <code>{}</code> も除去して <code>(e => allElems.some())()</code> という構成にした。全体の即時関数の戻り地はどうでもいいのでこのように省いて良い</li>
  <li><code>document.querySelector()</code> の引数に渡す CSS クラス名や ID 名を、<code>.map().concat()</code> <code>.map().flat()</code> を駆使して構築する
    <ul>
      <li>もしココで要素の順番をシャッフルしたければ、<code>.some()</code> の手前で <code>.sort(n=>Math.random()-.5)</code> みたいなコードを入れれば、雑なシャッフルができる</li>
    </ul>
  </li>
  <li><code>some()</code> の中は <code>&#x26;&#x26;</code> 演算子を使って短縮化している</li>
</ul>
<p>コレのスペースを除去して1行にまとめたのが冒頭のコード。</p>
<pre class="language-javascript"><code class="language-javascript">javascript<span class="token operator">:</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token arrow operator">=></span><span class="token punctuation">[</span><span class="token string">'angry'</span><span class="token punctuation">,</span><span class="token string">'sad'</span><span class="token punctuation">,</span><span class="token string">'cool'</span><span class="token punctuation">,</span><span class="token string">'like'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token arrow operator">=></span><span class="token string">'#submit-'</span><span class="token operator">+</span>x<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">concat</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">'bad'</span><span class="token punctuation">,</span><span class="token string">'sad'</span><span class="token punctuation">,</span><span class="token string">'glad'</span><span class="token punctuation">,</span><span class="token string">'good'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token method function property-access">map</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token arrow operator">=></span><span class="token punctuation">[</span><span class="token string">'.btn_'</span><span class="token operator">+</span>x<span class="token punctuation">,</span><span class="token string">'.btn_feeling_'</span><span class="token operator">+</span>x<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">flat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">some</span><span class="token punctuation">(</span><span class="token parameter">x</span><span class="token arrow operator">=></span><span class="token punctuation">(</span>e<span class="token operator">=</span><span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">querySelector</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">&#x26;&#x26;</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token method function property-access">scrollIntoView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>e<span class="token punctuation">.</span><span class="token method function property-access">click</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token operator">!</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<h2 id="その他"><a class="header-link" href="#その他"><span class="header-link-mark"></span></a>その他</h2>
<p>ブックマークレットを作るための短縮化には、拙作の <strong><code>@neos21/bookmarkletify</code></strong> という npm パッケージが有効かと思われる。コチラも合わせてドウゾ。</p>
<ul>
  <li><a href="https://www.npmjs.com/package/@neos21/bookmarkletify">@neos21/bookmarkletify</a></li>
</ul>
<p>以前作った、ポイントサイトやアンケートサイトで使えるブックマークレットは、別ブログ <strong>Corredor</strong> の方でいくつか紹介している。コチラもよかったらドウゾ。</p>
<ul>
  <li><a href="/blog/2018/03/25-02.html">アンケートサイトで使える！ドラッグ・アンド・ドロップで選択した範囲を一括でクリックするブックマークレット</a></li>
  <li><a href="/blog/2018/03/26-01.html">アンケートサイトで使える！都道府県セレクトボックスを自動選択するブックマークレット</a></li>
  <li><a href="/blog/2018/03/27-03.html">アンケートサイトで使える！テキストボックスに年齢を自動入力するブックマークレット</a></li>
  <li><a href="/blog/2018/03/28-01.html">アンケートサイトで使える！性別のラジオボタンを自動選択するブックマークレット</a></li>
  <li><a href="/blog/2018/03/29-01.html">アンケートサイトの色々な回答に一気に答えるブックマークレットを作った</a></li>
  <li><a href="/blog/2018/10/28-01.html">ラジオボタンやチェックボックスをランダムにチェックするブックマークレットを作った</a></li>
</ul>
<p>以上。</p>

      </main>
      <footer id="footer">
        <div id="date-time">
          <dl>
            <dt>Created</dt>
            <dd><time>2019-12-10</time></dd>
            <dt>Last-Modified</dt>
            <dd><time>2019-12-10</time></dd>
          </dl>
        </div>
        <nav id="footer-links">
          <ul>
            <li id="footer-link-about"><a href="/about/index.html" title="About">About</a></li>
            <li id="footer-link-search"><a href="/about/search.html" title="Search">Search</a></li>
            <li id="footer-link-feeds"><a href="/feeds.xml" title="Feeds">Feeds</a></li>
            <li id="footer-link-github"><a href="https://github.com/Neos21/" title="GitHub">GitHub</a></li>
          </ul>
        </nav>
        <nav id="to-top"><a href="#" title="To Top"><span>▲ To Top</span></a></nav>
      </footer>
    </div>
  </body>
</html>
