<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="theme-color" content="#0990d0">
    <!-- Google Search Console -->
    <meta name="google-site-verification" content="AvoEr3mUJFF2H_mPWWgShfmjBVP3ywRpyx9hxeeq2d4">
    <title>いい加減 tar コマンドを覚えるためのまとめ - Neo's World</title>
    <link rel="icon" href="/favicon.ico">
    <link rel="stylesheet" href="/styles.css">
    <link rel="canonical" href="https://neos21.net/blog/2019/04/16-02.html">
    <link rel="search" type="application/opensearchdescription+xml" title="neos21.net" href="/opensearch.xml">
    <link rel="alternate" type="application/atom+xml" title="Feeds" href="/feeds.xml">
    <link rel="author" href="http://www.hatena.ne.jp/neos21/">
    <script defer src="/scripts.js"></script>
    <!-- Global Site Tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YMHFLZP1M1"></script>
    <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date());gtag('config','G-YMHFLZP1M1');gtag('config','UA-106501-1');</script>
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6475907504235292" crossorigin="anonymous"></script>
  </head>
  <body>
    <div id="container">
      <header id="header">
        <div id="header-brand">
          <div id="header-brand-contents">
            <div id="site-title"><a href="/index.html">Neo's World</a></div>
            <nav id="header-links">
              <ul>
                <li id="header-link-about"><a href="/about/index.html" title="About"><span>About</span></a></li>
                <li id="header-link-search"><a href="/about/search.html" title="Search"><span>Search</span></a></li>
                <li id="header-link-feeds"><a href="/feeds.xml" title="Feeds"><span>Feeds</span></a></li>
                <li id="header-link-to-bottom"><a href="#footer" title="To Bottom"><span>▼ To Bottom</span></a></li>
              </ul>
            </nav>
          </div>
        </div>
        <nav id="global-nav">
          <ul>
            <li><a href="/blog/index.html">Blog</a></li>
            <li><a href="/tech/index.html">Tech</a></li>
            <li><a href="/music/index.html">Music</a></li>
            <li><a href="/games/index.html">Games</a></li>
            <li><a href="/gallery/index.html">Gallery</a></li>
            <li><a href="/etc/index.html">Etc.</a></li>
          </ul>
        </nav>
        <nav id="path">
          <ul>
            <li><a href="/index.html">Neo's World</a></li>
            <li><a href="/blog/index.html">Blog</a></li>
            <li><a href="/blog/2019/index.html">2019年</a></li>
            <li><a href="/blog/2019/04/index.html">04月</a></li>
          </ul>
        </nav>
      </header>
      <main id="main">
        <div id="header-date"><time>2019-04-16</time></div>
        <h1 id="page-title">いい加減 tar コマンドを覚えるためのまとめ</h1>

<p>ファイルのアーカイブ、圧縮、解凍を行える <em><code>tar</code></em> コマンド。オプション引数が覚えられずいつも調べてしまうので、いい加減覚える。</p>
<h2 id="目次"><a class="header-link" href="#目次"><span class="header-link-mark"></span></a>目次</h2>
<ul>
  <li><a href="#%E3%83%98%E3%83%AB%E3%83%97%E3%82%92%E8%A6%8B%E3%81%A6%E3%81%BF%E3%82%8B">ヘルプを見てみる</a>
    <ul>
      <li><a href="#bsd-tar">BSD tar</a></li>
      <li><a href="#gnu-tar">GNU tar</a></li>
    </ul>
  </li>
  <li><a href="#%E3%82%B5%E3%83%B3%E3%83%97%E3%83%AB%E3%82%B3%E3%83%BC%E3%83%89%E3%81%AB%E3%81%A4%E3%81%84%E3%81%A6">サンプルコードについて</a></li>
  <li><a href="#cvf--%E3%82%A2%E3%83%BC%E3%82%AB%E3%82%A4%E3%83%96%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B"><code>cvf</code> : アーカイブを作成する</a></li>
  <li><a href="#czvf--gzip-%E3%81%A7%E5%9C%A7%E7%B8%AE%E3%81%99%E3%82%8B"><code>czvf</code> : gzip で圧縮する</a>
    <ul>
      <li><a href="#cjvf--bzip2-%E5%BD%A2%E5%BC%8F%E3%81%A7%E5%9C%A7%E7%B8%AE%E3%81%99%E3%82%8B"><code>cjvf</code> : bzip2 形式で圧縮する</a></li>
      <li><a href="#cjvf--xz-%E5%BD%A2%E5%BC%8F%E3%81%A7%E5%9C%A7%E7%B8%AE%E3%81%99%E3%82%8B"><code>cJvf</code> : xz 形式で圧縮する</a></li>
    </ul>
  </li>
  <li><a href="#xvf--%E3%82%A2%E3%83%BC%E3%82%AB%E3%82%A4%E3%83%96%E3%82%92%E5%B1%95%E9%96%8B%E3%81%99%E3%82%8B"><code>xvf</code> : アーカイブを展開する</a></li>
  <li><a href="#tf--%E6%A0%BC%E7%B4%8D%E3%81%95%E3%82%8C%E3%81%A6%E3%81%84%E3%82%8B%E3%83%87%E3%82%A3%E3%83%AC%E3%82%AF%E3%83%88%E3%83%AA%E5%90%8D%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E5%90%8D%E3%82%92%E5%8F%96%E5%BE%97%E3%81%99%E3%82%8B"><code>tf</code> : 格納されているディレクトリ名・ファイル名を取得する</a></li>
  <li><a href="#%E3%81%BE%E3%81%A8%E3%82%81%E8%A1%A8">まとめ表</a></li>
</ul>
<h2 id="ヘルプを見てみる"><a class="header-link" href="#ヘルプを見てみる"><span class="header-link-mark"></span></a>ヘルプを見てみる</h2>
<p>まずはコマンドのヘルプを見てみる。</p>
<h3 id="bsd-tar"><a class="header-link" href="#bsd-tar"><span class="header-link-mark"></span></a>BSD tar</h3>
<p>MacOS Mojave に入っている <strong>BSD tar</strong> のヘルプはこんな感じ。</p>
<pre class="language-bash"><code class="language-bash">$ <span class="token function">tar</span> --help
tar<span class="token punctuation">(</span>bsdtar<span class="token punctuation">)</span>: manipulate archive files
First option must be a mode specifier:
  -c Create  -r Add/Replace  -t List  -u Update  -x Extract
Common Options:
  -b <span class="token comment">#  Use # 512-byte records per I/O block</span>
  -f <span class="token operator">&#x3C;</span>filename<span class="token operator">></span>  Location of archive
  -v    Verbose
  -w    Interactive
Create: <span class="token function">tar</span> -c <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">&#x3C;</span>file<span class="token operator">></span> <span class="token operator">|</span> <span class="token operator">&#x3C;</span>dir<span class="token operator">></span> <span class="token operator">|</span> @<span class="token operator">&#x3C;</span>archive<span class="token operator">></span> <span class="token operator">|</span> -C <span class="token operator">&#x3C;</span>dir<span class="token operator">></span> <span class="token punctuation">]</span>
  <span class="token operator">&#x3C;</span>file<span class="token operator">></span>, <span class="token operator">&#x3C;</span>dir<span class="token operator">></span>  <span class="token function">add</span> these items to archive
  -z, -j, -J, --lzma  Compress archive with gzip/bzip2/xz/lzma
  --format <span class="token punctuation">{</span>ustar<span class="token operator">|</span>pax<span class="token operator">|</span>cpio<span class="token operator">|</span>shar<span class="token punctuation">}</span>  Select archive <span class="token function">format</span>
  --exclude <span class="token operator">&#x3C;</span>pattern<span class="token operator">></span>  Skip files that match pattern
  -C <span class="token operator">&#x3C;</span>dir<span class="token operator">></span>  Change to <span class="token operator">&#x3C;</span>dir<span class="token operator">></span> before processing remaining files
  @<span class="token operator">&#x3C;</span>archive<span class="token operator">></span>  Add entries from <span class="token operator">&#x3C;</span>archive<span class="token operator">></span> to output
List: <span class="token function">tar</span> -t <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">&#x3C;</span>patterns<span class="token operator">></span><span class="token punctuation">]</span>
  <span class="token operator">&#x3C;</span>patterns<span class="token operator">></span>  If specified, list only entries that match
Extract: <span class="token function">tar</span> -x <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token operator">&#x3C;</span>patterns<span class="token operator">></span><span class="token punctuation">]</span>
  <span class="token operator">&#x3C;</span>patterns<span class="token operator">></span>  If specified, extract only entries that match
  -k    Keep <span class="token punctuation">(</span>don<span class="token string">'t overwrite) existing files
  -m    Don'</span>t restore modification <span class="token builtin class-name">times</span>
  -O    Write entries to stdout, don't restore to disk
  -p    Restore permissions <span class="token punctuation">(</span>including ACLs, owner, <span class="token function">file</span> flags<span class="token punctuation">)</span>
bsdtar <span class="token number">2.8</span>.3 - libarchive <span class="token number">2.8</span>.3
</code></pre>
<p>シンプルで分かりやすい。<code>crtux</code> のどれかからやりたいことを選んで、共通オプションとして <code>vf</code> あたりがあって、Create 時は <code>zjJ</code> などが使えるよ、と。</p>
<h3 id="gnu-tar"><a class="header-link" href="#gnu-tar"><span class="header-link-mark"></span></a>GNU tar</h3>
<p>次は CentOS 7 に含まれている GNU tar を見る。</p>
<pre class="language-bash"><code class="language-bash">$ <span class="token function">tar</span> --version
<span class="token function">tar</span> <span class="token punctuation">(</span>GNU <span class="token function">tar</span><span class="token punctuation">)</span> <span class="token number">1.26</span>
Copyright <span class="token punctuation">(</span>C<span class="token punctuation">)</span> <span class="token number">2011</span> Free Software Foundation, Inc.
License GPLv3+: GNU GPL version <span class="token number">3</span> or later <span class="token operator">&#x3C;</span>http://gnu.org/licenses/gpl.html<span class="token operator">></span>.
This is <span class="token function">free</span> software: you are <span class="token function">free</span> to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.

$ <span class="token function">tar</span> --help
Usage: <span class="token function">tar</span> <span class="token punctuation">[</span>OPTION<span class="token punctuation">..</span>.<span class="token punctuation">]</span> <span class="token punctuation">[</span>FILE<span class="token punctuation">]</span><span class="token punctuation">..</span>.
GNU <span class="token variable"><span class="token variable">`</span><span class="token function">tar</span><span class="token string">' saves many files together into a single tape or disk archive, and can
restore individual files from the archive.

Examples:
  tar -cf archive.tar foo bar  # Create archive.tar from files foo and bar.
  tar -tvf archive.tar         # List all files in archive.tar verbosely.
  tar -xf archive.tar          # Extract all files from archive.tar.

 Main operation mode:

  -A, --catenate, --concatenate   append tar files to an archive
  -c, --create               create a new archive
  -d, --diff, --compare      find differences between archive and file system
      --delete               delete from the archive (not on mag tapes!)
  -r, --append               append files to the end of an archive
  -t, --list                 list the contents of an archive
      --test-label           test the archive volume label and exit
  -u, --update               only append files newer than copy in archive
  -x, --extract, --get       extract files from an archive

 Operation modifiers:

      --check-device         check device numbers when creating incremental
                             archives (default)
  -g, --listed-incremental=FILE   handle new GNU-format incremental backup
  -G, --incremental          handle old GNU-format incremental backup
      --ignore-failed-read   do not exit with nonzero on unreadable files
      --level=NUMBER         dump level for created listed-incremental archive
  -n, --seek                 archive is seekable
      --no-check-device      do not check device numbers when creating
                             incremental archives
      --no-seek              archive is not seekable
      --occurrence[=NUMBER]  process only the NUMBERth occurrence of each file
                             in the archive; this option is valid only in
                             conjunction with one of the subcommands --delete,
                             --diff, --extract or --list and when a list of
                             files is given either on the command line or via
                             the -T option; NUMBER defaults to 1
      --sparse-version=MAJOR[.MINOR]
                             set version of the sparse format to use (implies
                             --sparse)
  -S, --sparse               handle sparse files efficiently

 Overwrite control:

  -k, --keep-old-files       don'</span>t replace existing files when extracting,
                             treat them as errors
      --keep-directory-symlink   preserve existing symlinks to directories when
                             extracting
      --keep-newer-files     don<span class="token string">'t replace existing files that are newer than
                             their archive copies
      --no-overwrite-dir     preserve metadata of existing directories
      --overwrite            overwrite existing files when extracting
      --overwrite-dir        overwrite metadata of existing directories when
                             extracting (default)
      --recursive-unlink     empty hierarchies prior to extracting directory
      --remove-files         remove files after adding them to the archive
      --skip-old-files       don'</span>t replace existing files when extracting,
                             silently skip over them
  -U, --unlink-first         remove each <span class="token function">file</span> prior to extracting over it
  -W, --verify               attempt to verify the archive after writing it

 Select output stream:

      --ignore-command-error ignore <span class="token builtin class-name">exit</span> codes of children
      --no-ignore-command-error   treat non-zero <span class="token builtin class-name">exit</span> codes of children as
                             error
  -O, --to-stdout            extract files to standard output
      --to-command<span class="token operator">=</span>COMMAND   pipe extracted files to another program

 Handling of <span class="token function">file</span> attributes:

      --atime-preserve<span class="token punctuation">[</span><span class="token operator">=</span>METHOD<span class="token punctuation">]</span>   preserve access <span class="token builtin class-name">times</span> on dumped files, either
                             by restoring the <span class="token builtin class-name">times</span> after reading
                             <span class="token punctuation">(</span>METHOD<span class="token operator">=</span><span class="token string">'replace'</span><span class="token punctuation">;</span> default<span class="token punctuation">)</span> or by not setting the
                             <span class="token builtin class-name">times</span> <span class="token keyword">in</span> the first place <span class="token punctuation">(</span>METHOD<span class="token operator">=</span><span class="token string">'system'</span><span class="token punctuation">)</span>
      --delay-directory-restore   delay setting modification <span class="token builtin class-name">times</span> and
                             permissions of extracted directories <span class="token keyword">until</span> the end
                             of extraction
      --group<span class="token operator">=</span>NAME           force NAME as group <span class="token keyword">for</span> added files
      --mode<span class="token operator">=</span>CHANGES         force <span class="token punctuation">(</span>symbolic<span class="token punctuation">)</span> mode CHANGES <span class="token keyword">for</span> added files
      --mtime<span class="token operator">=</span>DATE-OR-FILE   <span class="token builtin class-name">set</span> mtime <span class="token keyword">for</span> added files from DATE-OR-FILE
  -m, --touch                don<span class="token string">'t extract file modified time
      --no-delay-directory-restore
                             cancel the effect of --delay-directory-restore
                             option
      --no-same-owner        extract files as yourself (default for ordinary
                             users)
      --no-same-permissions  apply the user'</span>s <span class="token builtin class-name">umask</span> when extracting permissions
                             from the archive <span class="token punctuation">(</span>default <span class="token keyword">for</span> ordinary <span class="token function">users</span><span class="token punctuation">)</span>
      --numeric-owner        always use numbers <span class="token keyword">for</span> user/group names
      --owner<span class="token operator">=</span>NAME           force NAME as owner <span class="token keyword">for</span> added files
  -p, --preserve-permissions, --same-permissions
                             extract information about <span class="token function">file</span> permissions
                             <span class="token punctuation">(</span>default <span class="token keyword">for</span> superuser<span class="token punctuation">)</span>
      --preserve             same as both -p and -s
      --same-owner           try extracting files with the same ownership as
                             exists <span class="token keyword">in</span> the archive <span class="token punctuation">(</span>default <span class="token keyword">for</span> superuser<span class="token punctuation">)</span>
  -s, --preserve-order, --same-order
                             member arguments are listed <span class="token keyword">in</span> the same order as
                             the files <span class="token keyword">in</span> the archive

 Handling of extended <span class="token function">file</span> attributes:

      --acls                 Enable the POSIX ACLs support
      --no-acls              Disable the POSIX ACLs support
      --no-selinux           Disable the SELinux context support
      --no-xattrs            Disable extended attributes support
      --selinux              Enable the SELinux context support
      --xattrs               Enable extended attributes support
      --xattrs-exclude<span class="token operator">=</span>MASK  specify the exclude pattern <span class="token keyword">for</span> xattr keys
      --xattrs-include<span class="token operator">=</span>MASK  specify the include pattern <span class="token keyword">for</span> xattr keys

 Device selection and switching:

  -f, --file<span class="token operator">=</span>ARCHIVE         use archive <span class="token function">file</span> or device ARCHIVE
      --force-local          archive <span class="token function">file</span> is <span class="token builtin class-name">local</span> even <span class="token keyword">if</span> it has a colon
  -F, --info-script<span class="token operator">=</span>NAME, --new-volume-script<span class="token operator">=</span>NAME
                             run script at end of each tape <span class="token punctuation">(</span>implies -M<span class="token punctuation">)</span>
  -L, --tape-length<span class="token operator">=</span>NUMBER   change tape after writing NUMBER x <span class="token number">1024</span> bytes
  -M, --multi-volume         create/list/extract multi-volume archive
      --rmt-command<span class="token operator">=</span>COMMAND  use given rmt COMMAND instead of rmt
      --rsh-command<span class="token operator">=</span>COMMAND  use remote COMMAND instead of rsh
      --volno-file<span class="token operator">=</span>FILE      use/update the volume number <span class="token keyword">in</span> FILE

 Device blocking:

  -b, --blocking-factor<span class="token operator">=</span>BLOCKS   BLOCKS x <span class="token number">512</span> bytes per record
  -B, --read-full-records    reblock as we <span class="token builtin class-name">read</span> <span class="token punctuation">(</span>for <span class="token number">4</span>.2BSD pipes<span class="token punctuation">)</span>
  -i, --ignore-zeros         ignore zeroed blocks <span class="token keyword">in</span> archive <span class="token punctuation">(</span>means EOF<span class="token punctuation">)</span>
      --record-size<span class="token operator">=</span>NUMBER   NUMBER of bytes per record, multiple of <span class="token number">512</span>

 Archive <span class="token function">format</span> selection:

  -H, --format<span class="token operator">=</span>FORMAT        create archive of the given <span class="token function">format</span>

 FORMAT is one of the following:

    gnu                      GNU <span class="token function">tar</span> <span class="token number">1.13</span>.x <span class="token function">format</span>
    oldgnu                   GNU <span class="token function">format</span> as per <span class="token function">tar</span> <span class="token operator">&#x3C;</span><span class="token operator">=</span> <span class="token number">1.12</span>
    pax                      POSIX <span class="token number">1003.1</span>-2001 <span class="token punctuation">(</span>pax<span class="token punctuation">)</span> <span class="token function">format</span>
    posix                    same as pax
    ustar                    POSIX <span class="token number">1003.1</span>-1988 <span class="token punctuation">(</span>ustar<span class="token punctuation">)</span> <span class="token function">format</span>
    v7                       old V7 <span class="token function">tar</span> <span class="token function">format</span>

      --old-archive, --portability
                             same as --format<span class="token operator">=</span>v7
      --pax-option<span class="token operator">=</span>keyword<span class="token punctuation">[</span><span class="token punctuation">[</span>:<span class="token punctuation">]</span><span class="token operator">=</span>value<span class="token punctuation">]</span><span class="token punctuation">[</span>,keyword<span class="token punctuation">[</span><span class="token punctuation">[</span>:<span class="token punctuation">]</span><span class="token operator">=</span>value<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">..</span>.
                             control pax keywords
      --posix                same as --format<span class="token operator">=</span>posix
  -V, --label<span class="token operator">=</span>TEXT           create archive with volume name TEXT<span class="token punctuation">;</span> at
                             list/extract time, use TEXT as a globbing pattern
                             <span class="token keyword">for</span> volume name

 Compression options:

  -a, --auto-compress        use archive suffix to determine the compression
                             program
  -I, --use-compress-program<span class="token operator">=</span>PROG
                             filter through PROG <span class="token punctuation">(</span>must accept -d<span class="token punctuation">)</span>
  -j, --bzip2                filter the archive through <span class="token function">bzip2</span>
  -J, --xz                   filter the archive through xz
      --lzip                 filter the archive through lzip
      --lzma                 filter the archive through lzma
      --lzop
      --no-auto-compress     <span class="token keyword">do</span> not use archive suffix to determine the
                             compression program
  -z, --gzip, --gunzip, --ungzip   filter the archive through <span class="token function">gzip</span>
  -Z, --compress, --uncompress   filter the archive through compress

 Local <span class="token function">file</span> selection:

      --add-file<span class="token operator">=</span>FILE        <span class="token function">add</span> given FILE to the archive <span class="token punctuation">(</span>useful <span class="token keyword">if</span> its name
                             starts with a dash<span class="token punctuation">)</span>
      --backup<span class="token punctuation">[</span><span class="token operator">=</span>CONTROL<span class="token punctuation">]</span>     backup before removal, choose version CONTROL
  -C, --directory<span class="token operator">=</span>DIR        change to directory DIR
      --exclude<span class="token operator">=</span>PATTERN      exclude files, given as a PATTERN
      --exclude-backups      exclude backup and lock files
      --exclude-caches       exclude contents of directories containing
                             CACHEDIR.TAG, except <span class="token keyword">for</span> the tag <span class="token function">file</span> itself
      --exclude-caches-all   exclude directories containing CACHEDIR.TAG
      --exclude-caches-under exclude everything under directories containing
                             CACHEDIR.TAG
      --exclude-tag<span class="token operator">=</span>FILE     exclude contents of directories containing FILE,
                             except <span class="token keyword">for</span> FILE itself
      --exclude-tag-all<span class="token operator">=</span>FILE exclude directories containing FILE
      --exclude-tag-under<span class="token operator">=</span>FILE   exclude everything under directories
                             containing FILE
      --exclude-vcs          exclude version control system directories
  -h, --dereference          follow symlinks<span class="token punctuation">;</span> archive and dump the files they
                             point to
      --hard-dereference     follow hard links<span class="token punctuation">;</span> archive and dump the files they
                             refer to
  -K, --starting-file<span class="token operator">=</span>MEMBER-NAME
                             begin at member MEMBER-NAME when reading the
                             archive
      --newer-mtime<span class="token operator">=</span>DATE     compare <span class="token function">date</span> and <span class="token function">time</span> when data changed only
      --no-null              disable the effect of the previous --null option
      --no-recursion         avoid descending automatically <span class="token keyword">in</span> directories
      --no-unquote           <span class="token keyword">do</span> not unquote filenames <span class="token builtin class-name">read</span> with -T
      --null                 -T reads null-terminated names, disable -C
  -N, --newer<span class="token operator">=</span>DATE-OR-FILE, --after-date<span class="token operator">=</span>DATE-OR-FILE
                             only store files newer than DATE-OR-FILE
      --one-file-system      stay <span class="token keyword">in</span> <span class="token builtin class-name">local</span> <span class="token function">file</span> system when creating archive
  -P, --absolute-names       don't strip leading <span class="token variable">`</span></span>/<span class="token string">'s from file names
      --recursion            recurse into directories (default)
      --suffix=STRING        backup before removal, override usual suffix ('</span>~<span class="token string">'
                             unless overridden by environment variable
                             SIMPLE_BACKUP_SUFFIX)
  -T, --files-from=FILE      get names to extract or create from FILE
      --unquote              unquote filenames read with -T (default)
  -X, --exclude-from=FILE    exclude patterns listed in FILE

 File name transformations:

      --strip-components=NUMBER   strip NUMBER leading components from file
                             names on extraction
      --transform=EXPRESSION, --xform=EXPRESSION
                             use sed replace EXPRESSION to transform file
                             names

 File name matching options (affect both exclude and include patterns):

      --anchored             patterns match file name start
      --ignore-case          ignore case
      --no-anchored          patterns match after any <span class="token variable"><span class="token variable">`</span>/' <span class="token punctuation">(</span>default <span class="token keyword">for</span>
                             exclusion<span class="token punctuation">)</span>
      --no-ignore-case       <span class="token keyword">case</span> sensitive matching <span class="token punctuation">(</span>default<span class="token punctuation">)</span>
      --no-wildcards         verbatim string matching
      --no-wildcards-match-slash   wildcards <span class="token keyword">do</span> not match <span class="token variable">`</span></span>/'</span>
      --wildcards            use wildcards <span class="token punctuation">(</span>default<span class="token punctuation">)</span>
      --wildcards-match-slash   wildcards match <span class="token variable"><span class="token variable">`</span>/' <span class="token punctuation">(</span>default <span class="token keyword">for</span> exclusion<span class="token punctuation">)</span>

 Informative output:

      --checkpoint<span class="token punctuation">[</span><span class="token operator">=</span>NUMBER<span class="token punctuation">]</span>  display progress messages every NUMBERth record
                             <span class="token punctuation">(</span>default <span class="token number">10</span><span class="token punctuation">)</span>
      --checkpoint-action<span class="token operator">=</span>ACTION   execute ACTION on each checkpoint
      --full-time            print <span class="token function">file</span> <span class="token function">time</span> to its full resolution
      --index-file<span class="token operator">=</span>FILE      send verbose output to FILE
  -l, --check-links          print a message <span class="token keyword">if</span> not all links are dumped
      --no-quote-chars<span class="token operator">=</span>STRING   disable quoting <span class="token keyword">for</span> characters from STRING
      --quote-chars<span class="token operator">=</span>STRING   additionally quote characters from STRING
      --quoting-style<span class="token operator">=</span>STYLE  <span class="token builtin class-name">set</span> name quoting style<span class="token punctuation">;</span> see below <span class="token keyword">for</span> valid STYLE
                             values
  -R, --block-number         show block number within archive with each message
                            
      --show-defaults        show <span class="token function">tar</span> defaults
      --show-omitted-dirs    when listing or extracting, list each directory
                             that does not match search criteria
      --show-transformed-names, --show-stored-names
                             show <span class="token function">file</span> or archive names after transformation
      --totals<span class="token punctuation">[</span><span class="token operator">=</span>SIGNAL<span class="token punctuation">]</span>      print total bytes after processing the archive<span class="token punctuation">;</span>
                             with an argument - print total bytes when this
                             SIGNAL is delivered<span class="token punctuation">;</span> Allowed signals are: SIGHUP,
                             SIGQUIT, SIGINT, SIGUSR1 and SIGUSR2<span class="token punctuation">;</span> the names
                             without SIG prefix are also accepted
      --utc                  print <span class="token function">file</span> modification <span class="token builtin class-name">times</span> <span class="token keyword">in</span> UTC
  -v, --verbose              verbosely list files processed
      --warning<span class="token operator">=</span>KEYWORD      warning control
  -w, --interactive, --confirmation
                             ask <span class="token keyword">for</span> confirmation <span class="token keyword">for</span> every action

 Compatibility options:

  -o                         when creating, same as --old-archive<span class="token punctuation">;</span> when
                             extracting, same as --no-same-owner

 Other options:

  -?, --help                 give this <span class="token builtin class-name">help</span> list
      --restrict             disable use of some potentially harmful options
      --usage                give a short usage message
      --version              print program version

Mandatory or optional arguments to long options are also mandatory or optional
<span class="token keyword">for</span> any corresponding short options.

The backup suffix is <span class="token variable">`</span></span>~', unless <span class="token builtin class-name">set</span> with --suffix or SIMPLE_BACKUP_SUFFIX.
The version control may be <span class="token builtin class-name">set</span> with --backup or VERSION_CONTROL, values are:

  none, off       never <span class="token function">make</span> backups
  t, numbered     <span class="token function">make</span> numbered backups
  nil, existing   numbered <span class="token keyword">if</span> numbered backups exist, simple otherwise
  never, simple   always <span class="token function">make</span> simple backups

Valid arguments <span class="token keyword">for</span> the --quoting-style option are:

  literal
  shell
  shell-always
  c
  c-maybe
  escape
  locale
  clocale

*This* <span class="token function">tar</span> defaults to:
--format<span class="token operator">=</span>gnu -f- -b20 --quoting-style<span class="token operator">=</span>escape --rmt-command<span class="token operator">=</span>/etc/rmt
--rsh-command<span class="token operator">=</span>/usr/bin/ssh

Report bugs to <span class="token operator">&#x3C;</span>bug-tar@gnu.org<span class="token operator">></span>.
</code></pre>
<p>長い。BSD tar よりも高機能なのかしら。</p>
<h2 id="サンプルコードについて"><a class="header-link" href="#サンプルコードについて"><span class="header-link-mark"></span></a>サンプルコードについて</h2>
<p>以降は、BSD tar・GNU tar どちらでも有効なコマンドを紹介する。動作に差がある場合はそれぞれ説明する。</p>
<p>サンプルとして以下のようなファイルを用意した。これらのファイルを指定して圧縮したり解凍したりした時にどうなるか見てみる。</p>
<pre class="language-bash"><code class="language-bash">$ tree
/tar-test/
├── file-1.txt
├── file-2.txt
└── my-directory
    ├── inner-file-1.txt
    └── inner-file-2.txt
</code></pre>
<p>BSD tar は MacOS Mojave 同梱のモノ、GNU tar は CentOS 7 に同梱のモノを使って検証する。</p>
<h2 id="cvf--アーカイブを作成する"><a class="header-link" href="#cvf--アーカイブを作成する"><span class="header-link-mark"></span></a><code>cvf</code> : アーカイブを作成する</h2>
<p>まずは、複数のファイルを一つのファイルにまとめるだけのやり方から。<code>tar</code> コマンドは Tape ARchive の略で、圧縮機能はそのオプション。<code>ar</code> というコマンドもあったんだとか。アーカイブにまとめたファイルを「Tarball」と呼んだりする。</p>
<ul>
  <li>参考 : <a href="https://ja.wikipedia.org/wiki/Ar_(UNIX)">ar (UNIX) - Wikipedia</a></li>
  <li>参考 : <a href="https://detail.chiebukuro.yahoo.co.jp/qa/question_detail/q10141343255">linuxでアーカイバーにarでなくtarを使うのは何故ですか？私はあまり大... - Yahoo!知恵袋</a></li>
</ul>
<pre class="language-bash"><code class="language-bash"><span class="token comment"># file-1・file-2 を dest.tar という1ファイルにまとめる</span>
$ <span class="token function">tar</span> -c -f ./dest.tar ./file-1.txt ./file-2.txt

<span class="token comment"># 1文字のオプションはハイフンも不要</span>
$ <span class="token function">tar</span> cf ./dest.tar ./file-1.txt ./file-2.txt

<span class="token comment"># 「v」を付けるとどのファイルを操作しているか詳細が出力される</span>
<span class="token comment"># 以下は BSD tar の場合。「a」は「Add」の意味</span>
$ <span class="token function">tar</span> cvf ./dest.tar ./file-1.txt ./file-2.txt
a ./file-1.txt
a ./file-2.txt

<span class="token comment"># 同じコマンドを BSD tar で。出力のされ方が違うが効果は同じ</span>
$ <span class="token function">tar</span> cvf ./dest-gnu.tar ./file-1.txt ./file-2.txt
./file-1.txt
./file-2.txt
</code></pre>
<p><code>-c</code> とかのハイフンはなくてもあっても大丈夫。繋げて書いても OK。</p>
<blockquote>
  <p>古くからあるコマンドなんで「 <code>-</code> を打つのさえめんどくさい、ファッキュー！」な人がこんな事をしたんだと思います。多分。</p>
  <ul>
    <li>参考 : <a href="https://qiita.com/ironsand/items/b53301eb07e0f6199126">tar.gz や tar.bz2 の展開は tar xf でOKです。 - Qiita</a></li>
  </ul>
</blockquote>
<p>…というワケで、単にアーカイブにまとめるだけなら、</p>
<pre class="language-bash"><code class="language-bash">$ <span class="token function">tar</span> cvf 【出力ファイル名】.tar 【追加するファイルやディレクトリを複数指定できる】
</code></pre>
<p>コレで覚えておこう。</p>
<p>動作に必要なのは <code>c</code> (Create) と <code>f</code> (File) だけだが、何をアーカイブにまとめているかは確認できた方が良いので、<code>v</code> (Verbose) も入れておこう。</p>
<p><code>-f</code> オプションはアーカイブするファイル名を指定したりするオプションなので、<code>tar cfv</code> などのようにオプションの途中に書くと動かない場合がある、らしい。ただ、手元の BSD tar と GNU tar で試した限りは、途中に書いても大丈夫だった。とはいえ、余計なトラブルを防ぐためにも、<strong><code>f</code> オプションは最後に書き、直後にファイル名を羅列していく</strong>、と覚えておこう。</p>
<h2 id="czvf--gzip-で圧縮する"><a class="header-link" href="#czvf--gzip-で圧縮する"><span class="header-link-mark"></span></a><code>czvf</code> : gzip で圧縮する</h2>
<p>先程の <code>cvf</code> に <em><code>z</code></em> オプションを付けると、<em>gzip</em> 形式で圧縮できる。Tar でまとめつつ圧縮するので、拡張子は <code>.tar.gz</code> と付けるのが慣例。gzip は GNU Zip の略で、Windows でよく見かける Zip 形式とは圧縮の方式が違う。</p>
<p>Mac・CentOS ともに、<code>gzip</code> (圧縮)、<code>gunzip</code> (解凍) というコマンドもある。<code>tar cz</code> (<code>--gzip</code> 圧縮)、<code>tar xz</code> (<code>--gunzip</code> 解凍) とほぼ同じ。</p>
<ul>
  <li>参考 : <a href="https://ja.wikipedia.org/wiki/Gzip">gzip - Wikipedia</a></li>
</ul>
<pre class="language-bash"><code class="language-bash"><span class="token comment"># 「c」「z」「v」は順不同</span>
$ <span class="token function">tar</span> czvf dest.tar.gz ./my-directory/
a ./my-directory
a ./my-directory/inner-file-1.txt
a ./my-directory/inner-file-2.txt

<span class="token comment"># こう書いても同じ</span>
$ <span class="token function">tar</span> cv --gzip -f dest.tar.gz ./my-directory/
</code></pre>
<p><strong>GNU tar のみ、<code>z</code> の代わりに <code>a</code> オプションを渡すと、ファイル名に指定した拡張子から自動的に判断して gzip 形式で圧縮してくれる</strong>。BSD tar では <code>a</code> オプションはないのでエラーになるし、自動判別機能もない。</p>
<pre class="language-bash"><code class="language-bash"><span class="token comment"># 拡張子から判断して gzip 形式で圧縮する</span>
$ <span class="token function">tar</span> cavf dest-gnu.tar.gz ./my-directory/
</code></pre>
<p><code>a</code> オプションを使って本当に gzip で圧縮されたかどうかは、<code>cvf</code> で単にアーカイブした場合のファイルと <code>czvf</code> でアーカイブ + gzip 圧縮した場合のファイルを別途生成し、ファイルサイズを比較してみれば良い。</p>
<p>GNU tar の <code>a</code> オプションは便利なものの、BSD tar では使えないので、素直に <strong><code>czvf</code></strong> で覚えた方が良いかと。</p>
<h3 id="cjvf--bzip2-形式で圧縮する"><a class="header-link" href="#cjvf--bzip2-形式で圧縮する"><span class="header-link-mark"></span></a><code>cjvf</code> : bzip2 形式で圧縮する</h3>
<p><code>z</code> 以外のオプションとして、<code>j</code> オプションがある。コレは <em>bzip2</em> という圧縮フォーマットで圧縮するモノ。gzip より圧縮率が高いが、処理速度が遅い。拡張子は <code>.tar.bz2</code> が慣例。bzip<strong>2</strong> と言うだけあって、「bzip」は原型であり別物なので注意。今はもう bzip2 形式しか見ないと思う。</p>
<pre class="language-bash"><code class="language-bash">$ <span class="token function">tar</span> cjvf dest.tar.bz2 ./my-directory/
</code></pre>
<p>Mac には <code>bzip2</code> (圧縮)、<code>bunzip2</code> (解凍) コマンドがあったが、CentOS には入っていなかった。また、<em>CentOS 7 に同梱の GNU tar だと <code>j</code> オプションでの圧縮・展開がいずれも動作しなかった</em>。BSD tar で圧縮した <code>.tar.bz2</code> を持ち込んで CentOS で <code>tar xjvf</code> などとしてみたがダメ。どうもこの GNU tar は bzip2 形式での圧縮・解凍には対応していないっぽい？あんま使うことないから気にしなくていっか。</p>
<ul>
  <li>参考 : <a href="https://qiita.com/fujieda/items/6c67db36a540b749d7ab">圧縮されたtarの展開方法の変遷 - Qiita</a></li>
</ul>
<h3 id="cjvf--xz-形式で圧縮する"><a class="header-link" href="#cjvf--xz-形式で圧縮する"><span class="header-link-mark"></span></a><code>cJvf</code> : xz 形式で圧縮する</h3>
<p>小文字の <code>j</code> が <em>bzip2</em> 形式での圧縮だったが、大文字の <code>J</code> にすると <strong>xz</strong> という圧縮フォーマットを使う。gzip・bzip2 より後発で、圧縮率・処理速度は概ね良好な形式。Tar と組み合わせて圧縮した際は <code>.tar.xz</code> と拡張子を付けるのが慣例。</p>
<pre class="language-bash"><code class="language-bash">$ <span class="token function">tar</span> cJvf dest.tar.xz ./my-directory/
</code></pre>
<p>Mac・CentOS ともに <code>xz</code> (圧縮)、<code>unxz</code> (解凍) コマンドが入っていた。</p>
<h2 id="xvf--アーカイブを展開する"><a class="header-link" href="#xvf--アーカイブを展開する"><span class="header-link-mark"></span></a><code>xvf</code> : アーカイブを展開する</h2>
<p><code>c</code> で Create (アーカイブの作成) なら、その逆の展開は <code>x</code> で eXtract。</p>
<pre class="language-bash"><code class="language-bash"><span class="token comment"># 同ディレクトリにある2つのファイルをまとめた場合</span>
$ <span class="token function">tar</span> cvf ./dest.tar ./file-1.txt ./file-2.txt

<span class="token comment"># 展開すると、同ディレクトリに2つのファイルが出力される (つまり元ファイルが上書きされるので注意)</span>
$ <span class="token function">tar</span> xvf ./dest.tar
</code></pre>
<p>展開時に <code>z</code> (gzip)・<code>j</code> (bzip2)・<code>J</code> (xz) と形式別のオプションを指定することで解凍できるが、最近の BSD tar と GNU tar はいずれも、<code>zjJ</code> の<strong>オプションなしに <code>xf</code> のみで自動的に解凍 + 展開</strong>を行ってくれる。</p>
<p>GNU tar なら <code>a</code> オプションと拡張子で自動判定して圧縮できるし、解凍時は <code>xvf</code> で自動判定して解凍してくれるので、もう圧縮形式を覚えておく必要はなくなる。BSD tar は圧縮時に自動判定してくれないが、結局 bzip2 や xz を使う機会はほとんどないので、黙って <code>czvf</code> ⇔ <code>xvf</code> で対比させておけばよいかと。</p>
<h2 id="tf--格納されているディレクトリ名ファイル名を取得する"><a class="header-link" href="#tf--格納されているディレクトリ名ファイル名を取得する"><span class="header-link-mark"></span></a><code>tf</code> : 格納されているディレクトリ名・ファイル名を取得する</h2>
<p><code>xf</code> で解凍・展開する前に、中身を確認したい時は、<strong><code>tf</code></strong> を使うと良い。<code>-t</code> は <code>--list</code> の略みたい。</p>
<pre class="language-bash"><code class="language-bash">$ <span class="token function">tar</span> tf bsd.tar.gz
./my-directory/
./my-directory/inner-file-1.txt
./my-directory/inner-file-2.txt

<span class="token comment"># 「v」を付けると ls -l 的に見える</span>
$ <span class="token function">tar</span> tvf bsd.tar.gz
drwxr-xr-x  <span class="token number">0</span> Neo    staff       <span class="token number">0</span>  <span class="token number">3</span>  <span class="token number">4</span> <span class="token number">13</span>:57 ./my-directory/
-rw-r--r--  <span class="token number">0</span> Neo    staff      <span class="token number">13</span>  <span class="token number">3</span>  <span class="token number">4</span> <span class="token number">13</span>:57 ./my-directory/inner-file-1.txt
-rw-r--r--  <span class="token number">0</span> Neo    staff      <span class="token number">13</span>  <span class="token number">3</span>  <span class="token number">4</span> <span class="token number">13</span>:57 ./my-directory/inner-file-2.txt
</code></pre>
<p><code>t</code> も <code>x</code> と同様、圧縮形式を指定するオプションは不要。<code>v</code> オプションを渡すと <code>ls -l</code> 同様に詳細が見えるので、<code>tf</code> でファイル名のみ見るか、<code>tvf</code> で詳細まで見るかはお好みで。</p>
<h2 id="まとめ表"><a class="header-link" href="#まとめ表"><span class="header-link-mark"></span></a>まとめ表</h2>
<p>ということで、ココまでの内容を表形式でまとめ。</p><table>
  <thead>
    <tr>
      <th>tar</th>
      <th colspan="2">Action</th>
      <th colspan="2">Type</th>
      <th colspan="2">Options</th>
      <th>Dest File</th>
      <th>Source Files...</th>
      <th>Alternative</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td rowspan="10">tar</td>
      <td rowspan="5"><strong>c</strong></td>
      <td rowspan="5">(--create)</td>
      <td>(指定なし)</td>
      <td>(= Tarball)</td>
      <td rowspan="10"><strong>v</strong><br><strong>f</strong></td>
      <td rowspan="10">(--verbose)<br>(--file)</td>
      <td>./dest.tar</td>
      <td rowspan="5">./source.txt ./sources/</td>
      <td style="background: #ddd;">-</td>
    </tr>
    <tr>
      <td><strong>z</strong></td>
      <td>(--gzip)</td>
      <td>./dest.tar.gz</td>
      <td>gzip</td>
    </tr>
    <tr>
      <td>j</td>
      <td>(--bzip2)</td>
      <td>./dest.tar.bz2</td>
      <td>bzip2</td>
    </tr>
    <tr>
      <td>J</td>
      <td>(--xz)</td>
      <td>./dest.tar.xz</td>
      <td>xz</td>
    </tr>
    <tr>
      <td>a</td>
      <td>(--auto-compress)</td>
      <td>./dest.tar.【Type】</td>
      <td><em>※ GNU tar Only</em></td>
    </tr>
    <tr>
      <td><strong>t</strong></td>
      <td>(--list)</td>
      <td><em>(指定なし)</em></td>
      <td><em>(= 自動判別)</em></td>
      <td>./dest.tar</td>
      <td style="background: #ddd;">-</td>
      <td style="background: #ddd;">-</td>
    </tr>
    <tr>
      <td rowspan="4"><strong>x</strong></td>
      <td rowspan="4">(--extract)</td>
      <td><em>(指定なし)</em></td>
      <td><em>(= 自動判別)</em></td>
      <td>./dest.tar</td>
      <td rowspan="4" style="background: #ddd;">-</td>
      <td style="background: #ddd;">-</td>
    </tr>
    <tr>
      <td>z</td>
      <td>(--gzip)</td>
      <td>./dest.tar.gz</td>
      <td>gunzip</td>
    </tr>
    <tr>
      <td>j</td>
      <td>(--bzip2)</td>
      <td>./dest.tar.bz2</td>
      <td>bunzip2</td>
    </tr>
    <tr>
      <td>J</td>
      <td>(--xz)</td>
      <td>./dest.tar.xz</td>
      <td>unxz</td>
    </tr>
  </tbody>
</table>
<p>コレをチートシートしておこうと思う。他にも色々なオプションがあるものの、普段使うのはこのくらいかな。</p>
<ul>
  <li>参考 : <a href="https://uxmilk.jp/12288">【tar】Linuxでファイルの圧縮・解凍をするコマンド | UX MILK</a></li>
  <li>参考 : <a href="https://eng-entrance.com/linux-command-tar">tarコマンドについて詳しくまとめました 【Linuxコマンド集】</a></li>
  <li>参考 : <a href="https://qiita.com/wnoguchi/items/cb0fa7c11b119e96f1e5#bzip2">圧縮展開系のコマンドのまとめ - Qiita</a></li>
  <li>参考 : <a href="https://www.atmarkit.co.jp/ait/articles/1608/15/news015.html">【 tar 】コマンド――アーカイブファイルを作成する／展開する : Linux基本コマンドTips（40） - ＠IT</a></li>
  <li>参考 : <a href="https://qiita.com/astro_super_nova/items/e7ff4ef5ec9fa253fd61">tarのオプションをまとめる - Qiita</a></li>
</ul>

      </main>
      <footer id="footer">
        <div id="footer-contents">
          <div id="date-time">
            <dl>
              <dt>Created</dt>
              <dd><time>2019-04-16</time></dd>
              <dt>Last-Modified</dt>
              <dd><time>2019-04-16</time></dd>
            </dl>
          </div>
          <nav id="footer-links">
            <ul>
              <li id="footer-link-about"><a href="/about/index.html" title="About">About</a></li>
              <li id="footer-link-search"><a href="/about/search.html" title="Search">Search</a></li>
              <li id="footer-link-feeds"><a href="/feeds.xml" title="Feeds">Feeds</a></li>
              <li id="footer-link-github"><a href="https://github.com/Neos21/" title="GitHub">GitHub</a></li>
            </ul>
          </nav>
          <nav id="to-top"><a href="#" title="To Top"><span>▲ To Top</span></a></nav>
        </div>
      </footer>
    </div>
  </body>
</html>
