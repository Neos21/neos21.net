<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="theme-color" content="#0990d0">
    <!-- Google Search Console -->
    <meta name="google-site-verification" content="AvoEr3mUJFF2H_mPWWgShfmjBVP3ywRpyx9hxeeq2d4">
    <title>MacOS で Docker を始めてみる - Neo's World</title>
    <link rel="icon" href="/favicon.ico">
    <link rel="stylesheet" href="/styles.css">
    <link rel="canonical" href="https://neos21.net/blog/2019/02/18-01.html">
    <link rel="search" type="application/opensearchdescription+xml" title="neos21.net" href="/opensearch.xml">
    <link rel="alternate" type="application/atom+xml" href="/feeds.xml">
    <link rel="author" href="http://www.hatena.ne.jp/neos21/">
    <!-- Global Site Tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YMHFLZP1M1"></script>
    <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date());gtag('config','G-YMHFLZP1M1');gtag('config','UA-106501-1');</script>
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6475907504235292" crossorigin="anonymous"></script>
  </head>
  <body>
    <div id="container">
      <header id="header">
        <div id="header-brand">
          <div id="header-brand-contents">
            <div id="site-title"><a href="/index.html">Neo's World</a></div>
            <nav id="header-links">
              <ul>
                <li id="header-link-about"><a href="/about/index.html" title="About"><span>About</span></a></li>
                <li id="header-link-search"><a href="/about/search.html" title="Search"><span>Search</span></a></li>
                <li id="header-link-feeds"><a href="/feeds.xml" title="Feeds"><span>Feeds</span></a></li>
                <li id="header-link-to-bottom"><a href="#footer" title="To Bottom"><span>▼ To Bottom</span></a></li>
              </ul>
            </nav>
          </div>
        </div>
        <nav id="global-nav">
          <ul>
            <li><a href="/blog/index.html">Blog</a></li>
            <li><a href="/tech/index.html">Tech</a></li>
            <li><a href="/music/index.html">Music</a></li>
            <li><a href="/games/index.html">Games</a></li>
            <li><a href="/gallery/index.html">Gallery</a></li>
            <li><a href="/etc/index.html">Etc.</a></li>
          </ul>
        </nav>
        <nav id="path">
          <ul>
            <li><a href="/index.html">Neo's World</a></li>
            <li><a href="/blog/index.html">Blog</a></li>
            <li><a href="/blog/2019/index.html">2019年</a></li>
            <li><a href="/blog/2019/02/index.html">02月</a></li>
          </ul>
        </nav>
      </header>
      <main id="main">
        <div id="header-date"><time>2019-02-18</time></div>
        <h1 id="page-title">MacOS で Docker を始めてみる</h1>

<p>これまで仮想環境というと <em>VirtualBox</em> (とそれを操作する <em>Vagrant</em>) を使ったことがあったが、今回 <strong>Docker</strong> に手を出してみた。</p>
<ul>
  <li><a href="https://www.docker.com/">Enterprise Container Platform | Docker</a></li>
</ul>
<p>とりあえず MacOS High Sierra か MacOS Mojave 上に Docker をインストールし、適当に CentOS でも動かしてみようと思う。</p>
<h2 id="目次"><a class="header-link" href="#目次"><span class="header-link-mark"></span></a>目次</h2>
<ul>
  <li><a href="#docker-%E3%81%AE%E3%83%80%E3%82%A6%E3%83%B3%E3%83%AD%E3%83%BC%E3%83%89%E3%81%A8%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB">Docker のダウンロードとインストール</a></li>
  <li><a href="#docker-%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6-centos-%E3%82%92%E8%B5%B7%E5%8B%95%E3%81%95%E3%81%9B%E3%81%A6%E3%81%BF%E3%82%8B">Docker を使って CentOS を起動させてみる</a></li>
  <li><a href="#docker-%E3%81%AF%E7%B5%82%E4%BA%86%E6%99%82%E3%81%AB%E5%A4%89%E6%9B%B4%E3%82%92%E4%BF%9D%E6%8C%81%E3%81%97%E3%81%A6%E3%81%8F%E3%82%8C%E3%81%AA%E3%81%84--docker-%E3%81%AE%E6%80%9D%E6%83%B3">Docker は終了時に変更を保持してくれない : Docker の思想</a></li>
  <li><a href="#%E3%81%AA%E3%82%93%E3%81%A0%E3%81%8B%E9%9B%A3%E3%81%97%E3%81%84%E3%81%9E-docker">なんだか難しいぞ Docker</a></li>
</ul>
<h2 id="docker-のダウンロードとインストール"><a class="header-link" href="#docker-のダウンロードとインストール"><span class="header-link-mark"></span></a>Docker のダウンロードとインストール</h2>
<p>Mac 用の Docker (<strong>Docker Desktop</strong>) はコチラからダウンロードできる。</p>
<ul>
  <li><a href="https://store.docker.com/editions/community/docker-ce-desktop-mac">Docker Hub</a></li>
</ul>
<p>Docker をダウンロードするには、Docker ID というアカウントを作らないといけない。この後出てくる <em>Docker Hub</em> のために必要なようだ。</p>
<p>インストーラをダウンロードしたらそいつを開いて、いつものように <code>Applications/</code> ディレクトリに放り投げてやれば良い。</p>
<p>Docker を起動させると、タスクバーに Docker のアイコンが現れ、常駐するようになる。</p>
<p>ココまで到達すれば、ターミナルで <code>$ docker</code> コマンドが叩けるようになっていると思う。</p>
<h2 id="docker-を使って-centos-を起動させてみる"><a class="header-link" href="#docker-を使って-centos-を起動させてみる"><span class="header-link-mark"></span></a>Docker を使って CentOS を起動させてみる</h2>
<p>それでは、Docker を使って CentOS を起動させてみる。ターミナルで以下のように入力する。</p>
<pre class="language-bash"><code class="language-bash">$ docker run -it centos:7 <span class="token function">bash</span>
</code></pre>
<p>いきなり <code>centos:7</code> という文言が登場するので、「VirtualBox でいうイメージファイルは要らないのか？」と思うが、ココで <em>Docker Hub</em> が登場する。</p>
<p>Docker Hub は、Docker イメージ (Docker で動作する仮想環境) を公開できる GitHub のようなモノで、ココに色々なベンダや団体が公式で Docker イメージを置いて配信してくれている。</p>
<ul>
  <li><a href="https://hub.docker.com/">Docker Hub</a></li>
</ul>
<p>ユーザは基本的に Docker Hub から Docker イメージをダウンロードして利用するワケだが、ローカルにその Docker イメージがなければ、自動的に Docker Hub から検索して取得してくれるのだ。</p>
<p>CentOS の場合は、次のページで配布されているイメージ名 (タグ) が確認できる。</p>
<ul>
  <li><a href="https://hub.docker.com/_/centos">Docker Hub</a></li>
</ul>
<p>もし上述のコマンドで、<code>centos:7</code> ではなく <code>centos</code> と指定した場合は、その時点での最新版が取得できる。他にも <code>centos:6</code> (<code>centos:centos6</code> と書いても同じ) とか、<code>centos:7.6.1810</code> とか、色々なバージョンがタグ付けされて公開されている。</p>
<p>初回はこの Docker Hub から Docker イメージがダウンロードされるのだが、CentOS の場合で 200MB くらいあるので、ポケット Wi-Fi を使っているような人は通信量に注意。</p>
<p>さて、初回は Docker イメージのダウンロードに少々時間がかかるが、それが完了すると、CentOS のプロンプトが表示されるだろう。</p>
<pre class="language-bash"><code class="language-bash"><span class="token comment"># 起動コマンドを叩くと…</span>
$ docker run -it centos:7 <span class="token function">bash</span>

<span class="token comment"># こんなプロンプトが表示されるはず</span>
<span class="token punctuation">[</span>root@380f3a76c398 /<span class="token punctuation">]</span><span class="token comment"># whoami</span>
root

<span class="token comment"># CentOS が動作していることが分かる</span>
<span class="token punctuation">[</span>root@380f3a76c398 /<span class="token punctuation">]</span><span class="token comment"># cat /etc/redhat-release </span>
CentOS Linux release <span class="token number">7.6</span>.1810 <span class="token punctuation">(</span>Core<span class="token punctuation">)</span> 
</code></pre>
<p>こんな感じで、CentOS が使えるようになった。</p>
<h2 id="docker-は終了時に変更を保持してくれない--docker-の思想"><a class="header-link" href="#docker-は終了時に変更を保持してくれない--docker-の思想"><span class="header-link-mark"></span></a>Docker は終了時に変更を保持してくれない : Docker の思想</h2>
<p>CentOS が触れるようになったので、<code>yum</code> で色々インストールして、コードを書いて動かしたりしてみて、「あぁ〜満足、今日はおしまい〜」と <strong><code>exit</code> を打ったら最後。</strong></p>
<p>翌日、同じ <code>$ docker run</code> コマンドで CentOS を立ち上げてみると、昨日行ったはずの設定変更も、作ったファイルも、全てが消えてしまっているのだ。</p>
<p>もちろん、ファイルを永続化したり、OS 周りの設定変更を保存したりする方法はあるのだが、何も考えずに <code>$ docker run</code> と <code>$$ exit</code> で起動・終了していると、このような挙動になる。<code>docker start</code> とかの話を始めると少々長くなるので今回は省略するが、このような挙動は、Docker の基本思想によるものであることに触れておこう。</p>
<p>Docker は、「Docker イメージ」と呼ばれる「設計図・設計書」を基に、「Docker コンテナ」という「箱 (実体)」を作る。</p>
<p>「Docker イメージ」の実態は <code>Dockerfile</code> というファイルに記述されたスクリプトで、ココに「Docker コンテナを起動する前にやること」を書いておくのだ。例えば、Node.js がすぐさま使える <code>node</code> イメージの場合だと、「ベースの OS に Debian を使って、Node.js をインストールしておいて、npm コマンドが使えるように PATH を通して…」的なことを、<code>Dockerfile</code> に記述している。実際のファイルは以下で閲覧できる。</p>
<ul>
  <li><a href="https://github.com/nodejs/docker-node">GitHub - nodejs/docker-node: Official Docker Image for Node.js</a></li>
  <li><a href="https://github.com/nodejs/docker-node/blob/master/10/jessie/Dockerfile">docker-node/Dockerfile at master · nodejs/docker-node · GitHub</a> … たとえばコレとか</li>
</ul>
<p>で、Docker イメージを基に「箱」を作る、と表現したが、「Docker コンテナ」というのが、実際に稼動している仮想環境のことだ。セキュリティ用語に「サンドボックス」という言葉があるが、Docker コンテナはこの考えに近い。箱の内で行われた変更は、外部には影響しないし、最後は箱ごと捨ててしまうのだ。</p>
<p>Docker はこの<em>「Docker コンテナ」を、頻繁に起動したり、終了して破棄したり</em>、といった使い方が想定されている。つまり、</p>
<ol>
  <li>予め「Docker イメージ (<code>Dockerfile</code>)」で、「こういうアプリケーションサーバを構築して、起動させるぞ」といった命令を書いておき、</li>
  <li><code>$ docker run</code> コマンドによりそのイメージからコンテナを生成、アプリケーションサーバを起動させる</li>
  <li>サーバがクラッシュしたり、機能改修によって中身を差し替えたくなったら、起動しているコンテナを終了して破棄し、別の新たなコンテナを起動する</li>
</ol>
<p>といった使い方を見越して作られているのだ。</p>
<p>VirtualBox なんかとは違い、<strong>「1つのコンテナ = 1つの仮想環境」で動かすのは1プロセスだけ</strong>、という感覚で、その「仮想環境 = Docker コンテナ = 箱」を、用途に応じてポイポイとっかえひっかえするワケだ。</p>
<h2 id="なんだか難しいぞ-docker"><a class="header-link" href="#なんだか難しいぞ-docker"><span class="header-link-mark"></span></a>なんだか難しいぞ Docker</h2>
<p>2019年、遅ればせながら Docker に入門したワタクシ。使っていくうちに理解できることも増えてきたが、VirtualBox や Vagrant のような感覚とは違う使い方で、戸惑うことも多い。</p>
<p>これからちょくちょく Docker の使い方について、理解したことを紹介していこうと思う。</p>

      </main>
      <footer id="footer">
        <div id="footer-contents">
          <div id="date-time">
            <dl>
              <dt>Created</dt>
              <dd><time>2019-02-18</time></dd>
              <dt>Last-Modified</dt>
              <dd><time>2019-02-18</time></dd>
            </dl>
          </div>
          <nav id="footer-links">
            <ul>
              <li id="footer-link-about"><a href="/about/index.html" title="About">About</a></li>
              <li id="footer-link-search"><a href="/about/search.html" title="Search">Search</a></li>
              <li id="footer-link-feeds"><a href="/feeds.xml" title="Feeds">Feeds</a></li>
              <li id="footer-link-github"><a href="https://github.com/Neos21/" title="GitHub">GitHub</a></li>
            </ul>
          </nav>
          <nav id="to-top"><a href="#" title="To Top"><span>▲ To Top</span></a></nav>
        </div>
      </footer>
    </div>
  </body>
</html>
