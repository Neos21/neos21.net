<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="theme-color" content="#0990d0">
    <!-- Google Search Console -->
    <meta name="google-site-verification" content="AvoEr3mUJFF2H_mPWWgShfmjBVP3ywRpyx9hxeeq2d4">
    <title>JavaScript だけでブラウザ上からスマホの向きや動きを知る … 2 DeviceMotion 編 - Neo's World</title>
    <link rel="icon" href="/favicon.ico">
    <link rel="stylesheet" href="/styles.css">
    <link rel="canonical" href="https://neos21.net/blog/2017/10/21-02.html">
    <link rel="search" type="application/opensearchdescription+xml" title="neos21.net" href="/opensearch.xml">
    <link rel="alternate" type="application/atom+xml" href="/feeds.xml">
    <link rel="author" href="http://www.hatena.ne.jp/neos21/">
    <!-- Global Site Tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YMHFLZP1M1"></script>
    <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date());gtag('config','G-YMHFLZP1M1');gtag('config','UA-106501-1');</script>
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6475907504235292" crossorigin="anonymous"></script>
  </head>
  <body>
    <div id="container">
      <header id="header">
        <div id="header-brand">
          <div id="header-brand-contents">
            <div id="site-title"><a href="/index.html">Neo's World</a></div>
            <nav id="header-links">
              <ul>
                <li id="header-link-about"><a href="/about/index.html" title="About"><span>About</span></a></li>
                <li id="header-link-search"><a href="/about/search.html" title="Search"><span>Search</span></a></li>
                <li id="header-link-feeds"><a href="/feeds.xml" title="Feeds"><span>Feeds</span></a></li>
                <li id="header-link-to-bottom"><a href="#footer" title="To Bottom"><span>▼ To Bottom</span></a></li>
              </ul>
            </nav>
          </div>
        </div>
        <nav id="global-nav">
          <ul>
            <li><a href="/blog/index.html">Blog</a></li>
            <li><a href="/tech/index.html">Tech</a></li>
            <li><a href="/music/index.html">Music</a></li>
            <li><a href="/games/index.html">Games</a></li>
            <li><a href="/gallery/index.html">Gallery</a></li>
            <li><a href="/etc/index.html">Etc.</a></li>
          </ul>
        </nav>
        <nav id="path">
          <ul>
            <li><a href="/index.html">Neo's World</a></li>
            <li><a href="/blog/index.html">Blog</a></li>
            <li><a href="/blog/2017/index.html">2017年</a></li>
            <li><a href="/blog/2017/10/index.html">10月</a></li>
          </ul>
        </nav>
      </header>
      <main id="main">
        <div id="header-date"><time>2017-10-21</time></div>
        <h1 id="page-title">JavaScript だけでブラウザ上からスマホの向きや動きを知る … 2 DeviceMotion 編</h1>

<p>前回紹介した DeviceOrientation は「端末が現在どのような方角を向いていて、どのくらい傾いているか」が分かるシロモノだった。</p>
<ul>
  <li><a href="/blog/2017/10/20-01.html">JavaScript だけでブラウザ上からスマホの向きや動きを知る … 1 DeviceOrientation 編</a></li>
</ul>
<p>今回は <strong>DeviceMotion</strong>、<em>加速度センサー</em> の情報を取得する。</p>
<p>これを使うと、一定の速度以上で端末を動かしたことを検知するとか、ユーザが端末を持ってジャンプした、とかいう動きを検知することができる。動きの種類に応じた処理を行いたい時に使えるだろう。</p>
<p>以下の GitHub Pages にサンプルを作ったので、コチラを見ながら読んでみてほしい。</p>
<ul>
  <li><a href="https://neos21.github.io/poc-ios-safari-web/js-api-access-1.html">iOS Safari Web Test</a></li>
</ul>
<h2 id="対象ブラウザがイベントを取得できるかの検知"><a class="header-link" href="#対象ブラウザがイベントを取得できるかの検知"><span class="header-link-mark"></span></a>対象ブラウザがイベントを取得できるかの検知</h2>
<p>対象のブラウザが DeviceMotion (加速度センサー) のイベントを取得できるかは、以下のように確認する。</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword control-flow">if</span><span class="token punctuation">(</span><span class="token maybe-class-name">DeviceMotionEvent</span> <span class="token keyword">in</span> <span class="token dom variable">window</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 加速度センサーが使える</span>
<span class="token punctuation">}</span>
</code></pre>
<p>こちらも DeviceOrientationEvent と同じように、 <code>window.ondevicemotion</code> というプロパティもあるので覚えておきたい。</p>
<h2 id="devicemotionevent-の取得方法"><a class="header-link" href="#devicemotionevent-の取得方法"><span class="header-link-mark"></span></a>DeviceMotionEvent の取得方法</h2>
<p>以下のように <code>window</code> のイベントとして定義することで情報を取得できる。</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token dom variable">window</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">'devicemotion'</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// Interval</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'前回呼び出しからの経過時間 : '</span> <span class="token operator">+</span> event<span class="token punctuation">.</span><span class="token property-access">interval</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// Acceleration : 端末の加速度</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'x (左右) : '</span> <span class="token operator">+</span> event<span class="token punctuation">.</span><span class="token property-access">acceleration</span><span class="token punctuation">.</span><span class="token property-access">x</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'y (上下) : '</span> <span class="token operator">+</span> event<span class="token punctuation">.</span><span class="token property-access">acceleration</span><span class="token punctuation">.</span><span class="token property-access">y</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'z (前後) : '</span> <span class="token operator">+</span> event<span class="token punctuation">.</span><span class="token property-access">acceleration</span><span class="token punctuation">.</span><span class="token property-access">z</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// Acceleration Including Gravity : 端末の加速度 + 重力</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'x (左右) : '</span> <span class="token operator">+</span> event<span class="token punctuation">.</span><span class="token property-access">accelerationIncludingGravity</span><span class="token punctuation">.</span><span class="token property-access">x</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'y (上下) : '</span> <span class="token operator">+</span> event<span class="token punctuation">.</span><span class="token property-access">accelerationIncludingGravity</span><span class="token punctuation">.</span><span class="token property-access">y</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'z (前後) : '</span> <span class="token operator">+</span> event<span class="token punctuation">.</span><span class="token property-access">accelerationIncludingGravity</span><span class="token punctuation">.</span><span class="token property-access">z</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// Rotation Rate : デバイスの回転速度</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'alpha (縦回転)   : '</span> <span class="token operator">+</span> event<span class="token punctuation">.</span><span class="token property-access">rotationRate</span><span class="token punctuation">.</span><span class="token property-access">alpha</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'beta  (横回転)   : '</span> <span class="token operator">+</span> event<span class="token punctuation">.</span><span class="token property-access">rotationRate</span><span class="token punctuation">.</span><span class="token property-access">beta</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'gamma (水平回転) : '</span> <span class="token operator">+</span> event<span class="token punctuation">.</span><span class="token property-access">rotationRate</span><span class="token punctuation">.</span><span class="token property-access">gamma</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>コメントで大体説明してしまったが、加速度センサーやデバイスの回転方向を取得することができる。</p>
<h3 id="interval"><a class="header-link" href="#interval"><span class="header-link-mark"></span></a>interval</h3>
<p><code>interval</code> は前回情報を取得してから今回の呼び出しまでの経過時間を示す。大抵は0.001秒みたいな物凄い勢いで繰り返し呼び出されるので、ログ出力やパワーが必要な処理を高速で何度も呼び出さないように注意したい。</p>
<h3 id="acceleration"><a class="header-link" href="#acceleration"><span class="header-link-mark"></span></a>acceleration</h3>
<p><code>acceleration</code> は、端末の上下左右前後の加速度が分かる。端末をビュンと前に出したり、勢い良く高く上げたりすると、<code>x</code>・<code>y</code>・<code>z</code> の値が大きくなるのが分かると思う。</p>
<h3 id="accelerationincludinggravity"><a class="header-link" href="#accelerationincludinggravity"><span class="header-link-mark"></span></a>accelerationIncludingGravity</h3>
<p><code>accelerationIncludingGravity</code> は、<code>acceleration</code> が純粋に端末の位置移動による加速度を返していたのに対し、こちらはそれに加えて重力も加味した値が返される。</p>
<p>どちらかというと、<code>accelerationIncludingGravity</code> が重力加速度を含んだ生の加速度を返していて、<code>acceleration</code> はここから重力加速度を除いた情報として値を返しているようだ。</p>
<h3 id="rotationrate"><a class="header-link" href="#rotationrate"><span class="header-link-mark"></span></a>rotationRate</h3>
<p><code>rotationRate</code> はデバイスの回転速度。前後左右に傾けるような動きの速度が分かる。</p>
<hr>
<p>かなり高速で繰り返しイベントが発火するので、情報の扱いが大変そう。閾値の設定も難しいところだが、JavaScript だけで特殊な処理なしにこうした情報が取得できるのは面白い。</p>
<h2 id="参考文献"><a class="header-link" href="#参考文献"><span class="header-link-mark"></span></a>参考文献</h2>
<ul>
  <li><a href="http://cartman0.hatenablog.com/entry/2015/06/26/175002">JavaScript で加速度センサーの値を取ってみる - はしくれエンジニアもどきのメモ</a></li>
</ul>
<p>DeviceMotion・DeviceOrientation 両方のサンプルコードが載っているサイトたち。</p>
<ul>
  <li><a href="http://1010real.hateblo.jp/entry/2014/04/21/213118">javascriptでデバイスの向きと加速度を取得 - とある角度から</a></li>
  <li><a href="http://www.yoheim.net/blog.php?q=20130201">JS iPhoneに搭載されているセンターの値を、JavaScriptから取得する - YoheiM .NET</a></li>
  <li><a href="https://matome.naver.jp/odai/2140737862157033401">Webアプリ入門（HTML5+JavaScript) 6章センサー - NAVER まとめ</a></li>
</ul>

      </main>
      <footer id="footer">
        <div id="footer-contents">
          <div id="date-time">
            <dl>
              <dt>Created</dt>
              <dd><time>2017-10-21</time></dd>
              <dt>Last-Modified</dt>
              <dd><time>2017-10-21</time></dd>
            </dl>
          </div>
          <nav id="footer-links">
            <ul>
              <li id="footer-link-about"><a href="/about/index.html" title="About">About</a></li>
              <li id="footer-link-search"><a href="/about/search.html" title="Search">Search</a></li>
              <li id="footer-link-feeds"><a href="/feeds.xml" title="Feeds">Feeds</a></li>
              <li id="footer-link-github"><a href="https://github.com/Neos21/" title="GitHub">GitHub</a></li>
            </ul>
          </nav>
          <nav id="to-top"><a href="#" title="To Top"><span>▲ To Top</span></a></nav>
        </div>
      </footer>
    </div>
  </body>
</html>
