<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="theme-color" content="#0990d0">
    <!-- Google Search Console -->
    <meta name="google-site-verification" content="AvoEr3mUJFF2H_mPWWgShfmjBVP3ywRpyx9hxeeq2d4">
    <title>はてなブログのトップページやアーカイブページで記事ごとにシェアリンクを追加する - Neo's World</title>
    <link rel="icon" href="/favicon.ico">
    <link rel="stylesheet" href="/styles.css">
    <link rel="canonical" href="https://neos21.net/blog/2017/02/13-03.html">
    <link rel="search" type="application/opensearchdescription+xml" title="neos21.net" href="/opensearch.xml">
    <link rel="alternate" type="application/atom+xml" title="Feeds" href="/feeds.xml">
    <link rel="author" href="http://www.hatena.ne.jp/neos21/">
    <script defer src="/scripts.js"></script>
    <!-- Global Site Tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YMHFLZP1M1"></script>
    <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date());gtag('config','G-YMHFLZP1M1');gtag('config','UA-106501-1');</script>
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6475907504235292" crossorigin="anonymous"></script>
  </head>
  <body>
    <div id="container">
      <header id="header">
        <div id="header-brand">
          <div id="header-brand-contents">
            <div id="site-title"><a href="/index.html">Neo's World</a></div>
            <nav id="header-links">
              <ul>
                <li id="header-link-about"><a href="/about/index.html" title="About"><span>About</span></a></li>
                <li id="header-link-search"><a href="/about/search.html" title="Search"><span>Search</span></a></li>
                <li id="header-link-feeds"><a href="/feeds.xml" title="Feeds"><span>Feeds</span></a></li>
                <li id="header-link-to-bottom"><a href="#footer" title="To Bottom"><span>▼ To Bottom</span></a></li>
              </ul>
            </nav>
          </div>
        </div>
        <nav id="global-nav">
          <ul>
            <li><a href="/blog/index.html">Blog</a></li>
            <li><a href="/tech/index.html">Tech</a></li>
            <li><a href="/music/index.html">Music</a></li>
            <li><a href="/games/index.html">Games</a></li>
            <li><a href="/gallery/index.html">Gallery</a></li>
            <li><a href="/etc/index.html">Etc.</a></li>
          </ul>
        </nav>
        <nav id="path">
          <ul>
            <li><a href="/index.html">Neo's World</a></li>
            <li><a href="/blog/index.html">Blog</a></li>
            <li><a href="/blog/2017/index.html">2017年</a></li>
            <li><a href="/blog/2017/02/index.html">02月</a></li>
          </ul>
        </nav>
      </header>
      <main id="main">
        <div id="header-date"><time>2017-02-13</time></div>
        <h1 id="page-title">はてなブログのトップページやアーカイブページで記事ごとにシェアリンクを追加する</h1>

<p>はてなブログ標準のシェアリンク (ソーシャルパーツとも) は、<em>通常だと各記事のページにしか表示されない</em>。これを、<strong>トップページや、月別・カテゴリ別・検索結果などのアーカイブページにおいて、各記事の下にシェアリンクを追加する</strong>方法を紹介する。</p>
<p>完成形としては、以下の画像のように、各記事の下部に独自シェアリンクが配置された状態になる。</p>
<p>
  <img src="13-03-01.png" alt="アーカイブ表示">
</p>
<h2 id="通常のソーシャルパーツや独自シェアリンク"><a class="header-link" href="#通常のソーシャルパーツや独自シェアリンク"><span class="header-link-mark"></span></a>通常のソーシャルパーツや独自シェアリンク</h2>
<p>通常のシェアリンクは、「デザイン」→「カスタマイズ」→「記事」より、「ソーシャルパーツ」を選択して任意のシェアリンクを追加できる。</p>
<p>これを独自のシェアリンクにして高速化を図る方法は、以下の記事で紹介したように、<em>「デザイン」→「カスタマイズ」→「記事」→「記事下」</em> に HTML を追加することで作成できる。付随する CSS も以下で紹介しているので、シェアリンクのデザインは以下の記事をドウゾ。</p>
<ul>
  <li><a href="/blog/2017/01/30-02.html">はてなブログで独自のシェアリンク・フォローボタンを作る HTML・CSS</a></li>
</ul>
<p>このブログの場合、「記事下」に以下のような HTML を追加している。<code>{Permalink}</code> や <code>{Title}</code> 部分は、はてなブログが各記事の URL やタイトルに自動的に置換してくれる。</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>neos21-share<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>neos21-share-hatebu<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://b.hatena.ne.jp/entry/{Permalink}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blogicon-bookmark<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>i</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>span</span><span class="token punctuation">></span></span>Bookmark<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>span</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>li</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>neos21-share-twitter<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>https://twitter.com/share?url={Permalink}<span class="token entity named-entity" title="&#x26;">&#x26;amp;</span>text={Title}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blogicon-twitter<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>i</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>span</span><span class="token punctuation">></span></span>Twitter<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>span</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>li</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>neos21-share-facebook<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.facebook.com/share.php?u={Permalink}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blogicon-facebook<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>i</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>span</span><span class="token punctuation">></span></span>Facebook<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>span</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>li</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>neos21-share-pocket<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://getpocket.com/edit?url={Permalink}<span class="token entity named-entity" title="&#x26;">&#x26;amp;</span>title={Title}<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blogicon-chevron-down<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>i</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>span</span><span class="token punctuation">></span></span>Pocket<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>span</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>li</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>ul</span><span class="token punctuation">></span></span>
</code></pre>
<h2 id="独自シェアリンクを記事ごとに置く方法"><a class="header-link" href="#独自シェアリンクを記事ごとに置く方法"><span class="header-link-mark"></span></a>独自シェアリンクを記事ごとに置く方法</h2>
<p>さて、このような独自のシェアリンクを、トップページやアーカイブページにおいて記事ごとに配置するには、JavaScript を組み合わせるしかない。つまり、以下のような方法を取る。</p>
<ol>
  <li>「フッタ」部分に、シェアリンクのテンプレートとなる HTML を置いておく</li>
  <li>ページ読み込み時に、<code>1.</code> で用意したテンプレート HTML を複製し、記事ごとに URL やタイトル部分を書き換えて DOM 挿入する</li>
</ol>
<p>ということで、この方法を紹介する。</p>
<h2 id="テンプレート-html"><a class="header-link" href="#テンプレート-html"><span class="header-link-mark"></span></a>テンプレート HTML</h2>
<p>シェアリンクのテンプレートとなる HTML は、以下のようなものになる。<strong>これを「デザイン」→「カスタマイズ」→「フッタ」に仕込んでおく</strong>。</p>
<pre class="language-html"><code class="language-html"><span class="token comment">&#x3C;!-- シェアリンクのテンプレート --></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>neos21-template<span class="token punctuation">"</span></span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">="</span><span class="token attr-value"><span class="token property">display</span><span class="token punctuation">:</span>none<span class="token punctuation">;</span></span><span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>neos21-share<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>neos21-share-template<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>neos21-share-hatebu<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>neos21-share-hatebu-link<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blogicon-bookmark<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>i</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>span</span><span class="token punctuation">></span></span>Bookmark<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>span</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>li</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>neos21-share-twitter<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>neos21-share-twitter-link<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blogicon-twitter<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>i</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>span</span><span class="token punctuation">></span></span>Twitter<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>span</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>li</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>neos21-share-facebook<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>neos21-share-facebook-link<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blogicon-facebook<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>i</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>span</span><span class="token punctuation">></span></span>Facebook<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>span</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>li</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>neos21-share-pocket<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>neos21-share-pocket-link<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blogicon-chevron-down<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>i</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>span</span><span class="token punctuation">></span></span>Pocket<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>span</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>li</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>ul</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>div</span><span class="token punctuation">></span></span>
</code></pre>
<p>記事ごとに設置しているシェアリンクと同様のスタイルを適用させるため、基本的には「記事下」に配置した HTML と同様。一部異なるのは、いずれもスクリプトで処理するための部分。</p>
<ul>
  <li>テンプレートとして複製するときに扱いやすくするため、<code>ul.neos21-share</code> に対し <code>#neos21-share-template</code> という ID を付与している。</li>
  <li><code>a</code> 要素には <code>href</code> 属性を書いていない。記事ごとに URL を作る必要があるため、ココでは書いておかない。</li>
  <li>その代わり、この <code>a</code> 要素を特定しやすくするため、記事ごとのシェアリンクには付けていなかった <code>.neos21-share-【SNS 名】-link</code> というクラス名を付与している。</li>
  <li>このテンプレート全体は表示させる必要がないので、これを囲んだ <code>div#neos21-template</code> には <code>display:none</code> を書いておくと安全。</li>
</ul>
<p>というワケで、このようなテンプレート HTML が完成する。</p>
<h2 id="記事ごとにテンプレートを複製するスクリプト"><a class="header-link" href="#記事ごとにテンプレートを複製するスクリプト"><span class="header-link-mark"></span></a>記事ごとにテンプレートを複製するスクリプト</h2>
<p>このテンプレート HTML を複製し、記事ごとに仕込んでいくための処理は、以下のような JavaScript で行う。<em>これも「デザイン」→「カスタマイズ」→「フッタ」に仕込んでおく</em>。先程のテンプレート HTML の直後にでも置いておけば良いだろう。</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token operator">&#x3C;</span>script<span class="token operator">></span>
  <span class="token comment">// 記事ごとにシェアリンクを追加する</span>
  <span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Body 要素に任意のクラス名が存在するか確認する関数</span>
    <span class="token keyword">var</span> <span class="token function-variable function">hasClass</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">className</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword control-flow">return</span> <span class="token punctuation">(</span><span class="token string">" "</span> <span class="token operator">+</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">.</span><span class="token property-access">className</span> <span class="token operator">+</span> <span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\n\t]</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span> <span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">indexOf</span><span class="token punctuation">(</span><span class="token string">" "</span> <span class="token operator">+</span> className <span class="token operator">+</span> <span class="token string">" "</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// Body 要素のクラス名に応じて記事一覧を取得し、シェアリンクの挿入先を決定する</span>
    <span class="token keyword">var</span> articles<span class="token punctuation">;</span>
    <span class="token keyword">var</span> destClassName<span class="token punctuation">;</span>
    <span class="token keyword control-flow">if</span><span class="token punctuation">(</span><span class="token function">hasClass</span><span class="token punctuation">(</span><span class="token string">"page-index"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// トップページの場合</span>
      articles <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementsByClassName</span><span class="token punctuation">(</span><span class="token string">"hentry"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      destClassName <span class="token operator">=</span> <span class="token string">"customized-footer"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword control-flow">else</span> <span class="token keyword control-flow">if</span><span class="token punctuation">(</span><span class="token function">hasClass</span><span class="token punctuation">(</span><span class="token string">"page-archive"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// アーカイブページ (月別・カテゴリ別・検索結果) の場合</span>
      articles <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementsByClassName</span><span class="token punctuation">(</span><span class="token string">"archive-entry"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      destClassName <span class="token operator">=</span> <span class="token string">"archive-entry-body"</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// 該当しないページでは処理しない (シェアリンクは作らない)</span>
      <span class="token keyword control-flow">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// ページが読み込まれたら実行する</span>
    <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">"DOMContentLoaded"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// テンプレートを取得する</span>
      <span class="token keyword">var</span> template <span class="token operator">=</span> <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">"neos21-share-template"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      template<span class="token punctuation">.</span><span class="token method function property-access">removeAttribute</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      <span class="token comment">// 記事ごとにシェアリンクを複製して作っていく</span>
      <span class="token class-name">Array</span><span class="token punctuation">.</span><span class="token property-access">prototype</span><span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">.</span><span class="token method function property-access">call</span><span class="token punctuation">(</span>articles<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">article</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 記事情報を取得する。記事タイトルのみ URL 用にエンコードしておく</span>
        <span class="token keyword">var</span> entryTitleLink <span class="token operator">=</span> article<span class="token punctuation">.</span><span class="token method function property-access">getElementsByClassName</span><span class="token punctuation">(</span><span class="token string">"entry-title-link"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> title <span class="token operator">=</span> <span class="token function">encodeURIComponent</span><span class="token punctuation">(</span>entryTitleLink<span class="token punctuation">.</span><span class="token property-access">innerText</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">var</span> permalink <span class="token operator">=</span> entryTitleLink<span class="token punctuation">.</span><span class="token method function property-access">getAttribute</span><span class="token punctuation">(</span><span class="token string">"href"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// テンプレートを複製する</span>
        <span class="token keyword">var</span> clone <span class="token operator">=</span> template<span class="token punctuation">.</span><span class="token method function property-access">cloneNode</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// はてブ用リンク : http://b.hatena.ne.jp/entry/{Permalink}</span>
        <span class="token keyword">var</span> hatebuLink <span class="token operator">=</span> clone<span class="token punctuation">.</span><span class="token method function property-access">getElementsByClassName</span><span class="token punctuation">(</span><span class="token string">"neos21-share-hatebu-link"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        hatebuLink<span class="token punctuation">.</span><span class="token method function property-access">setAttribute</span><span class="token punctuation">(</span><span class="token string">"href"</span><span class="token punctuation">,</span> <span class="token string">"http://b.hatena.ne.jp/entry/"</span> <span class="token operator">+</span> permalink<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// Twitter 用リンク : https://twitter.com/share?url={Permalink}&#x26;amp;text={Title}</span>
        <span class="token keyword">var</span> twitterLink <span class="token operator">=</span> clone<span class="token punctuation">.</span><span class="token method function property-access">getElementsByClassName</span><span class="token punctuation">(</span><span class="token string">"neos21-share-twitter-link"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        twitterLink<span class="token punctuation">.</span><span class="token method function property-access">setAttribute</span><span class="token punctuation">(</span><span class="token string">"href"</span><span class="token punctuation">,</span> <span class="token string">"https://twitter.com/share?url="</span> <span class="token operator">+</span> permalink <span class="token operator">+</span> <span class="token string">"&#x26;amp;text="</span> <span class="token operator">+</span> title<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// Facebook 用リンク : http://www.facebook.com/share.php?u={Permalink}</span>
        <span class="token keyword">var</span> facebookLink <span class="token operator">=</span> clone<span class="token punctuation">.</span><span class="token method function property-access">getElementsByClassName</span><span class="token punctuation">(</span><span class="token string">"neos21-share-facebook-link"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        facebookLink<span class="token punctuation">.</span><span class="token method function property-access">setAttribute</span><span class="token punctuation">(</span><span class="token string">"href"</span><span class="token punctuation">,</span> <span class="token string">"http://www.facebook.com/share.php?u="</span> <span class="token operator">+</span> permalink<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// Pocket 用リンク : http://getpocket.com/edit?url={Permalink}&#x26;amp;title={Title}</span>
        <span class="token keyword">var</span> pocketLink <span class="token operator">=</span> clone<span class="token punctuation">.</span><span class="token method function property-access">getElementsByClassName</span><span class="token punctuation">(</span><span class="token string">"neos21-share-pocket-link"</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        pocketLink<span class="token punctuation">.</span><span class="token method function property-access">setAttribute</span><span class="token punctuation">(</span><span class="token string">"href"</span><span class="token punctuation">,</span> <span class="token string">"http://getpocket.com/edit?url="</span> <span class="token operator">+</span> permalink <span class="token operator">+</span> <span class="token string">"&#x26;amp;title="</span> <span class="token operator">+</span> title<span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 記事下部に挿入する</span>
        article<span class="token punctuation">.</span><span class="token method function property-access">getElementsByClassName</span><span class="token punctuation">(</span>destClassName<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token method function property-access">appendChild</span><span class="token punctuation">(</span>clone<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      
      <span class="token comment">// テンプレートを削除する</span>
      <span class="token dom variable">document</span><span class="token punctuation">.</span><span class="token method function property-access">getElementById</span><span class="token punctuation">(</span><span class="token string">"neos21-template"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">removeChild</span><span class="token punctuation">(</span>template<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&#x3C;</span><span class="token operator">/</span>script<span class="token operator">></span>
</code></pre>
<p>少々長いが、コメントも付けているので、やろうとしていることは分かっていただけるかと思う。</p>
<ul>
  <li>まずは Body 要素のクラス名から、このページが「トップページ」か「アーカイブページ」かを判別する。
    <ul>
      <li>それ以外のページ (プロフィールページや各記事のページ) はシェアリンクが不要なので、<code>return;</code> で処理しないようにしている。</li>
      <li>「トップページ」の場合と「アーカイブページ」の場合とで、記事ごとの HTML が若干異なる。
        <ul>
          <li>トップページ (<code>body.page-index</code>) の場合 : <code>article.hentry</code> の数だけ記事が存在する。各記事のフッタには空の <code>div.customized-footer</code> が存在するので、この内にシェアリンクを追加していく。</li>
          <li>アーカイブページ (<code>body.page-archive</code>) の場合 : <code>section.archive-entry</code> の数だけ記事が存在する。各記事にフッタを示す要素はないので、本文とはてなスターが含まれている、<code>div.archive-entry-body</code> の最後に追加していく。</li>
        </ul>
      </li>
    </ul>
  </li>
  <li>ココからの処理は、トップページかアーカイブページのいずれかの場合のみ行われる。<code>document.addEventListener("DOMContentLoaded")</code> を利用して、ページ読み込み時に使用する。</li>
  <li>最初に置いたテンプレート HTML のうち、<code>ul#neos21-share-template</code> を変数 <code>template</code> として取得しておく。これを記事ごとに複製して加工していく。複製時に邪魔しないよう ID は消しておく。</li>
  <li>記事ごとのループ処理は <code>Array.prototype.forEach.call()</code> を利用する。第一引数に Array ライクな関数、つまりココでは <code>var articles</code> が記事の要素の配列になっているので、コレを指定する。第二引数が配列の各要素に行わせる処理を関数で書いておく。この関数の引数 (ココでは <code>article</code> 部分) が、各要素を示す変数になる。ということで、<code>Array.prototype.forEach.call(articles, function(article) {});</code> という枠組みができる。</li>
</ul>
<p>ループ処理の中では、テンプレート HTML を複製して加工していく。</p>
<ul>
  <li>シェアリンクを作るため、「記事ごとの URL」と「記事のタイトル」を取得する。これは、記事タイトルとそのリンクが <code>h1</code>.entry-title > a.entry-title-link<code>でマークアップされているので、この</code>a.entry-title-link` を拾ってやればいい。</li>
  <li><code>a.entry-title-link</code> の <code>href</code> 属性値はどうもエスケープされた URL が入っているようなので、変数 <code>permalink</code> には <code>#encodeURIComponent()</code> は噛ませない。</li>
  <li>記事のタイトルは <code>a.entry-title-link</code> の <code>.innerText</code> で取得する。リンク URL に組み込むため、<code>#encodeURIComponent()</code> でエスケープしておく。</li>
  <li>変数 <code>template</code> を、<code>#cloneNode(true)</code> で子要素含めて丸ごと複製する。この複製した変数 <code>clone</code> の HTML をアレコレいじくって、記事の下部に挿入していく。</li>
  <li>各 SNS に合わせたリンク URL を生成していく。変数 <code>clone</code> の中から、各 <code>a</code> 要素を取得する。これを楽に書くため、<code>a</code> 要素に <code>.neos21-share-【SNS 名】-link</code> というクラス名を付与していた。</li>
  <li>この <code>a</code> 要素に <code>href</code> 属性を設定する。ココは各記事用のシェアリンクと同様なのだが、はてなブログが用意していた <code>{Permalink}</code> や <code>{Title}</code> といった変数ではなく、先ほどこねこね作った <code>permalink</code> や <code>title</code> という変数を使うことになる。</li>
  <li>こうして、変数 <code>clone</code> の中は各記事のシェアリンクに書き換えられた。あとはこれを各記事の最下部に挿入する。ページを判別したときに控えておいた <code>destClassName</code> が挿入先のノードになるので、このノードに対して <code>#appendChild()</code> してやる。</li>
</ul>
<p>最後に仕上げ。</p>
<ul>
  <li>テンプレート全体を囲んでいる <code>div#neos21-template</code> には <code>display:none</code> を指定しているので、必ずしもやる必要はないが、元の <code>ul#neos21-share-template</code> は <code>#removeChild()</code> で消しておくと気持ち良いかも。</li>
</ul>
<p>これでやりたいことはできた。</p>
<h2 id="アーカイブページのためにスタイルを少し直す"><a class="header-link" href="#アーカイブページのためにスタイルを少し直す"><span class="header-link-mark"></span></a>アーカイブページのためにスタイルを少し直す</h2>
<p>アーカイブページにおいて、サムネイル付きの記事の場合にシェアリンクが崩れるのを確認したので、Float を解除するための Clearfix を仕込んでおくと良いだろう。アーカイブページであることを判別するには、JavaScript でやっているのと同様、Body 要素に <code>.page-archive</code> クラスが付与されていれば良いので、これを親セレクタとして指定してやる。</p>
<p>JavaScript で挿入する <code>ul.neos21-share</code> は、この <code>span.social-buttons</code> の後ろに入るので、<code>span.social-buttons</code> 内の <code>span.star-container</code> をブロック要素化してマージンを与えておく。</p>
<pre class="language-css"><code class="language-css"><span class="token comment">/* はてなスターが入っている span 要素の手前で Clearfix */</span>
<span class="token selector">body<span class="token class">.page-archive</span> span<span class="token class">.social-buttons</span><span class="token pseudo-element">:before</span></span> <span class="token punctuation">{</span>
  <span class="token property">display</span><span class="token punctuation">:</span>block<span class="token punctuation">;</span>
  <span class="token property">visibility</span><span class="token punctuation">:</span>hidden<span class="token punctuation">;</span>
  <span class="token property">clear</span><span class="token punctuation">:</span>both<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token property">font-size</span><span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token property">content</span><span class="token punctuation">:</span><span class="token string">"."</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/* サムネイルとの余白を適度に開けるための指定 */</span>
<span class="token selector">body<span class="token class">.page-archive</span> span<span class="token class">.social-buttons</span> span<span class="token class">.star-container</span></span> <span class="token punctuation">{</span>
  <span class="token property">display</span><span class="token punctuation">:</span>block<span class="token punctuation">;</span>
  <span class="token property">margin-top</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span>
  <span class="token property">margin-bottom</span><span class="token punctuation">:</span><span class="token number">10</span><span class="token unit">px</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<p>上の CSS は HTML 構造を分かりやすくするために要素名も書いておいたが、余計なセレクタをかませると速度が遅くなるので、クラス名だけで良いだろう。</p>
<h2 id="スクリプトを圧縮する"><a class="header-link" href="#スクリプトを圧縮する"><span class="header-link-mark"></span></a>スクリプトを圧縮する</h2>
<p>CSS の圧縮は以下の記事で説明したように、npm-scripts を利用した Minify の手法を用意してあるので、コチラをドウゾ。</p>
<ul>
  <li><a href="/blog/2017/01/31-03.html">CSS を Minify (圧縮) する npm パッケージの Clean-CSS をコマンドラインで利用する「Clean-CSS-CLI」</a></li>
</ul>
<p>JavaScript の方は、独自のクラス名部分が使い回せそうだったので、今回は人力で「オレオレ Uglify」をしてみた。</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token operator">!</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">var</span> d<span class="token operator">=</span><span class="token dom variable">document</span><span class="token punctuation">,</span>i<span class="token operator">=</span><span class="token string">"getElementById"</span><span class="token punctuation">,</span>c<span class="token operator">=</span><span class="token string">"getElementsByClassName"</span><span class="token punctuation">,</span>q<span class="token operator">=</span><span class="token string">"setAttribute"</span><span class="token punctuation">,</span>f<span class="token operator">=</span><span class="token string">"href"</span><span class="token punctuation">,</span>s<span class="token operator">=</span><span class="token string">" "</span><span class="token punctuation">,</span><span class="token function-variable function">h</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter"><span class="token constant">C</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword control-flow">return</span> <span class="token operator">~</span><span class="token punctuation">(</span>s<span class="token operator">+</span>d<span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">.</span><span class="token property-access">className</span><span class="token operator">+</span>s<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\n\t]</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span>s<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">indexOf</span><span class="token punctuation">(</span>s<span class="token operator">+</span><span class="token string">"page-"</span><span class="token operator">+</span><span class="token constant">C</span><span class="token operator">+</span>s<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>a<span class="token punctuation">,</span>e<span class="token punctuation">,</span>n<span class="token operator">=</span><span class="token string">"neos21-"</span><span class="token punctuation">,</span>r<span class="token operator">=</span><span class="token string">"share-"</span><span class="token punctuation">,</span>w<span class="token operator">=</span>n<span class="token operator">+</span>r<span class="token punctuation">,</span>l<span class="token operator">=</span><span class="token string">"-link"</span><span class="token punctuation">,</span>t<span class="token operator">=</span><span class="token string">"template"</span><span class="token punctuation">;</span><span class="token keyword control-flow">if</span><span class="token punctuation">(</span><span class="token function">h</span><span class="token punctuation">(</span><span class="token string">"index"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>a<span class="token operator">=</span>d<span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">"hentry"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>e<span class="token operator">=</span><span class="token string">"customized-footer"</span><span class="token punctuation">;</span><span class="token keyword control-flow">else</span><span class="token punctuation">{</span><span class="token keyword control-flow">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">h</span><span class="token punctuation">(</span><span class="token string">"archive"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword control-flow">return</span><span class="token punctuation">;</span>a<span class="token operator">=</span>d<span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">"archive-entry"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>e<span class="token operator">=</span><span class="token string">"archive-entry-body"</span><span class="token punctuation">}</span>d<span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">"DOMContentLoaded"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">var</span> <span class="token constant">T</span><span class="token operator">=</span>d<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span>w<span class="token operator">+</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token constant">T</span><span class="token punctuation">.</span><span class="token method function property-access">removeAttribute</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Array</span><span class="token punctuation">.</span><span class="token property-access">prototype</span><span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">.</span><span class="token method function property-access">call</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter"><span class="token constant">A</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">var</span> <span class="token constant">L</span><span class="token operator">=</span><span class="token constant">A</span><span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">"entry-title"</span><span class="token operator">+</span>l<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token constant">E</span><span class="token operator">=</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span><span class="token constant">L</span><span class="token punctuation">.</span><span class="token property-access">innerText</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token constant">P</span><span class="token operator">=</span><span class="token constant">L</span><span class="token punctuation">.</span><span class="token method function property-access">getAttribute</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">,</span>o<span class="token operator">=</span><span class="token constant">T</span><span class="token punctuation">.</span><span class="token method function property-access">cloneNode</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function-variable function">x</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter"><span class="token constant">N</span><span class="token punctuation">,</span><span class="token constant">U</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>o<span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">(</span>w<span class="token operator">+</span><span class="token constant">N</span><span class="token operator">+</span>l<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span>q<span class="token punctuation">]</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span><span class="token constant">U</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token string">"hatebu"</span><span class="token punctuation">,</span><span class="token string">"http://b.hatena.ne.jp/entry/"</span><span class="token operator">+</span><span class="token constant">P</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token string">"twitter"</span><span class="token punctuation">,</span><span class="token string">"https://twitter.com/share?url="</span><span class="token operator">+</span><span class="token constant">P</span><span class="token operator">+</span><span class="token string">"&#x26;amp;text="</span><span class="token operator">+</span><span class="token constant">E</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token string">"facebook"</span><span class="token punctuation">,</span><span class="token string">"http://www.facebook.com/share.php?u="</span><span class="token operator">+</span><span class="token constant">P</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token string">"pocket"</span><span class="token punctuation">,</span><span class="token string">"http://getpocket.com/edit?url="</span><span class="token operator">+</span><span class="token constant">P</span><span class="token operator">+</span><span class="token string">"&#x26;amp;title="</span><span class="token operator">+</span><span class="token constant">E</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token constant">A</span><span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token method function property-access">appendChild</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>d<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span>n<span class="token operator">+</span>t<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">removeChild</span><span class="token punctuation">(</span><span class="token constant">T</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<p>このコードは先ほどのスクリプトと完全に同じ動きをする。</p>
<p>少しだけ改行を入れ、コメントを追加してみよう。</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token comment">// !function(){}(); で即時関数になる</span>
<span class="token operator">!</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">var</span> d<span class="token operator">=</span><span class="token dom variable">document</span><span class="token punctuation">,</span>
      i<span class="token operator">=</span><span class="token string">"getElementById"</span><span class="token punctuation">,</span>
      c<span class="token operator">=</span><span class="token string">"getElementsByClassName"</span><span class="token punctuation">,</span>
      q<span class="token operator">=</span><span class="token string">"setAttribute"</span><span class="token punctuation">,</span>
      f<span class="token operator">=</span><span class="token string">"href"</span><span class="token punctuation">,</span>
      <span class="token comment">// Body 要素のクラスを判別する関数</span>
      s<span class="token operator">=</span><span class="token string">" "</span><span class="token punctuation">,</span>
      <span class="token function-variable function">h</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter"><span class="token constant">C</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// ~ 演算子を使うと「indexOf() !== -1」(>= も同義) を代用できる</span>
        <span class="token keyword control-flow">return</span> <span class="token operator">~</span><span class="token punctuation">(</span>s<span class="token operator">+</span>d<span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">.</span><span class="token property-access">className</span><span class="token operator">+</span>s<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\n\t]</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span>s<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">indexOf</span><span class="token punctuation">(</span>s<span class="token operator">+</span><span class="token string">"page-"</span><span class="token operator">+</span><span class="token constant">C</span><span class="token operator">+</span>s<span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">// a : 元のコードの変数 articles に相当</span>
      a<span class="token punctuation">,</span>
      <span class="token comment">// e : 元のコードの変数 destClassName に相当</span>
      e<span class="token punctuation">,</span>
      <span class="token comment">// 使い回せそうなクラス名の文字列を分解して保持しておく</span>
      n<span class="token operator">=</span><span class="token string">"neos21-"</span><span class="token punctuation">,</span>
      r<span class="token operator">=</span><span class="token string">"share-"</span><span class="token punctuation">,</span>
      <span class="token comment">// "neos21-share-"</span>
      w<span class="token operator">=</span>n<span class="token operator">+</span>r<span class="token punctuation">,</span>
      l<span class="token operator">=</span><span class="token string">"-link"</span><span class="token punctuation">,</span>
      t<span class="token operator">=</span><span class="token string">"template"</span><span class="token punctuation">;</span>
  
  <span class="token comment">// 頻繁に使う document.getElementsByClassName() などはブラケット記法 (配列記法) でアクセスする</span>
  <span class="token comment">// カンマ演算子を利用して処理</span>
  <span class="token keyword control-flow">if</span><span class="token punctuation">(</span><span class="token function">h</span><span class="token punctuation">(</span><span class="token string">"index"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> a<span class="token operator">=</span>d<span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">"hentry"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> e<span class="token operator">=</span><span class="token string">"customized-footer"</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">else</span><span class="token punctuation">{</span>
    <span class="token comment">// return を先に行わせれば if 文を1行で済ませられる</span>
    <span class="token keyword control-flow">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">h</span><span class="token punctuation">(</span><span class="token string">"archive"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword control-flow">return</span><span class="token punctuation">;</span>
    a<span class="token operator">=</span>d<span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">"archive-entry"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>e<span class="token operator">=</span><span class="token string">"archive-entry-body"</span>
  <span class="token punctuation">}</span>
  
  d<span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">"DOMContentLoaded"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token comment">// テンプレート取得</span>
    <span class="token keyword">var</span> <span class="token constant">T</span><span class="token operator">=</span>d<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span>w<span class="token operator">+</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token constant">T</span><span class="token punctuation">.</span><span class="token method function property-access">removeAttribute</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token class-name">Array</span><span class="token punctuation">.</span><span class="token property-access">prototype</span><span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">.</span><span class="token method function property-access">call</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter"><span class="token constant">A</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token comment">// 変数 A が各記事の要素、変数 L が記事タイトルのリンク要素を取得</span>
      <span class="token keyword">var</span> <span class="token constant">L</span><span class="token operator">=</span><span class="token constant">A</span><span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">"entry-title"</span><span class="token operator">+</span>l<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token comment">// E : title</span>
          <span class="token constant">E</span><span class="token operator">=</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span><span class="token constant">L</span><span class="token punctuation">.</span><span class="token property-access">innerText</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token comment">// P : permalink</span>
          <span class="token constant">P</span><span class="token operator">=</span><span class="token constant">L</span><span class="token punctuation">.</span><span class="token method function property-access">getAttribute</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token comment">// o : 複製した要素 (clone)。「1」は暗黙型変換で「true」。</span>
          o<span class="token operator">=</span><span class="token constant">T</span><span class="token punctuation">.</span><span class="token method function property-access">cloneNode</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token comment">// x : 指定クラスの href 属性に指定の URL 文字列を設定する、という処理を関数化</span>
          <span class="token function-variable function">x</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter"><span class="token constant">N</span><span class="token punctuation">,</span><span class="token constant">U</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            o<span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">(</span>w<span class="token operator">+</span><span class="token constant">N</span><span class="token operator">+</span>l<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span>q<span class="token punctuation">]</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span><span class="token constant">U</span><span class="token punctuation">)</span>
          <span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token comment">// リンクの加工</span>
      <span class="token function">x</span><span class="token punctuation">(</span><span class="token string">"hatebu"</span><span class="token punctuation">,</span><span class="token string">"http://b.hatena.ne.jp/entry/"</span><span class="token operator">+</span><span class="token constant">P</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">x</span><span class="token punctuation">(</span><span class="token string">"twitter"</span><span class="token punctuation">,</span><span class="token string">"https://twitter.com/share?url="</span><span class="token operator">+</span><span class="token constant">P</span><span class="token operator">+</span><span class="token string">"&#x26;amp;text="</span><span class="token operator">+</span><span class="token constant">E</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">x</span><span class="token punctuation">(</span><span class="token string">"facebook"</span><span class="token punctuation">,</span><span class="token string">"http://www.facebook.com/share.php?u="</span><span class="token operator">+</span><span class="token constant">P</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">x</span><span class="token punctuation">(</span><span class="token string">"pocket"</span><span class="token punctuation">,</span><span class="token string">"http://getpocket.com/edit?url="</span><span class="token operator">+</span><span class="token constant">P</span><span class="token operator">+</span><span class="token string">"&#x26;amp;title="</span><span class="token operator">+</span><span class="token constant">E</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// 記事下部に追加</span>
      <span class="token constant">A</span><span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token method function property-access">appendChild</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// テンプレート削除</span>
    d<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span>n<span class="token operator">+</span>t<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">removeChild</span><span class="token punctuation">(</span><span class="token constant">T</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token comment">// false は暗黙型変換を利用して 0 と表記</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<p>こんな感じ。<code>"entry"</code> という文字列も4回出てきているのだが、1文字変数を作って文字列連結しても1文字多くなってしまうので止めた。</p>
<p>というか、はてブロテンプレートのクラス名を1文字変数で作るのは乱暴過ぎる気がするので、"page-" を関数内に埋め込んだり、<code>.entry-title-link</code> に変数を使ったりするのは止めた方が良いとは思う。可読性も兼ねて人力圧縮するなら、文字列結合で別の動きをさせるのは避けた方が良いだろう。</p>
<p>そういうワケで、このブログの最終的な「フッタ」HTML には、以下のように HTML と JavaScript を圧縮して挿入している。</p>
<pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>neos21-template<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>ul</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>neos21-share<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>neos21-share-template<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>neos21-share-hatebu<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>neos21-share-hatebu-link<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blogicon-bookmark<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>i</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>span</span><span class="token punctuation">></span></span>Bookmark<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>span</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>li</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>neos21-share-twitter<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>neos21-share-twitter-link<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blogicon-twitter<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>i</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>span</span><span class="token punctuation">></span></span>Twitter<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>span</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>li</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>neos21-share-facebook<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>neos21-share-facebook-link<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blogicon-facebook<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>i</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>span</span><span class="token punctuation">></span></span>Facebook<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>span</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>li</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>li</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>neos21-share-pocket<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>a</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>neos21-share-pocket-link<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>i</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>blogicon-chevron-down<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>i</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>span</span><span class="token punctuation">></span></span>Pocket<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>span</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>a</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>li</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>ul</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;</span>script</span><span class="token punctuation">></span></span><span class="token script"><span class="token language-javascript"><span class="token operator">!</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">var</span> d<span class="token operator">=</span><span class="token dom variable">document</span><span class="token punctuation">,</span>i<span class="token operator">=</span><span class="token string">"getElementById"</span><span class="token punctuation">,</span>c<span class="token operator">=</span><span class="token string">"getElementsByClassName"</span><span class="token punctuation">,</span>q<span class="token operator">=</span><span class="token string">"setAttribute"</span><span class="token punctuation">,</span>f<span class="token operator">=</span><span class="token string">"href"</span><span class="token punctuation">,</span>s<span class="token operator">=</span><span class="token string">" "</span><span class="token punctuation">,</span><span class="token function-variable function">h</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter"><span class="token constant">C</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword control-flow">return</span> <span class="token operator">~</span><span class="token punctuation">(</span>s<span class="token operator">+</span>d<span class="token punctuation">.</span><span class="token property-access">body</span><span class="token punctuation">.</span><span class="token property-access">className</span><span class="token operator">+</span>s<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">replace</span><span class="token punctuation">(</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">[\n\t]</span><span class="token regex-delimiter">/</span><span class="token regex-flags">g</span></span><span class="token punctuation">,</span>s<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">indexOf</span><span class="token punctuation">(</span>s<span class="token operator">+</span><span class="token string">"page-"</span><span class="token operator">+</span><span class="token constant">C</span><span class="token operator">+</span>s<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>a<span class="token punctuation">,</span>e<span class="token punctuation">,</span>n<span class="token operator">=</span><span class="token string">"neos21-"</span><span class="token punctuation">,</span>r<span class="token operator">=</span><span class="token string">"share-"</span><span class="token punctuation">,</span>w<span class="token operator">=</span>n<span class="token operator">+</span>r<span class="token punctuation">,</span>l<span class="token operator">=</span><span class="token string">"-link"</span><span class="token punctuation">,</span>t<span class="token operator">=</span><span class="token string">"template"</span><span class="token punctuation">;</span><span class="token keyword control-flow">if</span><span class="token punctuation">(</span><span class="token function">h</span><span class="token punctuation">(</span><span class="token string">"index"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>a<span class="token operator">=</span>d<span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">"hentry"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>e<span class="token operator">=</span><span class="token string">"customized-footer"</span><span class="token punctuation">;</span><span class="token keyword control-flow">else</span><span class="token punctuation">{</span><span class="token keyword control-flow">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">h</span><span class="token punctuation">(</span><span class="token string">"archive"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword control-flow">return</span><span class="token punctuation">;</span>a<span class="token operator">=</span>d<span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">"archive-entry"</span><span class="token punctuation">)</span><span class="token punctuation">,</span>e<span class="token operator">=</span><span class="token string">"archive-entry-body"</span><span class="token punctuation">}</span>d<span class="token punctuation">.</span><span class="token method function property-access">addEventListener</span><span class="token punctuation">(</span><span class="token string">"DOMContentLoaded"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">var</span> <span class="token constant">T</span><span class="token operator">=</span>d<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span>w<span class="token operator">+</span>t<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token constant">T</span><span class="token punctuation">.</span><span class="token method function property-access">removeAttribute</span><span class="token punctuation">(</span><span class="token string">"id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token class-name">Array</span><span class="token punctuation">.</span><span class="token property-access">prototype</span><span class="token punctuation">.</span><span class="token method function property-access">forEach</span><span class="token punctuation">.</span><span class="token method function property-access">call</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter"><span class="token constant">A</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">var</span> <span class="token constant">L</span><span class="token operator">=</span><span class="token constant">A</span><span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token string">"entry-title"</span><span class="token operator">+</span>l<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token constant">E</span><span class="token operator">=</span><span class="token function">encodeURIComponent</span><span class="token punctuation">(</span><span class="token constant">L</span><span class="token punctuation">.</span><span class="token property-access">innerText</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token constant">P</span><span class="token operator">=</span><span class="token constant">L</span><span class="token punctuation">.</span><span class="token method function property-access">getAttribute</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span><span class="token punctuation">,</span>o<span class="token operator">=</span><span class="token constant">T</span><span class="token punctuation">.</span><span class="token method function property-access">cloneNode</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token function-variable function">x</span><span class="token operator">=</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter"><span class="token constant">N</span><span class="token punctuation">,</span><span class="token constant">U</span></span><span class="token punctuation">)</span><span class="token punctuation">{</span>o<span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">(</span>w<span class="token operator">+</span><span class="token constant">N</span><span class="token operator">+</span>l<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span>q<span class="token punctuation">]</span><span class="token punctuation">(</span>f<span class="token punctuation">,</span><span class="token constant">U</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token string">"hatebu"</span><span class="token punctuation">,</span><span class="token string">"http://b.hatena.ne.jp/entry/"</span><span class="token operator">+</span><span class="token constant">P</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token string">"twitter"</span><span class="token punctuation">,</span><span class="token string">"https://twitter.com/share?url="</span><span class="token operator">+</span><span class="token constant">P</span><span class="token operator">+</span><span class="token string">"&#x26;amp;text="</span><span class="token operator">+</span><span class="token constant">E</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token string">"facebook"</span><span class="token punctuation">,</span><span class="token string">"http://www.facebook.com/share.php?u="</span><span class="token operator">+</span><span class="token constant">P</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">x</span><span class="token punctuation">(</span><span class="token string">"pocket"</span><span class="token punctuation">,</span><span class="token string">"http://getpocket.com/edit?url="</span><span class="token operator">+</span><span class="token constant">P</span><span class="token operator">+</span><span class="token string">"&#x26;amp;title="</span><span class="token operator">+</span><span class="token constant">E</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token constant">A</span><span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token method function property-access">appendChild</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>d<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">(</span>n<span class="token operator">+</span>t<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token method function property-access">removeChild</span><span class="token punctuation">(</span><span class="token constant">T</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&#x3C;/</span>script</span><span class="token punctuation">></span></span>
</code></pre>
<p><em>これでトップページからも記事をシェアしてもらいやすくなった</em>と思うので、皆様どうかシェアのほど宜しくお願い致します。ｗ</p>

      </main>
      <footer id="footer">
        <div id="footer-contents">
          <div id="date-time">
            <dl>
              <dt>Created</dt>
              <dd><time>2017-02-13</time></dd>
              <dt>Last-Modified</dt>
              <dd><time>2017-02-13</time></dd>
            </dl>
          </div>
          <nav id="footer-links">
            <ul>
              <li id="footer-link-about"><a href="/about/index.html" title="About">About</a></li>
              <li id="footer-link-search"><a href="/about/search.html" title="Search">Search</a></li>
              <li id="footer-link-feeds"><a href="/feeds.xml" title="Feeds">Feeds</a></li>
              <li id="footer-link-github"><a href="https://github.com/Neos21/" title="GitHub">GitHub</a></li>
            </ul>
          </nav>
          <nav id="to-top"><a href="#" title="To Top"><span>▲ To Top</span></a></nav>
        </div>
      </footer>
    </div>
  </body>
</html>
