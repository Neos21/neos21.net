<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Google Search Console -->
    <meta name="google-site-verification" content="AvoEr3mUJFF2H_mPWWgShfmjBVP3ywRpyx9hxeeq2d4">
    <title>npm パッケージを作って公開してみた - Neo's World</title>
    <link rel="icon" href="/favicon.ico">
    <link rel="stylesheet" href="/styles.css">
    <link rel="canonical" href="https://neos21.net/blog/2017/08/10-03.html">
    <link rel="search" type="application/opensearchdescription+xml" title="neos21.net" href="/opensearch.xml">
    <link rel="alternate" type="application/atom+xml" href="/feeds.xml">
    <link rel="author" href="http://www.hatena.ne.jp/neos21/">
    <!-- Global Site Tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YMHFLZP1M1"></script>
    <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date());gtag('config','G-YMHFLZP1M1');gtag('config','UA-106501-1');</script>
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6475907504235292" crossorigin="anonymous"></script>
  </head>
  <body>
    <div id="container">
      <header id="header">
        <div id="site-title"><a href="/index.html">Neo's World</a></div>
        <nav id="header-links">
          <ul>
            <li id="header-link-about"><a href="/about/index.html" title="About"><span>About</span></a></li>
            <li id="header-link-search"><a href="/about/search.html" title="Search"><span>Search</span></a></li>
            <li id="header-link-feeds"><a href="/feeds.xml" title="Feeds"><span>Feeds</span></a></li>
            <li id="header-link-to-bottom"><a href="#footer" title="To Bottom"><span>▼ To Bottom</span></a></li>
          </ul>
        </nav>
        <nav id="global-nav">
          <ul>
            <li><a href="/blog/index.html">Blog</a></li>
            <li><a href="/tech/index.html">Tech</a></li>
            <li><a href="/music/index.html">Music</a></li>
            <li><a href="/games/index.html">Games</a></li>
            <li><a href="/gallery/index.html">Gallery</a></li>
            <li><a href="/etc/index.html">Etc.</a></li>
          </ul>
        </nav>
        <nav id="path">
          <ul>
            <li><a href="/index.html">Neo's World</a></li>
            <li><a href="/blog/index.html">Blog</a></li>
            <li><a href="/blog/2017/index.html">2017年</a></li>
            <li><a href="/blog/2017/08/index.html">08月</a></li>
          </ul>
        </nav>
      </header>
      <main id="main">
        <div id="header-date"><time>2017-08-10</time></div>
        <h1 id="page-title">npm パッケージを作って公開してみた</h1>

<p>npm パッケージを Fork して公開してみたいなーと思い、まずはまっさらな状態から npm パッケージを公開するまでの方法を調べた。</p>
<p>ざっくりとした流れは以下のとおり。</p>
<ol>
  <li>npmjs にユーザ登録する</li>
  <li><code>npm adduser</code> でログインする</li>
  <li><code>npm init</code> でパッケージを作る</li>
  <li>エントリポイント (<code>index.js</code>) の作成</li>
  <li>CLI (<code>bin/my-module</code>) の作成</li>
  <li><code>.npmignore</code> の作成</li>
  <li><code>npm publish</code> で公開する</li>
</ol>
<p>今回この手順で作ってみたサンプルパッケージは以下。</p>
<ul>
  <li><a href="https://www.npmjs.com/package/@neos21/neos21">@neos21/neos21 - npm</a></li>
</ul>
<p>ついでにこのサンプルパッケージの実装は以下。</p>
<ul>
  <li><a href="https://github.com/Neos21/npm-neos21">GitHub - Neos21/npm-neos21: npm package example</a></li>
</ul>
<p>では、この手順を詳しく説明する。</p>
<h2 id="1-npmjs-にユーザ登録する"><a class="header-link" href="#1-npmjs-にユーザ登録する"><span class="header-link-mark"></span></a>1. npmjs にユーザ登録する</h2>
<p>まずは npm パッケージを公開している公式のリポジトリである、<a href="https://www.npmjs.com/">npmjs</a> でユーザ登録を行う。</p>
<p>「Sign up for npm」から</p>
<ul>
  <li>Name (任意の名前 : 表示用)</li>
  <li>Public Email (メアド : このアドレスに登録確認メールが飛んでくる)</li>
  <li>Username (<em>スコープ・パッケージ</em>に使用されるユーザ名)</li>
  <li>Password (パスワード)</li>
</ul>
<p>を登録する。</p>
<p>「Username」は npm パッケージの作者として表示される他、「@angular/cli」などのように「@ユーザ名/パッケージ名」という「スコープ・パッケージ」を作る時の「@ユーザ名」部分にあたる。</p>
<p>スコープ・パッケージは、元々プライベートモジュールを有料で扱えるもので、パブリックなパッケージなら無料で使えるようになった。これまでの npm パッケージ名は早い者勝ちだったが、ユーザ名を付与することで名前空間の衝突を避けられるようになった。</p>
<p>登録するとメールアドレスに確認のメールが飛んで来るので、URL にアクセスしてユーザ登録完了。</p>
<h2 id="2-npm-adduser-でログインする"><a class="header-link" href="#2-npm-adduser-でログインする"><span class="header-link-mark"></span></a>2. <code>npm adduser</code> でログインする</h2>
<p>続いてターミナルで <code>$ npm adduser</code> を実行する。ユーザ名とパスワードを聞かれるので入力すると、<code>~/.npmrc</code> にトークンが追記される。これで <code>npm publish</code> ができるようになる。</p>
<p>トークン情報はホームディレクトリの <code>~/.npmrc</code> である必要はなく、npm パッケージと同じディレクトリに置いた <code>.npmrc</code> に書いておいても大丈夫な様子。ただしうっかりこのトークンを含んだ <code>.npmrc</code> を GitHub などに公開しないよう注意。</p>
<h2 id="3-npm-init-でパッケージを作る"><a class="header-link" href="#3-npm-init-でパッケージを作る"><span class="header-link-mark"></span></a>3. <code>npm init</code> でパッケージを作る</h2>
<p>いよいよパッケージ作成。といっても、普段 npm パッケージを使うプロジェクトで行っているのと同じように、最初は <code>npm init</code> で始める。</p>
<p>今回はまず GitHub でパッケージ用のリポジトリを作り、それを <code>git clone</code> してきてから <code>npm init</code> する。こうすることで <code>package.json</code> にデフォルトで色々記載してもらえるので楽になる。</p>
<pre class="language-bash"><code class="language-bash">$ <span class="token function">git</span> clone https://github.com/【ユーザ名】/【リポジトリ名】
$ <span class="token builtin class-name">cd</span> 【リポジトリ名】/
$ <span class="token function">npm</span> init
</code></pre>
<p>パッケージ名は <code>@【ユーザ名】/【パッケージ名】</code> という書き方にするとスコープ・パッケージが作れる。<code>npm init --scope=【ユーザ名】</code> と始めると自動補完してくれる。勿論後から <code>package.json</code> を手修正して <code>@【ユーザ名】/【パッケージ名】</code> としても問題ない。</p>
<p>ちなみに、<strong>試してみたところ <code>@neos21</code> というユーザ名と同じパッケージ名では <code>npm publish</code> することができなかった</strong>。スコープ・パッケージのユーザ名部分に付く <code>@</code> は特殊な解釈を行っているようである。</p>
<h3 id="エントリポイント-indexjs-の作成"><a class="header-link" href="#エントリポイント-indexjs-の作成"><span class="header-link-mark"></span></a>エントリポイント (<code>index.js</code>) の作成</h3>
<p>まずは <code>package.json</code> の <code>main</code> に記載される <code>index.js</code> を作る。これが、npm パッケージを <code>require()</code> した時に使えるモノとなる。</p>
<p>今回は、ただユーザ名と URL をコンソール出力するだけのファイルを作ってみた。</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token comment">// index.js</span>
<span class="token keyword">function</span> <span class="token function"><span class="token maybe-class-name">Neos21</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'@neos21'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'http://neo.s21.xrea.com/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span><span class="token property-access">exports</span> <span class="token operator">=</span> <span class="token maybe-class-name">Neos21</span><span class="token punctuation">;</span>
</code></pre>
<p><code>require()</code> で使うために <code>module.exports</code> を忘れないこと。</p>
<h3 id="cli-binmy-module-の作成"><a class="header-link" href="#cli-binmy-module-の作成"><span class="header-link-mark"></span></a>CLI (<code>bin/my-module</code>) の作成</h3>
<p>次に、グローバルインストールした時や <code>npm run</code> などで呼ぶ時に実行される、コマンドラインモジュールを作る。</p>
<p><code>bin/</code> ディレクトリを作り、コマンド名となるファイル名 <code>neos21</code> を作ってみる。ユーザ名と URL を出力するだけのコマンドだ。</p>
<pre class="language-javascript"><code class="language-javascript">#<span class="token operator">!</span><span class="token operator">/</span>usr<span class="token operator">/</span>bin<span class="token operator">/</span>env node

<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'@neos21'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'http://neo.s21.xrea.com/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>そしてこれをコマンドラインで呼び出せるようにするため、<code>package.json</code> に <code>bin</code> プロパティを追加する。</p>
<pre class="language-json"><code class="language-json"><span class="token property">"main"</span><span class="token operator">:</span> <span class="token string">"index.js"</span><span class="token punctuation">,</span>
<span class="token property">"bin"</span><span class="token operator">:</span> <span class="token string">"bin/neos21"</span><span class="token punctuation">,</span>
</code></pre>
<h3 id="npmignore-の作成"><a class="header-link" href="#npmignore-の作成"><span class="header-link-mark"></span></a><code>.npmignore</code> の作成</h3>
<p><code>.npmignore</code> は <code>npm publish</code> する際に公開しないようにするファイルを設定するもの。<code>.gitignore</code> があって <code>.npmignore</code> がない場合は、<code>.gitignore</code> がそのままリネームされて <code>.npmignore</code> となって Publish されるようだ。</p>
<p>書き方は <code>.gitignore</code> と同じで、無視したいファイルやディレクトリを書けば良い。</p>
<h2 id="4-npm-publish-で公開する"><a class="header-link" href="#4-npm-publish-で公開する"><span class="header-link-mark"></span></a>4. <code>npm publish</code> で公開する</h2>
<p>これでとりあえず完成。おもむろに <strong><code>$ npm publish --access=public</code></strong> を叩いてみると、あっという間に公開される。スコープパッケージの場合は <code>--access=public</code> オプションを付けないとプライベート扱いになるためオプション必須。</p>
<p>公開されたパッケージは以下のような URL で確認できる他、<code>$ npm search 【パッケージ名】</code> で検索して表示されるようになる。</p>
<ul>
  <li><a href="https://www.npmjs.com/package/@neos21/neos21">@neos21/neos21 - npm</a></li>
</ul>
<h2 id="実際にパッケージを使ってみる"><a class="header-link" href="#実際にパッケージを使ってみる"><span class="header-link-mark"></span></a>実際にパッケージを使ってみる</h2>
<p>それでは実際にパッケージを使ってみる。</p>
<p>まずは適当なプロジェクトでローカルインストールし、<code>index.js</code> に作った関数を実行してみる。</p>
<pre class="language-bash"><code class="language-bash"><span class="token comment"># パッケージを利用する適当なプロジェクトを作る</span>
$ <span class="token function">mkdir</span> test-project <span class="token operator">&#x26;&#x26;</span> <span class="token builtin class-name">cd</span> <span class="token variable">$_</span>
$ <span class="token function">npm</span> init -y

<span class="token comment"># パッケージをローカルインストールする</span>
$ <span class="token function">npm</span> <span class="token function">install</span> @neos21/neos21 --save

<span class="token comment"># パッケージを呼び出して利用する JS ファイルを作ってみる</span>
$ <span class="token function">touch</span> test.js
</code></pre>
<p><code>test.js</code> ファイルには以下のように実装する。</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token comment">// パッケージを読み込む</span>
<span class="token keyword">var</span> neos21 <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'@neos21/neos21'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 読み込んだパッケージの関数を実行する</span>
<span class="token function">neos21</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>これで出来上がり。Node.js で <code>test.js</code> を実行してみると、正しくパッケージが読み込まれ、ユーザ名と URL が表示されるだろう。</p>
<pre class="language-bash"><code class="language-bash"><span class="token comment"># パッケージを利用しているスクリプトを実行する</span>
$ node test.js
@neos21
http://neo.s21.xrea.com/
</code></pre>
<p>次に、グローバルインストールをしてコマンドラインモジュール (<code>bin/neos21</code>) を使ってみる。</p>
<pre class="language-bash"><code class="language-bash"><span class="token comment"># パッケージをグローバルインストールする</span>
$ <span class="token function">npm</span> <span class="token function">install</span> -g @neos21/neos21

<span class="token comment"># パッケージを実行してみる</span>
$ neos21
@neos21
http://neo.s21.xrea.com/
</code></pre>
<p>ご覧のとおり。</p>
<hr>
<p>これで npm パッケージの作成から公開まではとりあえず試せた。</p>
<ul>
  <li>参考：<a href="http://efcl.info/2015/04/30/npm-namespace/">npmで名前空間を持ったモジュールを公開する方法(scoped modules) | Web Scratch</a></li>
  <li>参考：<a href="http://qiita.com/fnobi/items/f6b1574fb9f4518ed520">3分でできるnpmモジュール - Qiita</a></li>
  <li>参考：<a href="http://qiita.com/TsutomuNakamura/items/f943e0490d509f128ae2">初めてのnpm パッケージ公開 - Qiita</a></li>
</ul>

      </main>
      <footer id="footer">
        <div id="date-time">
          <dl>
            <dt>Created</dt>
            <dd><time>2017-08-10</time></dd>
            <dt>Last-Modified</dt>
            <dd><time>2017-08-10</time></dd>
          </dl>
        </div>
        <nav id="footer-links">
          <ul>
            <li id="footer-link-about"><a href="/about/index.html" title="About">About</a></li>
            <li id="footer-link-search"><a href="/about/search.html" title="Search">Search</a></li>
            <li id="footer-link-feeds"><a href="/feeds.xml" title="Feeds">Feeds</a></li>
            <li id="footer-link-github"><a href="https://github.com/Neos21/" title="GitHub">GitHub</a></li>
          </ul>
        </nav>
        <nav id="to-top"><a href="#" title="To Top"><span>▲ To Top</span></a></nav>
      </footer>
    </div>
  </body>
</html>
