<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="theme-color" content="#0990d0">
    <!-- Google Search Console -->
    <meta name="google-site-verification" content="AvoEr3mUJFF2H_mPWWgShfmjBVP3ywRpyx9hxeeq2d4">
    <title>xargs ナニモワカラナイ - Neo's World</title>
    <link rel="icon" href="/favicon.ico">
    <link rel="stylesheet" href="/styles.css">
    <link rel="canonical" href="https://neos21.net/blog/2021/02/20-01.html">
    <link rel="search" type="application/opensearchdescription+xml" title="neos21.net" href="/opensearch.xml">
    <link rel="alternate" type="application/atom+xml" title="Feeds" href="/feeds.xml">
    <link rel="author" href="http://www.hatena.ne.jp/neos21/">
    <script defer src="/scripts.js"></script>
    <!-- Global Site Tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YMHFLZP1M1"></script>
    <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date());gtag('config','G-YMHFLZP1M1');gtag('config','UA-106501-1');</script>
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6475907504235292" crossorigin="anonymous"></script>
  </head>
  <body>
    <div id="container">
      <header id="header">
        <div id="header-brand">
          <div id="header-brand-contents">
            <div id="site-title"><a href="/index.html">Neo's World</a></div>
            <nav id="header-links">
              <ul>
                <li id="header-link-about"><a href="/about/index.html" title="About"><span>About</span></a></li>
                <li id="header-link-search"><a href="/about/search.html" title="Search"><span>Search</span></a></li>
                <li id="header-link-feeds"><a href="/feeds.xml" title="Feeds"><span>Feeds</span></a></li>
                <li id="header-link-to-bottom"><a href="#footer" title="To Bottom"><span>▼ To Bottom</span></a></li>
              </ul>
            </nav>
          </div>
        </div>
        <nav id="global-nav">
          <ul>
            <li><a href="/blog/index.html">Blog</a></li>
            <li><a href="/tech/index.html">Tech</a></li>
            <li><a href="/music/index.html">Music</a></li>
            <li><a href="/games/index.html">Games</a></li>
            <li><a href="/gallery/index.html">Gallery</a></li>
            <li><a href="/etc/index.html">Etc.</a></li>
          </ul>
        </nav>
        <nav id="path">
          <ul>
            <li><a href="/index.html">Neo's World</a></li>
            <li><a href="/blog/index.html">Blog</a></li>
            <li><a href="/blog/2021/index.html">2021年</a></li>
            <li><a href="/blog/2021/02/index.html">02月</a></li>
          </ul>
        </nav>
      </header>
      <main id="main">
        <div id="header-date"><time>2021-02-20</time></div>
        <h1 id="page-title">xargs ナニモワカラナイ</h1>
<div class="ad-amazon">
  <div class="ad-amazon-image">
    <a href="https://www.amazon.co.jp/dp/B085C7B7VH?tag=neos21-22&amp;linkCode=osi&amp;th=1&amp;psc=1">
      <img src="https://m.media-amazon.com/images/I/51UQcVJV6HL._SL160_.jpg" width="108" height="160">
    </a>
  </div>
  <div class="ad-amazon-info">
    <div class="ad-amazon-title">
      <a href="https://www.amazon.co.jp/dp/B085C7B7VH?tag=neos21-22&amp;linkCode=osi&amp;th=1&amp;psc=1">Linuxコマンドブック ビギナーズ 第5版</a>
    </div>
  </div>
</div>
<p>コマンドの実行結果を利用して、別のコマンドを <code>for</code> 文的に実行できる、という認識でいる <em><code>xargs</code></em> コマンド。恥ずかしながらマジで使い方が分からなくて、コイツだけはググってコピペでしのいで、「何故かコレで動く」状態の認識で使ってきた。何なら怖いから便利そうでも逃げてきたくらいだ。</p>
<p>さすがに格好悪いので、今回は <code>xargs</code> コマンドの使い方を頑張って勉強する。</p>
<h2 id="目次"><a class="header-link" href="#目次"><span class="header-link-mark"></span></a>目次</h2>
<ul>
  <li>
    <ul>
      <li><a href="#xargs-%E3%81%AF-linux-%E3%81%A8-mac-%E3%81%A7%E4%BB%95%E6%A7%98%E3%81%8C%E9%81%95%E3%81%86">xargs は Linux と Mac で仕様が違う</a></li>
      <li><a href="#xargs-%E3%81%AE%E5%9F%BA%E6%9C%AC%E7%9A%84%E3%81%AA%E4%BD%BF%E3%81%84%E6%96%B9--l-1">xargs の基本的な使い方 (<code>-L 1</code>)</a></li>
      <li><a href="#%E5%BC%95%E6%95%B0%E3%81%8C%E6%B8%A1%E3%81%95%E3%82%8C%E3%82%8B%E6%95%B0%E3%82%92%E5%A4%89%E3%81%88%E3%82%8B">引数が渡される数を変える</a></li>
      <li><a href="#rm-%E3%82%AA%E3%83%97%E3%82%B7%E3%83%A7%E3%83%B3%E3%81%A7%E4%B8%80%E6%8B%AC%E5%89%8A%E9%99%A4%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B"><code>rm</code> オプションで一括削除してみる</a></li>
      <li><a href="#find--exec-%E3%81%A7%E6%B6%88%E3%81%97%E3%81%A6%E3%81%BF%E3%82%8B"><code>find -exec</code> で消してみる</a></li>
      <li><a href="#%E5%8C%BA%E5%88%87%E3%82%8A%E6%96%87%E5%AD%97%E3%82%92%E6%8C%87%E5%AE%9A%E3%81%99%E3%82%8B--0">区切り文字を指定する (<code>-0</code>)</a></li>
      <li><a href="#xargs-%E3%82%92%E7%A2%BA%E8%AA%8D%E3%81%97%E3%81%AA%E3%81%8C%E3%82%89%E5%AE%9F%E8%A1%8C%E3%81%97%E3%81%9F%E3%81%84--p"><code>xargs</code> を確認しながら実行したい (<code>-p</code>)</a></li>
      <li><a href="#%E5%BC%95%E6%95%B0%E3%81%AE%E6%8C%BF%E5%85%A5%E4%BD%8D%E7%BD%AE%E3%82%92%E8%87%AA%E5%88%86%E3%81%A7%E6%8C%87%E5%AE%9A%E3%81%99%E3%82%8B--i-">引数の挿入位置を自分で指定する (<code>-I {}</code>)</a></li>
      <li><a href="#xargs-%E3%81%A7%E8%A4%87%E6%95%B0%E3%81%AE%E3%82%B3%E3%83%9E%E3%83%B3%E3%83%89%E3%82%92%E5%AE%9F%E8%A1%8C%E3%81%97%E3%81%9F%E3%81%84"><code>xargs</code> で複数のコマンドを実行したい</a></li>
    </ul>
  </li>
  <li><a href="#%E4%BB%A5%E4%B8%8A">以上</a></li>
</ul>
<h2 id="xargs-は-linux-と-mac-で仕様が違う"><a class="header-link" href="#xargs-は-linux-と-mac-で仕様が違う"><span class="header-link-mark"></span></a>xargs は Linux と Mac で仕様が違う</h2>
<p>出たよ BSD。なんか変だなと思ったら Mac の <code>xargs</code> は認識しないオプションがあったよ。</p>
<ul>
  <li><a href="https://blog.ayakumo.net/entry/2018/02/07/070608">xargs が Linux と Mac 両方できちんと動くためには -i ではなく -I オプションを使う - blog.ayakumo.net</a></li>
</ul>
<p>簡単にいうと、<code>-i</code> も <code>-l</code> (小文字のエル) も引っかかるポイントがあるから止めとけってことみたい。</p>
<p>以降は Linux 版でも Mac 版でも同じように動作する書き方を紹介していく。</p>
<h2 id="xargs-の基本的な使い方--l-1"><a class="header-link" href="#xargs-の基本的な使い方--l-1"><span class="header-link-mark"></span></a>xargs の基本的な使い方 (<code>-L 1</code>)</h2>
<p><code>xargs</code> が一見分かりにくいのは、パイプで渡した文字列がどのように挿入されるかが分かりにくいところだろう。</p>
<p>例えば次の例。</p>
<pre class="language-bash"><code class="language-bash">$ <span class="token function">ls</span> -1 <span class="token operator">|</span> <span class="token function">xargs</span> -L <span class="token number">1</span> <span class="token builtin class-name">echo</span> <span class="token string">'Name :'</span>
</code></pre>
<p>まず、<code>$ ls -1</code> で、ファイル名一覧を出す。<code>-1</code> オプションはあってもなくても変わらないんだけど、イメージしやすくなると思うので、1行につき1ファイルで出力するよう指定した。</p>
<p>んでその結果が <code>xargs</code> に渡る。<em><code>-L 1</code></em> というのは、Linux 版の <code>-l</code> オプションと同じ意味。<em>引数を1つずつ渡す</em>意味になる。</p>
<p>何のコマンドを実行しているかというと、<code>echo 'Name :'</code> というコマンド。コレだけ見ると、普通に文字列 <code>Name :</code> をコンソール出力するだけだ。</p>
<p>コレを <code>xargs</code> に指定していて、引数が1つ渡されるので、結果は次のようになる。</p>
<pre class="language-bash"><code class="language-bash"><span class="token comment"># まずファイル一覧の結果だけ見てみる</span>
$ <span class="token function">ls</span> -1
file-1.txt
file-2.txt
file-3.txt

<span class="token comment"># 先程のコマンドを実行する</span>
$ <span class="token function">ls</span> -1 <span class="token operator">|</span> <span class="token function">xargs</span> -L <span class="token number">1</span> <span class="token builtin class-name">echo</span> <span class="token string">'Name :'</span>
Name <span class="token builtin class-name">:</span> file-1.txt
Name <span class="token builtin class-name">:</span> file-2.txt
Name <span class="token builtin class-name">:</span> file-3.txt
</code></pre>
<p>このようになった。</p>
<p><code>-L 1</code> (<code>-l</code>) で、渡される引数の数を指定して、その回数だけ指定した <code>echo</code> コマンドが実行されたというワケ。</p>
<h2 id="引数が渡される数を変える"><a class="header-link" href="#引数が渡される数を変える"><span class="header-link-mark"></span></a>引数が渡される数を変える</h2>
<p>今のままだと、<code>$ ls -1</code> と大して結果が変わらなくて、イマイチ効果が分かりにくい。しかし、次のような例だと、その効果がイメージしやすいと思う。</p>
<pre class="language-bash"><code class="language-bash"><span class="token comment"># 削除コマンドを使うので、お試し用のディレクトリとファイルを作ります</span>
$ <span class="token function">mkdir</span> test-directory <span class="token operator">&#x26;&#x26;</span> <span class="token builtin class-name">cd</span> <span class="token variable">$_</span>
$ <span class="token function">touch</span> a.txt b.txt c.txt

$ <span class="token function">find</span> ./*.txt
a.txt
b.txt
c.txt

<span class="token comment"># これらのファイルを削除する</span>
$ <span class="token function">find</span> ./*.txt <span class="token operator">|</span> <span class="token function">xargs</span> <span class="token function">rm</span>
</code></pre>
<p>この時、<code>xargs</code> 部分でどういうコマンドが実行されているかというと、</p>
<pre class="language-bash"><code class="language-bash">$ <span class="token function">rm</span> a.txt b.txt c.txt
</code></pre>
<p>と展開されている。</p>
<p>ココで比較したいのは、<code>rm</code> コマンドで一気に消そうとした場合と、<code>find</code> コマンドの <code>-exec</code> オプションを使った場合だ。</p>
<h2 id="rm-オプションで一括削除してみる"><a class="header-link" href="#rm-オプションで一括削除してみる"><span class="header-link-mark"></span></a><code>rm</code> オプションで一括削除してみる</h2>
<p>通常、<code>$ rm ./*.txt</code> といったコマンドは成功する。<code>./*.txt</code> 部分が <code>a.txt b.txt c.txt</code> と展開され、先程 <code>xargs</code> で展開されたコマンドと同等の結果になる。</p>
<p>しかし、削除対象のファイルが多すぎると、<code>Argument list too long</code> といったエラーが出て一括削除できないのだ。</p>
<p><code>xargs</code> は、このような引数の上限を超えないように自動的にコマンドを分割してくれるのだ。</p>
<ul>
  <li><a href="https://serverlog.jp/rm-argument-list-too-long/">/bin/rm: Argument list too longの対処方法</a></li>
</ul>
<p>例えば次のようなコマンドに展開されるワケだ。</p>
<pre class="language-bash"><code class="language-bash">$ <span class="token function">rm</span> a.txt b.txt c.txt <span class="token punctuation">..</span>. <span class="token punctuation">(</span>正常にコマンドが成功する数だけ列挙…<span class="token punctuation">)</span>
$ <span class="token function">rm</span> <span class="token number">10000</span>.txt <span class="token number">10001</span>.txt <span class="token number">10002</span>.txt <span class="token punctuation">..</span>. <span class="token punctuation">(</span>多い分は別コマンドとして実行するよう <span class="token function">xargs</span> が処理してくれる<span class="token punctuation">)</span>
</code></pre>
<p>この辺をうまいことやってくれるので、わざわざ <code>xargs</code> をかませておくと便利というワケ。</p>
<h2 id="find--exec-で消してみる"><a class="header-link" href="#find--exec-で消してみる"><span class="header-link-mark"></span></a><code>find -exec</code> で消してみる</h2>
<p><code>find</code> コマンドの <code>-exec</code> オプションを使うと、<code>xargs</code> っぽい処理をしてくれるのだが、内部的には動きが違う。</p>
<pre class="language-bash"><code class="language-bash">$ <span class="token function">find</span> ./*.txt -exec <span class="token function">rm</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">\</span><span class="token punctuation">;</span>
</code></pre>
<p>ファイルの削除はできるのだが、このコマンドは次のように展開される。</p>
<pre class="language-bash"><code class="language-bash">$ <span class="token function">rm</span> a.txt
$ <span class="token function">rm</span> b.txt
$ <span class="token function">rm</span> c.txt
</code></pre>
<p>つまり、ファイルの数だけ <code>rm</code> コマンドが実行されるので、削除処理が遅いのだ。</p>
<p>ちなみに <code>find</code> の <code>-delete</code> オプションは <code>xargs rm</code> と同等に上手いこと処理してくれて高速なのだが、<code>find</code> コマンドのバージョンによっては対応していないオプションなので、<code>xargs</code> を使ったやり方の方がより環境を選ばず、汎用性が高いだろう。</p>
<p>そんなワケで、<code>rm ./*.txt</code> や <code>find -exec</code> よりもメリットが多いので、<code>xargs rm</code> を使う機会があり、<code>xargs</code> の特徴を活かせているのだ。</p>
<ul>
  <li><a href="https://yamakisso.hatenablog.com/entry/2020/03/24/015418">結局findしたファイルを消す場合はどんなコマンドを使うか - 雑多に技術メモと他色々</a></li>
  <li><a href="https://qiita.com/iron-breaker/items/74a2ed1753587476157f">検索してファイルを消す時に高速に行う方法 - Qiita</a></li>
</ul>
<h2 id="区切り文字を指定する--0"><a class="header-link" href="#区切り文字を指定する--0"><span class="header-link-mark"></span></a>区切り文字を指定する (<code>-0</code>)</h2>
<p>ところで、先ほどと同じ <code>find</code> + <code>xargs rm</code> コマンドを、次のようなファイルが存在する状態で実行すると、おかしなことになる。</p>
<pre class="language-bash"><code class="language-bash"><span class="token comment"># スペースを含んだファイル「a b.txt」などを作る</span>
$ <span class="token function">touch</span> <span class="token string">'a b.txt'</span> <span class="token string">'c.txt'</span>

$ <span class="token function">find</span> ./*.txt
a b.txt
c.txt

<span class="token comment"># 先ほどと同じコマンドを実行する</span>
$ <span class="token function">find</span> ./*.txt <span class="token operator">|</span> <span class="token function">xargs</span> <span class="token function">rm</span>
rm: ./a: No such <span class="token function">file</span> or directory
rm: b.txt: No such <span class="token function">file</span> or directory

<span class="token comment"># ？</span>
$ <span class="token function">find</span> ./*.txt
./a b.txt
</code></pre>
<p>察しの良い方は気付いたと思うが、<code>xargs</code> はコマンドを次のように展開する。</p>
<pre class="language-bash"><code class="language-bash">$ <span class="token function">rm</span> ./a b.txt ./c.txt

<span class="token comment"># つまり…</span>
$ <span class="token function">rm</span>    ./a    b.txt    ./c.txt
</code></pre>
<p>このように、3つのファイルを消そうとするコマンドと勘違いされてしまったのだ。</p>
<p>コレを何とかするには、<code>find</code> コマンドの結果で使う区切り文字を <code>\0</code>・ヌル文字という特殊文字に変更し、<code>xargs</code> もヌル文字を解釈するように設定してやるのだ。</p>
<pre class="language-bash"><code class="language-bash">$ <span class="token function">touch</span> <span class="token string">'a b.txt'</span> <span class="token string">'c.txt'</span>

<span class="token comment"># `-print0` オプションを付けるとこうなる・人の目には区切られていないように見える</span>
$ <span class="token function">find</span> ./*.txt -print0
./a b.txt./c.txt

<span class="token comment"># このようにオプション指定すると、ヌル文字で区切って解釈してくれるので、正しくファイルが消せる</span>
$ <span class="token function">find</span> ./*.txt -print0 <span class="token operator">|</span> <span class="token function">xargs</span> -0 <span class="token function">rm</span>
</code></pre>
<p>コレが時々出てきてよく分からない <code>-print0</code> や <code>-0</code> の仕組みだ。</p>
<p>この仕組みが分かっていないと、思わぬファイルを削除してしまう恐れもある。よくよく注意しよう。</p>
<ul>
  <li><a href="https://qiita.com/maskedw/items/2dfdf6fa7eee991ddc45">findとxargsコマンドで-print0オプションを使う理由(改) - Qiita</a></li>
  <li><a href="https://qiita.com/yugokitajima/items/3e195c4fdc6b74057988">xargs が思いのほか危険だった - Qiita</a></li>
</ul>
<h2 id="xargs-を確認しながら実行したい--p"><a class="header-link" href="#xargs-を確認しながら実行したい--p"><span class="header-link-mark"></span></a><code>xargs</code> を確認しながら実行したい (<code>-p</code>)</h2>
<p>さて、<code>xargs</code> の有用性や安全に実行するための方法を見てきたが、より安全に実行するために、実行前確認をしたいと思う。</p>
<p>先程の <code>rm</code> コマンドの場合、思いつくのは <code>rm -i</code> コマンドだろう。<code>xargs</code> をかませる時は <em><code>-o</code></em> オプションを付与してやると、<code>rm -i</code> がうまく実行できるようになる。</p>
<pre class="language-bash"><code class="language-bash">$ <span class="token function">find</span> ./*.txt -print0 <span class="token operator">|</span> <span class="token function">xargs</span> -0 -o <span class="token function">rm</span> -i

<span class="token comment"># 次のようなコンソールが出る</span>
remove ./a b.txt?

<span class="token comment"># 「y」を入力すれば削除され、何も入力せず Enter を押せば削除されない</span>
remove ./a b.txt? y

<span class="token comment"># 次のコンソール出力。何も入力せず Enter を押してみる</span>
remove ./c.txt?

<span class="token comment"># 削除されたのは `a b.txt` のみ</span>
$ <span class="token function">ls</span>
c.txt
</code></pre>
<p>もし <code>-o</code> オプションを付けないと、このようなインタラクティブな動作にはならず、削除に失敗する。<code>--open-tty</code> の略らしい。</p>
<p>コレは <code>rm</code> コマンドのオプションを有効にしただけだ。それ以外のコマンドで実行前確認をする場合は、<strong><code>xargs</code> コマンドの <code>-p</code> オプション</strong>を使うと良いだろう。</p>
<pre class="language-bash"><code class="language-bash"><span class="token comment"># 単純に `-p` オプションを使うと、次のようになる</span>
$ <span class="token function">find</span> ./*.txt -print0 <span class="token operator">|</span> <span class="token function">xargs</span> -0 -p <span class="token builtin class-name">echo</span>
<span class="token builtin class-name">echo</span> ./a b.txt ./c.txt?<span class="token punctuation">..</span>. y

<span class="token comment"># コレまで見てきた `-L 1` オプションと組み合わせると順次実行できる</span>
$ <span class="token function">find</span> ./*.txt -print0 <span class="token operator">|</span> <span class="token function">xargs</span> -0 -p -L <span class="token number">1</span> <span class="token builtin class-name">echo</span>
<span class="token builtin class-name">echo</span> ./a b.txt?<span class="token punctuation">..</span>.
<span class="token builtin class-name">echo</span> ./c.txt?<span class="token punctuation">..</span>.

<span class="token comment"># 「y」を入力すれば初めてコマンドが実行される。何も入力せず Enter を押せば実行されない</span>
$ <span class="token function">find</span> ./*.txt -print0 <span class="token operator">|</span> <span class="token function">xargs</span> -0 -p -L <span class="token number">1</span> <span class="token builtin class-name">echo</span>
<span class="token builtin class-name">echo</span> ./a b.txt?<span class="token punctuation">..</span>.y
./a b.txt
<span class="token builtin class-name">echo</span> ./c.txt?<span class="token punctuation">..</span>.y
./c.txt
</code></pre>
<p>あまり意味はないが、<code>-o</code> と <code>-p</code> オプションを組み合わせたりもできる。それぞれ、コマンドの展開のされ方が異なる点を見てもらおう。</p>
<pre class="language-bash"><code class="language-bash">$ <span class="token function">find</span> ./*.txt -print0 <span class="token operator">|</span> <span class="token function">xargs</span> -0 -o -p <span class="token function">rm</span> -i
<span class="token function">rm</span> -i ./a b.txt ./c.txt?<span class="token punctuation">..</span>.y
remove ./a b.txt? y
remove ./c.txt? y

<span class="token comment"># コチラは `-L 1` オプションを指定</span>
$ <span class="token function">find</span> ./*.txt -print0 <span class="token operator">|</span> <span class="token function">xargs</span> -0 -o -p -L <span class="token number">1</span> <span class="token function">rm</span> -i
<span class="token function">rm</span> -i ./a b.txt?<span class="token punctuation">..</span>.y
remove ./a b.txt? y
<span class="token function">rm</span> -i ./c.txt?<span class="token punctuation">..</span>.y
remove ./c.txt? y
</code></pre>
<ul>
  <li><a href="https://stackoverflow.com/questions/18302856/removing-files-interactively-with-find-and-xargs">shell - Removing files interactively with find and xargs - Stack Overflow</a></li>
</ul>
<h2 id="引数の挿入位置を自分で指定する--i-"><a class="header-link" href="#引数の挿入位置を自分で指定する--i-"><span class="header-link-mark"></span></a>引数の挿入位置を自分で指定する (<code>-I {}</code>)</h2>
<p>ココまで色々触ってきたが、<code>xargs</code> で引数が装入される位置を自分で選べたら分かりやすくないだろうか。</p>
<p>そんな時は、<code>-I {}</code> (Linux 版なら <code>-i</code> が同義) というオプションが使える。</p>
<pre class="language-bash"><code class="language-bash">$ <span class="token function">ls</span> <span class="token operator">|</span> <span class="token function">xargs</span> -I <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token builtin class-name">echo</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
a b.txt
c.txt

$ <span class="token function">ls</span> <span class="token operator">|</span> <span class="token function">xargs</span> -I <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token builtin class-name">echo</span> <span class="token string">'Name : {}'</span>
Name <span class="token builtin class-name">:</span> a b.txt
Name <span class="token builtin class-name">:</span> c.txt

<span class="token comment"># 1つの引数を複数回使ったり</span>
$ <span class="token function">ls</span> <span class="token operator">|</span> <span class="token function">xargs</span> -I <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token builtin class-name">echo</span> <span class="token string">'Name : {} - {}'</span>
Name <span class="token builtin class-name">:</span> a b.txt - a b.txt
Name <span class="token builtin class-name">:</span> c.txt - c.txt
</code></pre>
<p>こんな感じ。<code>{}</code> という文字列を <code>echo</code> コマンド内にプレースホルダ的に配置している。<code>echo</code> コマンドの引数はシングルクォートを使っているが、<code>{}</code> は「変数」ではないので、ダブルクォートによる変数展開、シングルクォートによるエスケープの影響を受けない。</p>
<h2 id="xargs-で複数のコマンドを実行したい"><a class="header-link" href="#xargs-で複数のコマンドを実行したい"><span class="header-link-mark"></span></a><code>xargs</code> で複数のコマンドを実行したい</h2>
<p>指定のファイル達を <code>gzip</code> で圧縮して、指定のディレクトリに移す、といったことを、<code>xargs</code> を組合せたい時。<em><code>sh -c</code> ないしは <code>bash -c</code></em> を使ってやる。</p>
<pre class="language-bash"><code class="language-bash"><span class="token comment"># テスト用のファイル・ディレクトリを作成する</span>
$ <span class="token function">touch</span> <span class="token string">'a b.txt'</span> <span class="token string">'c.txt'</span> <span class="token string">'d.txt'</span>
$ <span class="token function">mkdir</span> zipped

<span class="token comment"># テキストファイルを gzip 圧縮して zipped ディレクトリに移動する</span>
$ <span class="token function">find</span> ./*.txt -print0 <span class="token operator">|</span> <span class="token function">xargs</span> -0 -I <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token function">bash</span> -c <span class="token string">"echo 'Exec : {}' &#x26;&#x26; gzip '{}' &#x26;&#x26; mv '{}.gz' ./zipped/ &#x26;&#x26; echo 'Finished : {}'"</span>
Exec <span class="token builtin class-name">:</span> ./a b.txt
Finished <span class="token builtin class-name">:</span> ./a b.txt
Exec <span class="token builtin class-name">:</span> ./c.txt
Finished <span class="token builtin class-name">:</span> ./c.txt
Exec <span class="token builtin class-name">:</span> ./d.txt
Finished <span class="token builtin class-name">:</span> ./d.txt

<span class="token comment"># 結果確認</span>
$ <span class="token function">find</span> <span class="token builtin class-name">.</span> -type f
./zipped/d.txt.gz
./zipped/c.txt.gz
./zipped/a b.txt.gz
</code></pre>
<p>各コマンド内で <code>{}</code> が展開されるので、<code>a b.txt</code> のようにスペースを含んだファイルを扱ってもおかしくならないように、適宜シングルクォートで囲ったりしている。</p>
<h1 id="以上"><a class="header-link" href="#以上"><span class="header-link-mark"></span></a>以上</h1>
<p>他にもまだ色んなオプションがあるのだが、よく使われるのはこのぐらいだろう。</p>
<ul>
  <li><code>xargs</code> コマンドは、指定のコマンドに対して引数を上手く分配して効率的に実行してくれるコマンド</li>
  <li><code>-l</code> と <code>-i</code> オプションは Mac で使えなかったりして混乱の元なので、<code>-L 1</code> と <code>-I {}</code> に読み替える・書き換える</li>
  <li><strong>引数がどの位置に装入されるのか分からなくなったら <code>-I {}</code> オプションを使って明記する</strong></li>
  <li>スペースを含んだ文字列を綺麗に扱うために、<code>find -print0</code> や <code>xargs -0</code> オプションを使う</li>
  <li><em>実行前確認をしたかったら <code>xargs -p</code> オプションを使う</em></li>
  <li>複数のコマンドを実行したい場合は <code>sh -c</code> (<code>bash -c</code>) を使う</li>
</ul>
<p><code>-I {}</code> と <code>-p</code> オプションさえ覚えてしまえば、安全に <code>xargs</code> を使いこなせそうだ。</p><div class="ad-rakuten">
  <div class="ad-rakuten-image">
    <a href="https://hb.afl.rakuten.co.jp/hgc/g00q0722.waxyc9ff.g00q0722.waxyd017/?pc=https%3A%2F%2Fitem.rakuten.co.jp%2Fbook%2F16221925%2F&amp;m=http%3A%2F%2Fm.rakuten.co.jp%2Fbook%2Fi%2F19930614%2F">
      <img src="https://thumbnail.image.rakuten.co.jp/@0_mall/book/cabinet/2826/9784815602826.jpg?_ex=128x128">
    </a>
  </div>
  <div class="ad-rakuten-info">
    <div class="ad-rakuten-title">
      <a href="https://hb.afl.rakuten.co.jp/hgc/g00q0722.waxyc9ff.g00q0722.waxyd017/?pc=https%3A%2F%2Fitem.rakuten.co.jp%2Fbook%2F16221925%2F&amp;m=http%3A%2F%2Fm.rakuten.co.jp%2Fbook%2Fi%2F19930614%2F">Linuxコマンドブック ビギナーズ 第5版 [ 川口 拓之 ]</a>
    </div>
    <div class="ad-rakuten-shop">
      <a href="https://hb.afl.rakuten.co.jp/hgc/g00q0722.waxyc9ff.g00q0722.waxyd017/?pc=https%3A%2F%2Fwww.rakuten.co.jp%2Fbook%2F&amp;m=http%3A%2F%2Fm.rakuten.co.jp%2Fbook%2F">楽天ブックス</a>
    </div>
    <div class="ad-rakuten-price">価格 : 2310円</div>
  </div>
</div>
<ul>
  <li><a href="https://www.softel.co.jp/blogs/tech/archives/5410">xargsで複数のコマンドを実行する at softelメモ</a></li>
  <li><a href="https://qiita.com/hitode7456/items/6ba8e2d58f9b8db9de11">xargs のオプションいろいろ - Qiita</a></li>
</ul>

      </main>
      <footer id="footer">
        <div id="footer-contents">
          <div id="date-time">
            <dl>
              <dt>Created</dt>
              <dd><time>2021-02-20</time></dd>
              <dt>Last-Modified</dt>
              <dd><time>2021-02-20</time></dd>
            </dl>
          </div>
          <nav id="footer-links">
            <ul>
              <li id="footer-link-about"><a href="/about/index.html" title="About">About</a></li>
              <li id="footer-link-search"><a href="/about/search.html" title="Search">Search</a></li>
              <li id="footer-link-feeds"><a href="/feeds.xml" title="Feeds">Feeds</a></li>
              <li id="footer-link-github"><a href="https://github.com/Neos21/" title="GitHub">GitHub</a></li>
            </ul>
          </nav>
          <nav id="to-top"><a href="#" title="To Top"><span>▲ To Top</span></a></nav>
        </div>
      </footer>
    </div>
  </body>
</html>
