<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="theme-color" content="#0990d0">
    <!-- Google Search Console -->
    <meta name="google-site-verification" content="AvoEr3mUJFF2H_mPWWgShfmjBVP3ywRpyx9hxeeq2d4">
    <title>過去ネタ供養 2：Python (+ Docker) 環境構築手順 - Neo's World</title>
    <link rel="icon" href="/favicon.ico">
    <link rel="stylesheet" href="/styles.css">
    <link rel="canonical" href="https://neos21.net/blog/2021/12/21-01.html">
    <link rel="search" type="application/opensearchdescription+xml" title="neos21.net" href="/opensearch.xml">
    <link rel="alternate" type="application/atom+xml" href="/feeds.xml">
    <link rel="author" href="http://www.hatena.ne.jp/neos21/">
    <!-- Global Site Tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YMHFLZP1M1"></script>
    <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date());gtag('config','G-YMHFLZP1M1');gtag('config','UA-106501-1');</script>
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6475907504235292" crossorigin="anonymous"></script>
  </head>
  <body>
    <div id="container">
      <header id="header">
        <div id="header-brand">
          <div id="header-brand-contents">
            <div id="site-title"><a href="/index.html">Neo's World</a></div>
            <nav id="header-links">
              <ul>
                <li id="header-link-about"><a href="/about/index.html" title="About"><span>About</span></a></li>
                <li id="header-link-search"><a href="/about/search.html" title="Search"><span>Search</span></a></li>
                <li id="header-link-feeds"><a href="/feeds.xml" title="Feeds"><span>Feeds</span></a></li>
                <li id="header-link-to-bottom"><a href="#footer" title="To Bottom"><span>▼ To Bottom</span></a></li>
              </ul>
            </nav>
          </div>
        </div>
        <nav id="global-nav">
          <ul>
            <li><a href="/blog/index.html">Blog</a></li>
            <li><a href="/tech/index.html">Tech</a></li>
            <li><a href="/music/index.html">Music</a></li>
            <li><a href="/games/index.html">Games</a></li>
            <li><a href="/gallery/index.html">Gallery</a></li>
            <li><a href="/etc/index.html">Etc.</a></li>
          </ul>
        </nav>
        <nav id="path">
          <ul>
            <li><a href="/index.html">Neo's World</a></li>
            <li><a href="/blog/index.html">Blog</a></li>
            <li><a href="/blog/2021/index.html">2021年</a></li>
            <li><a href="/blog/2021/12/index.html">12月</a></li>
          </ul>
        </nav>
      </header>
      <main id="main">
        <div id="header-date"><time>2021-12-21</time></div>
        <h1 id="page-title">過去ネタ供養 2：Python (+ Docker) 環境構築手順</h1>

<p>過去ネタ供養の連載その2。2019-11-03 頃に某プロジェクトで Python 開発環境を作ろうという話になって、その時の手順書などを Gist に上げていた。</p>
<p>Python 3.7 環境を作るのだが、それを Docker コンテナとして用意するか、ホストマシンにインストールするか、というのを選択できるようにしていた。</p>
<h2 id="目次"><a class="header-link" href="#目次"><span class="header-link-mark"></span></a>目次</h2>
<ul>
  <li><a href="#%E5%BF%85%E8%A6%81%E3%81%AA%E4%BD%9C%E6%A5%AD%E3%82%92%E5%89%B2%E3%82%8A%E5%87%BA%E3%81%99%E3%83%95%E3%83%AD%E3%83%BC%E3%83%81%E3%83%A3%E3%83%BC%E3%83%88">必要な作業を割り出すフローチャート</a></li>
  <li><a href="#os-%E3%81%AB%E7%9B%B4%E6%8E%A5-python-37-%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B%E6%89%8B%E9%A0%86">OS に直接 Python 3.7 をインストールする手順</a>
    <ul>
      <li><a href="#windows-os-%E3%81%AE%E5%A0%B4%E5%90%88">Windows OS の場合</a></li>
      <li><a href="#macos-%E3%81%AE%E5%A0%B4%E5%90%88">MacOS の場合</a></li>
    </ul>
  </li>
  <li><a href="#docker-%E3%82%92%E3%82%A4%E3%83%B3%E3%82%B9%E3%83%88%E3%83%BC%E3%83%AB%E3%81%99%E3%82%8B%E6%89%8B%E9%A0%86">Docker をインストールする手順</a></li>
  <li><a href="#docker-%E3%81%A7-python-%E3%82%A4%E3%83%A1%E3%83%BC%E3%82%B8%E3%82%92%E4%BD%BF%E7%94%A8%E3%81%99%E3%82%8B">Docker で Python イメージを使用する</a></li>
  <li><a href="#%E8%A6%81%E8%A7%A3%E8%AA%AC">要解説？</a></li>
</ul>
<h2 id="必要な作業を割り出すフローチャート"><a class="header-link" href="#必要な作業を割り出すフローチャート"><span class="header-link-mark"></span></a>必要な作業を割り出すフローチャート</h2>
<ol>
  <li>Docker 使う？
    <ol>
      <li>→ 使う
        <ol>
          <li>Docker 入れる</li>
          <li>Python の Docker イメージを落としてくる</li>
        </ol>
      </li>
      <li>→ 使わない
        <ol>
          <li>OS に Python 入れる</li>
          <li>Windows の場合は必要に応じて Git Bash (or Git SDK) も入れる</li>
        </ol>
      </li>
    </ol>
  </li>
</ol>
<h2 id="os-に直接-python-37-をインストールする手順"><a class="header-link" href="#os-に直接-python-37-をインストールする手順"><span class="header-link-mark"></span></a>OS に直接 Python 3.7 をインストールする手順</h2>
<h3 id="windows-os-の場合"><a class="header-link" href="#windows-os-の場合"><span class="header-link-mark"></span></a>Windows OS の場合</h3>
<p>以下の3つの方法があるのでお好きに。</p>
<ol>
  <li>Python.org の公式から落としてインストールする
    <ul>
      <li><a href="https://www.python.org/downloads/release/python-375/">https://www.python.org/downloads/release/python-375/</a></li>
      <li>v3.7.5 あたりでいいんじゃないですかね</li>
    </ul>
  </li>
  <li>Chocolatey が入っていれば Chocolatey でインストールする (楽)
    <ul>
      <li><code>PS1> choco install python3 --version=3.7.5</code></li>
    </ul>
  </li>
  <li>もしくは、GitBash (Git For Windows) の上位互換である <strong>Git SDK</strong> をインストールして、同梱の Python 3.7 を使う (個人的オヌヌメ)
    <ul>
      <li><a href="https://github.com/git-for-windows/build-extra/releases">https://github.com/git-for-windows/build-extra/releases</a></li>
    </ul>
  </li>
</ol>
<p>インストールが正常にできているか以下のように確認する。</p>
<ol>
  <li>ターミナルで <code>$ python -V</code> と実行して <code>Python 3.7.5</code> と出力されること</li>
  <li>ターミナルで <code>$ pip -V</code> と実行して <code>pip 19.3.1 from c:\python37\lib\site-packages\pip (python 3.7)</code> のように出力されること (細かいバージョンやパスなどはテキトーで)</li>
</ol>
<p>うまくいっていない場合は以下を確認する。</p>
<ul>
  <li>環境変数 <code>PATH</code> の記載順序などをチェックする</li>
  <li>GitBash を使っている場合は、試しに管理者権限で実行した PowerShell で動作するか確認する。GitBash で使用する際は <code>winpty</code> をかませてあるか確認する</li>
</ul>
<h3 id="macos-の場合"><a class="header-link" href="#macos-の場合"><span class="header-link-mark"></span></a>MacOS の場合</h3>
<ol>
  <li>Python.org の公式から落としてインストールする
    <ul>
      <li><a href="https://www.python.org/downloads/release/python-375/">https://www.python.org/downloads/release/python-375/</a></li>
      <li>v3.7.5 あたりでいいんじゃないですかね</li>
    </ul>
  </li>
  <li>Homebrew が入っていれば Homebrew でインストールする (楽)
    <ul>
      <li><code>$ brew install python</code></li>
      <li>Python2 系との衝突は <code>$ brew unlink python@2</code> → <code>$ brew link python</code> で解消できるかと</li>
    </ul>
  </li>
</ol>
<h2 id="docker-をインストールする手順"><a class="header-link" href="#docker-をインストールする手順"><span class="header-link-mark"></span></a>Docker をインストールする手順</h2>
<p>Docker を利用する際は DockerHub アカウントを作成する必要があるので、作っておく。</p>
<ul>
  <li>公式サイト : <a href="https://hub.docker.com/">https://hub.docker.com/</a>
    <ul>
      <li><code>Get started with Docker Desktop</code> を開くと、チュートリアル形式でインストールしていけるのでオススメ</li>
    </ul>
  </li>
  <li>Windows は Chocolatey、MacOS は Homebrew でもインストールできる
    <ul>
      <li><a href="https://qiita.com/Arturias/items/e13e3ecc39261a258bef">https://qiita.com/Arturias/items/e13e3ecc39261a258bef</a> (Windows Chocolatey)</li>
      <li><a href="https://qiita.com/nemui_/items/ed753f6b2eb9960845f7">https://qiita.com/nemui_/items/ed753f6b2eb9960845f7</a> (MacOS Homebrew)</li>
    </ul>
  </li>
  <li>Windows 10 Home の場合は Docker Toolbox というモノを使って、VirtualBox との併用でインストールする
    <ul>
      <li><a href="https://docs.docker.com/toolbox/toolbox_install_windows/">https://docs.docker.com/toolbox/toolbox_install_windows/</a></li>
      <li>VirtualBox のインストールやセットアップに失敗して上手くいかないことが多い (自分はホストオンリーアダプタの追加処理が失敗して苦戦した)。以下を気を付けると良いかも
        <ul>
          <li>「Windows の機能の有効化または無効化」で「ハイパーバイザ」「仮想化」「Hyper-V」関連の機能を無効化する</li>
          <li>ウイルスバスターなどは終了させた状態でインストールやセットアップを行う</li>
          <li>インストーラなどは全て「管理者権限で実行」する</li>
          <li>インストール前後などでこまめに OS 再起動する</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
<p>ターミナルで <code>$ docker --version</code> と実行してバージョン情報が出力されれば OK。</p>
<h2 id="docker-で-python-イメージを使用する"><a class="header-link" href="#docker-で-python-イメージを使用する"><span class="header-link-mark"></span></a>Docker で Python イメージを使用する</h2>
<p>予めインストールした Docker を起動しておく。タスクトレイアイコンで「Docker Desktop is running」と確認できれば OK。</p>
<p>ターミナルで以下のように実行する。</p>
<pre class="language-bash"><code class="language-bash">$ docker run -it python:3.7.5-buster
</code></pre>
<p>コレで「Debian 10 Buster OS に Python 3.7.5 がインストールされた状態の Docker イメージ」を指定している。初回はイメージのダウンロードに数百 MB 使うので留意。</p>
<p>Docker イメージのダウンロードが終わると自動的に Python の対話コンソールに切り替わる。 <code>>>></code> というプロンプトが見えているはず。</p>
<pre class="language-bash"><code class="language-bash"><span class="token operator">>></span><span class="token operator">></span> help<span class="token punctuation">(</span><span class="token punctuation">)</span>

Welcome to Python <span class="token number">3.7</span>'s <span class="token builtin class-name">help</span> utility<span class="token operator">!</span>
<span class="token comment"># 以下略</span>

help<span class="token operator">></span> quit

<span class="token operator">>></span><span class="token operator">></span> exit<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre>
<p>こんな感じで対話コンソールを確認できたらひとまず OK。</p>
<h2 id="要解説"><a class="header-link" href="#要解説"><span class="header-link-mark"></span></a>要解説？</h2>
<p>(メンバに説明が必要かなと思うトピックをメモしていたモノ)</p>
<ul>
  <li>pipenv のインストールと初回操作 (<code>$ pip install pipenv</code> ・ <code>$ pipenv --python 3.7</code>)</li>
  <li>pipenv 設定済のプロジェクトを使用するための手順 (<code>$ pipenv install -dev</code>)</li>
  <li>VSCode の準備 (エディタは強制しないけど VSCode の Python Extension Pack 入れるだけでだいぶ楽)</li>
  <li>Docker + Python 環境での操作手順
    <ul>
      <li>イメージの取得 (<code>docker pull</code>)・コンテナの生成 (<code>docker run</code>)</li>
      <li>コンテナの起動 (<code>docker start</code>)・停止 (<code>docker stop</code>)・接続 (<code>docker attach</code>)・切断 (<code>Ctrl + P</code> → <code>Ctrl + Q</code>)・破棄 (<code>docker rm</code>)</li>
      <li>コンテナ一覧 (<code>docker ps</code> ・ <code>docker ps --all</code>)・イメージの破棄 (<code>docker rmi</code>)</li>
      <li>構成によっては <code>docker-compose</code></li>
    </ul>
  </li>
  <li>Git 操作
    <ul>
      <li>確認 (<code>git status</code>)・差分 (<code>git diff</code>)・追加 <code>(git add</code>)・コミット (<code>git commit</code>)・プッシュ (<code>git push</code>)</li>
      <li>ブランチ確認 (<code>git branch</code>)・ブランチ切替 (<code>git checkout</code>)・ブランチ作成 (<code>git checkout -b</code>)</li>
      <li>リモートとの同期 (<code>git pull</code> ・ <code>git fetch</code>)・マージ (<code>git merge</code>)・Fast-Forward…</li>
      <li>ログ確認 (<code>git log</code> ・ <code>tig</code>)・Add 取り消し (<code>git checkout</code>)・Commit 取り消し (<code>git reset</code>)・使い所…</li>
      <li>ブランチ作成時の初回コミット : <code>$ git commit --allow-empty -m 'Init'</code> (<a href="https://qiita.com/NorsteinBekkler/items/b2418cd5e14a52189d19">https://qiita.com/NorsteinBekkler/items/b2418cd5e14a52189d19</a>)</li>
    </ul>
  </li>
  <li>GitHub 操作
    <ul>
      <li>クローン <code>(git clone</code>)</li>
      <li>プルリク</li>
    </ul>
  </li>
</ul>
<p>あのプロジェクトは自然消滅してしまったが、競合他社が元気よくやっていて、流行風邪の大打撃を受けていたのを見るに、自然消滅は悪くない結果だったのかもしれない。</p><div class="ad-amazon">
  <div class="ad-amazon-image">
    <a href="https://www.amazon.co.jp/dp/B076DDBBK9?tag=neos21-22&amp;linkCode=osi&amp;th=1&amp;psc=1">
      <img src="https://m.media-amazon.com/images/I/61mUe-f7C6L._SL160_.jpg" width="126" height="160">
    </a>
  </div>
  <div class="ad-amazon-info">
    <div class="ad-amazon-title">
      <a href="https://www.amazon.co.jp/dp/B076DDBBK9?tag=neos21-22&amp;linkCode=osi&amp;th=1&amp;psc=1">Python 1年生 体験してわかる！会話でまなべる！プログラミングのしくみ</a>
    </div>
  </div>
</div>
<div class="ad-rakuten">
  <div class="ad-rakuten-image">
    <a href="https://hb.afl.rakuten.co.jp/hgc/g00q0722.waxyc9ff.g00q0722.waxyd017/?pc=https%3A%2F%2Fitem.rakuten.co.jp%2Fbook%2F16627214%2F&amp;m=http%3A%2F%2Fm.rakuten.co.jp%2Fbook%2Fi%2F20271780%2F">
      <img src="https://thumbnail.image.rakuten.co.jp/@0_mall/book/cabinet/9328/9784873119328.jpg?_ex=128x128">
    </a>
  </div>
  <div class="ad-rakuten-info">
    <div class="ad-rakuten-title">
      <a href="https://hb.afl.rakuten.co.jp/hgc/g00q0722.waxyc9ff.g00q0722.waxyd017/?pc=https%3A%2F%2Fitem.rakuten.co.jp%2Fbook%2F16627214%2F&amp;m=http%3A%2F%2Fm.rakuten.co.jp%2Fbook%2Fi%2F20271780%2F">入門Python3　第2版 [ Bill Lubanovic ]</a>
    </div>
    <div class="ad-rakuten-shop">
      <a href="https://hb.afl.rakuten.co.jp/hgc/g00q0722.waxyc9ff.g00q0722.waxyd017/?pc=https%3A%2F%2Fwww.rakuten.co.jp%2Fbook%2F&amp;m=http%3A%2F%2Fm.rakuten.co.jp%2Fbook%2F">楽天ブックス</a>
    </div>
    <div class="ad-rakuten-price">価格 : 4180円</div>
  </div>
</div>

      </main>
      <footer id="footer">
        <div id="footer-contents">
          <div id="date-time">
            <dl>
              <dt>Created</dt>
              <dd><time>2021-12-21</time></dd>
              <dt>Last-Modified</dt>
              <dd><time>2021-12-21</time></dd>
            </dl>
          </div>
          <nav id="footer-links">
            <ul>
              <li id="footer-link-about"><a href="/about/index.html" title="About">About</a></li>
              <li id="footer-link-search"><a href="/about/search.html" title="Search">Search</a></li>
              <li id="footer-link-feeds"><a href="/feeds.xml" title="Feeds">Feeds</a></li>
              <li id="footer-link-github"><a href="https://github.com/Neos21/" title="GitHub">GitHub</a></li>
            </ul>
          </nav>
          <nav id="to-top"><a href="#" title="To Top"><span>▲ To Top</span></a></nav>
        </div>
      </footer>
    </div>
  </body>
</html>
