<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Google Search Console -->
    <meta name="google-site-verification" content="AvoEr3mUJFF2H_mPWWgShfmjBVP3ywRpyx9hxeeq2d4">
    <title>Web Speech Recognition API を使ってブラウザオンリーで音声認識する - Neo's World</title>
    <link rel="icon" href="/favicon.ico">
    <link rel="stylesheet" href="/styles.css">
    <link rel="canonical" href="https://neos21.net/blog/2021/03/09-01.html">
    <link rel="search" type="application/opensearchdescription+xml" title="neos21.net" href="/opensearch.xml">
    <link rel="alternate" type="application/atom+xml" href="/feeds.xml">
    <link rel="author" href="http://www.hatena.ne.jp/neos21/">
    <!-- Global Site Tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YMHFLZP1M1"></script>
    <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date());gtag('config','G-YMHFLZP1M1');gtag('config','UA-106501-1');</script>
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6475907504235292" crossorigin="anonymous"></script>
  </head>
  <body>
    <div id="container">
      <header id="header">
        <div id="site-title"><a href="/index.html">Neo's World</a></div>
        <nav id="header-links">
          <ul>
            <li id="header-link-about"><a href="/about/index.html" title="About"><span>About</span></a></li>
            <li id="header-link-search"><a href="/about/search.html" title="Search"><span>Search</span></a></li>
            <li id="header-link-feeds"><a href="/feeds.xml" title="Feeds"><span>Feeds</span></a></li>
            <li id="header-link-to-bottom"><a href="#footer" title="To Bottom"><span>▼ To Bottom</span></a></li>
          </ul>
        </nav>
        <nav id="global-nav">
          <ul>
            <li><a href="/blog/index.html">Blog</a></li>
            <li><a href="/tech/index.html">Tech</a></li>
            <li><a href="/music/index.html">Music</a></li>
            <li><a href="/games/index.html">Games</a></li>
            <li><a href="/gallery/index.html">Gallery</a></li>
            <li><a href="/etc/index.html">Etc.</a></li>
          </ul>
        </nav>
        <nav id="path">
          <ul>
            <li><a href="/index.html">Neo's World</a></li>
            <li><a href="/blog/index.html">Blog</a></li>
            <li><a href="/blog/2021/index.html">2021年</a></li>
            <li><a href="/blog/2021/03/index.html">03月</a></li>
          </ul>
        </nav>
      </header>
      <main id="main">
        <div id="header-date"><time>2021-03-09</time></div>
        <h1 id="page-title">Web Speech Recognition API を使ってブラウザオンリーで音声認識する</h1>

<p>ちょっと前に、合成音声を発話させる <em>Web Speech API</em> を試したが、今回はその API 群の一つである、音声認識を行う <strong>Recognition API</strong> を試してみる。</p>
<ul>
  <li><a href="/blog/2021/02/01-01.html">Web Speech API 触ってみた</a> … 以前試した「合成音声」の件</li>
</ul><div class="ad-amazon">
  <div class="ad-amazon-image">
    <a href="https://www.amazon.co.jp/dp/B07G2MZKRQ?tag=neos21-22&amp;linkCode=osi&amp;th=1&amp;psc=1">
      <img src="https://m.media-amazon.com/images/I/41x5iCCz2+L._SL160_.jpg" width="112" height="160">
    </a>
  </div>
  <div class="ad-amazon-info">
    <div class="ad-amazon-title">
      <a href="https://www.amazon.co.jp/dp/B07G2MZKRQ?tag=neos21-22&amp;linkCode=osi&amp;th=1&amp;psc=1">音声認識 (機械学習プロフェッショナルシリーズ)</a>
    </div>
  </div>
</div>
<div class="ad-rakuten">
  <div class="ad-rakuten-image">
    <a href="https://hb.afl.rakuten.co.jp/hgc/g00q0722.waxyc9ff.g00q0722.waxyd017/?pc=https%3A%2F%2Fitem.rakuten.co.jp%2Fbook%2F15208510%2F&amp;m=http%3A%2F%2Fm.rakuten.co.jp%2Fbook%2Fi%2F18852420%2F">
      <img src="https://thumbnail.image.rakuten.co.jp/@0_mall/book/cabinet/9274/9784061529274.jpg?_ex=128x128">
    </a>
  </div>
  <div class="ad-rakuten-info">
    <div class="ad-rakuten-title">
      <a href="https://hb.afl.rakuten.co.jp/hgc/g00q0722.waxyc9ff.g00q0722.waxyd017/?pc=https%3A%2F%2Fitem.rakuten.co.jp%2Fbook%2F15208510%2F&amp;m=http%3A%2F%2Fm.rakuten.co.jp%2Fbook%2Fi%2F18852420%2F">音声認識 （機械学習プロフェッショナルシリーズ） [ 篠田 浩一 ]</a>
    </div>
    <div class="ad-rakuten-shop">
      <a href="https://hb.afl.rakuten.co.jp/hgc/g00q0722.waxyc9ff.g00q0722.waxyd017/?pc=https%3A%2F%2Fwww.rakuten.co.jp%2Fbook%2F&amp;m=http%3A%2F%2Fm.rakuten.co.jp%2Fbook%2F">楽天ブックス</a>
    </div>
    <div class="ad-rakuten-price">価格 : 3080円</div>
  </div>
</div>
<h2 id="codepen-でサンプルを実装した"><a class="header-link" href="#codepen-でサンプルを実装した"><span class="header-link-mark"></span></a>CodePen でサンプルを実装した</h2>
<p>CodePen でサンプルを実装してみたので、以下でお試しあれ。自分は Chrome v88 で動作検証した。</p>
<ul>
  <li><a href="https://codepen.io/Neos21/pen/jOVGMya">Web Speech Recognition API</a></li>
</ul><p class="codepen" data-height="345" data-theme-id="light" data-default-tab="result" data-user="Neos21" data-slug-hash="jOVGMya" style="height: 345px; box-sizing: border-box; display: flex; align-items: center; justify-content: center; border: 2px solid; margin: 1em 0; padding: 1em;" data-pen-title="Web Speech Recognition API">
  <span>See the Pen <a href="https://codepen.io/Neos21/pen/jOVGMya">
  Web Speech Recognition API</a> by Neo (<a href="https://codepen.io/Neos21">@Neos21</a>)
  on <a href="https://codepen.io">CodePen</a>.</span>
</p>
<script async src="https://cpwebassets.codepen.io/assets/embed/ei.js"></script>
<p>利用するには、ブラウザの設定で「マイク」へのアクセスを許可してやる必要がある。マイクを許可したら、適当に喋りかけてみて欲しい。うまく音声が認識できると、「認識結果」欄に聞き取れた言葉が出力される。</p>
<h2 id="作り方・注意点"><a class="header-link" href="#作り方・注意点"><span class="header-link-mark"></span></a>作り方・注意点</h2>
<p>API の詳細は CodePen のコードを見てもらうとして。本質だけ記しておく。</p>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> rec <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">webkitSpeechRecognition</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
rec<span class="token punctuation">.</span><span class="token property-access">continuous</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>  <span class="token comment">// `true` にすると連続して音声認識するが、各種イベントが発火しなくなる</span>
rec<span class="token punctuation">.</span><span class="token property-access">interimResults</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>  <span class="token comment">// `true` にすると認識途中の結果も返す</span>
rec<span class="token punctuation">.</span><span class="token property-access">lang</span> <span class="token operator">=</span> <span class="token string">'ja-JP'</span><span class="token punctuation">;</span>  <span class="token comment">// 言語指定</span>
rec<span class="token punctuation">.</span><span class="token property-access">maxAlternatives</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>  <span class="token comment">// 結果候補の最大数 (デフォルト 1)</span>

<span class="token comment">// 音声認識開始処理 (既に `start()` している時に実行するとエラーになるのでその対策として)</span>
<span class="token keyword">const</span> <span class="token function-variable function">startRec</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token keyword control-flow">try</span> <span class="token punctuation">{</span>
    rec<span class="token punctuation">.</span><span class="token method function property-access">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">catch</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">error</span><span class="token punctuation">(</span><span class="token string">'音声認識は既に開始されています'</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// デフォルトの End イベント</span>
<span class="token keyword">const</span> <span class="token function-variable function">defaultOnEnd</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'on End'</span><span class="token punctuation">,</span> <span class="token string">'終了'</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">startRec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// continuous 相当の処理のため、録音を再開する</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 各種イベントを定義する</span>
rec<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">onstart</span>       <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token arrow operator">=></span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'on Start'</span>       <span class="token punctuation">,</span> <span class="token string">'開始・何か喋ってください'</span>        <span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span>
rec<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">onaudiostart</span>  <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token arrow operator">=></span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'on Audio Start'</span> <span class="token punctuation">,</span> <span class="token string">'録音開始・何か喋ってください'</span>    <span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span>
rec<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">onsoundstart</span>  <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token arrow operator">=></span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'on Sound Start'</span> <span class="token punctuation">,</span> <span class="token string">'音声検出開始・何か喋ってください'</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span>
rec<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">onspeechstart</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token arrow operator">=></span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'on Speech Start'</span><span class="token punctuation">,</span> <span class="token string">'音声認識開始 … 聞き取っています'</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span>
rec<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">onspeechend</span>   <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token arrow operator">=></span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'on Speech End'</span>  <span class="token punctuation">,</span> <span class="token string">'音声認識終了'</span>                    <span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span>
rec<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">onsoundend</span>    <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token arrow operator">=></span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'on Sound End'</span>   <span class="token punctuation">,</span> <span class="token string">'音声検出終了'</span>                    <span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span>
rec<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">onaudioend</span>    <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token arrow operator">=></span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'on Audio End'</span>   <span class="token punctuation">,</span> <span class="token string">'録音終了'</span>                        <span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span>
rec<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">onresult</span>      <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'Result'</span><span class="token punctuation">,</span> <span class="token string">'音声認識完了'</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span>
  rec<span class="token punctuation">.</span><span class="token method function property-access">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// continuous 相当の処理のためココで一時停止する</span>
  
  <span class="token comment">// 最後に認識した言葉を出力する</span>
  <span class="token keyword">const</span> transcript <span class="token operator">=</span> event<span class="token punctuation">.</span><span class="token property-access">results</span><span class="token punctuation">[</span>event<span class="token punctuation">.</span><span class="token property-access">results</span><span class="token punctuation">.</span><span class="token property-access">length</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token property-access">transcript</span><span class="token punctuation">;</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'Result (音声認識完了) … Transcript : '</span><span class="token punctuation">,</span> transcript<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
rec<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">onend</span>   <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token arrow operator">=></span> <span class="token function">defaultOnEnd</span><span class="token punctuation">(</span>event<span class="token punctuation">)</span><span class="token punctuation">;</span>
rec<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">onerror</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">warn</span><span class="token punctuation">(</span><span class="token string">'Error'</span><span class="token punctuation">,</span> <span class="token string">'エラーが発生しました'</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">if</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token property-access">error</span> <span class="token operator">===</span> <span class="token string">'not-allowed'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">error</span><span class="token punctuation">(</span><span class="token string">'Error [not-allowed]'</span><span class="token punctuation">,</span> <span class="token string">'マイクが許可されていません'</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// `onerror` 後に `onend` が発火するため `start()` で再開させないようにする</span>
    <span class="token keyword control-flow">return</span> rec<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">onend</span> <span class="token operator">=</span> <span class="token parameter">onEndEvent</span> <span class="token arrow operator">=></span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">error</span><span class="token punctuation">(</span><span class="token string">'End'</span><span class="token punctuation">,</span> <span class="token string">'マイクが許可されていません'</span><span class="token punctuation">,</span> onEndEvent<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword control-flow">if</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token property-access">error</span> <span class="token operator">===</span> <span class="token string">'no-speech'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">warn</span><span class="token punctuation">(</span><span class="token string">'Error [no-speech]'</span><span class="token punctuation">,</span> <span class="token string">'無音状態・音声が聞き取れません・再開します…'</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span>
    rec<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">onend</span> <span class="token operator">=</span> <span class="token parameter">onEndEvent</span> <span class="token arrow operator">=></span> <span class="token function">defaultOnEnd</span><span class="token punctuation">(</span>onEndEvent<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 念のためイベントを初期化する</span>
    <span class="token keyword control-flow">return</span> rec<span class="token punctuation">.</span><span class="token method function property-access">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword control-flow">if</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span><span class="token property-access">error</span> <span class="token operator">===</span> <span class="token string">'aborted'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">warn</span><span class="token punctuation">(</span><span class="token string">'Error [aborted]'</span><span class="token punctuation">,</span> <span class="token string">'音声認識が中止されました・再開します…'</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span>
    rec<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">onend</span> <span class="token operator">=</span> <span class="token parameter">onEndEvent</span> <span class="token arrow operator">=></span> <span class="token function">defaultOnEnd</span><span class="token punctuation">(</span>onEndEvent<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword control-flow">return</span> rec<span class="token punctuation">.</span><span class="token method function property-access">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// その他のエラー : 再開させないようにする https://wicg.github.io/speech-api/#speechreco-error</span>
  rec<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">onend</span> <span class="token operator">=</span> <span class="token parameter">onEndEvent</span> <span class="token arrow operator">=></span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">error</span><span class="token punctuation">(</span><span class="token string">'End'</span><span class="token punctuation">,</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">その他のエラーが発生したため終了しました [</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>event<span class="token punctuation">.</span><span class="token property-access">error</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> onEndEvent<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
rec<span class="token punctuation">.</span><span class="token method-variable function-variable method function property-access">onnomatch</span> <span class="token operator">=</span> <span class="token parameter">event</span> <span class="token arrow operator">=></span> <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">error</span><span class="token punctuation">(</span><span class="token string">'No Match'</span><span class="token punctuation">,</span> <span class="token string">'音声認識できませんでした'</span><span class="token punctuation">,</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">startRec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// 初回音声認識開始</span>

<span class="token comment">// 音声認識を中断する (`onaudioend` が発火する・`onresult` で結果が受け取れない)</span>
<span class="token comment">//rec.abort();</span>
<span class="token comment">// 音声認識を終了する (`onaudioend` が発火する・`onresult` で結果が受け取れる)</span>
<span class="token comment">//rec.stop();</span>
</code></pre>
<p><code>new webkitSpeechRecognition()</code> して、初期設定したり、各種イベントでの制御を入れたりして、<code>start()</code> するだけ。</p>
<p><code>start()</code> すると、<code>onstart</code> → <code>onaudiostart</code> の順でイベントが発火し、待機状態になる。ハッキリしない音でも何かしら拾えば <code>onsoundstart</code> が発火し、ハッキリと言葉が聞こえたら <code>onspeechstart</code> が発火する。ココらへんは一応ログ出ししているが、このタイミングで何かやれることはないかな。</p>
<p>ひとしきり音声認識が終わると、<code>onresult</code> が発火する。この中から <code>transcript</code> プロパティを取得すると、音声認識した文言が取得できる。日本語の場合、単語で分かち書き (スペース区切り) され、漢字への変換なども行われた状態の文字列が取得できる。ここいらの仕組みはブラウザ内部の処理でありハッキリしないので、音声認識した結果を元に何か処理をしたい場合は、漢字・ひらがな・カタカナの表記を曖昧に認識できるように準備しておく必要があるだろう。</p>
<p><code>onresult</code> の中で <code>stop()</code> を呼んでいるため、<code>onspeechend</code> → <code>onsoundend</code> → <code>onend</code> が発火する。自分が書いたコードでは <code>onend</code> 内で再度 <code>start()</code> をしているので、連続して音声認識が行われる。<code>rec.continuous</code> というモードがあるのだが、コレを使うとどうも上手く聞き取り続けられなかったので、自分で明示的に <code>stop()</code> → <code>start()</code> を呼び出すようにした。</p>
<p>マイクがミュート状態だったりしてしばらく無音状態が続くと、<code>onerror</code> が発火するが、エラー種別が <code>no-speech</code> なのでそれ以外のエラーとは区別が付く。<code>onnomatch</code> は自分が試した限りでは発火したことがなかった。</p>
<h2 id="以上"><a class="header-link" href="#以上"><span class="header-link-mark"></span></a>以上</h2>
<p>ブラウザオンリー、外部ライブラリも不要で、簡単に音声認識が実装できてしまった。イベントのハンドリングを原始的に行わないといけないので、その辺面倒臭さはあるが、以前試した Web Speech API と組み合わせてやれば、音声認識に対して合成音声で応答する、といったことも JS オンリーで実装できてしまうだろう。</p><div class="ad-amazon">
  <div class="ad-amazon-image">
    <a href="https://www.amazon.co.jp/dp/4627847122?tag=neos21-22&amp;linkCode=osi&amp;th=1&amp;psc=1">
      <img src="https://m.media-amazon.com/images/I/31pISyyH1nL._SL160_.jpg" width="114" height="160">
    </a>
  </div>
  <div class="ad-amazon-info">
    <div class="ad-amazon-title">
      <a href="https://www.amazon.co.jp/dp/4627847122?tag=neos21-22&amp;linkCode=osi&amp;th=1&amp;psc=1">フリーソフトでつくる音声認識システム パターン認識・機械学習の初歩から対話システムまで</a>
    </div>
  </div>
</div>
<ul>
  <li><a href="https://www.ebiebievidence.com/posts/web-speech-api/">Web Speech APIなら、数行で、ブラウザ上で、無料で音声認識・音声合成ができる | ebiebievidence.com</a></li>
  <li><a href="https://qiita.com/hmmrjn/items/4b77a86030ed0071f548">Webページでブラウザの音声認識機能を使おう - Web Speech API Speech Recognition - Qiita</a></li>
  <li><a href="https://qiita.com/progfay/items/e1865ae41006c6a6b17b">webkitSpeechRecgnitionを扱う - Qiita</a></li>
  <li><a href="https://jellyware.jp/kurage/iot/webspeechapi.html">クラゲのIoTテクノロジー</a></li>
  <li><a href="https://qiita.com/y_ando87/items/b777cc0078960d026fea">文字起こしツールを作った（無料でとりあえず動かしたい人向け） - Qiita</a></li>
</ul>

      </main>
      <footer id="footer">
        <div id="date-time">
          <dl>
            <dt>Created</dt>
            <dd><time>2021-03-09</time></dd>
            <dt>Last-Modified</dt>
            <dd><time>2021-03-09</time></dd>
          </dl>
        </div>
        <nav id="footer-links">
          <ul>
            <li id="footer-link-about"><a href="/about/index.html" title="About">About</a></li>
            <li id="footer-link-search"><a href="/about/search.html" title="Search">Search</a></li>
            <li id="footer-link-feeds"><a href="/feeds.xml" title="Feeds">Feeds</a></li>
            <li id="footer-link-github"><a href="https://github.com/Neos21/" title="GitHub">GitHub</a></li>
          </ul>
        </nav>
        <nav id="to-top"><a href="#" title="To Top"><span>▲ To Top</span></a></nav>
      </footer>
    </div>
  </body>
</html>
