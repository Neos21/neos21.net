<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Google Search Console -->
    <meta name="google-site-verification" content="AvoEr3mUJFF2H_mPWWgShfmjBVP3ywRpyx9hxeeq2d4">
    <title>見た映画の感想を管理するアプリ「FilmDeX」を作った 前編 - Neo's World</title>
    <link rel="icon" href="/favicon.ico">
    <link rel="stylesheet" href="/styles.css">
    <link rel="canonical" href="https://neos21.net/blog/2021/09/17-01.html">
    <link rel="search" type="application/opensearchdescription+xml" title="neos21.net" href="/opensearch.xml">
    <link rel="alternate" type="application/atom+xml" href="/feeds.xml">
    <link rel="author" href="http://www.hatena.ne.jp/neos21/">
    <!-- Global Site Tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YMHFLZP1M1"></script>
    <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date());gtag('config','G-YMHFLZP1M1');gtag('config','UA-106501-1');</script>
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6475907504235292" crossorigin="anonymous"></script>
  </head>
  <body>
    <div id="container">
      <header id="header">
        <div id="site-title"><a href="/index.html">Neo's World</a></div>
        <nav id="header-links">
          <ul>
            <li id="header-link-about"><a href="/about/index.html" title="About"><span>About</span></a></li>
            <li id="header-link-search"><a href="/about/search.html" title="Search"><span>Search</span></a></li>
            <li id="header-link-feeds"><a href="/feeds.xml" title="Feeds"><span>Feeds</span></a></li>
            <li id="header-link-to-bottom"><a href="#footer" title="To Bottom"><span>▼ To Bottom</span></a></li>
          </ul>
        </nav>
        <nav id="global-nav">
          <ul>
            <li><a href="/blog/index.html">Blog</a></li>
            <li><a href="/tech/index.html">Tech</a></li>
            <li><a href="/music/index.html">Music</a></li>
            <li><a href="/games/index.html">Games</a></li>
            <li><a href="/gallery/index.html">Gallery</a></li>
            <li><a href="/etc/index.html">Etc.</a></li>
          </ul>
        </nav>
        <nav id="path">
          <ul>
            <li><a href="/index.html">Neo's World</a></li>
            <li><a href="/blog/index.html">Blog</a></li>
            <li><a href="/blog/2021/index.html">2021年</a></li>
            <li><a href="/blog/2021/09/index.html">09月</a></li>
          </ul>
        </nav>
      </header>
      <main id="main">
        <div id="header-date"><time>2021-09-17</time></div>
        <h1 id="page-title">見た映画の感想を管理するアプリ「FilmDeX」を作った 前編</h1>

<p>自分は映画が好きで、このサイトのブログでもそれなりに映画レビューの記事を書いてきた。ただ、ブログ記事は見た時に何となく書いているので、一覧性に欠ける。</p>
<p>自分は果たしてどれだけの映画を見てきたのか？それらはどんな映画だったっけ？誰が出演していたっけ？同じ監督の作品はどれくらい見てきただろうか？</p>
<p>そういう<em>「僕が見た映画データベース」</em>を作りたい欲求は5年ぐらい前から考えていた。当初は Rails で作ろうかなーと考え、作りかけたところで放置。Perl・PHP・Python CGI をイジイジしていた数年前もなんか出来ないかなーと考えていたが、形にならず。そして今回ようやく、<strong>Angular + NestJS</strong> でウェブアプリを作成した。その名も <strong>FilmDeX</strong>。</p>
<ul>
  <li><a href="https://neos21.github.io/filmdex/">FilmDeX</a></li>
</ul>
<p>↑ GitHub Pages で閲覧できる。</p>
<ul>
  <li><a href="https://github.com/Neos21/filmdex">Neos21/filmdex: FilmDeX : 観た映画の情報・感想を一覧表示・管理するウェブアプリ</a></li>
</ul>
<p>↑ GitHub リポジトリ。</p>
<p>エンドユーザの皆様としては、GitHub Pages で映画情報を見ていただくだけ。ただ、裏側は色々と試行錯誤したので、その経緯を以下に書いていく。</p>
<h2 id="目次"><a class="header-link" href="#目次"><span class="header-link-mark"></span></a>目次</h2>
<ul>
  <li><a href="#%E5%AE%89%E5%AE%9A%E3%81%AE-angular">安定の Angular</a></li>
  <li><a href="#nestjs-%E3%82%92%E4%BD%BF%E3%81%A3%E3%81%A6%E3%81%BF%E3%81%9F%E3%81%8B%E3%81%A3%E3%81%9F">NestJS を使ってみたかった</a></li>
  <li><a href="#nodejs--sqlite-%E3%82%92%E7%A8%BC%E5%8B%95%E3%81%95%E3%81%9B%E3%82%89%E3%82%8C%E3%82%8B%E5%A0%B4%E6%89%80%E3%81%8C%E3%81%AA%E3%81%84">Node.js + SQLite を稼動させられる場所がない</a></li>
  <li><a href="#%E5%8F%82%E7%85%A7%E5%B0%82%E7%94%A8%E3%81%AE%E3%82%AF%E3%83%A9%E3%82%A4%E3%82%A2%E3%83%B3%E3%83%88%E3%82%A2%E3%83%97%E3%83%AA%E3%81%AB%E3%81%97%E3%82%88%E3%81%86%E3%81%8B">参照専用のクライアントアプリにしようか…</a></li>
</ul>
<h2 id="安定の-angular"><a class="header-link" href="#安定の-angular"><span class="header-link-mark"></span></a>安定の Angular</h2>
<p>フロントエンドには安定の Angular を使った。皆なんで React や Vue を選択してわざわざ苦労してるんだろう？CSS-in-JS の話とか周辺ライブラリの選定とか、ホントいつまでやってんの？プロジェクトの設計じゃなくて早く実装しろよと思って見てる。</p>
<p>Angular はその辺フルスタックで全部用意されてるので、さっさと Angular Way に乗っちゃえば実装に専念できる。完全に TypeScript に対応しているのもスゲー楽。今回は頑張って <code>any</code> で逃げないようにコーディングしてみた。仕事でしょーもないウンコードばっかり見せられてゲンナリしているので、自分が思うキレイなコードを追求できて自己満足した。</p>
<h2 id="nestjs-を使ってみたかった"><a class="header-link" href="#nestjs-を使ってみたかった"><span class="header-link-mark"></span></a>NestJS を使ってみたかった</h2>
<p>最終的には <em>NestJS で作った部分をゴッソリ捨てた</em>のだが、今回試しに使ってみた NestJS がとても実装しやすかった。</p>
<ul>
  <li><a href="https://github.com/Neos21/filmdex/tree/v1">Neos21/filmdex at v1</a></li>
  <li><a href="https://github.com/Neos21/filmdex/tree/v1/server">filmdex/server at v1 · Neos21/filmdex</a></li>
</ul>
<p>↑ NestJS の実装部分は削除してしまったので、<code>v1</code> というタグ時点のコードを参照いただきたい。以降はこの <code>v1</code> 時点の構成について話す。</p>
<p>NestJS というアプリケーションサーバフレームワークは、TypeScript 製で、Angular に似た CLI やデコレータが用意されている。公式ガイドも豊富で、とても実装しやすかった。</p>
<p>映画情報の登録や更新は、管理画面で行えるような作りにしてみた。よくあるパスワード認証でログインしたあと、JWT (JSON Web Token) を発行し、それで API コール時に認証をかけるようにした。この辺の仕組みも NestJS のモジュールが存在していて、イイカンジに実装できる。調べればすぐ情報が出てくるので、NestJS の作り込みで困ることはほぼなかった。</p>
<p>データ永続化層については、ローカルでデータを保持したい思いから、SQLite を使うことにした。NestJS からは O/R マッパーの <em>TypeORM</em> を使ってイイカンジに接続できる。TypeORM はリレーションの扱いで若干苦労したけど、まぁ許容範囲内。キチンと作れば TypeScript のデコレータやクラスで作ったコードは、可読性は高い。</p>
<h2 id="nodejs--sqlite-を稼動させられる場所がない"><a class="header-link" href="#nodejs--sqlite-を稼動させられる場所がない"><span class="header-link-mark"></span></a>Node.js + SQLite を稼動させられる場所がない</h2>
<p>NestJS での実装が気持ち良く、TypeORM も使いこなし、Angular 側から NestJS 側で作った <code>.ts</code> クラスを <code>import</code> して Universal TS だーみたいな感じでウキウキで開発していたワケだが、Node.js でアプリケーションサーバを作ってしまうと、それをデプロイ・稼動させられる PaaS のホスティングサービスがほとんどないことを思い出す。さらに、PostgreSQL や MySQL を提供している無料の PaaS はあるが、SQLite を提供している PaaS はほぼなかった。</p>
<p><a href="https://github.com/ripienaar/free-for-dev">free-for-dev</a> なども参照したが、FaaS はそこそこあれど、やはり PaaS となるとほぼない。あったとしても SQLite に対応していなかったりする。</p>
<p>そうなると残るは IaaS に自前で置くしかない。Always Free の OCI に試しに置いてみたら、Angular も NestJS もちゃんとビルドでき、SQLite 部分込みで正常に動作した。一応問題はないのだが、Always Free VM は低スペックなので、ココに自分以外からのアクセスがあると、参照系だけといえどもサーバの負荷が気になってくる。</p>
<p>というのも、当初は NestJS 側で API を用意し、SQLite から都度全量を取得し、Angular で表示するような作りにしていたのだ。となると、画面を開くたびに SQLite への SELECT が発生するので、無料サーバにとっては負荷がかかるなーと。</p>
<h2 id="参照専用のクライアントアプリにしようか"><a class="header-link" href="#参照専用のクライアントアプリにしようか"><span class="header-link-mark"></span></a>参照専用のクライアントアプリにしようか…</h2>
<p>SQLite に対してデータの追加・更新をするのは、レビューを書く自分だけ。エンドユーザの皆様はデータを参照するだけ。</p>
<p>だったら、SQLite DB からの参照を頻繁に行う必要はなく、データを JSON ファイルにでも吐き出しておいて、サーバサイドとは接続しない参照専用のクライアントアプリを作ったら良いんじゃないか？と考え始めた。</p>
<p>結果的にデータを JSON ファイルで持つなら、TypeORM と SQLite を省いて、<a href="https://github.com/louischatriot/nedb">NeDB</a> あたりを使って JSON ファイルを直接読み書きしたら良かったのでは？とも思い始めてしまう。</p>
<p>見た映画の情報を一覧表示するデータベースとしては、個人的に求めていた UI・機能を実現できた。こんな映画見たなー、コレ面白かったなー、みたいなのを一覧化して、シリーズモノを検索して確認したりできる UI で、とりあえず僕の欲しいモノは作れた。</p>
<p>ただ、<em>「個人の趣味のプロジェクトとして、完全無料でホスティングしたい」</em>という要件が重たく、あれこれやっている内にイビツなプロジェクトになってきた。裏側の構成検討は<strong>後編</strong>で再検討する。</p>
<ul>
  <li>後編：<a href="18-01.html">見た映画の感想を管理するアプリ「FilmDeX」を作った 後編</a></li>
</ul><div class="ad-rakuten">
  <div class="ad-rakuten-image">
    <a href="https://hb.afl.rakuten.co.jp/hgc/g00reb42.waxycf23.g00reb42.waxyd080/?pc=https%3A%2F%2Fitem.rakuten.co.jp%2Frakutenkobo-ebooks%2Fd3133a38ca6d317082f4cd7f78b393c4%2F&amp;m=http%3A%2F%2Fm.rakuten.co.jp%2Frakutenkobo-ebooks%2Fi%2F18698031%2F">
      <img src="https://thumbnail.image.rakuten.co.jp/@0_mall/rakutenkobo-ebooks/cabinet/5916/2000007895916.jpg?_ex=128x128">
    </a>
  </div>
  <div class="ad-rakuten-info">
    <div class="ad-rakuten-title">
      <a href="https://hb.afl.rakuten.co.jp/hgc/g00reb42.waxycf23.g00reb42.waxyd080/?pc=https%3A%2F%2Fitem.rakuten.co.jp%2Frakutenkobo-ebooks%2Fd3133a38ca6d317082f4cd7f78b393c4%2F&amp;m=http%3A%2F%2Fm.rakuten.co.jp%2Frakutenkobo-ebooks%2Fi%2F18698031%2F">Learn TypeScript 3 by Building Web Applications Gain a solid understanding of TypeScript, Angular, Vue, React, and NestJS【電子書籍】[ Sebastien Dubois ]</a>
    </div>
    <div class="ad-rakuten-shop">
      <a href="https://hb.afl.rakuten.co.jp/hgc/g00reb42.waxycf23.g00reb42.waxyd080/?pc=https%3A%2F%2Fwww.rakuten.co.jp%2Frakutenkobo-ebooks%2F&amp;m=http%3A%2F%2Fm.rakuten.co.jp%2Frakutenkobo-ebooks%2F">楽天Kobo電子書籍ストア</a>
    </div>
    <div class="ad-rakuten-price">価格 : 2870円</div>
  </div>
</div>
<div class="ad-amazon">
  <div class="ad-amazon-image">
    <a href="https://www.amazon.co.jp/dp/B081FB89BL?tag=neos21-22&amp;linkCode=osi&amp;th=1&amp;psc=1">
      <img src="https://m.media-amazon.com/images/I/51AeDmW+RVL._SL160_.jpg" width="129" height="160">
    </a>
  </div>
  <div class="ad-amazon-info">
    <div class="ad-amazon-title">
      <a href="https://www.amazon.co.jp/dp/B081FB89BL?tag=neos21-22&amp;linkCode=osi&amp;th=1&amp;psc=1">Learn TypeScript 3 by Building Web Applications: Gain a solid understanding of TypeScript, Angular, Vue, React, and NestJS (English Edition)</a>
    </div>
  </div>
</div>

      </main>
      <footer id="footer">
        <div id="date-time">
          <dl>
            <dt>Created</dt>
            <dd><time>2021-09-17</time></dd>
            <dt>Last-Modified</dt>
            <dd><time>2021-09-17</time></dd>
          </dl>
        </div>
        <nav id="footer-links">
          <ul>
            <li id="footer-link-about"><a href="/about/index.html" title="About">About</a></li>
            <li id="footer-link-search"><a href="/about/search.html" title="Search">Search</a></li>
            <li id="footer-link-feeds"><a href="/feeds.xml" title="Feeds">Feeds</a></li>
            <li id="footer-link-github"><a href="https://github.com/Neos21/" title="GitHub">GitHub</a></li>
          </ul>
        </nav>
        <nav id="to-top"><a href="#" title="To Top"><span>▲ To Top</span></a></nav>
      </footer>
    </div>
  </body>
</html>
