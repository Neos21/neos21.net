<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="theme-color" content="#0990d0">
    <!-- Google Search Console -->
    <meta name="google-site-verification" content="AvoEr3mUJFF2H_mPWWgShfmjBVP3ywRpyx9hxeeq2d4">
    <title>Node.js の worker_threads でマルチスレッド処理を行う - Neo's World</title>
    <link rel="icon" href="/favicon.ico">
    <link rel="stylesheet" href="/styles.css">
    <link rel="canonical" href="https://neos21.net/blog/2022/08/11-01.html">
    <link rel="search" type="application/opensearchdescription+xml" title="neos21.net" href="/opensearch.xml">
    <link rel="alternate" type="application/atom+xml" title="Feeds" href="/feeds.xml">
    <link rel="author" href="http://www.hatena.ne.jp/neos21/">
    <script src="/scripts.js"></script>
    <!-- Global Site Tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YMHFLZP1M1"></script>
    <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date());gtag('config','G-YMHFLZP1M1');gtag('config','UA-106501-1');</script>
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6475907504235292" crossorigin="anonymous"></script>
  </head>
  <body>
    <div id="container">
      <header id="header">
        <div id="header-brand">
          <div id="header-brand-contents">
            <div id="site-title"><a href="/index.html">Neo's World</a></div>
            <nav id="header-links">
              <ul>
                <li id="header-link-theme"><a href="#" title="Toggle Theme"><span>Toggle Theme</span></a></li>
                <li id="header-link-about"><a href="/about/index.html" title="About"><span>About</span></a></li>
                <li id="header-link-search"><a href="/about/search.html" title="Search"><span>Search</span></a></li>
                <li id="header-link-feeds"><a href="/feeds.xml" title="Feeds"><span>Feeds</span></a></li>
                <li id="header-link-to-bottom"><a href="#footer" title="To Bottom"><span>▼ To Bottom</span></a></li>
              </ul>
            </nav>
          </div>
        </div>
        <nav id="global-nav">
          <ul>
            <li><a href="/blog/index.html">Blog</a></li>
            <li><a href="/tech/index.html">Tech</a></li>
            <li><a href="/music/index.html">Music</a></li>
            <li><a href="/games/index.html">Games</a></li>
            <li><a href="/gallery/index.html">Gallery</a></li>
            <li><a href="/etc/index.html">Etc.</a></li>
          </ul>
        </nav>
        <nav id="path">
          <ul>
            <li><a href="/index.html">Neo's World</a></li>
            <li><a href="/blog/index.html">Blog</a></li>
            <li><a href="/blog/2022/index.html">2022年</a></li>
            <li><a href="/blog/2022/08/index.html">08月</a></li>
          </ul>
        </nav>
      </header>
      <main id="main">
        <div id="header-date"><time>2022-08-11</time></div>
        <h1 id="page-title">Node.js の worker_threads でマルチスレッド処理を行う</h1>

<p>先日 Web Worker による別スレッド処理の方法を紹介したが、今度は Node.js で同様にマルチスレッド処理ができる、<strong><code>worker_threads</code></strong> という組み込みモジュールを紹介する。</p>
<ul>
  <li>過去記事 : <a href="./10-01.html">Web Worker を使ってバックグラウンド処理などしてみる</a></li>
</ul>
<h2 id="目次"><a class="header-link" href="#目次"><span class="header-link-mark"></span></a>目次</h2>
<ul>
  <li><a href="#nodejs-%E3%81%AB%E3%81%8A%E3%81%91%E3%82%8B%E3%83%97%E3%83%AD%E3%82%BB%E3%82%B9%E3%82%B9%E3%83%AC%E3%83%83%E3%83%89%E3%81%AE%E6%A6%82%E5%BF%B5%E6%95%B4%E7%90%86">Node.js におけるプロセス・スレッドの概念整理</a></li>
  <li><a href="#%E3%81%AF%E3%82%88%E3%82%B3%E3%83%BC%E3%83%89%E8%A6%8B%E3%81%9B%E3%82%8D">はよコード見せろ</a></li>
  <li><a href="#%E3%81%8A%E3%81%BE%E3%81%91--intel-mac-%E3%81%AE%E3%82%A2%E3%82%AF%E3%83%86%E3%82%A3%E3%83%93%E3%83%86%E3%82%A3%E3%83%A2%E3%83%8B%E3%82%BFcpu-%E3%82%B9%E3%83%AC%E3%83%83%E3%83%89%E3%81%AE%E5%8D%8A%E5%88%86%E3%81%8C%E4%BD%BF%E3%82%8F%E3%82%8C%E3%81%A6%E3%81%84%E3%81%AA%E3%81%84%E3%82%88%E3%81%86%E3%81%AB%E8%A6%8B%E3%81%88%E3%82%8B%E4%BB%B6">おまけ : Intel Mac のアクティビティモニタ、CPU スレッドの半分が使われていないように見える件</a></li>
</ul>
<h2 id="nodejs-におけるプロセススレッドの概念整理"><a class="header-link" href="#nodejs-におけるプロセススレッドの概念整理"><span class="header-link-mark"></span></a>Node.js におけるプロセス・スレッドの概念整理</h2>
<p><em>Node.js は通常、「シングル・プロセス」「シングル・スレッド」で実行される。</em></p>
<p>「プロセス」というのは平たくいえば「起動中の1アプリ」のことで、「シングル・プロセス」というのは「Node.js はその処理中にプロセスを1つしか作りませんよ」ということである。「マルチ・プロセス」で動くアプリといえば、Apache HTTP Server などが分かりやすいか。Google Chrome ブラウザなんかも、タブごとなどにマルチプロセスで動いている。</p>
<p>「スレッド」というのは、各プロセスが使用する CPU の単位。よく「4コア8スレッド CPU」などというが、CPU のコア数がイコールスレッド数だったり、最近はハイパースレッディング機能を持つ CPU がほとんどなので、CPU コア数の倍の数が「利用可能なスレッド数」とみなせる。Node.js の場合、1つのプロセスしか起動せず、その1つのプロセスの中でも、CPU を1スレッド分しか使わないで動作している、ということである。例えば2コア4スレッドの CPU 上で Node.js 製のアプリを動かすと、CPU 使用率は全体でも 25% 程度に留まる、というようなイメージである。</p>
<p>ただ、実際の Node.js 内部では、libuv によって必要に応じて自動的にマルチスレッド処理をしているようである (<code>fs</code> モジュールでのファイル I/O など)。そのために待機するスレッドも作られているようだ。まぁ Node.js を使ったスクリプトやアプリを書く人にとってはほとんど意識する場所ではなく、原則シングルスレッドで動いている、という考え方で問題ないかと覆う。</p>
<ul>
  <li>参考 : <a href="https://github.com/nodejs/node/blob/v18.7.0/deps/uv/src/threadpool.c#L39">node/threadpool.c at v18.7.0 · nodejs/node</a> … デフォルトで4スレッド作られる模様</li>
</ul>
<p>こういう仕組みなので、Node.js が複数の処理を同時に行おうと思った場合、「イベントループ」という仕組みで、あたかも同時並行に処理しているかのように見せているワケである。Promise や <code>async</code>・<code>await</code> によって実現される非同期処理は、<strong>実際は「並列 (Pararell)」ではなく「並行 (Concurrent)」処理</strong>なのである。両手で同時に絵を描いているのではなく、片手で2枚の紙にちょっとずつ絵を描いていっているような、そんなイメージ。ｗ</p>
<ul>
  <li>参考 : <a href="https://zenn.dev/antez/books/568dd4d86562a1/viewer/531a45">非同期処理 プロセスとスレッド｜業務ができる中級者になるためのJavaScript入門（文法編）</a></li>
  <li>参考 : <a href="https://qiita.com/Kohei909Otsuka/items/26be74de803d195b37bd">並行処理、並列処理のあれこれ - Qiita</a></li>
</ul>
<p>Node.js には元々、<code>child_process</code> というモジュールで別プロセスを起動する方法があり、コレを応用した <strong><code>cluster</code></strong> というモジュールが用意されている。コチラは内部で <code>child_process</code> を利用しており、複数のプロセスを起動することで、それらのプロセスに異なる CPU スレッドを利用させることで負荷分散させていた。つまり <em>「マルチ・プロセス」で動作するのだが、各プロセスは「シングル・スレッド」で動作している</em>、というのが <code>cluster</code> モジュールである。</p>
<p>Cluster モジュールについては過去記事で紹介しているが、Express のような HTTP サーバを負荷分散させるために使ったりするのが向いている。プロセスの起動というのは起動時にメモリを大きく消費するし、各プロセスが別々にメモリを確保するので、使い所は見極めないといけない。</p>
<ul>
  <li>過去記事 : <a href="/blog/2019/04/18-01.html">Node.js の Cluster モジュールを使って Express サーバを並列化する</a></li>
</ul>
<p>ただ、最近は Kubernetes なんかにアプリをデプロイすることがあると思うが、その際は Pod の <code>replicas</code> でレプリカ数を指定して複数コンテナを起動させた方が、適切に負荷分散されることだろう (わざわざ Pod 内で <code>cluster</code> モジュールを使う必要はない)。Kubernetes Pod 内で <code>require('os').cpus().length</code> を見ると、K8s Worker Node の CPU スレッド数がそのまま見えるので、その数でプロセスを分離して負荷分散しようとすると、Pod 定義の <code>resources.limits.cpu</code> の設定とそぐわなくなってしまう。</p>
<ul>
  <li>参考 : <a href="https://amagiacademy.com/blog/posts/2020-02-26/node-container-cpu">Node.js w/ container CPU limits</a>
    <ul>
      <li>K8s の設定の方で CPU 0.2コア の Limit を指定していても、4つのワーカに分離される</li>
    </ul>
  </li>
  <li>参考 : <a href="https://stackoverflow.com/questions/57813464/does-it-make-sense-to-use-nodejs-cluster-package-with-kubernetes">node.js - Does it make sense to use NodeJS cluster package with Kubernetes? - Stack Overflow</a>
    <ul>
      <li>K8s 使ってるならレプリカ Pod 立てれば良いだけ、Cluster モジュールは要らんやろ、という指摘</li>
    </ul>
  </li>
</ul>
<p>では、今回紹介する <strong><code>worker_threads</code></strong> とはどういうモノかというと、<strong>「シングル・プロセス」「マルチ・スレッド」</strong> で動作するコードが書けるようになるモノである。Cluster と違ってプロセスは一つ。それでいて CPU スレッドは複数使える。</p>
<p>コレの何が良いのかというと、「別プロセスを起動する」よりも生成コストが少なく済むことと、「<em>各スレッドがメモリを共有できる</em>」点にある。<code>child_process</code> および <code>cluster</code> によって別プロセスを起動した場合、そのプロセス間でのデータのやり取りは IPC という仕組みで、メッセージを送り合うことになる。メッセージは各プロセスで複製して保持されるので、大容量のデータを「共有」したい時にメモリを食うことになるワケである。一方、<code>worker_threads</code> の仕組みなら、平たくいえば「各々が同じグローバル変数を参照・操作できる」のに近い状況となり、大量データの受け渡しが低コストで済むワケである。</p>
<p><code>worker_threads</code> は Node.js v10.5.0 頃に導入され、v11 以降は普通に利用できるようになっている。</p>
<p><code>worker_threads</code> によってより軽量にマルチスレッド処理が実現できるようになるなら、<code>cluster</code> モジュールはもう要らないのではないか、というとそうでもない。<strong>Node.js は V8 の制限により、1プロセスが保持するヒープメモリは 1.5GB まで</strong>となっている。単一プロセスでメモリを共有する <code>worker_threads</code> の場合、使えるメモリは全体で 1.5GB まで、というのが原則となる。一方 <code>cluster</code> ならプロセスを分離しているので、その分だけメモリを多く利用できるワケである。だから HTTP サーバのようなモノならクラスタ化して複数起動しておくことで、<em>CPU コア、大容量メモリを活用した負荷分散ができる</em>というワケだ。</p>
<p><code>worker_threads</code> はスレッド分割によって CPU バウンドな処理はより効率的に処理できるようになるが、「メモリが共有できる」という点は、処理内容によってはメリットにもデメリットにもなりうるということである。</p>
<ul>
  <li>参考 : <a href="https://scrapbox.io/shokai/Worker_Threads">Worker Threads - 橋本商会</a></li>
  <li>参考 : <a href="https://nhiroki.jp/2017/12/10/javascript-parallel-processing#5-worker-%E3%81%AE%E3%82%B3%E3%82%B9%E3%83%88">JavaScript のスレッド並列実行環境</a></li>
</ul>
<h2 id="はよコード見せろ"><a class="header-link" href="#はよコード見せろ"><span class="header-link-mark"></span></a>はよコード見せろ</h2>
<p>…話が長くなってしまったが、とりあえず <code>worker_threads</code> を利用するコードをお見せしよう。</p>
<ul>
  <li><code>main.js</code> … Worker を生成する、親となるコード</li>
</ul>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> workerThreads <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'worker_threads'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// ココでは Worker を1つ生成する</span>
<span class="token keyword">const</span> worker <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">workerThreads<span class="token punctuation">.</span>Worker</span><span class="token punctuation">(</span><span class="token string">'./worker.js'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  workerData<span class="token operator">:</span> <span class="token string">'From Main'</span>  <span class="token comment">// Worker に初期値を渡せる</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

worker<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token parameter">message</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[Main] Worker からメッセージを受信 : [</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
worker<span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> <span class="token parameter">error</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[Main] Worker でエラーが発生 : [</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>error<span class="token punctuation">.</span><span class="token property-access">message</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'[Main] 初回メッセージを送る'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
worker<span class="token punctuation">.</span><span class="token method function property-access">postMessage</span><span class="token punctuation">(</span><span class="token string">'Hello From Main'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token string">'[Main] エラーを発生させるためのメッセージを送る'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  worker<span class="token punctuation">.</span><span class="token method function property-access">postMessage</span><span class="token punctuation">(</span><span class="token string">'Please Error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>続いて、上の <code>main.js</code> から呼び出される Worker 側のコード。</p>
<ul>
  <li><code>worker.js</code></li>
</ul>
<pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> workerThreads <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'worker_threads'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// うっかり `$ node ./worker.js` で起動された時に何もしないようにする</span>
<span class="token keyword control-flow">if</span><span class="token punctuation">(</span>workerThreads<span class="token punctuation">.</span><span class="token property-access">isMainThread</span><span class="token punctuation">)</span> <span class="token keyword control-flow">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'このスクリプトはメインスレッドでは利用できません'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// `new Worker()` の `workerData` で渡された値が参照できる</span>
<span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[Worker] Init Worker Data : [</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>workerThreads<span class="token punctuation">.</span><span class="token property-access">workerData</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>

workerThreads<span class="token punctuation">.</span><span class="token property-access">parentPort</span><span class="token punctuation">.</span><span class="token method function property-access">on</span><span class="token punctuation">(</span><span class="token string">'message'</span><span class="token punctuation">,</span> <span class="token parameter">message</span> <span class="token arrow operator">=></span> <span class="token punctuation">{</span>
  <span class="token console class-name">console</span><span class="token punctuation">.</span><span class="token method function property-access">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[Worker] メインスレッドからメッセージを受信 : [</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">]</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// わざとエラーを投げるためのコード</span>
  <span class="token keyword control-flow">if</span><span class="token punctuation">(</span>message <span class="token operator">===</span> <span class="token string">'Please Error'</span><span class="token punctuation">)</span> <span class="token keyword control-flow">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">'Worker からエラーをスローします'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  
  <span class="token comment">// `main.js` に向けてメッセージを送信する</span>
  workerThreads<span class="token punctuation">.</span><span class="token property-access">parentPort</span><span class="token punctuation">.</span><span class="token method function property-access">postMessage</span><span class="token punctuation">(</span><span class="token string">'Worker からメッセージを返信します'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre>
<p>こんな感じで、Web Worker に似たような <code>postMessage()</code> でのやり取りができる。メモリを共有するには SharedArrayBuffer などを使わないといけないので、この例では各メッセージは複製されているのだが。</p>
<p>CPU リソースを使う重たい処理を、CPU スレッドの数だけ分割して処理させ、各 Worker の計算結果を親スレッドが束ねる、みたいな感じで扱うと、マルチスレッドの恩恵が受けられそう。</p>
<ul>
  <li>参考 : <a href="https://qiita.com/suin/items/bce351c812603d413841">Node.js: CPU負荷で3秒かかっていた処理を「Worker Threads」で1秒に時短する - Qiita</a></li>
  <li>参考 : <a href="https://qiita.com/suin/items/bc79e1ced0dbb70c0a11">Node.js: <code>worker_threads</code>のスレッド間通信は、<code>child_process</code>のプロセス間通信の2〜11倍速い。 - Qiita</a></li>
  <li>参考 : <a href="https://qiita.com/suin/items/8fb7f77dd0a994b6f524">Node.js Worker Threads: スレッド間でデータを送受信する方法 - Qiita</a></li>
  <li>参考 : <a href="https://kakts-tec.hatenablog.com/entry/2018/12/14/005316">worker_threadsを使ったNode.js マルチスレッドプログラミング - kakts-log</a></li>
  <li>参考 : <a href="https://qiita.com/syamobariyuta/items/17537f3be70626111e34">Node.jsのworker_threadsモジュール（スレッドプール） - Qiita</a></li>
  <li>参考 : <a href="https://nju33.com/notes/nodejs/articles/%E3%83%9E%E3%83%AB%E3%83%81%E3%82%B9%E3%83%AC%E3%83%83%E3%83%89:%20worker_threads">マルチスレッド: worker_threads - NodeJS | nju33</a></li>
</ul>
<h2 id="おまけ--intel-mac-のアクティビティモニタcpu-スレッドの半分が使われていないように見える件"><a class="header-link" href="#おまけ--intel-mac-のアクティビティモニタcpu-スレッドの半分が使われていないように見える件"><span class="header-link-mark"></span></a>おまけ : Intel Mac のアクティビティモニタ、CPU スレッドの半分が使われていないように見える件</h2>
<p>今回の記事を書くために CPU に負荷をかけるようなコードを書いて色々と動作確認していたのだが、Intel CPU 搭載の MacBook Pro の「アクティビティモニタ」を見ていたところ、6コア12スレッドのうち、6スレッドしかアクティブに動いていなくて、残り6スレッドは全く使用されていないかのように見えていた。</p>
<ul>
  <li>使用していたのは MacBook Pro (16-inch, 2019) モデルで、CPU は Intel(R) Core(TM) i7-9750H CPU @ 2.60GHz (6コア12スレッド)、メモリは 16GB 2667MHz DDR4</li>
</ul>
<p>Node.js や V8 エンジンのせいなのかと思い、Python など他の言語のコードでも負荷をかけてみたけど、やはり12スレッド中、奇数番目の6スレッドしか動作していないように見えていた。</p>
<ul>
  <li><a href="https://github.com/nodejs/help/issues/2316">macOS only uses half of its logical CPU cores by using Worker Threads · Issue #2316 · nodejs/help</a></li>
  <li><a href="https://github.com/nodejs/node/issues/38629">only half of the cores can be made busy on MacOS, ever · Issue #38629 · nodejs/node</a></li>
  <li><a href="https://github.com/denoland/deno/issues/10592">on MacOS only half of the CPU cores can be maxed out · Issue #10592 · denoland/deno</a></li>
</ul>
<p>似たような話をしている人もいるのだけど、M1 Mac ではハイパースレッディングをしなくなったから全コア使っているように見えてるらしく、コレといった原因がよく分からない。コレは何で？どゆこと？故障とかじゃないと思うんだけど、ワイの MBP はハイパースレッディング無効化されとるんか？笑〃 どなたか原因が分かる方、教えてくだしあ〜ｗ</p><div class="ad-amazon">
  <div class="ad-amazon-image">
    <a href="https://www.amazon.co.jp/dp/B07CKM67YX?tag=neos21-22&amp;linkCode=osi&amp;th=1&amp;psc=1">
      <img src="https://m.media-amazon.com/images/I/51LpKnsmSQL._SL160_.jpg" width="125" height="160">
    </a>
  </div>
  <div class="ad-amazon-info">
    <div class="ad-amazon-title">
      <a href="https://www.amazon.co.jp/dp/B07CKM67YX?tag=neos21-22&amp;linkCode=osi&amp;th=1&amp;psc=1">Linuxとpthreadsによる マルチスレッドプログラミング入門</a>
    </div>
  </div>
</div>
<div class="ad-rakuten">
  <div class="ad-rakuten-image">
    <a href="https://hb.afl.rakuten.co.jp/hgc/g00reb42.waxycf23.g00reb42.waxyd080/?pc=https%3A%2F%2Fitem.rakuten.co.jp%2Frakutenkobo-ebooks%2F35cabe8ecee03951b36de5718d601172%2F&amp;m=http%3A%2F%2Fm.rakuten.co.jp%2Frakutenkobo-ebooks%2Fi%2F13182880%2F">
      <img src="https://thumbnail.image.rakuten.co.jp/@0_mall/rakutenkobo-ebooks/cabinet/8203/2000001848203.jpg?_ex=128x128">
    </a>
  </div>
  <div class="ad-rakuten-info">
    <div class="ad-rakuten-title">
      <a href="https://hb.afl.rakuten.co.jp/hgc/g00reb42.waxycf23.g00reb42.waxyd080/?pc=https%3A%2F%2Fitem.rakuten.co.jp%2Frakutenkobo-ebooks%2F35cabe8ecee03951b36de5718d601172%2F&amp;m=http%3A%2F%2Fm.rakuten.co.jp%2Frakutenkobo-ebooks%2Fi%2F13182880%2F">増補改訂版 Java言語で学ぶデザインパターン入門 マルチスレッド編【電子書籍】[ 結城 浩 ]</a>
    </div>
    <div class="ad-rakuten-shop">
      <a href="https://hb.afl.rakuten.co.jp/hgc/g00reb42.waxycf23.g00reb42.waxyd080/?pc=https%3A%2F%2Fwww.rakuten.co.jp%2Frakutenkobo-ebooks%2F&amp;m=http%3A%2F%2Fm.rakuten.co.jp%2Frakutenkobo-ebooks%2F">楽天Kobo電子書籍ストア</a>
    </div>
    <div class="ad-rakuten-price">価格 : 5170円</div>
  </div>
</div>

      </main>
      <footer id="footer">
        <div id="footer-contents">
          <div id="date-time">
            <dl>
              <dt>Created</dt>
              <dd><time>2022-08-11</time></dd>
              <dt>Last-Modified</dt>
              <dd><time>2022-08-11</time></dd>
            </dl>
          </div>
          <nav id="footer-links">
            <ul>
              <li id="footer-link-about"><a href="/about/index.html" title="About">About</a></li>
              <li id="footer-link-search"><a href="/about/search.html" title="Search">Search</a></li>
              <li id="footer-link-feeds"><a href="/feeds.xml" title="Feeds">Feeds</a></li>
              <li id="footer-link-github"><a href="https://github.com/Neos21/" title="GitHub">GitHub</a></li>
            </ul>
          </nav>
          <nav id="to-top"><a href="#" title="To Top"><span>▲ To Top</span></a></nav>
        </div>
      </footer>
    </div>
  </body>
</html>
