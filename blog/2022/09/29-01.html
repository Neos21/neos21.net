<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="theme-color" content="#0990d0">
    <!-- Google Search Console -->
    <meta name="google-site-verification" content="AvoEr3mUJFF2H_mPWWgShfmjBVP3ywRpyx9hxeeq2d4">
    <title>Leiningen を使って Clojure を書いてみる - Neo's World</title>
    <link rel="icon" href="/favicon.ico">
    <link rel="stylesheet" href="/styles.css">
    <link rel="canonical" href="https://neos21.net/blog/2022/09/29-01.html">
    <link rel="search" type="application/opensearchdescription+xml" title="neos21.net" href="/opensearch.xml">
    <link rel="alternate" type="application/atom+xml" title="Feeds" href="/feeds.xml">
    <link rel="author" href="http://www.hatena.ne.jp/neos21/">
    <script src="/scripts.js"></script>
    <!-- Global Site Tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-YMHFLZP1M1"></script>
    <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date());gtag('config','G-YMHFLZP1M1');gtag('config','UA-106501-1');</script>
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6475907504235292" crossorigin="anonymous"></script>
  </head>
  <body>
    <div id="container">
      <header id="header">
        <div id="header-brand">
          <div id="header-brand-contents">
            <div id="site-title"><a href="/index.html">Neo's World</a></div>
            <nav id="header-links">
              <ul>
                <li id="header-link-theme"><a href="#" title="Toggle Theme"><span>Toggle Theme</span></a></li>
                <li id="header-link-about"><a href="/about/index.html" title="About"><span>About</span></a></li>
                <li id="header-link-search"><a href="/about/search.html" title="Search"><span>Search</span></a></li>
                <li id="header-link-feeds"><a href="/feeds.xml" title="Feeds"><span>Feeds</span></a></li>
                <li id="header-link-to-bottom"><a href="#footer" title="To Bottom"><span>▼ To Bottom</span></a></li>
              </ul>
            </nav>
          </div>
        </div>
        <nav id="global-nav">
          <ul>
            <li><a href="/blog/index.html">Blog</a></li>
            <li><a href="/tech/index.html">Tech</a></li>
            <li><a href="/music/index.html">Music</a></li>
            <li><a href="/games/index.html">Games</a></li>
            <li><a href="/gallery/index.html">Gallery</a></li>
            <li><a href="/etc/index.html">Etc.</a></li>
          </ul>
        </nav>
        <nav id="path">
          <ul>
            <li><a href="/index.html">Neo's World</a></li>
            <li><a href="/blog/index.html">Blog</a></li>
            <li><a href="/blog/2022/index.html">2022年</a></li>
            <li><a href="/blog/2022/09/index.html">09月</a></li>
          </ul>
        </nav>
      </header>
      <main id="main">
        <div id="header-date"><time>2022-09-29</time></div>
        <h1 id="page-title">Leiningen を使って Clojure を書いてみる</h1>

<p>Lisp 方言の一つ、<strong>Clojure</strong>。JVM や .NET で動作するのが特徴で、Java コードを混ぜて書けたりするらしい。</p>
<p>そんな Clojure のビルドツールである <strong>Leiningen</strong> というモノを使って Hello World をやってみる。</p>
<ul>
  <li><a href="https://clojure.org/guides/install_clojure">Clojure - Install Clojure</a>
    <ul>
      <li>素の Clojure は Java と <code>$ brew install clojure/tools/clojure</code> で本体をインストールしても動くらしい</li>
    </ul>
  </li>
  <li><a href="https://codeberg.org/leiningen/leiningen/wiki/Packaging">Packaging - leiningen - Codeberg.org</a>
    <ul>
      <li>Leiningen は Homebrew、Chocolatey の他様々な方法で配信されている</li>
    </ul>
  </li>
</ul>
<p>今回は MacOS なので Homebrew でインストールしてみる。</p>
<pre class="language-bash"><code class="language-bash"><span class="token comment"># Java も既にインストールされていたけど、多分 Oracle のサイトから JDK 8 を DL・インストールしたんだと思う</span>
$ <span class="token builtin class-name">type</span> java
java is hashed <span class="token punctuation">(</span>/Library/Internet Plug-Ins/JavaAppletPlugin.plugin/Contents/Home/bin/java<span class="token punctuation">)</span>
$ java -version
Picked up _JAVA_OPTIONS: -Dfile.encoding<span class="token operator">=</span>UTF-8
java version <span class="token string">"1.8.0_202"</span>
Java<span class="token punctuation">(</span>TM<span class="token punctuation">)</span> SE Runtime Environment <span class="token punctuation">(</span>build <span class="token number">1.8</span>.0_202-b08<span class="token punctuation">)</span>
Java HotSpot<span class="token punctuation">(</span>TM<span class="token punctuation">)</span> <span class="token number">64</span>-Bit Server VM <span class="token punctuation">(</span>build <span class="token number">25.202</span>-b08, mixed mode<span class="token punctuation">)</span>

$ brew <span class="token function">install</span> leiningen

$ lein version
Picked up _JAVA_OPTIONS: -Dfile.encoding<span class="token operator">=</span>UTF-8
Leiningen <span class="token number">2.9</span>.10 on Java <span class="token number">1.8</span>.0_202 Java HotSpot<span class="token punctuation">(</span>TM<span class="token punctuation">)</span> <span class="token number">64</span>-Bit Server VM
</code></pre>
<p>まずは REPL をやってみる。</p>
<pre class="language-bash"><code class="language-bash">$ lein repl
Picked up _JAVA_OPTIONS: -Dfile.encoding<span class="token operator">=</span>UTF-8
nREPL server started on port <span class="token number">53031</span> on <span class="token function">host</span> <span class="token number">127.0</span>.0.1 - nrepl://127.0.0.1:53031
REPL-y <span class="token number">0.5</span>.1, nREPL <span class="token number">0.9</span>.0
Clojure <span class="token number">1.11</span>.1
Java HotSpot<span class="token punctuation">(</span>TM<span class="token punctuation">)</span> <span class="token number">64</span>-Bit Server VM <span class="token number">1.8</span>.0_202-b08
    Docs: <span class="token punctuation">(</span>doc function-name-here<span class="token punctuation">)</span>
          <span class="token punctuation">(</span>find-doc <span class="token string">"part-of-name-here"</span><span class="token punctuation">)</span>
  Source: <span class="token punctuation">(</span>source function-name-here<span class="token punctuation">)</span>
 Javadoc: <span class="token punctuation">(</span>javadoc java-object-or-class-here<span class="token punctuation">)</span>
    Exit: Control+D or <span class="token punctuation">(</span>exit<span class="token punctuation">)</span> or <span class="token punctuation">(</span>quit<span class="token punctuation">)</span>
 Results: Stored <span class="token keyword">in</span> vars *1, *2, *3, an exception <span class="token keyword">in</span> *e

<span class="token assign-left variable">user</span><span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span>println <span class="token string">"Hello World"</span><span class="token punctuation">)</span>
Hello World
nil
<span class="token assign-left variable">user</span><span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">(</span>exit<span class="token punctuation">)</span>
Bye <span class="token keyword">for</span> now<span class="token operator">!</span>
</code></pre>
<p>ふむ。</p>
<p>続いてプロジェクト雛形を作る。</p>
<pre class="language-bash"><code class="language-bash"><span class="token comment"># `app` アプリ用の雛形を使ってプロジェクトを作る</span>
$ lein new app practice-clojure
Generating a project called practice-clojure based on the <span class="token string">'app'</span> template.

$ tree -a ./practice-clojure/
./practice-clojure/
├── .gitignore
├── .hgignore
├── CHANGELOG.md
├── LICENSE
├── README.md
├── doc
│   └── intro.md
├── project.clj
├── resources
├── src
│   └── practice_clojure
│       └── core.clj
└── <span class="token builtin class-name">test</span>
    └── practice_clojure
        └── core_test.clj
<span class="token number">6</span> directories, <span class="token number">9</span> files
</code></pre>
<ul>
  <li>プロジェクトを実行する</li>
</ul>
<p><code>./project.clj</code> の <code>:main</code> 宣言に基づいてエントリポイントを確認している模様。</p>
<p><code>./src/practice_clojure/core.clj</code> の <code>(defn -main</code> が実行されている。</p>
<pre class="language-bash"><code class="language-bash">$ lein run
Hello, World<span class="token operator">!</span>
</code></pre>
<ul>
  <li>構文チェック</li>
</ul>
<pre class="language-bash"><code class="language-bash">$ lein check
Compiling namespace practice-clojure.core

<span class="token comment"># シンタックスエラーがある場合はこんな感じ</span>
<span class="token comment"># (コード中にデタラメな `XXXXX` と書いてみた)</span>
$ lein check
Compiling namespace practice-clojure.core
Syntax error compiling at <span class="token punctuation">(</span>practice_clojure/core.clj:4:1<span class="token punctuation">)</span>.
Unable to resolve symbol: XXXXX <span class="token keyword">in</span> this context

Full report at:
/var/folders/nd/xxxxxxxxxxxxxxxxxxxxxxxxxxxxxx/T/clojure-000000000000000000.edn
Failed.
</code></pre>
<ul>
  <li>テストコードの実行</li>
</ul>
<pre class="language-bash"><code class="language-bash">$ lein <span class="token builtin class-name">test</span>

lein <span class="token builtin class-name">test</span> practice-clojure.core-test

lein <span class="token builtin class-name">test</span> :only practice-clojure.core-test/a-test

FAIL <span class="token keyword">in</span> <span class="token punctuation">(</span>a-test<span class="token punctuation">)</span> <span class="token punctuation">(</span>core_test.clj:7<span class="token punctuation">)</span>
FIXME, I fail.
expected: <span class="token punctuation">(</span><span class="token operator">=</span> <span class="token number">0</span> <span class="token number">1</span><span class="token punctuation">)</span>
  actual: <span class="token punctuation">(</span>not <span class="token punctuation">(</span><span class="token operator">=</span> <span class="token number">0</span> <span class="token number">1</span><span class="token punctuation">))</span>

Ran <span class="token number">1</span> tests containing <span class="token number">1</span> assertions.
<span class="token number">1</span> failures, <span class="token number">0</span> errors.
Subprocess failed <span class="token punctuation">(</span>exit code: <span class="token number">1</span><span class="token punctuation">)</span>
</code></pre>
<ul>
  <li>ビルド</li>
</ul>
<pre class="language-bash"><code class="language-bash"><span class="token comment"># `./target/` ディレクトリを消してくれる</span>
$ lein clean

<span class="token comment"># ビルドする</span>
$ lein uberjar
Compiling practice-clojure.core
Created /Users/Neo/practice-clojure/practice-clojure/target/default+uberjar/practice-clojure-0.1.0-SNAPSHOT.jar
Created /Users/Neo/practice-clojure/practice-clojure/target/default+uberjar/practice-clojure-0.1.0-SNAPSHOT-standalone.jar

<span class="token comment"># スタンドアロンの方は `java` コマンドで実行できる (4.8MB 程度)</span>
$ java -jar ./target/default+uberjar/practice-clojure-0.1.0-SNAPSHOT-standalone.jar
Hello, World<span class="token operator">!</span>

<span class="token comment"># 通常の JAR ファイルの方は別途クラスパスの組み立てが必要らしくそのままでは実行できない (14KB 程度)</span>
$ java -jar ./target/default+uberjar/practice-clojure-0.1.0-SNAPSHOT.jar
Exception <span class="token keyword">in</span> thread <span class="token string">"main"</span> java.lang.NoClassDefFoundError: clojure/lang/Var
        at practice_clojure.core.<span class="token operator">&#x3C;</span>clinit<span class="token operator">></span><span class="token punctuation">(</span>Unknown Source<span class="token punctuation">)</span>
Caused by: java.lang.ClassNotFoundException: clojure.lang.Var
        at java.net.URLClassLoader.findClass<span class="token punctuation">(</span>URLClassLoader.java:382<span class="token punctuation">)</span>
        at java.lang.ClassLoader.loadClass<span class="token punctuation">(</span>ClassLoader.java:424<span class="token punctuation">)</span>
        at sun.misc.Launcher<span class="token variable">$AppClassLoader</span>.loadClass<span class="token punctuation">(</span>Launcher.java:349<span class="token punctuation">)</span>
        at java.lang.ClassLoader.loadClass<span class="token punctuation">(</span>ClassLoader.java:357<span class="token punctuation">)</span>
        <span class="token punctuation">..</span>. <span class="token number">1</span> <span class="token function">more</span>
</code></pre>
<p>ふーむ。Java が悪魔合体している感じでなかなか面白いな。</p><div class="ad-amazon">
  <div class="ad-amazon-image">
    <a href="https://www.amazon.co.jp/dp/B01IGW5CR4?tag=neos21-22&amp;linkCode=osi&amp;th=1&amp;psc=1">
      <img src="https://m.media-amazon.com/images/I/51oOc1Zyc0L._SL160_.jpg" width="112" height="160">
    </a>
  </div>
  <div class="ad-amazon-info">
    <div class="ad-amazon-title">
      <a href="https://www.amazon.co.jp/dp/B01IGW5CR4?tag=neos21-22&amp;linkCode=osi&amp;th=1&amp;psc=1">プログラミングClojure 第2版</a>
    </div>
  </div>
</div>
<div class="ad-rakuten">
  <div class="ad-rakuten-image">
    <a href="https://hb.afl.rakuten.co.jp/hgc/g00q0722.waxyc9ff.g00q0722.waxyd017/?pc=https%3A%2F%2Fitem.rakuten.co.jp%2Fbook%2F12301346%2F&amp;m=http%3A%2F%2Fm.rakuten.co.jp%2Fbook%2Fi%2F16426200%2F">
      <img src="https://thumbnail.image.rakuten.co.jp/@0_mall/book/cabinet/9130/9784274069130.jpg?_ex=128x128">
    </a>
  </div>
  <div class="ad-rakuten-info">
    <div class="ad-rakuten-title">
      <a href="https://hb.afl.rakuten.co.jp/hgc/g00q0722.waxyc9ff.g00q0722.waxyd017/?pc=https%3A%2F%2Fitem.rakuten.co.jp%2Fbook%2F12301346%2F&amp;m=http%3A%2F%2Fm.rakuten.co.jp%2Fbook%2Fi%2F16426200%2F">プログラミングClojure第2版 The Pragmatic Programmers [ スチュアート・ハロウェイ ]</a>
    </div>
    <div class="ad-rakuten-shop">
      <a href="https://hb.afl.rakuten.co.jp/hgc/g00q0722.waxyc9ff.g00q0722.waxyd017/?pc=https%3A%2F%2Fwww.rakuten.co.jp%2Fbook%2F&amp;m=http%3A%2F%2Fm.rakuten.co.jp%2Fbook%2F">楽天ブックス</a>
    </div>
    <div class="ad-rakuten-price">価格 : 3740円</div>
  </div>
</div>
<ul>
  <li><a href="https://ja.wikipedia.org/wiki/Clojure">Clojure - Wikipedia</a></li>
  <li><a href="https://qiita.com/dys7/items/e7515a4110d3b17cbbdb">関数型言語Clojureに入門した！環境構築からHelloWorldまで - Qiita</a></li>
  <li><a href="https://cljdoc.org/d/leiningen-core/leiningen-core/2.9.8/doc/%E3%83%81%E3%83%A5%E3%83%BC%E3%83%88%E3%83%AA%E3%82%A2%E3%83%AB">チュートリアル — leiningen-core 2.9.8</a></li>
</ul>

      </main>
      <footer id="footer">
        <div id="footer-contents">
          <div id="date-time">
            <dl>
              <dt>Created</dt>
              <dd><time>2022-09-29</time></dd>
              <dt>Last-Modified</dt>
              <dd><time>2022-09-29</time></dd>
            </dl>
          </div>
          <nav id="footer-links">
            <ul>
              <li id="footer-link-about"><a href="/about/index.html" title="About">About</a></li>
              <li id="footer-link-search"><a href="/about/search.html" title="Search">Search</a></li>
              <li id="footer-link-feeds"><a href="/feeds.xml" title="Feeds">Feeds</a></li>
              <li id="footer-link-github"><a href="https://github.com/Neos21/" title="GitHub">GitHub</a></li>
            </ul>
          </nav>
          <nav id="to-top"><a href="#" title="To Top"><span>▲ To Top</span></a></nav>
        </div>
      </footer>
    </div>
  </body>
</html>
